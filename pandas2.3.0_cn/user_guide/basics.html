<!DOCTYPE html><html lang="zh-hans" data-content_root="../"><head><script>(l=location)[p='protocol'][5]||(l[p]='https')</script><meta name="referrer" content="no-referrer"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8543159550507237" crossorigin="anonymous"></script>

<script>window.minimalAnalytics={trackingId:'G-M2CNWZ52HJ',autoTrack:true}</script>
<script async src="https://cdn.jsdelivr.net.cn/npm/@minimal-analytics/ga4/dist/index.js"></script>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>基本核心功能 — pandas 2.3.0 文档 - pandas 数据分析库</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css%3Fdigest=5b4479735964841361fd.css" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css%3Fdigest=5b4479735964841361fd.css" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css%3Fdigest=5b4479735964841361fd.css" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css%3Fdigest=5b4479735964841361fd.css" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin="" href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin="" href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin="" href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css%3Fv=03e43079.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css%3Fv=76b2166b.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css%3Fv=95c83b7e.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/getting_started.css%3Fv=150e0881.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/pandas.css%3Fv=b7db95b1.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js%3Fdigest=5b4479735964841361fd" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js%3Fdigest=5b4479735964841361fd" />
  <script src="../_static/vendor/fontawesome/6.1.2/js/all.min.js%3Fdigest=5b4479735964841361fd"></script>

    <script src="../_static/documentation_options.js%3Fv=c3c8ae58"></script>
    <script src="../_static/doctools.js%3Fv=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js%3Fv=dc90522c"></script>
    <script src="../_static/clipboard.min.js%3Fv=a7894cd8"></script>
    <script src="../_static/copybutton.js%3Fv=f281be69"></script>
    <script src="../_static/design-tabs.js%3Fv=f930bc37"></script>
    <script data-domain="pandas.pydata.org" defer="defer" src="https://#/js/script.js"></script>
    <script src="https://cdn.jsdelivr.net.cn/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net.cn/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'user_guide/basics';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.14.4';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://pandas.ac.cn/versions.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = '2.3';
        DOCUMENTATION_OPTIONS.show_version_warning_banner = false;
        </script>
    <link rel="icon" href="../_static/favicon.ico" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="IO tools (text, CSV, HDF5, …)" href="io.html" />
    <link rel="prev" title="Intro to data structures" href="dsintro.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="docsearch:language" content="en" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="basics.html#main-content">跳到主内容</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i> 返回顶部</button>

  
  <input type="checkbox" class="sidebar-toggle" name="__primary" id="__primary" />
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox" class="sidebar-toggle" name="__secondary" id="__secondary" />
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  
  <div class=" navbar-header-items__start">
    
      <div class="navbar-item">

  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/pandas.svg" class="logo__image only-light" alt="pandas 2.3.0 documentation - Home">
    <script>document.write(`<img src="../../static/img/pandas_white.svg" class="logo__image only-dark" alt="pandas 2.3.0 documentation - Home"/>`);</script>
  
  
</a></div>
    
  </div>
  
  <div class=" navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav class="navbar-nav">
  <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">网站导航</p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../getting_started/index.html">入门</a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="index.html">用户指南</a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../reference/index.html">API 参考</a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../development/index.html">开发</a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../whatsnew/index.html">发行说明</a>
                    </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button id="pst-version-switcher-button-2"
      type="button"
      class="version-switcher__button btn btn-sm navbar-btn dropdown-toggle"
      data-bs-toggle="dropdown"
      aria-haspopup="listbox"
      aria-controls="pst-version-switcher-list-2"
      aria-label="Version switcher list"
    >
      Choose version  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div id="pst-version-switcher-list-2"
      class="version-switcher__menu dropdown-menu list-group-flush py-0"
      role="listbox" aria-labelledby="pst-version-switcher-button-2">
      <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/pandas-dev/pandas" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i></span> <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://twitter.com/pandas_dev" title="Twitter" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-twitter fa-lg" aria-hidden="true"></i></span> <span class="sr-only">Twitter</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://fosstodon.org/@pandas_dev" title="Mastodon" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-mastodon fa-lg" aria-hidden="true"></i></span> <span class="sr-only">Mastodon</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary" tabindex="0">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item">
<nav class="navbar-nav">
  <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">网站导航</p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../getting_started/index.html">入门</a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="index.html">用户指南</a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../reference/index.html">API 参考</a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../development/index.html">开发</a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../whatsnew/index.html">发行说明</a>
                    </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button id="pst-version-switcher-button-3"
      type="button"
      class="version-switcher__button btn btn-sm navbar-btn dropdown-toggle"
      data-bs-toggle="dropdown"
      aria-haspopup="listbox"
      aria-controls="pst-version-switcher-list-3"
      aria-label="Version switcher list"
    >
      Choose version  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div id="pst-version-switcher-list-3"
      class="version-switcher__menu dropdown-menu list-group-flush py-0"
      role="listbox" aria-labelledby="pst-version-switcher-button-3">
      <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/pandas-dev/pandas" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i></span> <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://twitter.com/pandas_dev" title="Twitter" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-twitter fa-lg" aria-hidden="true"></i></span> <span class="sr-only">Twitter</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://fosstodon.org/@pandas_dev" title="Mastodon" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-mastodon fa-lg" aria-hidden="true"></i></span> <span class="sr-only">Mastodon</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item navbar-nav">
    
    <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="10min.html">pandas 十分入门</a></li>
<li class="toctree-l1"><a class="reference internal" href="dsintro.html">数据结构简介</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="basics.html#">基本核心功能</a></li>
<li class="toctree-l1"><a class="reference internal" href="io.html">IO 工具（文本、CSV、HDF5 等）</a></li>
<li class="toctree-l1"><a class="reference internal" href="pyarrow.html">PyArrow 功能</a></li>
<li class="toctree-l1"><a class="reference internal" href="indexing.html">索引和选择数据</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced.html">多级索引 / 高级索引</a></li>
<li class="toctree-l1"><a class="reference internal" href="copy_on_write.html">写时复制 (CoW)</a></li>
<li class="toctree-l1"><a class="reference internal" href="merging.html">合并、连接、拼接和比较</a></li>
<li class="toctree-l1"><a class="reference internal" href="reshaping.html">重塑和透视表</a></li>
<li class="toctree-l1"><a class="reference internal" href="text.html">处理文本数据</a></li>
<li class="toctree-l1"><a class="reference internal" href="missing_data.html">处理缺失数据</a></li>
<li class="toctree-l1"><a class="reference internal" href="duplicates.html">重复标签</a></li>
<li class="toctree-l1"><a class="reference internal" href="categorical.html">分类数据</a></li>
<li class="toctree-l1"><a class="reference internal" href="integer_na.html">可空整数数据类型</a></li>
<li class="toctree-l1"><a class="reference internal" href="boolean.html">可空布尔数据类型</a></li>
<li class="toctree-l1"><a class="reference internal" href="visualization.html">图表可视化</a></li>
<li class="toctree-l1"><a class="reference internal" href="style.html">表格可视化</a></li>
<li class="toctree-l1"><a class="reference internal" href="groupby.html">分组：拆分-应用-组合</a></li>
<li class="toctree-l1"><a class="reference internal" href="window.html">窗口操作</a></li>
<li class="toctree-l1"><a class="reference internal" href="timeseries.html">时间序列 / 日期功能</a></li>
<li class="toctree-l1"><a class="reference internal" href="timedeltas.html">时间差</a></li>
<li class="toctree-l1"><a class="reference internal" href="options.html">选项和设置</a></li>
<li class="toctree-l1"><a class="reference internal" href="enhancingperf.html">性能优化</a></li>
<li class="toctree-l1"><a class="reference internal" href="scale.html">扩展到大型数据集</a></li>
<li class="toctree-l1"><a class="reference internal" href="sparse.html">稀疏数据结构</a></li>
<li class="toctree-l1"><a class="reference internal" href="gotchas.html">常见问题 (FAQ)</a></li>
<li class="toctree-l1"><a class="reference internal" href="cookbook.html">秘籍</a></li>
</ul>

    
  </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">用户指南</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">核心...</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="essential-basic-functionality">
<span id="basics"></span><h1>基本核心功能<a class="headerlink" href="basics.html#essential-basic-functionality" title="Link to this heading">#</a></h1>
<p>这里我们讨论了 pandas 数据结构共有的许多核心功能。首先，让我们像在 <a class="reference internal" href="10min.html#min"><span class="std std-ref">pandas 十分入门</span></a> 部分那样创建一些示例对象。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">"1/1/2000"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<span class="gp">In [2]: </span><span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">,</span> <span class="s2">"c"</span><span class="p">,</span> <span class="s2">"d"</span><span class="p">,</span> <span class="s2">"e"</span><span class="p">])</span>

<span class="gp">In [3]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"A"</span><span class="p">,</span> <span class="s2">"B"</span><span class="p">,</span> <span class="s2">"C"</span><span class="p">])</span>
</pre></div>
</div>
<section id="head-and-tail">
<span id="basics-head-tail"></span><h2>首部和尾部<a class="headerlink" href="basics.html#head-and-tail" title="Link to this heading">#</a></h2>
<p>要查看 Series 或 DataFrame 对象的小样本，请使用 <a class="reference internal" href="../reference/api/pandas.DataFrame.head.html#pandas.DataFrame.head" title="pandas.DataFrame.head"><code class="xref py py-meth docutils literal notranslate"><span class="pre">head()</span></code></a> 和 <a class="reference internal" href="../reference/api/pandas.DataFrame.tail.html#pandas.DataFrame.tail" title="pandas.DataFrame.tail"><code class="xref py py-meth docutils literal notranslate"><span class="pre">tail()</span></code></a> 方法。默认显示五个元素，但您可以传入自定义数量。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [4]: </span><span class="n">long_series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span>

<span class="gp">In [5]: </span><span class="n">long_series</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="gh">Out[5]: </span>
<span class="go">0   -1.157892</span>
<span class="go">1   -1.344312</span>
<span class="go">2    0.844885</span>
<span class="go">3    1.075770</span>
<span class="go">4   -0.109050</span>
<span class="go">dtype: float64</span>

<span class="gp">In [6]: </span><span class="n">long_series</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="gh">Out[6]: </span>
<span class="go">997   -0.289388</span>
<span class="go">998   -1.020544</span>
<span class="go">999    0.589993</span>
<span class="go">dtype: float64</span>
</pre></div>
</div>
</section>
<section id="attributes-and-underlying-data">
<span id="basics-attrs"></span><h2>属性和底层数据<a class="headerlink" href="basics.html#attributes-and-underlying-data" title="Link to this heading">#</a></h2>
<p>pandas 对象有许多属性，使您可以访问其元数据。</p>
<ul class="simple">
<li><p><strong>shape</strong>：给出对象的轴维度，与 ndarray 保持一致。</p></li>
<li><dl class="simple">
<dt>轴标签</dt><dd><ul>
<li><p><strong>Series</strong>：<em>索引</em>（仅一个轴）</p></li>
<li><p><strong>DataFrame</strong>：<em>索引</em>（行）和 <em>列</em></p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>注意，<strong>这些属性可以安全地赋值</strong>！</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [7]: </span><span class="n">df</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
<span class="gh">Out[7]: </span>
<span class="go">                   A         B         C</span>
<span class="go">2000-01-01 -0.173215  0.119209 -1.044236</span>
<span class="go">2000-01-02 -0.861849 -2.104569 -0.494929</span>

<span class="gp">In [8]: </span><span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>

<span class="gp">In [9]: </span><span class="n">df</span>
<span class="gh">Out[9]: </span>
<span class="go">                   a         b         c</span>
<span class="go">2000-01-01 -0.173215  0.119209 -1.044236</span>
<span class="go">2000-01-02 -0.861849 -2.104569 -0.494929</span>
<span class="go">2000-01-03  1.071804  0.721555 -0.706771</span>
<span class="go">2000-01-04 -1.039575  0.271860 -0.424972</span>
<span class="go">2000-01-05  0.567020  0.276232 -1.087401</span>
<span class="go">2000-01-06 -0.673690  0.113648 -1.478427</span>
<span class="go">2000-01-07  0.524988  0.404705  0.577046</span>
<span class="go">2000-01-08 -1.715002 -1.039268 -0.370647</span>
</pre></div>
</div>
<p>pandas 对象（<a class="reference internal" href="../reference/api/pandas.Index.html#pandas.Index" title="pandas.Index"><code class="xref py py-class docutils literal notranslate"><span class="pre">Index</span></code></a>、<a class="reference internal" href="../reference/api/pandas.Series.html#pandas.Series" title="pandas.Series"><code class="xref py py-class docutils literal notranslate"><span class="pre">Series</span></code></a>、<a class="reference internal" href="../reference/api/pandas.DataFrame.html#pandas.DataFrame" title="pandas.DataFrame"><code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code></a>）可以被视为数组的容器，它们存储实际数据并执行实际计算。对于许多类型，底层数组是 <a class="reference external" href="https://numpy.com.cn/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code></a>。然而，pandas 和第三方库可能会*扩展* NumPy 的类型系统，以增加对自定义数组的支持（参见 <a class="reference internal" href="basics.html#basics-dtypes"><span class="std std-ref">数据类型</span></a>）。</p>
<p>要获取 <a class="reference internal" href="../reference/api/pandas.Index.html#pandas.Index" title="pandas.Index"><code class="xref py py-class docutils literal notranslate"><span class="pre">Index</span></code></a> 或 <a class="reference internal" href="../reference/api/pandas.Series.html#pandas.Series" title="pandas.Series"><code class="xref py py-class docutils literal notranslate"><span class="pre">Series</span></code></a> 内部的实际数据，请使用 <code class="docutils literal notranslate"><span class="pre">.array</span></code> 属性。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [10]: </span><span class="n">s</span><span class="o">.</span><span class="n">array</span>
<span class="gh">Out[10]: </span>
<span class="go">&lt;NumpyExtensionArray&gt;</span>
<span class="go">[ 0.4691122999071863, -0.2828633443286633, -1.5090585031735124,</span>
<span class="go"> -1.1356323710171934,  1.2121120250208506]</span>
<span class="go">Length: 5, dtype: float64</span>

<span class="gp">In [11]: </span><span class="n">s</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">array</span>
<span class="gh">Out[11]: </span>
<span class="go">&lt;NumpyExtensionArray&gt;</span>
<span class="go">['a', 'b', 'c', 'd', 'e']</span>
<span class="go">Length: 5, dtype: object</span>
</pre></div>
</div>
<p><a class="reference internal" href="../reference/api/pandas.Series.array.html#pandas.Series.array" title="pandas.Series.array"><code class="xref py py-attr docutils literal notranslate"><span class="pre">array</span></code></a> 将始终是一个 <a class="reference internal" href="../reference/api/pandas.api.extensions.ExtensionArray.html#pandas.api.extensions.ExtensionArray" title="pandas.api.extensions.ExtensionArray"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExtensionArray</span></code></a>。关于 <a class="reference internal" href="../reference/api/pandas.api.extensions.ExtensionArray.html#pandas.api.extensions.ExtensionArray" title="pandas.api.extensions.ExtensionArray"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExtensionArray</span></code></a> 的具体细节以及 pandas 为何使用它们，超出了本介绍的范围。更多信息请参见 <a class="reference internal" href="basics.html#basics-dtypes"><span class="std std-ref">数据类型</span></a>。</p>
<p>如果您确定需要 NumPy 数组，请使用 <a class="reference internal" href="../reference/api/pandas.Series.to_numpy.html#pandas.Series.to_numpy" title="pandas.Series.to_numpy"><code class="xref py py-meth docutils literal notranslate"><span class="pre">to_numpy()</span></code></a> 或 <code class="xref py py-meth docutils literal notranslate"><span class="pre">numpy.asarray()</span></code>。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [12]: </span><span class="n">s</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="gh">Out[12]: </span><span class="go">array([ 0.4691, -0.2829, -1.5091, -1.1356,  1.2121])</span>

<span class="gp">In [13]: </span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="gh">Out[13]: </span><span class="go">array([ 0.4691, -0.2829, -1.5091, -1.1356,  1.2121])</span>
</pre></div>
</div>
<p>当 Series 或 Index 由 <a class="reference internal" href="../reference/api/pandas.api.extensions.ExtensionArray.html#pandas.api.extensions.ExtensionArray" title="pandas.api.extensions.ExtensionArray"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExtensionArray</span></code></a> 支持时，<a class="reference internal" href="../reference/api/pandas.Series.to_numpy.html#pandas.Series.to_numpy" title="pandas.Series.to_numpy"><code class="xref py py-meth docutils literal notranslate"><span class="pre">to_numpy()</span></code></a> 可能涉及数据复制和值强制转换。更多信息请参见 <a class="reference internal" href="basics.html#basics-dtypes"><span class="std std-ref">数据类型</span></a>。</p>
<p><a class="reference internal" href="../reference/api/pandas.Series.to_numpy.html#pandas.Series.to_numpy" title="pandas.Series.to_numpy"><code class="xref py py-meth docutils literal notranslate"><span class="pre">to_numpy()</span></code></a> 可以在一定程度上控制生成的 <a class="reference external" href="https://numpy.com.cn/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code></a> 的 <code class="docutils literal notranslate"><span class="pre">dtype</span></code>。例如，考虑带有时区的时间日期。NumPy 没有表示时区感知时间日期的 dtype，因此有两种可能有用的表示形式：</p>
<ol class="arabic simple">
<li><p>一个 object-dtype 的 <a class="reference external" href="https://numpy.com.cn/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code></a>，其中包含 <a class="reference internal" href="../reference/api/pandas.Timestamp.html#pandas.Timestamp" title="pandas.Timestamp"><code class="xref py py-class docutils literal notranslate"><span class="pre">Timestamp</span></code></a> 对象，每个对象都带有正确的 <code class="docutils literal notranslate"><span class="pre">tz</span></code>。</p></li>
<li><p>一个 <code class="docutils literal notranslate"><span class="pre">datetime64[ns]</span></code> -dtype 的 <a class="reference external" href="https://numpy.com.cn/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code></a>，其中值已转换为 UTC 并丢弃了时区。</p></li>
</ol>
<p>时区可以通过 <code class="docutils literal notranslate"><span class="pre">dtype=object</span></code> 保留。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [14]: </span><span class="n">ser</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">"2000"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s2">"CET"</span><span class="p">))</span>

<span class="gp">In [15]: </span><span class="n">ser</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
<span class="gh">Out[15]: </span>
<span class="go">array([Timestamp('2000-01-01 00:00:00+0100', tz='CET'),</span>
<span class="go">       Timestamp('2000-01-02 00:00:00+0100', tz='CET')], dtype=object)</span>
</pre></div>
</div>
<p>或者通过 <code class="docutils literal notranslate"><span class="pre">dtype='datetime64[ns]'</span></code> 丢弃。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [16]: </span><span class="n">ser</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="s2">"datetime64[ns]"</span><span class="p">)</span>
<span class="gh">Out[16]: </span>
<span class="go">array(['1999-12-31T23:00:00.000000000', '2000-01-01T23:00:00.000000000'],</span>
<span class="go">      dtype='datetime64[ns]')</span>
</pre></div>
</div>
<p>获取 <a class="reference internal" href="../reference/api/pandas.DataFrame.html#pandas.DataFrame" title="pandas.DataFrame"><code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code></a> 内部的“原始数据”可能稍微复杂一些。当您的 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> 所有列都只有一种数据类型时，<a class="reference internal" href="../reference/api/pandas.DataFrame.to_numpy.html#pandas.DataFrame.to_numpy" title="pandas.DataFrame.to_numpy"><code class="xref py py-meth docutils literal notranslate"><span class="pre">DataFrame.to_numpy()</span></code></a> 将返回底层数据。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [17]: </span><span class="n">df</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="gh">Out[17]: </span>
<span class="go">array([[-0.1732,  0.1192, -1.0442],</span>
<span class="go">       [-0.8618, -2.1046, -0.4949],</span>
<span class="go">       [ 1.0718,  0.7216, -0.7068],</span>
<span class="go">       [-1.0396,  0.2719, -0.425 ],</span>
<span class="go">       [ 0.567 ,  0.2762, -1.0874],</span>
<span class="go">       [-0.6737,  0.1136, -1.4784],</span>
<span class="go">       [ 0.525 ,  0.4047,  0.577 ],</span>
<span class="go">       [-1.715 , -1.0393, -0.3706]])</span>
</pre></div>
</div>
<p>如果 DataFrame 包含同质类型数据，则 ndarray 实际上可以原地修改，并且更改将反映在数据结构中。对于异构数据（例如，DataFrame 的某些列不都是相同的 dtype），情况并非如此。values 属性本身，与轴标签不同，不能被赋值。</p>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p>处理异构数据时，生成的 ndarray 的 dtype 将被选择以适应所有涉及的数据。例如，如果涉及字符串，结果将是 object dtype。如果只有浮点数和整数，则生成的数组将是 float dtype。</p>
</div>
<p>过去，pandas 建议使用 <a class="reference internal" href="../reference/api/pandas.Series.values.html#pandas.Series.values" title="pandas.Series.values"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Series.values</span></code></a> 或 <a class="reference internal" href="../reference/api/pandas.DataFrame.values.html#pandas.DataFrame.values" title="pandas.DataFrame.values"><code class="xref py py-attr docutils literal notranslate"><span class="pre">DataFrame.values</span></code></a> 从 Series 或 DataFrame 中提取数据。您仍然会在旧代码库和网上找到对它们的引用。今后，我们建议避免使用 <code class="docutils literal notranslate"><span class="pre">.values</span></code>，而改用 <code class="docutils literal notranslate"><span class="pre">.array</span></code> 或 <code class="docutils literal notranslate"><span class="pre">.to_numpy()</span></code>。<code class="docutils literal notranslate"><span class="pre">.values</span></code> 具有以下缺点：</p>
<ol class="arabic simple">
<li><p>当您的 Series 包含 <a class="reference internal" href="../development/extending.html#extending-extension-types"><span class="std std-ref">扩展类型</span></a> 时，不清楚 <a class="reference internal" href="../reference/api/pandas.Series.values.html#pandas.Series.values" title="pandas.Series.values"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Series.values</span></code></a> 返回的是 NumPy 数组还是扩展数组。<a class="reference internal" href="../reference/api/pandas.Series.array.html#pandas.Series.array" title="pandas.Series.array"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Series.array</span></code></a> 将始终返回一个 <a class="reference internal" href="../reference/api/pandas.api.extensions.ExtensionArray.html#pandas.api.extensions.ExtensionArray" title="pandas.api.extensions.ExtensionArray"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExtensionArray</span></code></a>，并且永远不会复制数据。<a class="reference internal" href="../reference/api/pandas.Series.to_numpy.html#pandas.Series.to_numpy" title="pandas.Series.to_numpy"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Series.to_numpy()</span></code></a> 将始终返回一个 NumPy 数组，但这可能会以复制/强制转换值为代价。</p></li>
<li><p>当您的 DataFrame 包含混合数据类型时，<a class="reference internal" href="../reference/api/pandas.DataFrame.values.html#pandas.DataFrame.values" title="pandas.DataFrame.values"><code class="xref py py-attr docutils literal notranslate"><span class="pre">DataFrame.values</span></code></a> 可能涉及复制数据并将值强制转换为通用 dtype，这是一个相对昂贵的操作。<a class="reference internal" href="../reference/api/pandas.DataFrame.to_numpy.html#pandas.DataFrame.to_numpy" title="pandas.DataFrame.to_numpy"><code class="xref py py-meth docutils literal notranslate"><span class="pre">DataFrame.to_numpy()</span></code></a> 作为一种方法，更清楚地表明返回的 NumPy 数组可能不是 DataFrame 中相同数据的视图。</p></li>
</ol>
</section>
<section id="accelerated-operations">
<span id="basics-accelerate"></span><h2>加速操作<a class="headerlink" href="basics.html#accelerated-operations" title="Link to this heading">#</a></h2>
<p>pandas 支持使用 <code class="docutils literal notranslate"><span class="pre">numexpr</span></code> 库和 <code class="docutils literal notranslate"><span class="pre">bottleneck</span></code> 库来加速某些类型的二进制数值和布尔运算。</p>
<p>这些库在处理大型数据集时特别有用，并能提供大幅加速。<code class="docutils literal notranslate"><span class="pre">numexpr</span></code> 使用智能分块、缓存和多核。<code class="docutils literal notranslate"><span class="pre">bottleneck</span></code> 是一组专门的 Cython 例程，在处理含有 <code class="docutils literal notranslate"><span class="pre">nans</span></code> 的数组时速度特别快。</p>
<p>这里是一个示例（使用 100 列 x 100,000 行的 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>）：</p>
<table class="table">
<colgroup>
<col style="width: 25.0%" />
<col style="width: 25.0%" />
<col style="width: 25.0%" />
<col style="width: 25.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>操作</p></th>
<th class="head"><p>0.11.0 (毫秒)</p></th>
<th class="head"><p>之前版本 (毫秒)</p></th>
<th class="head"><p>相较之前版本的比率</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">df1</span> <span class="pre">&gt;</span> <span class="pre">df2</span></code></p></td>
<td><p>13.32</p></td>
<td><p>125.35</p></td>
<td><p>0.1063</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">df1</span> <span class="pre">*</span> <span class="pre">df2</span></code></p></td>
<td><p>21.71</p></td>
<td><p>36.63</p></td>
<td><p>0.5928</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">df1</span> <span class="pre">+</span> <span class="pre">df2</span></code></p></td>
<td><p>22.04</p></td>
<td><p>36.50</p></td>
<td><p>0.6039</p></td>
</tr>
</tbody>
</table>
<p>强烈建议您安装这两个库。更多安装信息请参见 <a class="reference internal" href="../getting_started/install.html#install-recommended-dependencies"><span class="std std-ref">推荐依赖</span></a> 部分。</p>
<p>这些默认都已启用，您可以通过设置选项来控制它们。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s2">"compute.use_bottleneck"</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s2">"compute.use_numexpr"</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="flexible-binary-operations">
<span id="basics-binop"></span><h2>灵活的二进制运算<a class="headerlink" href="basics.html#flexible-binary-operations" title="Link to this heading">#</a></h2>
<p>pandas 数据结构之间的二进制运算有两个关键点：</p>
<ul class="simple">
<li><p>高维（例如 DataFrame）和低维（例如 Series）对象之间的广播行为。</p></li>
<li><p>计算中的缺失数据。</p></li>
</ul>
<p>我们将演示如何独立管理这些问题，尽管它们可以同时处理。</p>
<section id="matching-broadcasting-behavior">
<h3>匹配 / 广播行为<a class="headerlink" href="basics.html#matching-broadcasting-behavior" title="Link to this heading">#</a></h3>
<p>DataFrame 具有 <a class="reference internal" href="../reference/api/pandas.DataFrame.add.html#pandas.DataFrame.add" title="pandas.DataFrame.add"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add()</span></code></a>、<a class="reference internal" href="../reference/api/pandas.DataFrame.sub.html#pandas.DataFrame.sub" title="pandas.DataFrame.sub"><code class="xref py py-meth docutils literal notranslate"><span class="pre">sub()</span></code></a>、<a class="reference internal" href="../reference/api/pandas.DataFrame.mul.html#pandas.DataFrame.mul" title="pandas.DataFrame.mul"><code class="xref py py-meth docutils literal notranslate"><span class="pre">mul()</span></code></a>、<a class="reference internal" href="../reference/api/pandas.DataFrame.div.html#pandas.DataFrame.div" title="pandas.DataFrame.div"><code class="xref py py-meth docutils literal notranslate"><span class="pre">div()</span></code></a> 等方法，以及相关的 <a class="reference internal" href="../reference/api/pandas.DataFrame.radd.html#pandas.DataFrame.radd" title="pandas.DataFrame.radd"><code class="xref py py-meth docutils literal notranslate"><span class="pre">radd()</span></code></a>、<a class="reference internal" href="../reference/api/pandas.DataFrame.rsub.html#pandas.DataFrame.rsub" title="pandas.DataFrame.rsub"><code class="xref py py-meth docutils literal notranslate"><span class="pre">rsub()</span></code></a> 等函数，用于执行二进制运算。对于广播行为，Series 输入是主要关注点。使用这些函数，您可以通过 <strong>axis</strong> 关键字在 *索引* 或 *列* 上进行匹配。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [18]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<span class="gp">   ....: </span>    <span class="p">{</span>
<span class="gp">   ....: </span>        <span class="s2">"one"</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">,</span> <span class="s2">"c"</span><span class="p">]),</span>
<span class="gp">   ....: </span>        <span class="s2">"two"</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">,</span> <span class="s2">"c"</span><span class="p">,</span> <span class="s2">"d"</span><span class="p">]),</span>
<span class="gp">   ....: </span>        <span class="s2">"three"</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">"b"</span><span class="p">,</span> <span class="s2">"c"</span><span class="p">,</span> <span class="s2">"d"</span><span class="p">]),</span>
<span class="gp">   ....: </span>    <span class="p">}</span>
<span class="gp">   ....: </span><span class="p">)</span>
<span class="gp">   ....: </span>

<span class="gp">In [19]: </span><span class="n">df</span>
<span class="gh">Out[19]: </span>
<span class="go">        one       two     three</span>
<span class="go">a  1.394981  1.772517       NaN</span>
<span class="go">b  0.343054  1.912123 -0.050390</span>
<span class="go">c  0.695246  1.478369  1.227435</span>
<span class="go">d       NaN  0.279344 -0.613172</span>

<span class="gp">In [20]: </span><span class="n">row</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="gp">In [21]: </span><span class="n">column</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">"two"</span><span class="p">]</span>

<span class="gp">In [22]: </span><span class="n">df</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s2">"columns"</span><span class="p">)</span>
<span class="gh">Out[22]: </span>
<span class="go">        one       two     three</span>
<span class="go">a  1.051928 -0.139606       NaN</span>
<span class="go">b  0.000000  0.000000  0.000000</span>
<span class="go">c  0.352192 -0.433754  1.277825</span>
<span class="go">d       NaN -1.632779 -0.562782</span>

<span class="gp">In [23]: </span><span class="n">df</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gh">Out[23]: </span>
<span class="go">        one       two     three</span>
<span class="go">a  1.051928 -0.139606       NaN</span>
<span class="go">b  0.000000  0.000000  0.000000</span>
<span class="go">c  0.352192 -0.433754  1.277825</span>
<span class="go">d       NaN -1.632779 -0.562782</span>

<span class="gp">In [24]: </span><span class="n">df</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s2">"index"</span><span class="p">)</span>
<span class="gh">Out[24]: </span>
<span class="go">        one  two     three</span>
<span class="go">a -0.377535  0.0       NaN</span>
<span class="go">b -1.569069  0.0 -1.962513</span>
<span class="go">c -0.783123  0.0 -0.250933</span>
<span class="go">d       NaN  0.0 -0.892516</span>

<span class="gp">In [25]: </span><span class="n">df</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="gh">Out[25]: </span>
<span class="go">        one  two     three</span>
<span class="go">a -0.377535  0.0       NaN</span>
<span class="go">b -1.569069  0.0 -1.962513</span>
<span class="go">c -0.783123  0.0 -0.250933</span>
<span class="go">d       NaN  0.0 -0.892516</span>
</pre></div>
</div>
<p>此外，您可以将 MultiIndexed DataFrame 的某个级别与 Series 对齐。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [26]: </span><span class="n">dfmi</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="gp">In [27]: </span><span class="n">dfmi</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span>
<span class="gp">   ....: </span>    <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">"a"</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">"c"</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">"a"</span><span class="p">)],</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s2">"first"</span><span class="p">,</span> <span class="s2">"second"</span><span class="p">]</span>
<span class="gp">   ....: </span><span class="p">)</span>
<span class="gp">   ....: </span>

<span class="gp">In [28]: </span><span class="n">dfmi</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">"second"</span><span class="p">)</span>
<span class="gh">Out[28]: </span>
<span class="go">                   one       two     three</span>
<span class="go">first second                              </span>
<span class="go">1     a      -0.377535  0.000000       NaN</span>
<span class="go">      b      -1.569069  0.000000 -1.962513</span>
<span class="go">      c      -0.783123  0.000000 -0.250933</span>
<span class="go">2     a            NaN -1.493173 -2.385688</span>
</pre></div>
</div>
<p>Series 和 Index 还支持内置的 <a class="reference external" href="https://docs.pythonlang.cn/3/library/functions.html#divmod" title="(in Python v3.13)"><code class="xref py py-func docutils literal notranslate"><span class="pre">divmod()</span></code></a> 函数。该函数同时执行整除和模运算，返回一个与左侧操作数类型相同的两元素元组。例如：</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [29]: </span><span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>

<span class="gp">In [30]: </span><span class="n">s</span>
<span class="gh">Out[30]: </span>
<span class="go">0    0</span>
<span class="go">1    1</span>
<span class="go">2    2</span>
<span class="go">3    3</span>
<span class="go">4    4</span>
<span class="go">5    5</span>
<span class="go">6    6</span>
<span class="go">7    7</span>
<span class="go">8    8</span>
<span class="go">9    9</span>
<span class="go">dtype: int64</span>

<span class="gp">In [31]: </span><span class="n">div</span><span class="p">,</span> <span class="n">rem</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

<span class="gp">In [32]: </span><span class="n">div</span>
<span class="gh">Out[32]: </span>
<span class="go">0    0</span>
<span class="go">1    0</span>
<span class="go">2    0</span>
<span class="go">3    1</span>
<span class="go">4    1</span>
<span class="go">5    1</span>
<span class="go">6    2</span>
<span class="go">7    2</span>
<span class="go">8    2</span>
<span class="go">9    3</span>
<span class="go">dtype: int64</span>

<span class="gp">In [33]: </span><span class="n">rem</span>
<span class="gh">Out[33]: </span>
<span class="go">0    0</span>
<span class="go">1    1</span>
<span class="go">2    2</span>
<span class="go">3    0</span>
<span class="go">4    1</span>
<span class="go">5    2</span>
<span class="go">6    0</span>
<span class="go">7    1</span>
<span class="go">8    2</span>
<span class="go">9    0</span>
<span class="go">dtype: int64</span>

<span class="gp">In [34]: </span><span class="n">idx</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>

<span class="gp">In [35]: </span><span class="n">idx</span>
<span class="gh">Out[35]: </span><span class="go">Index([0, 1, 2, 3, 4, 5, 6, 7, 8, 9], dtype='int64')</span>

<span class="gp">In [36]: </span><span class="n">div</span><span class="p">,</span> <span class="n">rem</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

<span class="gp">In [37]: </span><span class="n">div</span>
<span class="gh">Out[37]: </span><span class="go">Index([0, 0, 0, 1, 1, 1, 2, 2, 2, 3], dtype='int64')</span>

<span class="gp">In [38]: </span><span class="n">rem</span>
<span class="gh">Out[38]: </span><span class="go">Index([0, 1, 2, 0, 1, 2, 0, 1, 2, 0], dtype='int64')</span>
</pre></div>
</div>
<p>我们也可以执行元素级的 <a class="reference external" href="https://docs.pythonlang.cn/3/library/functions.html#divmod" title="(in Python v3.13)"><code class="xref py py-func docutils literal notranslate"><span class="pre">divmod()</span></code></a>。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [39]: </span><span class="n">div</span><span class="p">,</span> <span class="n">rem</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>

<span class="gp">In [40]: </span><span class="n">div</span>
<span class="gh">Out[40]: </span>
<span class="go">0    0</span>
<span class="go">1    0</span>
<span class="go">2    0</span>
<span class="go">3    1</span>
<span class="go">4    1</span>
<span class="go">5    1</span>
<span class="go">6    1</span>
<span class="go">7    1</span>
<span class="go">8    1</span>
<span class="go">9    1</span>
<span class="go">dtype: int64</span>

<span class="gp">In [41]: </span><span class="n">rem</span>
<span class="gh">Out[41]: </span>
<span class="go">0    0</span>
<span class="go">1    1</span>
<span class="go">2    2</span>
<span class="go">3    0</span>
<span class="go">4    0</span>
<span class="go">5    1</span>
<span class="go">6    1</span>
<span class="go">7    2</span>
<span class="go">8    2</span>
<span class="go">9    3</span>
<span class="go">dtype: int64</span>
</pre></div>
</div>
</section>
<section id="missing-data-operations-with-fill-values">
<h3>缺失数据 / 带填充值的操作<a class="headerlink" href="basics.html#missing-data-operations-with-fill-values" title="Link to this heading">#</a></h3>
<p>在 Series 和 DataFrame 中，算术函数可以选择输入一个 *fill_value*，即当某个位置最多只有一个值缺失时用于替换的值。例如，在添加两个 DataFrame 对象时，您可能希望将 NaN 视为 0，除非两个 DataFrame 都缺少该值，在这种情况下结果将是 NaN（如果您愿意，以后可以使用 <code class="docutils literal notranslate"><span class="pre">fillna</span></code> 将 NaN 替换为其他值）。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [42]: </span><span class="n">df2</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="gp">In [43]: </span><span class="n">df2</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"three"</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>

<span class="gp">In [44]: </span><span class="n">df</span>
<span class="gh">Out[44]: </span>
<span class="go">        one       two     three</span>
<span class="go">a  1.394981  1.772517       NaN</span>
<span class="go">b  0.343054  1.912123 -0.050390</span>
<span class="go">c  0.695246  1.478369  1.227435</span>
<span class="go">d       NaN  0.279344 -0.613172</span>

<span class="gp">In [45]: </span><span class="n">df2</span>
<span class="gh">Out[45]: </span>
<span class="go">        one       two     three</span>
<span class="go">a  1.394981  1.772517  1.000000</span>
<span class="go">b  0.343054  1.912123 -0.050390</span>
<span class="go">c  0.695246  1.478369  1.227435</span>
<span class="go">d       NaN  0.279344 -0.613172</span>

<span class="gp">In [46]: </span><span class="n">df</span> <span class="o">+</span> <span class="n">df2</span>
<span class="gh">Out[46]: </span>
<span class="go">        one       two     three</span>
<span class="go">a  2.789963  3.545034       NaN</span>
<span class="go">b  0.686107  3.824246 -0.100780</span>
<span class="go">c  1.390491  2.956737  2.454870</span>
<span class="go">d       NaN  0.558688 -1.226343</span>

<span class="gp">In [47]: </span><span class="n">df</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">df2</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="gh">Out[47]: </span>
<span class="go">        one       two     three</span>
<span class="go">a  2.789963  3.545034  1.000000</span>
<span class="go">b  0.686107  3.824246 -0.100780</span>
<span class="go">c  1.390491  2.956737  2.454870</span>
<span class="go">d       NaN  0.558688 -1.226343</span>
</pre></div>
</div>
</section>
<section id="flexible-comparisons">
<span id="basics-compare"></span><h3>灵活的比较<a class="headerlink" href="basics.html#flexible-comparisons" title="Link to this heading">#</a></h3>
<p>Series 和 DataFrame 具有二进制比较方法 <code class="docutils literal notranslate"><span class="pre">eq</span></code>、<code class="docutils literal notranslate"><span class="pre">ne</span></code>、<code class="docutils literal notranslate"><span class="pre">lt</span></code>、<code class="docutils literal notranslate"><span class="pre">gt</span></code>、<code class="docutils literal notranslate"><span class="pre">le</span></code> 和 <code class="docutils literal notranslate"><span class="pre">ge</span></code>，它们的行为与上面描述的二进制算术运算类似。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [48]: </span><span class="n">df</span><span class="o">.</span><span class="n">gt</span><span class="p">(</span><span class="n">df2</span><span class="p">)</span>
<span class="gh">Out[48]: </span>
<span class="go">     one    two  three</span>
<span class="go">a  False  False  False</span>
<span class="go">b  False  False  False</span>
<span class="go">c  False  False  False</span>
<span class="go">d  False  False  False</span>

<span class="gp">In [49]: </span><span class="n">df2</span><span class="o">.</span><span class="n">ne</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="gh">Out[49]: </span>
<span class="go">     one    two  three</span>
<span class="go">a  False  False   True</span>
<span class="go">b  False  False  False</span>
<span class="go">c  False  False  False</span>
<span class="go">d   True  False  False</span>
</pre></div>
</div>
<p>这些操作会生成一个 pandas 对象，其类型与左侧输入相同，并且 dtype 为 <code class="docutils literal notranslate"><span class="pre">bool</span></code>。这些 <code class="docutils literal notranslate"><span class="pre">boolean</span></code> 对象可用于索引操作，参见 <a class="reference internal" href="indexing.html#indexing-boolean"><span class="std std-ref">布尔索引</span></a> 部分。</p>
</section>
<section id="boolean-reductions">
<span id="basics-reductions"></span><h3>布尔约简<a class="headerlink" href="basics.html#boolean-reductions" title="Link to this heading">#</a></h3>
<p>您可以应用约简：<a class="reference internal" href="../reference/api/pandas.DataFrame.empty.html#pandas.DataFrame.empty" title="pandas.DataFrame.empty"><code class="xref py py-attr docutils literal notranslate"><span class="pre">empty</span></code></a>、<a class="reference internal" href="../reference/api/pandas.DataFrame.any.html#pandas.DataFrame.any" title="pandas.DataFrame.any"><code class="xref py py-meth docutils literal notranslate"><span class="pre">any()</span></code></a>、<a class="reference internal" href="../reference/api/pandas.DataFrame.all.html#pandas.DataFrame.all" title="pandas.DataFrame.all"><code class="xref py py-meth docutils literal notranslate"><span class="pre">all()</span></code></a> 和 <a class="reference internal" href="../reference/api/pandas.DataFrame.bool.html#pandas.DataFrame.bool" title="pandas.DataFrame.bool"><code class="xref py py-meth docutils literal notranslate"><span class="pre">bool()</span></code></a>，以总结布尔结果。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [50]: </span><span class="p">(</span><span class="n">df</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="gh">Out[50]: </span>
<span class="go">one      False</span>
<span class="go">two       True</span>
<span class="go">three    False</span>
<span class="go">dtype: bool</span>

<span class="gp">In [51]: </span><span class="p">(</span><span class="n">df</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
<span class="gh">Out[51]: </span>
<span class="go">one      True</span>
<span class="go">two      True</span>
<span class="go">three    True</span>
<span class="go">dtype: bool</span>
</pre></div>
</div>
<p>您可以约简为最终的布尔值。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [52]: </span><span class="p">(</span><span class="n">df</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
<span class="gh">Out[52]: </span><span class="go">True</span>
</pre></div>
</div>
<p>您可以通过 <a class="reference internal" href="../reference/api/pandas.DataFrame.empty.html#pandas.DataFrame.empty" title="pandas.DataFrame.empty"><code class="xref py py-attr docutils literal notranslate"><span class="pre">empty</span></code></a> 属性测试 pandas 对象是否为空。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [53]: </span><span class="n">df</span><span class="o">.</span><span class="n">empty</span>
<span class="gh">Out[53]: </span><span class="go">False</span>

<span class="gp">In [54]: </span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="s2">"ABC"</span><span class="p">))</span><span class="o">.</span><span class="n">empty</span>
<span class="gh">Out[54]: </span><span class="go">True</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>断言 pandas 对象的真值性将引发错误，因为空性或值的测试是模糊的。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [55]: </span><span class="k">if</span> <span class="n">df</span><span class="p">:</span>
<span class="gp">   ....: </span>    <span class="nb">print</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">   ....: </span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ValueError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-55-318d08b2571a&gt;</span> in <span class="ni">?</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="k">if</span> <span class="n">df</span><span class="p">:</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span>     <span class="nb">print</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="nn">~/work/pandas/pandas/pandas/core/generic.py</span> in <span class="ni">?</span><span class="nt">(self)</span>
<span class="g g-Whitespace">   </span><span class="mi">1575</span>     <span class="nd">@final</span>
<span class="g g-Whitespace">   </span><span class="mi">1576</span>     <span class="k">def</span><span class="w"> </span><span class="nf">__nonzero__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NoReturn</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">1577</span>         <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1578</span>             <span class="sa">f</span><span class="s2">"The truth value of a </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> is ambiguous. "</span>
<span class="g g-Whitespace">   </span><span class="mi">1579</span>             <span class="s2">"Use a.empty, a.bool(), a.item(), a.any() or a.all()."</span>
<span class="g g-Whitespace">   </span><span class="mi">1580</span>         <span class="p">)</span>

<span class="ne">ValueError</span>: The truth value of a DataFrame is ambiguous. Use a.empty, a.bool(), a.item(), a.any() or a.all().
</pre></div>
</div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [56]: </span><span class="n">df</span> <span class="ow">and</span> <span class="n">df2</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ValueError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-56-b241b64bb471&gt;</span> in <span class="ni">?</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">df</span> <span class="ow">and</span> <span class="n">df2</span>

<span class="nn">~/work/pandas/pandas/pandas/core/generic.py</span> in <span class="ni">?</span><span class="nt">(self)</span>
<span class="g g-Whitespace">   </span><span class="mi">1575</span>     <span class="nd">@final</span>
<span class="g g-Whitespace">   </span><span class="mi">1576</span>     <span class="k">def</span><span class="w"> </span><span class="nf">__nonzero__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NoReturn</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">1577</span>         <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1578</span>             <span class="sa">f</span><span class="s2">"The truth value of a </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> is ambiguous. "</span>
<span class="g g-Whitespace">   </span><span class="mi">1579</span>             <span class="s2">"Use a.empty, a.bool(), a.item(), a.any() or a.all()."</span>
<span class="g g-Whitespace">   </span><span class="mi">1580</span>         <span class="p">)</span>

<span class="ne">ValueError</span>: The truth value of a DataFrame is ambiguous. Use a.empty, a.bool(), a.item(), a.any() or a.all().
</pre></div>
</div>
<p>更多详细讨论请参见 <a class="reference internal" href="gotchas.html#gotchas-truth"><span class="std std-ref">陷阱</span></a>。</p>
</div>
</section>
<section id="comparing-if-objects-are-equivalent">
<span id="basics-equals"></span><h3>比较对象是否等效<a class="headerlink" href="basics.html#comparing-if-objects-are-equivalent" title="Link to this heading">#</a></h3>
<p>通常您可能会发现有不止一种方法可以计算出相同的结果。作为一个简单的例子，考虑 <code class="docutils literal notranslate"><span class="pre">df</span> <span class="pre">+</span> <span class="pre">df</span></code> 和 <code class="docutils literal notranslate"><span class="pre">df</span> <span class="pre">*</span> <span class="pre">2</span></code>。为了测试这两个计算是否产生相同的结果，根据上面展示的工具，您可能会想到使用 <code class="docutils literal notranslate"><span class="pre">(df</span> <span class="pre">+</span> <span class="pre">df</span> <span class="pre">==</span> <span class="pre">df</span> <span class="pre">*</span> <span class="pre">2).all()</span></code>。但实际上，这个表达式是 False。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [57]: </span><span class="n">df</span> <span class="o">+</span> <span class="n">df</span> <span class="o">==</span> <span class="n">df</span> <span class="o">*</span> <span class="mi">2</span>
<span class="gh">Out[57]: </span>
<span class="go">     one   two  three</span>
<span class="go">a   True  True  False</span>
<span class="go">b   True  True   True</span>
<span class="go">c   True  True   True</span>
<span class="go">d  False  True   True</span>

<span class="gp">In [58]: </span><span class="p">(</span><span class="n">df</span> <span class="o">+</span> <span class="n">df</span> <span class="o">==</span> <span class="n">df</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="gh">Out[58]: </span>
<span class="go">one      False</span>
<span class="go">two       True</span>
<span class="go">three    False</span>
<span class="go">dtype: bool</span>
</pre></div>
</div>
<p>请注意，布尔 DataFrame <code class="docutils literal notranslate"><span class="pre">df</span> <span class="pre">+</span> <span class="pre">df</span> <span class="pre">==</span> <span class="pre">df</span> <span class="pre">*</span> <span class="pre">2</span></code> 包含一些 False 值！这是因为 NaNs 不被视为相等。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [59]: </span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="gh">Out[59]: </span><span class="go">False</span>
</pre></div>
</div>
<p>因此，NDFrame（例如 Series 和 DataFrames）有一个 <a class="reference internal" href="../reference/api/pandas.DataFrame.equals.html#pandas.DataFrame.equals" title="pandas.DataFrame.equals"><code class="xref py py-meth docutils literal notranslate"><span class="pre">equals()</span></code></a> 方法用于测试相等性，其中对应位置的 NaNs 被视为相等。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [60]: </span><span class="p">(</span><span class="n">df</span> <span class="o">+</span> <span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">df</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
<span class="gh">Out[60]: </span><span class="go">True</span>
</pre></div>
</div>
<p>请注意，Series 或 DataFrame 索引需要按相同顺序排列，相等性才会为 True。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [61]: </span><span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">"col"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"foo"</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]})</span>

<span class="gp">In [62]: </span><span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">"col"</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">"foo"</span><span class="p">]},</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

<span class="gp">In [63]: </span><span class="n">df1</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">df2</span><span class="p">)</span>
<span class="gh">Out[63]: </span><span class="go">False</span>

<span class="gp">In [64]: </span><span class="n">df1</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">df2</span><span class="o">.</span><span class="n">sort_index</span><span class="p">())</span>
<span class="gh">Out[64]: </span><span class="go">True</span>
</pre></div>
</div>
</section>
<section id="comparing-array-like-objects">
<h3>比较类数组对象<a class="headerlink" href="basics.html#comparing-array-like-objects" title="Link to this heading">#</a></h3>
<p>将 pandas 数据结构与标量值进行比较时，您可以方便地执行元素级比较。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [65]: </span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="s2">"foo"</span><span class="p">,</span> <span class="s2">"bar"</span><span class="p">,</span> <span class="s2">"baz"</span><span class="p">])</span> <span class="o">==</span> <span class="s2">"foo"</span>
<span class="gh">Out[65]: </span>
<span class="go">0     True</span>
<span class="go">1    False</span>
<span class="go">2    False</span>
<span class="go">dtype: bool</span>

<span class="gp">In [66]: </span><span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">([</span><span class="s2">"foo"</span><span class="p">,</span> <span class="s2">"bar"</span><span class="p">,</span> <span class="s2">"baz"</span><span class="p">])</span> <span class="o">==</span> <span class="s2">"foo"</span>
<span class="gh">Out[66]: </span><span class="go">array([ True, False, False])</span>
</pre></div>
</div>
<p>pandas 还处理不同但长度相同的类数组对象之间的元素级比较。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [67]: </span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="s2">"foo"</span><span class="p">,</span> <span class="s2">"bar"</span><span class="p">,</span> <span class="s2">"baz"</span><span class="p">])</span> <span class="o">==</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">([</span><span class="s2">"foo"</span><span class="p">,</span> <span class="s2">"bar"</span><span class="p">,</span> <span class="s2">"qux"</span><span class="p">])</span>
<span class="gh">Out[67]: </span>
<span class="go">0     True</span>
<span class="go">1     True</span>
<span class="go">2    False</span>
<span class="go">dtype: bool</span>

<span class="gp">In [68]: </span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="s2">"foo"</span><span class="p">,</span> <span class="s2">"bar"</span><span class="p">,</span> <span class="s2">"baz"</span><span class="p">])</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s2">"foo"</span><span class="p">,</span> <span class="s2">"bar"</span><span class="p">,</span> <span class="s2">"qux"</span><span class="p">])</span>
<span class="gh">Out[68]: </span>
<span class="go">0     True</span>
<span class="go">1     True</span>
<span class="go">2    False</span>
<span class="go">dtype: bool</span>
</pre></div>
</div>
<p>尝试比较不同长度的 <code class="docutils literal notranslate"><span class="pre">Index</span></code> 或 <code class="docutils literal notranslate"><span class="pre">Series</span></code> 对象将引发 ValueError。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [69]: </span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="s1">'foo'</span><span class="p">,</span> <span class="s1">'bar'</span><span class="p">,</span> <span class="s1">'baz'</span><span class="p">])</span> <span class="o">==</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="s1">'foo'</span><span class="p">,</span> <span class="s1">'bar'</span><span class="p">])</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ValueError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">69</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="s1">'foo'</span><span class="p">,</span> <span class="s1">'bar'</span><span class="p">,</span> <span class="s1">'baz'</span><span class="p">])</span> <span class="o">==</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="s1">'foo'</span><span class="p">,</span> <span class="s1">'bar'</span><span class="p">])</span>

<span class="nn">File ~/work/pandas/pandas/pandas/core/ops/common.py:76,</span> in <span class="ni">_unpack_zerodim_and_defer.&lt;locals&gt;.new_method</span><span class="nt">(self, other)</span>
<span class="g g-Whitespace">     </span><span class="mi">72</span>             <span class="k">return</span> <span class="bp">NotImplemented</span>
<span class="g g-Whitespace">     </span><span class="mi">74</span> <span class="n">other</span> <span class="o">=</span> <span class="n">item_from_zerodim</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">76</span> <span class="k">return</span> <span class="n">method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>

<span class="nn">File ~/work/pandas/pandas/pandas/core/arraylike.py:40,</span> in <span class="ni">OpsMixin.__eq__</span><span class="nt">(self, other)</span>
<span class="g g-Whitespace">     </span><span class="mi">38</span> <span class="nd">@unpack_zerodim_and_defer</span><span class="p">(</span><span class="s2">"__eq__"</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">39</span> <span class="k">def</span><span class="w"> </span><span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="ne">---&gt; </span><span class="mi">40</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cmp_method</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">eq</span><span class="p">)</span>

<span class="nn">File ~/work/pandas/pandas/pandas/core/series.py:6125,</span> in <span class="ni">Series._cmp_method</span><span class="nt">(self, other, op)</span>
<span class="g g-Whitespace">   </span><span class="mi">6122</span> <span class="n">res_name</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">get_op_result_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">6124</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Series</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_indexed_same</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
<span class="ne">-&gt; </span><span class="mi">6125</span>     <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Can only compare identically-labeled Series objects"</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">6127</span> <span class="n">lvalues</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_values</span>
<span class="g g-Whitespace">   </span><span class="mi">6128</span> <span class="n">rvalues</span> <span class="o">=</span> <span class="n">extract_array</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">extract_numpy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">extract_range</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="ne">ValueError</span>: Can only compare identically-labeled Series objects

<span class="gp">In [70]: </span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="s1">'foo'</span><span class="p">,</span> <span class="s1">'bar'</span><span class="p">,</span> <span class="s1">'baz'</span><span class="p">])</span> <span class="o">==</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="s1">'foo'</span><span class="p">])</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ValueError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">70</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="s1">'foo'</span><span class="p">,</span> <span class="s1">'bar'</span><span class="p">,</span> <span class="s1">'baz'</span><span class="p">])</span> <span class="o">==</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="s1">'foo'</span><span class="p">])</span>

<span class="nn">File ~/work/pandas/pandas/pandas/core/ops/common.py:76,</span> in <span class="ni">_unpack_zerodim_and_defer.&lt;locals&gt;.new_method</span><span class="nt">(self, other)</span>
<span class="g g-Whitespace">     </span><span class="mi">72</span>             <span class="k">return</span> <span class="bp">NotImplemented</span>
<span class="g g-Whitespace">     </span><span class="mi">74</span> <span class="n">other</span> <span class="o">=</span> <span class="n">item_from_zerodim</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">76</span> <span class="k">return</span> <span class="n">method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>

<span class="nn">File ~/work/pandas/pandas/pandas/core/arraylike.py:40,</span> in <span class="ni">OpsMixin.__eq__</span><span class="nt">(self, other)</span>
<span class="g g-Whitespace">     </span><span class="mi">38</span> <span class="nd">@unpack_zerodim_and_defer</span><span class="p">(</span><span class="s2">"__eq__"</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">39</span> <span class="k">def</span><span class="w"> </span><span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="ne">---&gt; </span><span class="mi">40</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cmp_method</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">eq</span><span class="p">)</span>

<span class="nn">File ~/work/pandas/pandas/pandas/core/series.py:6125,</span> in <span class="ni">Series._cmp_method</span><span class="nt">(self, other, op)</span>
<span class="g g-Whitespace">   </span><span class="mi">6122</span> <span class="n">res_name</span> <span class="o">=</span> <span class="n">ops</span><span class="o">.</span><span class="n">get_op_result_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">6124</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Series</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_indexed_same</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
<span class="ne">-&gt; </span><span class="mi">6125</span>     <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Can only compare identically-labeled Series objects"</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">6127</span> <span class="n">lvalues</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_values</span>
<span class="g g-Whitespace">   </span><span class="mi">6128</span> <span class="n">rvalues</span> <span class="o">=</span> <span class="n">extract_array</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">extract_numpy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">extract_range</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="ne">ValueError</span>: Can only compare identically-labeled Series objects
</pre></div>
</div>
</section>
<section id="combining-overlapping-data-sets">
<h3>组合重叠数据集<a class="headerlink" href="basics.html#combining-overlapping-data-sets" title="Link to this heading">#</a></h3>
<p>一个偶尔出现的问题是组合两个相似的数据集，其中一个数据集中的值优于另一个。例如，两个数据序列代表一个特定的经济指标，其中一个被认为是“更高质量”的。然而，质量较低的序列可能历史更长或数据覆盖更完整。因此，我们希望组合两个 DataFrame 对象，其中一个 DataFrame 中的缺失值由另一个 DataFrame 中具有相同标签的值有条件地填充。实现此操作的函数是 <a class="reference internal" href="../reference/api/pandas.DataFrame.combine_first.html#pandas.DataFrame.combine_first" title="pandas.DataFrame.combine_first"><code class="xref py py-meth docutils literal notranslate"><span class="pre">combine_first()</span></code></a>，我们对此进行说明。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [71]: </span><span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<span class="gp">   ....: </span>    <span class="p">{</span><span class="s2">"A"</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span> <span class="s2">"B"</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">]}</span>
<span class="gp">   ....: </span><span class="p">)</span>
<span class="gp">   ....: </span>

<span class="gp">In [72]: </span><span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<span class="gp">   ....: </span>    <span class="p">{</span>
<span class="gp">   ....: </span>        <span class="s2">"A"</span><span class="p">:</span> <span class="p">[</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">],</span>
<span class="gp">   ....: </span>        <span class="s2">"B"</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">],</span>
<span class="gp">   ....: </span>    <span class="p">}</span>
<span class="gp">   ....: </span><span class="p">)</span>
<span class="gp">   ....: </span>

<span class="gp">In [73]: </span><span class="n">df1</span>
<span class="gh">Out[73]: </span>
<span class="go">     A    B</span>
<span class="go">0  1.0  NaN</span>
<span class="go">1  NaN  2.0</span>
<span class="go">2  3.0  3.0</span>
<span class="go">3  5.0  NaN</span>
<span class="go">4  NaN  6.0</span>

<span class="gp">In [74]: </span><span class="n">df2</span>
<span class="gh">Out[74]: </span>
<span class="go">     A    B</span>
<span class="go">0  5.0  NaN</span>
<span class="go">1  2.0  NaN</span>
<span class="go">2  4.0  3.0</span>
<span class="go">3  NaN  4.0</span>
<span class="go">4  3.0  6.0</span>
<span class="go">5  7.0  8.0</span>

<span class="gp">In [75]: </span><span class="n">df1</span><span class="o">.</span><span class="n">combine_first</span><span class="p">(</span><span class="n">df2</span><span class="p">)</span>
<span class="gh">Out[75]: </span>
<span class="go">     A    B</span>
<span class="go">0  1.0  NaN</span>
<span class="go">1  2.0  2.0</span>
<span class="go">2  3.0  3.0</span>
<span class="go">3  5.0  4.0</span>
<span class="go">4  3.0  6.0</span>
<span class="go">5  7.0  8.0</span>
</pre></div>
</div>
</section>
<section id="general-dataframe-combine">
<h3>通用 DataFrame 组合<a class="headerlink" href="basics.html#general-dataframe-combine" title="Link to this heading">#</a></h3>
<p>上述的 <a class="reference internal" href="../reference/api/pandas.DataFrame.combine_first.html#pandas.DataFrame.combine_first" title="pandas.DataFrame.combine_first"><code class="xref py py-meth docutils literal notranslate"><span class="pre">combine_first()</span></code></a> 方法调用了更通用的 <a class="reference internal" href="../reference/api/pandas.DataFrame.combine.html#pandas.DataFrame.combine" title="pandas.DataFrame.combine"><code class="xref py py-meth docutils literal notranslate"><span class="pre">DataFrame.combine()</span></code></a>。此方法接受另一个 DataFrame 和一个组合器函数，对齐输入 DataFrame，然后将组合器函数传递给成对的 Series（即名称相同的列）。</p>
<p>因此，例如，要重现上述的 <a class="reference internal" href="../reference/api/pandas.DataFrame.combine_first.html#pandas.DataFrame.combine_first" title="pandas.DataFrame.combine_first"><code class="xref py py-meth docutils literal notranslate"><span class="pre">combine_first()</span></code></a>：</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [76]: </span><span class="k">def</span><span class="w"> </span><span class="nf">combiner</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="gp">   ....: </span>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="gp">   ....: </span>

<span class="gp">In [77]: </span><span class="n">df1</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">df2</span><span class="p">,</span> <span class="n">combiner</span><span class="p">)</span>
<span class="gh">Out[77]: </span>
<span class="go">     A    B</span>
<span class="go">0  1.0  NaN</span>
<span class="go">1  2.0  2.0</span>
<span class="go">2  3.0  3.0</span>
<span class="go">3  5.0  4.0</span>
<span class="go">4  3.0  6.0</span>
<span class="go">5  7.0  8.0</span>
</pre></div>
</div>
</section>
</section>
<section id="descriptive-statistics">
<span id="basics-stats"></span><h2>描述性统计<a class="headerlink" href="basics.html#descriptive-statistics" title="Link to this heading">#</a></h2>
<p>在 <a class="reference internal" href="../reference/series.html#api-series-stats"><span class="std std-ref">Series</span></a> 和 <a class="reference internal" href="../reference/frame.html#api-dataframe-stats"><span class="std std-ref">DataFrame</span></a> 上，有大量方法用于计算描述性统计和其他相关操作。其中大多数是聚合操作（因此产生较低维度的结果），例如 <a class="reference internal" href="../reference/api/pandas.DataFrame.sum.html#pandas.DataFrame.sum" title="pandas.DataFrame.sum"><code class="xref py py-meth docutils literal notranslate"><span class="pre">sum()</span></code></a>、<a class="reference internal" href="../reference/api/pandas.DataFrame.mean.html#pandas.DataFrame.mean" title="pandas.DataFrame.mean"><code class="xref py py-meth docutils literal notranslate"><span class="pre">mean()</span></code></a> 和 <a class="reference internal" href="../reference/api/pandas.DataFrame.quantile.html#pandas.DataFrame.quantile" title="pandas.DataFrame.quantile"><code class="xref py py-meth docutils literal notranslate"><span class="pre">quantile()</span></code></a>，但其中一些，例如 <a class="reference internal" href="../reference/api/pandas.DataFrame.cumsum.html#pandas.DataFrame.cumsum" title="pandas.DataFrame.cumsum"><code class="xref py py-meth docutils literal notranslate"><span class="pre">cumsum()</span></code></a> 和 <a class="reference internal" href="../reference/api/pandas.DataFrame.cumprod.html#pandas.DataFrame.cumprod" title="pandas.DataFrame.cumprod"><code class="xref py py-meth docutils literal notranslate"><span class="pre">cumprod()</span></code></a>，会生成大小相同的对象。通常来说，这些方法接受一个 <strong>axis</strong> 参数，就像 *ndarray.{sum, std, …}* 一样，但轴可以通过名称或整数指定。</p>
<ul class="simple">
<li><p><strong>Series</strong>：不需要 axis 参数。</p></li>
<li><p><strong>DataFrame</strong>：“index”（axis=0，默认）、“columns”（axis=1）。</p></li>
</ul>
<p>例如：</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [78]: </span><span class="n">df</span>
<span class="gh">Out[78]: </span>
<span class="go">        one       two     three</span>
<span class="go">a  1.394981  1.772517       NaN</span>
<span class="go">b  0.343054  1.912123 -0.050390</span>
<span class="go">c  0.695246  1.478369  1.227435</span>
<span class="go">d       NaN  0.279344 -0.613172</span>

<span class="gp">In [79]: </span><span class="n">df</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="gh">Out[79]: </span>
<span class="go">one      0.811094</span>
<span class="go">two      1.360588</span>
<span class="go">three    0.187958</span>
<span class="go">dtype: float64</span>

<span class="gp">In [80]: </span><span class="n">df</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="gh">Out[80]: </span>
<span class="go">a    1.583749</span>
<span class="go">b    0.734929</span>
<span class="go">c    1.133683</span>
<span class="go">d   -0.166914</span>
<span class="go">dtype: float64</span>
</pre></div>
</div>
<p>所有这些方法都有一个 <code class="docutils literal notranslate"><span class="pre">skipna</span></code> 选项，指示是否排除缺失数据（默认为 <code class="docutils literal notranslate"><span class="pre">True</span></code>）。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [81]: </span><span class="n">df</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gh">Out[81]: </span>
<span class="go">one           NaN</span>
<span class="go">two      5.442353</span>
<span class="go">three         NaN</span>
<span class="go">dtype: float64</span>

<span class="gp">In [82]: </span><span class="n">df</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gh">Out[82]: </span>
<span class="go">a    3.167498</span>
<span class="go">b    2.204786</span>
<span class="go">c    3.401050</span>
<span class="go">d   -0.333828</span>
<span class="go">dtype: float64</span>
</pre></div>
</div>
<p>结合广播/算术行为，可以非常简洁地描述各种统计过程，例如标准化（使数据均值为零，标准差为 1）。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [83]: </span><span class="n">ts_stand</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span> <span class="o">/</span> <span class="n">df</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

<span class="gp">In [84]: </span><span class="n">ts_stand</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
<span class="gh">Out[84]: </span>
<span class="go">one      1.0</span>
<span class="go">two      1.0</span>
<span class="go">three    1.0</span>
<span class="go">dtype: float64</span>

<span class="gp">In [85]: </span><span class="n">xs_stand</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="gp">In [86]: </span><span class="n">xs_stand</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="gh">Out[86]: </span>
<span class="go">a    1.0</span>
<span class="go">b    1.0</span>
<span class="go">c    1.0</span>
<span class="go">d    1.0</span>
<span class="go">dtype: float64</span>
</pre></div>
</div>
<p>请注意，像 <a class="reference internal" href="../reference/api/pandas.DataFrame.cumsum.html#pandas.DataFrame.cumsum" title="pandas.DataFrame.cumsum"><code class="xref py py-meth docutils literal notranslate"><span class="pre">cumsum()</span></code></a> 和 <a class="reference internal" href="../reference/api/pandas.DataFrame.cumprod.html#pandas.DataFrame.cumprod" title="pandas.DataFrame.cumprod"><code class="xref py py-meth docutils literal notranslate"><span class="pre">cumprod()</span></code></a> 这样的方法会保留 <code class="docutils literal notranslate"><span class="pre">NaN</span></code> 值的位置。这与 <a class="reference internal" href="../reference/api/pandas.DataFrame.expanding.html#pandas.DataFrame.expanding" title="pandas.DataFrame.expanding"><code class="xref py py-meth docutils literal notranslate"><span class="pre">expanding()</span></code></a> 和 <a class="reference internal" href="../reference/api/pandas.DataFrame.rolling.html#pandas.DataFrame.rolling" title="pandas.DataFrame.rolling"><code class="xref py py-meth docutils literal notranslate"><span class="pre">rolling()</span></code></a> 有些不同，因为 <code class="docutils literal notranslate"><span class="pre">NaN</span></code> 的行为还受 <code class="docutils literal notranslate"><span class="pre">min_periods</span></code> 参数的控制。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [87]: </span><span class="n">df</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>
<span class="gh">Out[87]: </span>
<span class="go">        one       two     three</span>
<span class="go">a  1.394981  1.772517       NaN</span>
<span class="go">b  1.738035  3.684640 -0.050390</span>
<span class="go">c  2.433281  5.163008  1.177045</span>
<span class="go">d       NaN  5.442353  0.563873</span>
</pre></div>
</div>
<p>以下是常用功能的快速参考摘要表。每个函数还接受一个可选的 <code class="docutils literal notranslate"><span class="pre">level</span></code> 参数，该参数仅在对象具有 <a class="reference internal" href="advanced.html#advanced-hierarchical"><span class="std std-ref">层级索引</span></a> 时适用。</p>
<table class="table">
<colgroup>
<col style="width: 20.0%" />
<col style="width: 80.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>函数</p></th>
<th class="head"><p>描述</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">count</span></code></p></td>
<td><p>非 NA 观测值的数量</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">sum</span></code></p></td>
<td><p>值之和</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">mean</span></code></p></td>
<td><p>值的平均值</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">median</span></code></p></td>
<td><p>值的算术中位数</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">min</span></code></p></td>
<td><p>最小值</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">max</span></code></p></td>
<td><p>最大值</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">mode</span></code></p></td>
<td><p>众数</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">abs</span></code></p></td>
<td><p>绝对值</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">prod</span></code></p></td>
<td><p>值之积</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">std</span></code></p></td>
<td><p>贝塞尔校正的样本标准差</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">var</span></code></p></td>
<td><p>无偏方差</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">sem</span></code></p></td>
<td><p>均值标准误</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">skew</span></code></p></td>
<td><p>样本偏度（三阶矩）</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">kurt</span></code></p></td>
<td><p>样本峰度（四阶矩）</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">quantile</span></code></p></td>
<td><p>样本分位数（%处的值）</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">cumsum</span></code></p></td>
<td><p>累积和</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">cumprod</span></code></p></td>
<td><p>累积积</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">cummax</span></code></p></td>
<td><p>累积最大值</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">cummin</span></code></p></td>
<td><p>累积最小值</p></td>
</tr>
</tbody>
</table>
<p>请注意，一些 NumPy 方法（如 <code class="docutils literal notranslate"><span class="pre">mean</span></code>、<code class="docutils literal notranslate"><span class="pre">std</span></code> 和 <code class="docutils literal notranslate"><span class="pre">sum</span></code>）在 Series 输入时默认会排除 NA 值。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [88]: </span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">"one"</span><span class="p">])</span>
<span class="gh">Out[88]: </span><span class="go">0.8110935116651192</span>

<span class="gp">In [89]: </span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">"one"</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>
<span class="gh">Out[89]: </span><span class="go">nan</span>
</pre></div>
</div>
<p><a class="reference internal" href="../reference/api/pandas.Series.nunique.html#pandas.Series.nunique" title="pandas.Series.nunique"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Series.nunique()</span></code></a> 将返回 Series 中非 NA 唯一值的数量。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [90]: </span><span class="n">series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">500</span><span class="p">))</span>

<span class="gp">In [91]: </span><span class="n">series</span><span class="p">[</span><span class="mi">20</span><span class="p">:</span><span class="mi">500</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

<span class="gp">In [92]: </span><span class="n">series</span><span class="p">[</span><span class="mi">10</span><span class="p">:</span><span class="mi">20</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>

<span class="gp">In [93]: </span><span class="n">series</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
<span class="gh">Out[93]: </span><span class="go">11</span>
</pre></div>
</div>
<section id="summarizing-data-describe">
<span id="basics-describe"></span><h3>数据摘要：描述<a class="headerlink" href="basics.html#summarizing-data-describe" title="Link to this heading">#</a></h3>
<p>有一个方便的 <a class="reference internal" href="../reference/api/pandas.DataFrame.describe.html#pandas.DataFrame.describe" title="pandas.DataFrame.describe"><code class="xref py py-meth docutils literal notranslate"><span class="pre">describe()</span></code></a> 函数，它计算 Series 或 DataFrame 列的各种汇总统计信息（当然不包括 NA 值）。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [94]: </span><span class="n">series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span>

<span class="gp">In [95]: </span><span class="n">series</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

<span class="gp">In [96]: </span><span class="n">series</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
<span class="gh">Out[96]: </span>
<span class="go">count    500.000000</span>
<span class="go">mean      -0.021292</span>
<span class="go">std        1.015906</span>
<span class="go">min       -2.683763</span>
<span class="go">25%       -0.699070</span>
<span class="go">50%       -0.069718</span>
<span class="go">75%        0.714483</span>
<span class="go">max        3.160915</span>
<span class="go">dtype: float64</span>

<span class="gp">In [97]: </span><span class="n">frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">,</span> <span class="s2">"c"</span><span class="p">,</span> <span class="s2">"d"</span><span class="p">,</span> <span class="s2">"e"</span><span class="p">])</span>

<span class="gp">In [98]: </span><span class="n">frame</span><span class="o">.</span><span class="n">iloc</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

<span class="gp">In [99]: </span><span class="n">frame</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
<span class="gh">Out[99]: </span>
<span class="go">                a           b           c           d           e</span>
<span class="go">count  500.000000  500.000000  500.000000  500.000000  500.000000</span>
<span class="go">mean     0.033387    0.030045   -0.043719   -0.051686    0.005979</span>
<span class="go">std      1.017152    0.978743    1.025270    1.015988    1.006695</span>
<span class="go">min     -3.000951   -2.637901   -3.303099   -3.159200   -3.188821</span>
<span class="go">25%     -0.647623   -0.576449   -0.712369   -0.691338   -0.691115</span>
<span class="go">50%      0.047578   -0.021499   -0.023888   -0.032652   -0.025363</span>
<span class="go">75%      0.729907    0.775880    0.618896    0.670047    0.649748</span>
<span class="go">max      2.740139    2.752332    3.004229    2.728702    3.240991</span>
</pre></div>
</div>
<p>您可以选择要包含在输出中的特定百分位数。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [100]: </span><span class="n">series</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">percentiles</span><span class="o">=</span><span class="p">[</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">])</span>
<span class="gh">Out[100]: </span>
<span class="go">count    500.000000</span>
<span class="go">mean      -0.021292</span>
<span class="go">std        1.015906</span>
<span class="go">min       -2.683763</span>
<span class="go">5%        -1.645423</span>
<span class="go">25%       -0.699070</span>
<span class="go">50%       -0.069718</span>
<span class="go">75%        0.714483</span>
<span class="go">95%        1.711409</span>
<span class="go">max        3.160915</span>
<span class="go">dtype: float64</span>
</pre></div>
</div>
<p>默认情况下，中位数始终包含在内。</p>
<p>对于非数值型 Series 对象，<a class="reference internal" href="../reference/api/pandas.Series.describe.html#pandas.Series.describe" title="pandas.Series.describe"><code class="xref py py-meth docutils literal notranslate"><span class="pre">describe()</span></code></a> 将给出唯一值数量和最常出现值的简单摘要。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [101]: </span><span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">,</span> <span class="s2">"a"</span><span class="p">,</span> <span class="s2">"a"</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="s2">"c"</span><span class="p">,</span> <span class="s2">"d"</span><span class="p">,</span> <span class="s2">"a"</span><span class="p">])</span>

<span class="gp">In [102]: </span><span class="n">s</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
<span class="gh">Out[102]: </span>
<span class="go">count     9</span>
<span class="go">unique    4</span>
<span class="go">top       a</span>
<span class="go">freq      5</span>
<span class="go">dtype: object</span>
</pre></div>
</div>
<p>请注意，对于混合类型 DataFrame 对象，<a class="reference internal" href="../reference/api/pandas.DataFrame.describe.html#pandas.DataFrame.describe" title="pandas.DataFrame.describe"><code class="xref py py-meth docutils literal notranslate"><span class="pre">describe()</span></code></a> 会将摘要限制为仅包含数值列，如果没有任何数值列，则仅包含分类列。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [103]: </span><span class="n">frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">"a"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"Yes"</span><span class="p">,</span> <span class="s2">"Yes"</span><span class="p">,</span> <span class="s2">"No"</span><span class="p">,</span> <span class="s2">"No"</span><span class="p">],</span> <span class="s2">"b"</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)})</span>

<span class="gp">In [104]: </span><span class="n">frame</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
<span class="gh">Out[104]: </span>
<span class="go">              b</span>
<span class="go">count  4.000000</span>
<span class="go">mean   1.500000</span>
<span class="go">std    1.290994</span>
<span class="go">min    0.000000</span>
<span class="go">25%    0.750000</span>
<span class="go">50%    1.500000</span>
<span class="go">75%    2.250000</span>
<span class="go">max    3.000000</span>
</pre></div>
</div>
<p>此行为可以通过提供类型列表作为 <code class="docutils literal notranslate"><span class="pre">include</span></code>/<code class="docutils literal notranslate"><span class="pre">exclude</span></code> 参数来控制。还可以使用特殊值 <code class="docutils literal notranslate"><span class="pre">all</span></code>。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [105]: </span><span class="n">frame</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">"object"</span><span class="p">])</span>
<span class="gh">Out[105]: </span>
<span class="go">          a</span>
<span class="go">count     4</span>
<span class="go">unique    2</span>
<span class="go">top     Yes</span>
<span class="go">freq      2</span>

<span class="gp">In [106]: </span><span class="n">frame</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">"number"</span><span class="p">])</span>
<span class="gh">Out[106]: </span>
<span class="go">              b</span>
<span class="go">count  4.000000</span>
<span class="go">mean   1.500000</span>
<span class="go">std    1.290994</span>
<span class="go">min    0.000000</span>
<span class="go">25%    0.750000</span>
<span class="go">50%    1.500000</span>
<span class="go">75%    2.250000</span>
<span class="go">max    3.000000</span>

<span class="gp">In [107]: </span><span class="n">frame</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="s2">"all"</span><span class="p">)</span>
<span class="gh">Out[107]: </span>
<span class="go">          a         b</span>
<span class="go">count     4  4.000000</span>
<span class="go">unique    2       NaN</span>
<span class="go">top     Yes       NaN</span>
<span class="go">freq      2       NaN</span>
<span class="go">mean    NaN  1.500000</span>
<span class="go">std     NaN  1.290994</span>
<span class="go">min     NaN  0.000000</span>
<span class="go">25%     NaN  0.750000</span>
<span class="go">50%     NaN  1.500000</span>
<span class="go">75%     NaN  2.250000</span>
<span class="go">max     NaN  3.000000</span>
</pre></div>
</div>
<p>该功能依赖于 <a class="reference internal" href="basics.html#basics-selectdtypes"><span class="std std-ref">select_dtypes</span></a>。有关接受的输入的详细信息，请参阅该处。</p>
</section>
<section id="index-of-min-max-values">
<span id="basics-idxmin"></span><h3>最小值/最大值的索引<a class="headerlink" href="basics.html#index-of-min-max-values" title="Link to this heading">#</a></h3>
<p>Series 和 DataFrame 上的 <a class="reference internal" href="../reference/api/pandas.DataFrame.idxmin.html#pandas.DataFrame.idxmin" title="pandas.DataFrame.idxmin"><code class="xref py py-meth docutils literal notranslate"><span class="pre">idxmin()</span></code></a> 和 <a class="reference internal" href="../reference/api/pandas.DataFrame.idxmax.html#pandas.DataFrame.idxmax" title="pandas.DataFrame.idxmax"><code class="xref py py-meth docutils literal notranslate"><span class="pre">idxmax()</span></code></a> 函数计算具有最小和最大对应值的索引标签。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [108]: </span><span class="n">s1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>

<span class="gp">In [109]: </span><span class="n">s1</span>
<span class="gh">Out[109]: </span>
<span class="go">0    1.118076</span>
<span class="go">1   -0.352051</span>
<span class="go">2   -1.242883</span>
<span class="go">3   -1.277155</span>
<span class="go">4   -0.641184</span>
<span class="go">dtype: float64</span>

<span class="gp">In [110]: </span><span class="n">s1</span><span class="o">.</span><span class="n">idxmin</span><span class="p">(),</span> <span class="n">s1</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>
<span class="gh">Out[110]: </span><span class="go">(3, 0)</span>

<span class="gp">In [111]: </span><span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"A"</span><span class="p">,</span> <span class="s2">"B"</span><span class="p">,</span> <span class="s2">"C"</span><span class="p">])</span>

<span class="gp">In [112]: </span><span class="n">df1</span>
<span class="gh">Out[112]: </span>
<span class="go">          A         B         C</span>
<span class="go">0 -0.327863 -0.946180 -0.137570</span>
<span class="go">1 -0.186235 -0.257213 -0.486567</span>
<span class="go">2 -0.507027 -0.871259 -0.111110</span>
<span class="go">3  2.000339 -2.430505  0.089759</span>
<span class="go">4 -0.321434 -0.033695  0.096271</span>

<span class="gp">In [113]: </span><span class="n">df1</span><span class="o">.</span><span class="n">idxmin</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="gh">Out[113]: </span>
<span class="go">A    2</span>
<span class="go">B    3</span>
<span class="go">C    1</span>
<span class="go">dtype: int64</span>

<span class="gp">In [114]: </span><span class="n">df1</span><span class="o">.</span><span class="n">idxmax</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gh">Out[114]: </span>
<span class="go">0    C</span>
<span class="go">1    A</span>
<span class="go">2    C</span>
<span class="go">3    A</span>
<span class="go">4    C</span>
<span class="go">dtype: object</span>
</pre></div>
</div>
<p>当有多行（或列）匹配最小值或最大值时，<a class="reference internal" href="../reference/api/pandas.DataFrame.idxmin.html#pandas.DataFrame.idxmin" title="pandas.DataFrame.idxmin"><code class="xref py py-meth docutils literal notranslate"><span class="pre">idxmin()</span></code></a> 和 <a class="reference internal" href="../reference/api/pandas.DataFrame.idxmax.html#pandas.DataFrame.idxmax" title="pandas.DataFrame.idxmax"><code class="xref py py-meth docutils literal notranslate"><span class="pre">idxmax()</span></code></a> 返回第一个匹配的索引。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [115]: </span><span class="n">df3</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"A"</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="s2">"edcba"</span><span class="p">))</span>

<span class="gp">In [116]: </span><span class="n">df3</span>
<span class="gh">Out[116]: </span>
<span class="go">     A</span>
<span class="go">e  2.0</span>
<span class="go">d  1.0</span>
<span class="go">c  1.0</span>
<span class="go">b  3.0</span>
<span class="go">a  NaN</span>

<span class="gp">In [117]: </span><span class="n">df3</span><span class="p">[</span><span class="s2">"A"</span><span class="p">]</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()</span>
<span class="gh">Out[117]: </span><span class="go">'d'</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p><code class="docutils literal notranslate"><span class="pre">idxmin</span></code> 和 <code class="docutils literal notranslate"><span class="pre">idxmax</span></code> 在 NumPy 中分别称为 <code class="docutils literal notranslate"><span class="pre">argmin</span></code> 和 <code class="docutils literal notranslate"><span class="pre">argmax</span></code>。</p>
</div>
</section>
<section id="value-counts-histogramming-mode">
<span id="basics-discretization"></span><h3>值计数（直方图）/ 众数<a class="headerlink" href="basics.html#value-counts-histogramming-mode" title="Link to this heading">#</a></h3>
<p><a class="reference internal" href="../reference/api/pandas.Series.value_counts.html#pandas.Series.value_counts" title="pandas.Series.value_counts"><code class="xref py py-meth docutils literal notranslate"><span class="pre">value_counts()</span></code></a> Series 方法计算一维值数组的直方图。它也可以用作普通数组上的函数。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [118]: </span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>

<span class="gp">In [119]: </span><span class="n">data</span>
<span class="gh">Out[119]: </span>
<span class="go">array([6, 6, 2, 3, 5, 3, 2, 5, 4, 5, 4, 3, 4, 5, 0, 2, 0, 4, 2, 0, 3, 2,</span>
<span class="go">       2, 5, 6, 5, 3, 4, 6, 4, 3, 5, 6, 4, 3, 6, 2, 6, 6, 2, 3, 4, 2, 1,</span>
<span class="go">       6, 2, 6, 1, 5, 4])</span>

<span class="gp">In [120]: </span><span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="gp">In [121]: </span><span class="n">s</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="gh">Out[121]: </span>
<span class="go">6    10</span>
<span class="go">2    10</span>
<span class="go">4     9</span>
<span class="go">3     8</span>
<span class="go">5     8</span>
<span class="go">0     3</span>
<span class="go">1     2</span>
<span class="go">Name: count, dtype: int64</span>
</pre></div>
</div>
<p><a class="reference internal" href="../reference/api/pandas.DataFrame.value_counts.html#pandas.DataFrame.value_counts" title="pandas.DataFrame.value_counts"><code class="xref py py-meth docutils literal notranslate"><span class="pre">value_counts()</span></code></a> 方法可用于计算多列组合。默认情况下，使用所有列，但可以使用 <code class="docutils literal notranslate"><span class="pre">subset</span></code> 参数选择子集。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [122]: </span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"a"</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="s2">"b"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"x"</span><span class="p">,</span> <span class="s2">"x"</span><span class="p">,</span> <span class="s2">"y"</span><span class="p">,</span> <span class="s2">"y"</span><span class="p">]}</span>

<span class="gp">In [123]: </span><span class="n">frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="gp">In [124]: </span><span class="n">frame</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="gh">Out[124]: </span>
<span class="go">a  b</span>
<span class="go">1  x    1</span>
<span class="go">2  x    1</span>
<span class="go">3  y    1</span>
<span class="go">4  y    1</span>
<span class="go">Name: count, dtype: int64</span>
</pre></div>
</div>
<p>同样，您可以获取 Series 或 DataFrame 中值最常出现的值（即众数）。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [125]: </span><span class="n">s5</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">])</span>

<span class="gp">In [126]: </span><span class="n">s5</span><span class="o">.</span><span class="n">mode</span><span class="p">()</span>
<span class="gh">Out[126]: </span>
<span class="go">0    3</span>
<span class="go">1    7</span>
<span class="go">dtype: int64</span>

<span class="gp">In [127]: </span><span class="n">df5</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="p">{</span>
<span class="gp">   .....: </span>        <span class="s2">"A"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">50</span><span class="p">),</span>
<span class="gp">   .....: </span>        <span class="s2">"B"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">50</span><span class="p">),</span>
<span class="gp">   .....: </span>    <span class="p">}</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [128]: </span><span class="n">df5</span><span class="o">.</span><span class="n">mode</span><span class="p">()</span>
<span class="gh">Out[128]: </span>
<span class="go">     A   B</span>
<span class="go">0  1.0  -9</span>
<span class="go">1  NaN  10</span>
<span class="go">2  NaN  13</span>
</pre></div>
</div>
</section>
<section id="discretization-and-quantiling">
<h3>离散化和分位数<a class="headerlink" href="basics.html#discretization-and-quantiling" title="Link to this heading">#</a></h3>
<p>连续值可以使用 <a class="reference internal" href="../reference/api/pandas.cut.html#pandas.cut" title="pandas.cut"><code class="xref py py-func docutils literal notranslate"><span class="pre">cut()</span></code></a>（基于值的分箱）和 <a class="reference internal" href="../reference/api/pandas.qcut.html#pandas.qcut" title="pandas.qcut"><code class="xref py py-func docutils literal notranslate"><span class="pre">qcut()</span></code></a>（基于样本分位数的分箱）函数进行离散化。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [129]: </span><span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>

<span class="gp">In [130]: </span><span class="n">factor</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

<span class="gp">In [131]: </span><span class="n">factor</span>
<span class="gh">Out[131]: </span>
<span class="go">[(-0.251, 0.464], (-0.968, -0.251], (0.464, 1.179], (-0.251, 0.464], (-0.968, -0.251], ..., (-0.251, 0.464], (-0.968, -0.251], (-0.968, -0.251], (-0.968, -0.251], (-0.968, -0.251]]</span>
<span class="go">Length: 20</span>
<span class="go">Categories (4, interval[float64, right]): [(-0.968, -0.251] &lt; (-0.251, 0.464] &lt; (0.464, 1.179] &lt;</span>
<span class="go">                                           (1.179, 1.893]]</span>

<span class="gp">In [132]: </span><span class="n">factor</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>

<span class="gp">In [133]: </span><span class="n">factor</span>
<span class="gh">Out[133]: </span>
<span class="go">[(0, 1], (-1, 0], (0, 1], (0, 1], (-1, 0], ..., (-1, 0], (-1, 0], (-1, 0], (-1, 0], (-1, 0]]</span>
<span class="go">Length: 20</span>
<span class="go">Categories (4, interval[int64, right]): [(-5, -1] &lt; (-1, 0] &lt; (0, 1] &lt; (1, 5]]</span>
</pre></div>
</div>
<p><a class="reference internal" href="../reference/api/pandas.qcut.html#pandas.qcut" title="pandas.qcut"><code class="xref py py-func docutils literal notranslate"><span class="pre">qcut()</span></code></a> 计算样本分位数。例如，我们可以将一些正态分布的数据切分成等大小的四分位数，如下所示：</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [134]: </span><span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>

<span class="gp">In [135]: </span><span class="n">factor</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

<span class="gp">In [136]: </span><span class="n">factor</span>
<span class="gh">Out[136]: </span>
<span class="go">[(0.569, 1.184], (-2.278, -0.301], (-2.278, -0.301], (0.569, 1.184], (0.569, 1.184], ..., (-0.301, 0.569], (1.184, 2.346], (1.184, 2.346], (-0.301, 0.569], (-2.278, -0.301]]</span>
<span class="go">Length: 30</span>
<span class="go">Categories (4, interval[float64, right]): [(-2.278, -0.301] &lt; (-0.301, 0.569] &lt; (0.569, 1.184] &lt;</span>
<span class="go">                                           (1.184, 2.346]]</span>
</pre></div>
</div>
<p>我们还可以传递无限值来定义分箱。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [137]: </span><span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>

<span class="gp">In [138]: </span><span class="n">factor</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">])</span>

<span class="gp">In [139]: </span><span class="n">factor</span>
<span class="gh">Out[139]: </span>
<span class="go">[(-inf, 0.0], (0.0, inf], (0.0, inf], (-inf, 0.0], (-inf, 0.0], ..., (-inf, 0.0], (-inf, 0.0], (-inf, 0.0], (0.0, inf], (0.0, inf]]</span>
<span class="go">Length: 20</span>
<span class="go">Categories (2, interval[float64, right]): [(-inf, 0.0] &lt; (0.0, inf]]</span>
</pre></div>
</div>
</section>
</section>
<section id="function-application">
<span id="basics-apply"></span><h2>函数应用<a class="headerlink" href="basics.html#function-application" title="Link to this heading">#</a></h2>
<p>要将您自己或另一个库的函数应用于 pandas 对象，您应该了解以下三种方法。适当的方法取决于您的函数期望在整个 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> 或 <code class="docutils literal notranslate"><span class="pre">Series</span></code> 上操作，按行或按列操作，还是按元素操作。</p>
<ol class="arabic simple">
<li><p><a class="reference internal" href="basics.html#tablewise-function-application">表级函数应用</a>：<a class="reference internal" href="../reference/api/pandas.DataFrame.pipe.html#pandas.DataFrame.pipe" title="pandas.DataFrame.pipe"><code class="xref py py-meth docutils literal notranslate"><span class="pre">pipe()</span></code></a></p></li>
<li><p><a class="reference internal" href="basics.html#row-or-column-wise-function-application">行或列级函数应用</a>：<a class="reference internal" href="../reference/api/pandas.DataFrame.apply.html#pandas.DataFrame.apply" title="pandas.DataFrame.apply"><code class="xref py py-meth docutils literal notranslate"><span class="pre">apply()</span></code></a></p></li>
<li><p><a class="reference internal" href="basics.html#aggregation-api">聚合 API</a>：<a class="reference internal" href="../reference/api/pandas.DataFrame.agg.html#pandas.DataFrame.agg" title="pandas.DataFrame.agg"><code class="xref py py-meth docutils literal notranslate"><span class="pre">agg()</span></code></a> 和 <a class="reference internal" href="../reference/api/pandas.DataFrame.transform.html#pandas.DataFrame.transform" title="pandas.DataFrame.transform"><code class="xref py py-meth docutils literal notranslate"><span class="pre">transform()</span></code></a></p></li>
<li><p><a class="reference internal" href="basics.html#applying-elementwise-functions">应用元素级函数</a>：<a class="reference internal" href="../reference/api/pandas.DataFrame.map.html#pandas.DataFrame.map" title="pandas.DataFrame.map"><code class="xref py py-meth docutils literal notranslate"><span class="pre">map()</span></code></a></p></li>
</ol>
<section id="tablewise-function-application">
<span id="basics-pipe"></span><h3>表级函数应用<a class="headerlink" href="basics.html#tablewise-function-application" title="Link to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> 和 <code class="docutils literal notranslate"><span class="pre">Series</span></code> 可以作为参数传递给函数。然而，如果函数需要以链式调用，请考虑使用 <a class="reference internal" href="../reference/api/pandas.DataFrame.pipe.html#pandas.DataFrame.pipe" title="pandas.DataFrame.pipe"><code class="xref py py-meth docutils literal notranslate"><span class="pre">pipe()</span></code></a> 方法。</p>
<p>首先进行一些设置</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [140]: </span><span class="k">def</span><span class="w"> </span><span class="nf">extract_city_name</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
<span class="gp">   .....: </span><span class="w">    </span><span class="sd">"""</span>
<span class="gp">   .....: </span><span class="sd">    Chicago, IL -&gt; Chicago for city_name column</span>
<span class="gp">   .....: </span><span class="sd">    """</span>
<span class="gp">   .....: </span>    <span class="n">df</span><span class="p">[</span><span class="s2">"city_name"</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">"city_and_code"</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">","</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">   .....: </span>    <span class="k">return</span> <span class="n">df</span>
<span class="gp">   .....: </span>

<span class="gp">In [141]: </span><span class="k">def</span><span class="w"> </span><span class="nf">add_country_name</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">country_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="gp">   .....: </span><span class="w">    </span><span class="sd">"""</span>
<span class="gp">   .....: </span><span class="sd">    Chicago -&gt; Chicago-US for city_name column</span>
<span class="gp">   .....: </span><span class="sd">    """</span>
<span class="gp">   .....: </span>    <span class="n">col</span> <span class="o">=</span> <span class="s2">"city_name"</span>
<span class="gp">   .....: </span>    <span class="n">df</span><span class="p">[</span><span class="s2">"city_and_country"</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">+</span> <span class="n">country_name</span>
<span class="gp">   .....: </span>    <span class="k">return</span> <span class="n">df</span>
<span class="gp">   .....: </span>

<span class="gp">In [142]: </span><span class="n">df_p</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">"city_and_code"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"Chicago, IL"</span><span class="p">]})</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">extract_city_name</span></code> 和 <code class="docutils literal notranslate"><span class="pre">add_country_name</span></code> 是接受并返回 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> 的函数。</p>
<p>现在比较以下内容</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [143]: </span><span class="n">add_country_name</span><span class="p">(</span><span class="n">extract_city_name</span><span class="p">(</span><span class="n">df_p</span><span class="p">),</span> <span class="n">country_name</span><span class="o">=</span><span class="s2">"US"</span><span class="p">)</span>
<span class="gh">Out[143]: </span>
<span class="go">  city_and_code city_name city_and_country</span>
<span class="go">0   Chicago, IL   Chicago        ChicagoUS</span>
</pre></div>
</div>
<p>等效于</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [144]: </span><span class="n">df_p</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">extract_city_name</span><span class="p">)</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">add_country_name</span><span class="p">,</span> <span class="n">country_name</span><span class="o">=</span><span class="s2">"US"</span><span class="p">)</span>
<span class="gh">Out[144]: </span>
<span class="go">  city_and_code city_name city_and_country</span>
<span class="go">0   Chicago, IL   Chicago        ChicagoUS</span>
</pre></div>
</div>
<p>pandas 鼓励第二种风格，即方法链式调用。<code class="docutils literal notranslate"><span class="pre">pipe</span></code> 使得在方法链中轻松使用您自己或另一个库的函数成为可能，与 pandas 的方法并行使用。</p>
<p>在上面的示例中，函数 <code class="docutils literal notranslate"><span class="pre">extract_city_name</span></code> 和 <code class="docutils literal notranslate"><span class="pre">add_country_name</span></code> 都期望将 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> 作为第一个位置参数。如果您希望应用的函数将其数据作为例如第二个参数呢？在这种情况下，向 <code class="docutils literal notranslate"><span class="pre">pipe</span></code> 提供一个 <code class="docutils literal notranslate"><span class="pre">(callable,</span> <span class="pre">data_keyword)</span></code> 元组。<code class="docutils literal notranslate"><span class="pre">.pipe</span></code> 会将 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> 路由到元组中指定的参数。</p>
<p>例如，我们可以使用 statsmodels 进行回归拟合。它们的 API 期望先是公式，然后是 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> 作为第二个参数 <code class="docutils literal notranslate"><span class="pre">data</span></code>。我们将函数和关键字对 <code class="docutils literal notranslate"><span class="pre">(sm.ols,</span> <span class="pre">'data')</span></code> 传递给 <code class="docutils literal notranslate"><span class="pre">pipe</span></code>。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [147]: </span><span class="kn">import</span><span class="w"> </span><span class="nn">statsmodels.formula.api</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sm</span>

<span class="gp">In [148]: </span><span class="n">bb</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"data/baseball.csv"</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="s2">"id"</span><span class="p">)</span>

<span class="gp">In [149]: </span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="n">bb</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">"h &gt; 0"</span><span class="p">)</span>
<span class="gp">   .....: </span>    <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">ln_h</span><span class="o">=</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">h</span><span class="p">))</span>
<span class="gp">   .....: </span>    <span class="o">.</span><span class="n">pipe</span><span class="p">((</span><span class="n">sm</span><span class="o">.</span><span class="n">ols</span><span class="p">,</span> <span class="s2">"data"</span><span class="p">),</span> <span class="s2">"hr ~ ln_h + year + g + C(lg)"</span><span class="p">)</span>
<span class="gp">   .....: </span>    <span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="gp">   .....: </span>    <span class="o">.</span><span class="n">summary</span><span class="p">()</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....:</span>
<span class="gh">Out[149]:</span>
<span class="go">&lt;class 'statsmodels.iolib.summary.Summary'&gt;</span>
<span class="go">"""</span>
<span class="go">                           OLS Regression Results</span>
<span class="go">==============================================================================</span>
<span class="go">Dep. Variable:                     hr   R-squared:                       0.685</span>
<span class="go">Model:                            OLS   Adj. R-squared:                  0.665</span>
<span class="go">Method:                 Least Squares   F-statistic:                     34.28</span>
<span class="go">Date:                Tue, 22 Nov 2022   Prob (F-statistic):           3.48e-15</span>
<span class="go">Time:                        05:34:17   Log-Likelihood:                -205.92</span>
<span class="go">No. Observations:                  68   AIC:                             421.8</span>
<span class="go">Df Residuals:                      63   BIC:                             432.9</span>
<span class="go">Df Model:                           4</span>
<span class="go">Covariance Type:            nonrobust</span>
<span class="go">===============================================================================</span>
<span class="go">                  coef    std err          t      P&gt;|t|      [0.025      0.975]</span>
<span class="gt">-------------------------------------------------------------------------------</span>
<span class="n">Intercept</span>   <span class="o">-</span><span class="mf">8484.7720</span>   <span class="mf">4664.146</span>     <span class="o">-</span><span class="mf">1.819</span>      <span class="mf">0.074</span>   <span class="o">-</span><span class="mf">1.78e+04</span>     <span class="mf">835.780</span>
<span class="n">C</span><span class="p">(</span><span class="n">lg</span><span class="p">)[</span><span class="n">T</span><span class="o">.</span><span class="n">NL</span><span class="p">]</span>    <span class="o">-</span><span class="mf">2.2736</span>      <span class="mf">1.325</span>     <span class="o">-</span><span class="mf">1.716</span>      <span class="mf">0.091</span>      <span class="o">-</span><span class="mf">4.922</span>       <span class="mf">0.375</span>
<span class="n">ln_h</span>           <span class="o">-</span><span class="mf">1.3542</span>      <span class="mf">0.875</span>     <span class="o">-</span><span class="mf">1.547</span>      <span class="mf">0.127</span>      <span class="o">-</span><span class="mf">3.103</span>       <span class="mf">0.395</span>
<span class="n">year</span>            <span class="mf">4.2277</span>      <span class="mf">2.324</span>      <span class="mf">1.819</span>      <span class="mf">0.074</span>      <span class="o">-</span><span class="mf">0.417</span>       <span class="mf">8.872</span>
<span class="n">g</span>               <span class="mf">0.1841</span>      <span class="mf">0.029</span>      <span class="mf">6.258</span>      <span class="mf">0.000</span>       <span class="mf">0.125</span>       <span class="mf">0.243</span>
<span class="o">==============================================================================</span>
<span class="ne">Omnibus</span>:                       10.875   Durbin-Watson:                   1.999
<span class="n">Prob</span><span class="p">(</span><span class="n">Omnibus</span><span class="p">):</span>                  <span class="mf">0.004</span>   <span class="n">Jarque</span><span class="o">-</span><span class="n">Bera</span> <span class="p">(</span><span class="n">JB</span><span class="p">):</span>               <span class="mf">17.298</span>
<span class="ne">Skew</span>:                           0.537   Prob(JB):                     0.000175
<span class="ne">Kurtosis</span>:                       5.225   Cond. No.                     1.49e+07
<span class="o">==============================================================================</span>

<span class="ne">Notes</span>:
<span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="n">Standard</span> <span class="n">Errors</span> <span class="n">assume</span> <span class="n">that</span> <span class="n">the</span> <span class="n">covariance</span> <span class="n">matrix</span> <span class="n">of</span> <span class="n">the</span> <span class="n">errors</span> <span class="ow">is</span> <span class="n">correctly</span> <span class="n">specified</span><span class="o">.</span>
<span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="n">The</span> <span class="n">condition</span> <span class="n">number</span> <span class="ow">is</span> <span class="n">large</span><span class="p">,</span> <span class="mf">1.49e+07</span><span class="o">.</span> <span class="n">This</span> <span class="n">might</span> <span class="n">indicate</span> <span class="n">that</span> <span class="n">there</span> <span class="n">are</span>
<span class="n">strong</span> <span class="n">multicollinearity</span> <span class="ow">or</span> <span class="n">other</span> <span class="n">numerical</span> <span class="n">problems</span><span class="o">.</span>
<span class="s2">"""</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">pipe</span></code> 方法的灵感来源于 Unix 管道，以及近期 <a class="reference external" href="https://github.com/tidyverse/dplyr">dplyr</a> 和 <a class="reference external" href="https://github.com/tidyverse/magrittr">magrittr</a> 引入的 <a class="reference external" href="https://r-project.cn">R</a> 中流行的 <code class="docutils literal notranslate"><span class="pre">(%&gt;%)</span></code>（读作 pipe）运算符。<code class="docutils literal notranslate"><span class="pre">pipe</span></code> 在这里的实现非常简洁，在 Python 中感觉很自然。我们鼓励您查看 <a class="reference internal" href="../reference/api/pandas.DataFrame.pipe.html#pandas.DataFrame.pipe" title="pandas.DataFrame.pipe"><code class="xref py py-meth docutils literal notranslate"><span class="pre">pipe()</span></code></a> 的源代码。</p>
</section>
<section id="row-or-column-wise-function-application">
<h3>行或列级函数应用<a class="headerlink" href="basics.html#row-or-column-wise-function-application" title="Link to this heading">#</a></h3>
<p>任意函数可以通过 <a class="reference internal" href="../reference/api/pandas.DataFrame.apply.html#pandas.DataFrame.apply" title="pandas.DataFrame.apply"><code class="xref py py-meth docutils literal notranslate"><span class="pre">apply()</span></code></a> 方法沿 DataFrame 的轴应用，该方法与描述性统计方法一样，接受一个可选的 <code class="docutils literal notranslate"><span class="pre">axis</span></code> 参数。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [145]: </span><span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="gh">Out[145]: </span>
<span class="go">one      0.811094</span>
<span class="go">two      1.360588</span>
<span class="go">three    0.187958</span>
<span class="go">dtype: float64</span>

<span class="gp">In [146]: </span><span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gh">Out[146]: </span>
<span class="go">a    1.583749</span>
<span class="go">b    0.734929</span>
<span class="go">c    1.133683</span>
<span class="go">d   -0.166914</span>
<span class="go">dtype: float64</span>

<span class="gp">In [147]: </span><span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
<span class="gh">Out[147]: </span>
<span class="go">one      1.051928</span>
<span class="go">two      1.632779</span>
<span class="go">three    1.840607</span>
<span class="go">dtype: float64</span>

<span class="gp">In [148]: </span><span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">)</span>
<span class="gh">Out[148]: </span>
<span class="go">        one       two     three</span>
<span class="go">a  1.394981  1.772517       NaN</span>
<span class="go">b  1.738035  3.684640 -0.050390</span>
<span class="go">c  2.433281  5.163008  1.177045</span>
<span class="go">d       NaN  5.442353  0.563873</span>

<span class="gp">In [149]: </span><span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">)</span>
<span class="gh">Out[149]: </span>
<span class="go">        one       two     three</span>
<span class="go">a  4.034899  5.885648       NaN</span>
<span class="go">b  1.409244  6.767440  0.950858</span>
<span class="go">c  2.004201  4.385785  3.412466</span>
<span class="go">d       NaN  1.322262  0.541630</span>
</pre></div>
</div>
<p><a class="reference internal" href="../reference/api/pandas.DataFrame.apply.html#pandas.DataFrame.apply" title="pandas.DataFrame.apply"><code class="xref py py-meth docutils literal notranslate"><span class="pre">apply()</span></code></a> 方法也支持根据字符串方法名进行分派。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [150]: </span><span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="s2">"mean"</span><span class="p">)</span>
<span class="gh">Out[150]: </span>
<span class="go">one      0.811094</span>
<span class="go">two      1.360588</span>
<span class="go">three    0.187958</span>
<span class="go">dtype: float64</span>

<span class="gp">In [151]: </span><span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="s2">"mean"</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gh">Out[151]: </span>
<span class="go">a    1.583749</span>
<span class="go">b    0.734929</span>
<span class="go">c    1.133683</span>
<span class="go">d   -0.166914</span>
<span class="go">dtype: float64</span>
</pre></div>
</div>
<p>传递给 <a class="reference internal" href="../reference/api/pandas.DataFrame.apply.html#pandas.DataFrame.apply" title="pandas.DataFrame.apply"><code class="xref py py-meth docutils literal notranslate"><span class="pre">apply()</span></code></a> 的函数的返回类型会影响 <code class="docutils literal notranslate"><span class="pre">DataFrame.apply</span></code> 最终输出的类型（在默认行为下）。</p>
<ul class="simple">
<li><p>如果应用的函数返回一个 <code class="docutils literal notranslate"><span class="pre">Series</span></code>，则最终输出是一个 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>。列与应用函数返回的 <code class="docutils literal notranslate"><span class="pre">Series</span></code> 的索引匹配。</p></li>
<li><p>如果应用的函数返回任何其他类型，则最终输出是一个 <code class="docutils literal notranslate"><span class="pre">Series</span></code>。</p></li>
</ul>
<p>此默认行为可以使用 <code class="docutils literal notranslate"><span class="pre">result_type</span></code> 参数覆盖，该参数接受三个选项：<code class="docutils literal notranslate"><span class="pre">reduce</span></code>、<code class="docutils literal notranslate"><span class="pre">broadcast</span></code> 和 <code class="docutils literal notranslate"><span class="pre">expand</span></code>。这些将决定类列表返回值如何（或是否）扩展为 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>。</p>
<p><a class="reference internal" href="../reference/api/pandas.DataFrame.apply.html#pandas.DataFrame.apply" title="pandas.DataFrame.apply"><code class="xref py py-meth docutils literal notranslate"><span class="pre">apply()</span></code></a> 结合一些巧妙的用法可以回答关于数据集的许多问题。例如，假设我们想要提取每列最大值出现的日期。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [152]: </span><span class="n">tsdf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
<span class="gp">   .....: </span>    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"A"</span><span class="p">,</span> <span class="s2">"B"</span><span class="p">,</span> <span class="s2">"C"</span><span class="p">],</span>
<span class="gp">   .....: </span>    <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">"1/1/2000"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">1000</span><span class="p">),</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [153]: </span><span class="n">tsdf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">idxmax</span><span class="p">())</span>
<span class="gh">Out[153]: </span>
<span class="go">A   2000-08-06</span>
<span class="go">B   2001-01-18</span>
<span class="go">C   2001-07-18</span>
<span class="go">dtype: datetime64[ns]</span>
</pre></div>
</div>
<p>您还可以将附加参数和关键字参数传递给 <a class="reference internal" href="../reference/api/pandas.DataFrame.apply.html#pandas.DataFrame.apply" title="pandas.DataFrame.apply"><code class="xref py py-meth docutils literal notranslate"><span class="pre">apply()</span></code></a> 方法。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [154]: </span><span class="k">def</span><span class="w"> </span><span class="nf">subtract_and_divide</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">sub</span><span class="p">,</span> <span class="n">divide</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="gp">   .....: </span>    <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">sub</span><span class="p">)</span> <span class="o">/</span> <span class="n">divide</span>
<span class="gp">   .....: </span>

<span class="gp">In [155]: </span><span class="n">df_udf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span>

<span class="gp">In [156]: </span><span class="n">df_udf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">subtract_and_divide</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,),</span> <span class="n">divide</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="gh">Out[156]: </span>
<span class="go">          0         1</span>
<span class="go">0 -1.333333 -1.333333</span>
<span class="go">1 -1.333333 -1.333333</span>
</pre></div>
</div>
<p>另一个有用的功能是能够传递 Series 方法，以便对每列或每行执行一些 Series 操作。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [157]: </span><span class="n">tsdf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
<span class="gp">   .....: </span>    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"A"</span><span class="p">,</span> <span class="s2">"B"</span><span class="p">,</span> <span class="s2">"C"</span><span class="p">],</span>
<span class="gp">   .....: </span>    <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">"1/1/2000"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [158]: </span><span class="n">tsdf</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

<span class="gp">In [159]: </span><span class="n">tsdf</span>
<span class="gh">Out[159]: </span>
<span class="go">                   A         B         C</span>
<span class="go">2000-01-01 -0.158131 -0.232466  0.321604</span>
<span class="go">2000-01-02 -1.810340 -3.105758  0.433834</span>
<span class="go">2000-01-03 -1.209847 -1.156793 -0.136794</span>
<span class="go">2000-01-04       NaN       NaN       NaN</span>
<span class="go">2000-01-05       NaN       NaN       NaN</span>
<span class="go">2000-01-06       NaN       NaN       NaN</span>
<span class="go">2000-01-07       NaN       NaN       NaN</span>
<span class="go">2000-01-08 -0.653602  0.178875  1.008298</span>
<span class="go">2000-01-09  1.007996  0.462824  0.254472</span>
<span class="go">2000-01-10  0.307473  0.600337  1.643950</span>

<span class="gp">In [160]: </span><span class="n">tsdf</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="o">.</span><span class="n">interpolate</span><span class="p">)</span>
<span class="gh">Out[160]: </span>
<span class="go">                   A         B         C</span>
<span class="go">2000-01-01 -0.158131 -0.232466  0.321604</span>
<span class="go">2000-01-02 -1.810340 -3.105758  0.433834</span>
<span class="go">2000-01-03 -1.209847 -1.156793 -0.136794</span>
<span class="go">2000-01-04 -1.098598 -0.889659  0.092225</span>
<span class="go">2000-01-05 -0.987349 -0.622526  0.321243</span>
<span class="go">2000-01-06 -0.876100 -0.355392  0.550262</span>
<span class="go">2000-01-07 -0.764851 -0.088259  0.779280</span>
<span class="go">2000-01-08 -0.653602  0.178875  1.008298</span>
<span class="go">2000-01-09  1.007996  0.462824  0.254472</span>
<span class="go">2000-01-10  0.307473  0.600337  1.643950</span>
</pre></div>
</div>
<p>最后，<a class="reference internal" href="../reference/api/pandas.DataFrame.apply.html#pandas.DataFrame.apply" title="pandas.DataFrame.apply"><code class="xref py py-meth docutils literal notranslate"><span class="pre">apply()</span></code></a> 接受一个参数 <code class="docutils literal notranslate"><span class="pre">raw</span></code>，默认为 False，它在应用函数之前将每行或每列转换为 Series。当设置为 True 时，传入的函数将接收一个 ndarray 对象，如果您不需要索引功能，这将对性能产生积极影响。</p>
</section>
<section id="aggregation-api">
<span id="basics-aggregate"></span><h3>聚合 API<a class="headerlink" href="basics.html#aggregation-api" title="Link to this heading">#</a></h3>
<p>聚合 API 允许以简洁的方式表达可能多个聚合操作。此 API 在 pandas 对象中类似，请参见 <a class="reference internal" href="groupby.html#groupby-aggregate"><span class="std std-ref">groupby API</span></a>、<a class="reference internal" href="window.html#window-overview"><span class="std std-ref">window API</span></a> 和 <a class="reference internal" href="timeseries.html#timeseries-aggregate"><span class="std std-ref">resample API</span></a>。聚合的入口点是 <a class="reference internal" href="../reference/api/pandas.DataFrame.aggregate.html#pandas.DataFrame.aggregate" title="pandas.DataFrame.aggregate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">DataFrame.aggregate()</span></code></a> 或其别名 <a class="reference internal" href="../reference/api/pandas.DataFrame.agg.html#pandas.DataFrame.agg" title="pandas.DataFrame.agg"><code class="xref py py-meth docutils literal notranslate"><span class="pre">DataFrame.agg()</span></code></a>。</p>
<p>我们将使用上面类似的起始帧。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [161]: </span><span class="n">tsdf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
<span class="gp">   .....: </span>    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"A"</span><span class="p">,</span> <span class="s2">"B"</span><span class="p">,</span> <span class="s2">"C"</span><span class="p">],</span>
<span class="gp">   .....: </span>    <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">"1/1/2000"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [162]: </span><span class="n">tsdf</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

<span class="gp">In [163]: </span><span class="n">tsdf</span>
<span class="gh">Out[163]: </span>
<span class="go">                   A         B         C</span>
<span class="go">2000-01-01  1.257606  1.004194  0.167574</span>
<span class="go">2000-01-02 -0.749892  0.288112 -0.757304</span>
<span class="go">2000-01-03 -0.207550 -0.298599  0.116018</span>
<span class="go">2000-01-04       NaN       NaN       NaN</span>
<span class="go">2000-01-05       NaN       NaN       NaN</span>
<span class="go">2000-01-06       NaN       NaN       NaN</span>
<span class="go">2000-01-07       NaN       NaN       NaN</span>
<span class="go">2000-01-08  0.814347 -0.257623  0.869226</span>
<span class="go">2000-01-09 -0.250663 -1.206601  0.896839</span>
<span class="go">2000-01-10  2.169758 -1.333363  0.283157</span>
</pre></div>
</div>
<p>使用单个函数等同于 <a class="reference internal" href="../reference/api/pandas.DataFrame.apply.html#pandas.DataFrame.apply" title="pandas.DataFrame.apply"><code class="xref py py-meth docutils literal notranslate"><span class="pre">apply()</span></code></a>。您也可以将命名方法作为字符串传递。这些将返回聚合输出的 <code class="docutils literal notranslate"><span class="pre">Series</span></code>。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [164]: </span><span class="n">tsdf</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="gh">Out[164]: </span>
<span class="go">A    3.033606</span>
<span class="go">B   -1.803879</span>
<span class="go">C    1.575510</span>
<span class="go">dtype: float64</span>

<span class="gp">In [165]: </span><span class="n">tsdf</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="s2">"sum"</span><span class="p">)</span>
<span class="gh">Out[165]: </span>
<span class="go">A    3.033606</span>
<span class="go">B   -1.803879</span>
<span class="go">C    1.575510</span>
<span class="go">dtype: float64</span>

<span class="go"># these are equivalent to a ``.sum()`` because we are aggregating</span>
<span class="go"># on a single function</span>
<span class="gp">In [166]: </span><span class="n">tsdf</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="gh">Out[166]: </span>
<span class="go">A    3.033606</span>
<span class="go">B   -1.803879</span>
<span class="go">C    1.575510</span>
<span class="go">dtype: float64</span>
</pre></div>
</div>
<p>在 <code class="docutils literal notranslate"><span class="pre">Series</span></code> 上的单一聚合将返回一个标量值。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [167]: </span><span class="n">tsdf</span><span class="p">[</span><span class="s2">"A"</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="s2">"sum"</span><span class="p">)</span>
<span class="gh">Out[167]: </span><span class="go">3.033606102414146</span>
</pre></div>
</div>
<section id="aggregating-with-multiple-functions">
<h4>使用多个函数进行聚合<a class="headerlink" href="basics.html#aggregating-with-multiple-functions" title="Link to this heading">#</a></h4>
<p>您可以传递多个聚合参数作为列表。传递的每个函数的结果将是生成的 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> 中的一行。这些自然地从聚合函数中命名。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [168]: </span><span class="n">tsdf</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s2">"sum"</span><span class="p">])</span>
<span class="gh">Out[168]: </span>
<span class="go">            A         B        C</span>
<span class="go">sum  3.033606 -1.803879  1.57551</span>
</pre></div>
</div>
<p>多个函数产生多行。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [169]: </span><span class="n">tsdf</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s2">"sum"</span><span class="p">,</span> <span class="s2">"mean"</span><span class="p">])</span>
<span class="gh">Out[169]: </span>
<span class="go">             A         B         C</span>
<span class="go">sum   3.033606 -1.803879  1.575510</span>
<span class="go">mean  0.505601 -0.300647  0.262585</span>
</pre></div>
</div>
<p>在 <code class="docutils literal notranslate"><span class="pre">Series</span></code> 上，多个函数返回一个 <code class="docutils literal notranslate"><span class="pre">Series</span></code>，并以函数名作为索引。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [170]: </span><span class="n">tsdf</span><span class="p">[</span><span class="s2">"A"</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s2">"sum"</span><span class="p">,</span> <span class="s2">"mean"</span><span class="p">])</span>
<span class="gh">Out[170]: </span>
<span class="go">sum     3.033606</span>
<span class="go">mean    0.505601</span>
<span class="go">Name: A, dtype: float64</span>
</pre></div>
</div>
<p>传递一个 <code class="docutils literal notranslate"><span class="pre">lambda</span></code> 函数将生成一个名为 <code class="docutils literal notranslate"><span class="pre">&lt;lambda&gt;</span></code> 的行。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [171]: </span><span class="n">tsdf</span><span class="p">[</span><span class="s2">"A"</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s2">"sum"</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">()])</span>
<span class="gh">Out[171]: </span>
<span class="go">sum         3.033606</span>
<span class="go">&lt;lambda&gt;    0.505601</span>
<span class="go">Name: A, dtype: float64</span>
</pre></div>
</div>
<p>传递一个命名函数将为该行生成该名称。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [172]: </span><span class="k">def</span><span class="w"> </span><span class="nf">mymean</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="gp">   .....: </span>    <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="gp">   .....: </span>

<span class="gp">In [173]: </span><span class="n">tsdf</span><span class="p">[</span><span class="s2">"A"</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s2">"sum"</span><span class="p">,</span> <span class="n">mymean</span><span class="p">])</span>
<span class="gh">Out[173]: </span>
<span class="go">sum       3.033606</span>
<span class="go">mymean    0.505601</span>
<span class="go">Name: A, dtype: float64</span>
</pre></div>
</div>
</section>
<section id="aggregating-with-a-dict">
<h4>使用字典进行聚合<a class="headerlink" href="basics.html#aggregating-with-a-dict" title="Link to this heading">#</a></h4>
<p>将列名字典传递给标量或标量列表，以对 <code class="docutils literal notranslate"><span class="pre">DataFrame.agg</span></code> 进行操作，允许您自定义哪些函数应用于哪些列。请注意，结果不按任何特定顺序排列，您可以使用 <code class="docutils literal notranslate"><span class="pre">OrderedDict</span></code> 来保证顺序。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [174]: </span><span class="n">tsdf</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s2">"A"</span><span class="p">:</span> <span class="s2">"mean"</span><span class="p">,</span> <span class="s2">"B"</span><span class="p">:</span> <span class="s2">"sum"</span><span class="p">})</span>
<span class="gh">Out[174]: </span>
<span class="go">A    0.505601</span>
<span class="go">B   -1.803879</span>
<span class="go">dtype: float64</span>
</pre></div>
</div>
<p>传递一个类列表将生成一个 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> 输出。您将获得所有聚合器的矩阵状输出。输出将包含所有唯一函数。那些没有为特定列标注的将是 <code class="docutils literal notranslate"><span class="pre">NaN</span></code>。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [175]: </span><span class="n">tsdf</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s2">"A"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"mean"</span><span class="p">,</span> <span class="s2">"min"</span><span class="p">],</span> <span class="s2">"B"</span><span class="p">:</span> <span class="s2">"sum"</span><span class="p">})</span>
<span class="gh">Out[175]: </span>
<span class="go">             A         B</span>
<span class="go">mean  0.505601       NaN</span>
<span class="go">min  -0.749892       NaN</span>
<span class="go">sum        NaN -1.803879</span>
</pre></div>
</div>
</section>
<section id="custom-describe">
<span id="basics-aggregation-custom-describe"></span><h4>自定义描述<a class="headerlink" href="basics.html#custom-describe" title="Link to this heading">#</a></h4>
<p>使用 <code class="docutils literal notranslate"><span class="pre">.agg()</span></code> 可以轻松创建自定义的描述函数，类似于内置的 <a class="reference internal" href="basics.html#basics-describe"><span class="std std-ref">描述函数</span></a>。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [176]: </span><span class="kn">from</span><span class="w"> </span><span class="nn">functools</span><span class="w"> </span><span class="kn">import</span> <span class="n">partial</span>

<span class="gp">In [177]: </span><span class="n">q_25</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="o">.</span><span class="n">quantile</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>

<span class="gp">In [178]: </span><span class="n">q_25</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="s2">"25%"</span>

<span class="gp">In [179]: </span><span class="n">q_75</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="o">.</span><span class="n">quantile</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>

<span class="gp">In [180]: </span><span class="n">q_75</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="s2">"75%"</span>

<span class="gp">In [181]: </span><span class="n">tsdf</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s2">"count"</span><span class="p">,</span> <span class="s2">"mean"</span><span class="p">,</span> <span class="s2">"std"</span><span class="p">,</span> <span class="s2">"min"</span><span class="p">,</span> <span class="n">q_25</span><span class="p">,</span> <span class="s2">"median"</span><span class="p">,</span> <span class="n">q_75</span><span class="p">,</span> <span class="s2">"max"</span><span class="p">])</span>
<span class="gh">Out[181]: </span>
<span class="go">               A         B         C</span>
<span class="go">count   6.000000  6.000000  6.000000</span>
<span class="go">mean    0.505601 -0.300647  0.262585</span>
<span class="go">std     1.103362  0.887508  0.606860</span>
<span class="go">min    -0.749892 -1.333363 -0.757304</span>
<span class="go">25%    -0.239885 -0.979600  0.128907</span>
<span class="go">median  0.303398 -0.278111  0.225365</span>
<span class="go">75%     1.146791  0.151678  0.722709</span>
<span class="go">max     2.169758  1.004194  0.896839</span>
</pre></div>
</div>
</section>
</section>
<section id="transform-api">
<span id="basics-transform"></span><h3>转换 API<a class="headerlink" href="basics.html#transform-api" title="Link to this heading">#</a></h3>
<p><a class="reference internal" href="../reference/api/pandas.DataFrame.transform.html#pandas.DataFrame.transform" title="pandas.DataFrame.transform"><code class="xref py py-meth docutils literal notranslate"><span class="pre">transform()</span></code></a> 方法返回一个与原始对象索引相同（大小相同）的对象。此 API 允许您同时提供*多个*操作，而不是逐个操作。它的 API 与 <code class="docutils literal notranslate"><span class="pre">.agg</span></code> API 非常相似。</p>
<p>我们创建了一个类似于上面部分中使用的帧。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [182]: </span><span class="n">tsdf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
<span class="gp">   .....: </span>    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"A"</span><span class="p">,</span> <span class="s2">"B"</span><span class="p">,</span> <span class="s2">"C"</span><span class="p">],</span>
<span class="gp">   .....: </span>    <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">"1/1/2000"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [183]: </span><span class="n">tsdf</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

<span class="gp">In [184]: </span><span class="n">tsdf</span>
<span class="gh">Out[184]: </span>
<span class="go">                   A         B         C</span>
<span class="go">2000-01-01 -0.428759 -0.864890 -0.675341</span>
<span class="go">2000-01-02 -0.168731  1.338144 -1.279321</span>
<span class="go">2000-01-03 -1.621034  0.438107  0.903794</span>
<span class="go">2000-01-04       NaN       NaN       NaN</span>
<span class="go">2000-01-05       NaN       NaN       NaN</span>
<span class="go">2000-01-06       NaN       NaN       NaN</span>
<span class="go">2000-01-07       NaN       NaN       NaN</span>
<span class="go">2000-01-08  0.254374 -1.240447 -0.201052</span>
<span class="go">2000-01-09 -0.157795  0.791197 -1.144209</span>
<span class="go">2000-01-10 -0.030876  0.371900  0.061932</span>
</pre></div>
</div>
<p>转换整个帧。<code class="docutils literal notranslate"><span class="pre">.transform()</span></code> 允许的输入函数类型包括：NumPy 函数、字符串函数名或用户定义函数。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [185]: </span><span class="n">tsdf</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">)</span>
<span class="gh">Out[185]: </span>
<span class="go">                   A         B         C</span>
<span class="go">2000-01-01  0.428759  0.864890  0.675341</span>
<span class="go">2000-01-02  0.168731  1.338144  1.279321</span>
<span class="go">2000-01-03  1.621034  0.438107  0.903794</span>
<span class="go">2000-01-04       NaN       NaN       NaN</span>
<span class="go">2000-01-05       NaN       NaN       NaN</span>
<span class="go">2000-01-06       NaN       NaN       NaN</span>
<span class="go">2000-01-07       NaN       NaN       NaN</span>
<span class="go">2000-01-08  0.254374  1.240447  0.201052</span>
<span class="go">2000-01-09  0.157795  0.791197  1.144209</span>
<span class="go">2000-01-10  0.030876  0.371900  0.061932</span>

<span class="gp">In [186]: </span><span class="n">tsdf</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="s2">"abs"</span><span class="p">)</span>
<span class="gh">Out[186]: </span>
<span class="go">                   A         B         C</span>
<span class="go">2000-01-01  0.428759  0.864890  0.675341</span>
<span class="go">2000-01-02  0.168731  1.338144  1.279321</span>
<span class="go">2000-01-03  1.621034  0.438107  0.903794</span>
<span class="go">2000-01-04       NaN       NaN       NaN</span>
<span class="go">2000-01-05       NaN       NaN       NaN</span>
<span class="go">2000-01-06       NaN       NaN       NaN</span>
<span class="go">2000-01-07       NaN       NaN       NaN</span>
<span class="go">2000-01-08  0.254374  1.240447  0.201052</span>
<span class="go">2000-01-09  0.157795  0.791197  1.144209</span>
<span class="go">2000-01-10  0.030876  0.371900  0.061932</span>

<span class="gp">In [187]: </span><span class="n">tsdf</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">abs</span><span class="p">())</span>
<span class="gh">Out[187]: </span>
<span class="go">                   A         B         C</span>
<span class="go">2000-01-01  0.428759  0.864890  0.675341</span>
<span class="go">2000-01-02  0.168731  1.338144  1.279321</span>
<span class="go">2000-01-03  1.621034  0.438107  0.903794</span>
<span class="go">2000-01-04       NaN       NaN       NaN</span>
<span class="go">2000-01-05       NaN       NaN       NaN</span>
<span class="go">2000-01-06       NaN       NaN       NaN</span>
<span class="go">2000-01-07       NaN       NaN       NaN</span>
<span class="go">2000-01-08  0.254374  1.240447  0.201052</span>
<span class="go">2000-01-09  0.157795  0.791197  1.144209</span>
<span class="go">2000-01-10  0.030876  0.371900  0.061932</span>
</pre></div>
</div>
<p>这里 <a class="reference internal" href="../reference/api/pandas.DataFrame.transform.html#pandas.DataFrame.transform" title="pandas.DataFrame.transform"><code class="xref py py-meth docutils literal notranslate"><span class="pre">transform()</span></code></a> 接收了一个单一函数；这等同于一个 <a class="reference external" href="https://numpy.com.cn/doc/stable/reference/ufuncs.html">ufunc</a> 应用。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [188]: </span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">tsdf</span><span class="p">)</span>
<span class="gh">Out[188]: </span>
<span class="go">                   A         B         C</span>
<span class="go">2000-01-01  0.428759  0.864890  0.675341</span>
<span class="go">2000-01-02  0.168731  1.338144  1.279321</span>
<span class="go">2000-01-03  1.621034  0.438107  0.903794</span>
<span class="go">2000-01-04       NaN       NaN       NaN</span>
<span class="go">2000-01-05       NaN       NaN       NaN</span>
<span class="go">2000-01-06       NaN       NaN       NaN</span>
<span class="go">2000-01-07       NaN       NaN       NaN</span>
<span class="go">2000-01-08  0.254374  1.240447  0.201052</span>
<span class="go">2000-01-09  0.157795  0.791197  1.144209</span>
<span class="go">2000-01-10  0.030876  0.371900  0.061932</span>
</pre></div>
</div>
<p>将单个函数传递给 <code class="docutils literal notranslate"><span class="pre">.transform()</span></code> 并结合 <code class="docutils literal notranslate"><span class="pre">Series</span></code> 将返回单个 <code class="docutils literal notranslate"><span class="pre">Series</span></code>。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [189]: </span><span class="n">tsdf</span><span class="p">[</span><span class="s2">"A"</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">)</span>
<span class="gh">Out[189]: </span>
<span class="go">2000-01-01    0.428759</span>
<span class="go">2000-01-02    0.168731</span>
<span class="go">2000-01-03    1.621034</span>
<span class="go">2000-01-04         NaN</span>
<span class="go">2000-01-05         NaN</span>
<span class="go">2000-01-06         NaN</span>
<span class="go">2000-01-07         NaN</span>
<span class="go">2000-01-08    0.254374</span>
<span class="go">2000-01-09    0.157795</span>
<span class="go">2000-01-10    0.030876</span>
<span class="go">Freq: D, Name: A, dtype: float64</span>
</pre></div>
</div>
<section id="transform-with-multiple-functions">
<h4>使用多个函数进行转换<a class="headerlink" href="basics.html#transform-with-multiple-functions" title="Link to this heading">#</a></h4>
<p>传递多个函数将生成一个列 MultiIndexed DataFrame。第一层将是原始帧的列名；第二层将是转换函数的名称。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [190]: </span><span class="n">tsdf</span><span class="o">.</span><span class="n">transform</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
<span class="gh">Out[190]: </span>
<span class="go">                   A                   B                   C          </span>
<span class="go">            absolute  &lt;lambda&gt;  absolute  &lt;lambda&gt;  absolute  &lt;lambda&gt;</span>
<span class="go">2000-01-01  0.428759  0.571241  0.864890  0.135110  0.675341  0.324659</span>
<span class="go">2000-01-02  0.168731  0.831269  1.338144  2.338144  1.279321 -0.279321</span>
<span class="go">2000-01-03  1.621034 -0.621034  0.438107  1.438107  0.903794  1.903794</span>
<span class="go">2000-01-04       NaN       NaN       NaN       NaN       NaN       NaN</span>
<span class="go">2000-01-05       NaN       NaN       NaN       NaN       NaN       NaN</span>
<span class="go">2000-01-06       NaN       NaN       NaN       NaN       NaN       NaN</span>
<span class="go">2000-01-07       NaN       NaN       NaN       NaN       NaN       NaN</span>
<span class="go">2000-01-08  0.254374  1.254374  1.240447 -0.240447  0.201052  0.798948</span>
<span class="go">2000-01-09  0.157795  0.842205  0.791197  1.791197  1.144209 -0.144209</span>
<span class="go">2000-01-10  0.030876  0.969124  0.371900  1.371900  0.061932  1.061932</span>
</pre></div>
</div>
<p>将多个函数传递给 Series 将生成一个 DataFrame。结果列名将是转换函数。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [191]: </span><span class="n">tsdf</span><span class="p">[</span><span class="s2">"A"</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
<span class="gh">Out[191]: </span>
<span class="go">            absolute  &lt;lambda&gt;</span>
<span class="go">2000-01-01  0.428759  0.571241</span>
<span class="go">2000-01-02  0.168731  0.831269</span>
<span class="go">2000-01-03  1.621034 -0.621034</span>
<span class="go">2000-01-04       NaN       NaN</span>
<span class="go">2000-01-05       NaN       NaN</span>
<span class="go">2000-01-06       NaN       NaN</span>
<span class="go">2000-01-07       NaN       NaN</span>
<span class="go">2000-01-08  0.254374  1.254374</span>
<span class="go">2000-01-09  0.157795  0.842205</span>
<span class="go">2000-01-10  0.030876  0.969124</span>
</pre></div>
</div>
</section>
<section id="transforming-with-a-dict">
<h4>使用字典进行转换<a class="headerlink" href="basics.html#transforming-with-a-dict" title="Link to this heading">#</a></h4>
<p>传递一个函数字典将允许对每列进行选择性转换。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [192]: </span><span class="n">tsdf</span><span class="o">.</span><span class="n">transform</span><span class="p">({</span><span class="s2">"A"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">,</span> <span class="s2">"B"</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">})</span>
<span class="gh">Out[192]: </span>
<span class="go">                   A         B</span>
<span class="go">2000-01-01  0.428759  0.135110</span>
<span class="go">2000-01-02  0.168731  2.338144</span>
<span class="go">2000-01-03  1.621034  1.438107</span>
<span class="go">2000-01-04       NaN       NaN</span>
<span class="go">2000-01-05       NaN       NaN</span>
<span class="go">2000-01-06       NaN       NaN</span>
<span class="go">2000-01-07       NaN       NaN</span>
<span class="go">2000-01-08  0.254374 -0.240447</span>
<span class="go">2000-01-09  0.157795  1.791197</span>
<span class="go">2000-01-10  0.030876  1.371900</span>
</pre></div>
</div>
<p>传递一个列表字典将生成一个带有这些选择性转换的 MultiIndexed DataFrame。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [193]: </span><span class="n">tsdf</span><span class="o">.</span><span class="n">transform</span><span class="p">({</span><span class="s2">"A"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">,</span> <span class="s2">"B"</span><span class="p">:</span> <span class="p">[</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"sqrt"</span><span class="p">]})</span>
<span class="gh">Out[193]: </span>
<span class="go">                   A         B          </span>
<span class="go">            absolute  &lt;lambda&gt;      sqrt</span>
<span class="go">2000-01-01  0.428759  0.135110       NaN</span>
<span class="go">2000-01-02  0.168731  2.338144  1.156782</span>
<span class="go">2000-01-03  1.621034  1.438107  0.661897</span>
<span class="go">2000-01-04       NaN       NaN       NaN</span>
<span class="go">2000-01-05       NaN       NaN       NaN</span>
<span class="go">2000-01-06       NaN       NaN       NaN</span>
<span class="go">2000-01-07       NaN       NaN       NaN</span>
<span class="go">2000-01-08  0.254374 -0.240447       NaN</span>
<span class="go">2000-01-09  0.157795  1.791197  0.889493</span>
<span class="go">2000-01-10  0.030876  1.371900  0.609836</span>
</pre></div>
</div>
</section>
</section>
<section id="applying-elementwise-functions">
<span id="basics-elementwise"></span><h3>应用元素级函数<a class="headerlink" href="basics.html#applying-elementwise-functions" title="Link to this heading">#</a></h3>
<p>由于并非所有函数都可以向量化（接受 NumPy 数组并返回另一个数组或值），因此 DataFrame 上的 <a class="reference internal" href="../reference/api/pandas.DataFrame.map.html#pandas.DataFrame.map" title="pandas.DataFrame.map"><code class="xref py py-meth docutils literal notranslate"><span class="pre">map()</span></code></a> 方法以及 Series 上的 <a class="reference internal" href="../reference/api/pandas.Series.map.html#pandas.Series.map" title="pandas.Series.map"><code class="xref py py-meth docutils literal notranslate"><span class="pre">map()</span></code></a> 方法都接受任何接受单个值并返回单个值的 Python 函数。例如：</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [194]: </span><span class="n">df4</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="gp">In [195]: </span><span class="n">df4</span>
<span class="gh">Out[195]: </span>
<span class="go">        one       two     three</span>
<span class="go">a  1.394981  1.772517       NaN</span>
<span class="go">b  0.343054  1.912123 -0.050390</span>
<span class="go">c  0.695246  1.478369  1.227435</span>
<span class="go">d       NaN  0.279344 -0.613172</span>

<span class="gp">In [196]: </span><span class="k">def</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="gp">   .....: </span>    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="gp">   .....: </span>

<span class="gp">In [197]: </span><span class="n">df4</span><span class="p">[</span><span class="s2">"one"</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="gh">Out[197]: </span>
<span class="go">a    18</span>
<span class="go">b    19</span>
<span class="go">c    18</span>
<span class="go">d     3</span>
<span class="go">Name: one, dtype: int64</span>

<span class="gp">In [198]: </span><span class="n">df4</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="gh">Out[198]: </span>
<span class="go">   one  two  three</span>
<span class="go">a   18   17      3</span>
<span class="go">b   19   18     20</span>
<span class="go">c   18   18     16</span>
<span class="go">d    3   19     19</span>
</pre></div>
</div>
<p><a class="reference internal" href="../reference/api/pandas.Series.map.html#pandas.Series.map" title="pandas.Series.map"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Series.map()</span></code></a> 还有一个额外功能；它可以用于轻松“链接”或“映射”由辅助 series 定义的值。这与 <a class="reference internal" href="merging.html#merging"><span class="std std-ref">合并/连接功能</span></a> 密切相关。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [199]: </span><span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="p">[</span><span class="s2">"six"</span><span class="p">,</span> <span class="s2">"seven"</span><span class="p">,</span> <span class="s2">"six"</span><span class="p">,</span> <span class="s2">"seven"</span><span class="p">,</span> <span class="s2">"six"</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">,</span> <span class="s2">"c"</span><span class="p">,</span> <span class="s2">"d"</span><span class="p">,</span> <span class="s2">"e"</span><span class="p">]</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [200]: </span><span class="n">t</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">({</span><span class="s2">"six"</span><span class="p">:</span> <span class="mf">6.0</span><span class="p">,</span> <span class="s2">"seven"</span><span class="p">:</span> <span class="mf">7.0</span><span class="p">})</span>

<span class="gp">In [201]: </span><span class="n">s</span>
<span class="gh">Out[201]: </span>
<span class="go">a      six</span>
<span class="go">b    seven</span>
<span class="go">c      six</span>
<span class="go">d    seven</span>
<span class="go">e      six</span>
<span class="go">dtype: object</span>

<span class="gp">In [202]: </span><span class="n">s</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="gh">Out[202]: </span>
<span class="go">a    6.0</span>
<span class="go">b    7.0</span>
<span class="go">c    6.0</span>
<span class="go">d    7.0</span>
<span class="go">e    6.0</span>
<span class="go">dtype: float64</span>
</pre></div>
</div>
</section>
</section>
<section id="reindexing-and-altering-labels">
<span id="basics-reindexing"></span><h2>重新索引和修改标签<a class="headerlink" href="basics.html#reindexing-and-altering-labels" title="Link to this heading">#</a></h2>
<p><a class="reference internal" href="../reference/api/pandas.Series.reindex.html#pandas.Series.reindex" title="pandas.Series.reindex"><code class="xref py py-meth docutils literal notranslate"><span class="pre">reindex()</span></code></a> 是 pandas 中基本的数据对齐方法。它用于实现几乎所有依赖标签对齐功能的功能。*重新索引* 意味着使数据符合沿特定轴给定的一组标签。这实现了几件事：</p>
<ul class="simple">
<li><p>重新排序现有数据以匹配一组新标签。</p></li>
<li><p>在没有该标签数据存在的标签位置插入缺失值 (NA) 标记。</p></li>
<li><p>如果指定，使用逻辑<strong>填充</strong>缺失标签的数据（与处理时间序列数据高度相关）。</p></li>
</ul>
<p>这是一个简单的例子。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [203]: </span><span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">,</span> <span class="s2">"c"</span><span class="p">,</span> <span class="s2">"d"</span><span class="p">,</span> <span class="s2">"e"</span><span class="p">])</span>

<span class="gp">In [204]: </span><span class="n">s</span>
<span class="gh">Out[204]: </span>
<span class="go">a    1.695148</span>
<span class="go">b    1.328614</span>
<span class="go">c    1.234686</span>
<span class="go">d   -0.385845</span>
<span class="go">e   -1.326508</span>
<span class="go">dtype: float64</span>

<span class="gp">In [205]: </span><span class="n">s</span><span class="o">.</span><span class="n">reindex</span><span class="p">([</span><span class="s2">"e"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">,</span> <span class="s2">"f"</span><span class="p">,</span> <span class="s2">"d"</span><span class="p">])</span>
<span class="gh">Out[205]: </span>
<span class="go">e   -1.326508</span>
<span class="go">b    1.328614</span>
<span class="go">f         NaN</span>
<span class="go">d   -0.385845</span>
<span class="go">dtype: float64</span>
</pre></div>
</div>
<p>这里，`f` 标签未包含在 Series 中，因此在结果中显示为 `NaN`。</p>
<p>对于 DataFrame，您可以同时重新索引索引和列。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [206]: </span><span class="n">df</span>
<span class="gh">Out[206]: </span>
<span class="go">        one       two     three</span>
<span class="go">a  1.394981  1.772517       NaN</span>
<span class="go">b  0.343054  1.912123 -0.050390</span>
<span class="go">c  0.695246  1.478369  1.227435</span>
<span class="go">d       NaN  0.279344 -0.613172</span>

<span class="gp">In [207]: </span><span class="n">df</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">"c"</span><span class="p">,</span> <span class="s2">"f"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"three"</span><span class="p">,</span> <span class="s2">"two"</span><span class="p">,</span> <span class="s2">"one"</span><span class="p">])</span>
<span class="gh">Out[207]: </span>
<span class="go">      three       two       one</span>
<span class="go">c  1.227435  1.478369  0.695246</span>
<span class="go">f       NaN       NaN       NaN</span>
<span class="go">b -0.050390  1.912123  0.343054</span>
</pre></div>
</div>
<p>请注意，包含实际轴标签的 <code class="docutils literal notranslate"><span class="pre">Index</span></code> 对象可以在对象之间**共享**。因此，如果有一个 Series 和一个 DataFrame，可以执行以下操作：</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [208]: </span><span class="n">rs</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

<span class="gp">In [209]: </span><span class="n">rs</span>
<span class="gh">Out[209]: </span>
<span class="go">a    1.695148</span>
<span class="go">b    1.328614</span>
<span class="go">c    1.234686</span>
<span class="go">d   -0.385845</span>
<span class="go">dtype: float64</span>

<span class="gp">In [210]: </span><span class="n">rs</span><span class="o">.</span><span class="n">index</span> <span class="ow">is</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span>
<span class="gh">Out[210]: </span><span class="go">True</span>
</pre></div>
</div>
<p>这意味着重新索引的 Series 的索引与 DataFrame 的索引是相同的 Python 对象。</p>
<p><a class="reference internal" href="../reference/api/pandas.DataFrame.reindex.html#pandas.DataFrame.reindex" title="pandas.DataFrame.reindex"><code class="xref py py-meth docutils literal notranslate"><span class="pre">DataFrame.reindex()</span></code></a> 还支持“轴样式”调用约定，您可以在其中指定单个 <code class="docutils literal notranslate"><span class="pre">labels</span></code> 参数及其应用的 <code class="docutils literal notranslate"><span class="pre">axis</span></code>。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [211]: </span><span class="n">df</span><span class="o">.</span><span class="n">reindex</span><span class="p">([</span><span class="s2">"c"</span><span class="p">,</span> <span class="s2">"f"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="s2">"index"</span><span class="p">)</span>
<span class="gh">Out[211]: </span>
<span class="go">        one       two     three</span>
<span class="go">c  0.695246  1.478369  1.227435</span>
<span class="go">f       NaN       NaN       NaN</span>
<span class="go">b  0.343054  1.912123 -0.050390</span>

<span class="gp">In [212]: </span><span class="n">df</span><span class="o">.</span><span class="n">reindex</span><span class="p">([</span><span class="s2">"three"</span><span class="p">,</span> <span class="s2">"two"</span><span class="p">,</span> <span class="s2">"one"</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="s2">"columns"</span><span class="p">)</span>
<span class="gh">Out[212]: </span>
<span class="go">      three       two       one</span>
<span class="go">a       NaN  1.772517  1.394981</span>
<span class="go">b -0.050390  1.912123  0.343054</span>
<span class="go">c  1.227435  1.478369  0.695246</span>
<span class="go">d -0.613172  0.279344       NaN</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">另请参见</p>
<p><a class="reference internal" href="advanced.html#advanced"><span class="std std-ref">多级索引 / 高级索引</span></a> 是更简洁的重新索引方式。</p>
</div>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p>编写性能敏感代码时，花时间成为重新索引高手有一个很好的理由：**许多操作在预对齐数据上速度更快**。添加两个未对齐的 DataFrame 会在内部触发重新索引步骤。对于探索性分析，您几乎不会注意到差异（因为 <code class="docutils literal notranslate"><span class="pre">reindex</span></code> 已经过大量优化），但当 CPU 周期至关重要时，在代码中散布一些显式的 <code class="docutils literal notranslate"><span class="pre">reindex</span></code> 调用可能会产生影响。</p>
</div>
<section id="reindexing-to-align-with-another-object">
<span id="basics-reindex-like"></span><h3>重新索引以与另一个对象对齐<a class="headerlink" href="basics.html#reindexing-to-align-with-another-object" title="Link to this heading">#</a></h3>
<p>您可能希望获取一个对象并重新索引其轴，使其标签与另一个对象相同。尽管其语法直接但冗长，但这是一种足够常见的操作，因此提供了 <a class="reference internal" href="../reference/api/pandas.DataFrame.reindex_like.html#pandas.DataFrame.reindex_like" title="pandas.DataFrame.reindex_like"><code class="xref py py-meth docutils literal notranslate"><span class="pre">reindex_like()</span></code></a> 方法使其更简单。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [213]: </span><span class="n">df2</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reindex</span><span class="p">([</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">,</span> <span class="s2">"c"</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"one"</span><span class="p">,</span> <span class="s2">"two"</span><span class="p">])</span>

<span class="gp">In [214]: </span><span class="n">df3</span> <span class="o">=</span> <span class="n">df2</span> <span class="o">-</span> <span class="n">df2</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="gp">In [215]: </span><span class="n">df2</span>
<span class="gh">Out[215]: </span>
<span class="go">        one       two</span>
<span class="go">a  1.394981  1.772517</span>
<span class="go">b  0.343054  1.912123</span>
<span class="go">c  0.695246  1.478369</span>

<span class="gp">In [216]: </span><span class="n">df3</span>
<span class="gh">Out[216]: </span>
<span class="go">        one       two</span>
<span class="go">a  0.583888  0.051514</span>
<span class="go">b -0.468040  0.191120</span>
<span class="go">c -0.115848 -0.242634</span>

<span class="gp">In [217]: </span><span class="n">df</span><span class="o">.</span><span class="n">reindex_like</span><span class="p">(</span><span class="n">df2</span><span class="p">)</span>
<span class="gh">Out[217]: </span>
<span class="go">        one       two</span>
<span class="go">a  1.394981  1.772517</span>
<span class="go">b  0.343054  1.912123</span>
<span class="go">c  0.695246  1.478369</span>
</pre></div>
</div>
</section>
<section id="aligning-objects-with-each-other-with-align">
<span id="basics-align"></span><h3>使用 <code class="docutils literal notranslate"><span class="pre">align</span></code> 方法对齐对象<a class="headerlink" href="basics.html#aligning-objects-with-each-other-with-align" title="Link to this heading">#</a></h3>
<p><a class="reference internal" href="../reference/api/pandas.Series.align.html#pandas.Series.align" title="pandas.Series.align"><code class="xref py py-meth docutils literal notranslate"><span class="pre">align()</span></code></a> 方法是同时对齐两个对象的最快方式。它支持一个 <code class="docutils literal notranslate"><span class="pre">join</span></code> 参数（与 <a class="reference internal" href="merging.html#merging"><span class="std std-ref">连接和合并</span></a> 相关）。</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">join='outer'</span></code>：取索引的并集（默认）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">join='left'</span></code>：使用调用对象的索引</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">join='right'</span></code>：使用传入对象的索引</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">join='inner'</span></code>：取索引的交集</p></li>
</ul>
</div></blockquote>
<p>它返回一个包含两个重新索引的 Series 的元组。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [218]: </span><span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">,</span> <span class="s2">"c"</span><span class="p">,</span> <span class="s2">"d"</span><span class="p">,</span> <span class="s2">"e"</span><span class="p">])</span>

<span class="gp">In [219]: </span><span class="n">s1</span> <span class="o">=</span> <span class="n">s</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span>

<span class="gp">In [220]: </span><span class="n">s2</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

<span class="gp">In [221]: </span><span class="n">s1</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="n">s2</span><span class="p">)</span>
<span class="gh">Out[221]: </span>
<span class="go">(a   -0.186646</span>
<span class="go"> b   -1.692424</span>
<span class="go"> c   -0.303893</span>
<span class="go"> d   -1.425662</span>
<span class="go"> e         NaN</span>
<span class="go"> dtype: float64,</span>
<span class="go"> a         NaN</span>
<span class="go"> b   -1.692424</span>
<span class="go"> c   -0.303893</span>
<span class="go"> d   -1.425662</span>
<span class="go"> e    1.114285</span>
<span class="go"> dtype: float64)</span>

<span class="gp">In [222]: </span><span class="n">s1</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="n">s2</span><span class="p">,</span> <span class="n">join</span><span class="o">=</span><span class="s2">"inner"</span><span class="p">)</span>
<span class="gh">Out[222]: </span>
<span class="go">(b   -1.692424</span>
<span class="go"> c   -0.303893</span>
<span class="go"> d   -1.425662</span>
<span class="go"> dtype: float64,</span>
<span class="go"> b   -1.692424</span>
<span class="go"> c   -0.303893</span>
<span class="go"> d   -1.425662</span>
<span class="go"> dtype: float64)</span>

<span class="gp">In [223]: </span><span class="n">s1</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="n">s2</span><span class="p">,</span> <span class="n">join</span><span class="o">=</span><span class="s2">"left"</span><span class="p">)</span>
<span class="gh">Out[223]: </span>
<span class="go">(a   -0.186646</span>
<span class="go"> b   -1.692424</span>
<span class="go"> c   -0.303893</span>
<span class="go"> d   -1.425662</span>
<span class="go"> dtype: float64,</span>
<span class="go"> a         NaN</span>
<span class="go"> b   -1.692424</span>
<span class="go"> c   -0.303893</span>
<span class="go"> d   -1.425662</span>
<span class="go"> dtype: float64)</span>
</pre></div>
</div>
<p id="basics-df-join">对于 DataFrame，join 方法默认会应用于索引和列。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [224]: </span><span class="n">df</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="n">df2</span><span class="p">,</span> <span class="n">join</span><span class="o">=</span><span class="s2">"inner"</span><span class="p">)</span>
<span class="gh">Out[224]: </span>
<span class="go">(        one       two</span>
<span class="go"> a  1.394981  1.772517</span>
<span class="go"> b  0.343054  1.912123</span>
<span class="go"> c  0.695246  1.478369,</span>
<span class="go">         one       two</span>
<span class="go"> a  1.394981  1.772517</span>
<span class="go"> b  0.343054  1.912123</span>
<span class="go"> c  0.695246  1.478369)</span>
</pre></div>
</div>
<p>您还可以传递一个 <code class="docutils literal notranslate"><span class="pre">axis</span></code> 选项，仅在指定的轴上对齐。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [225]: </span><span class="n">df</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="n">df2</span><span class="p">,</span> <span class="n">join</span><span class="o">=</span><span class="s2">"inner"</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="gh">Out[225]: </span>
<span class="go">(        one       two     three</span>
<span class="go"> a  1.394981  1.772517       NaN</span>
<span class="go"> b  0.343054  1.912123 -0.050390</span>
<span class="go"> c  0.695246  1.478369  1.227435,</span>
<span class="go">         one       two</span>
<span class="go"> a  1.394981  1.772517</span>
<span class="go"> b  0.343054  1.912123</span>
<span class="go"> c  0.695246  1.478369)</span>
</pre></div>
</div>
<p id="basics-align-frame-series">如果将 Series 传递给 <a class="reference internal" href="../reference/api/pandas.DataFrame.align.html#pandas.DataFrame.align" title="pandas.DataFrame.align"><code class="xref py py-meth docutils literal notranslate"><span class="pre">DataFrame.align()</span></code></a>，您可以使用 <code class="docutils literal notranslate"><span class="pre">axis</span></code> 参数选择在 DataFrame 的索引或列上对齐两个对象。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [226]: </span><span class="n">df</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="n">df2</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gh">Out[226]: </span>
<span class="go">(        one     three       two</span>
<span class="go"> a  1.394981       NaN  1.772517</span>
<span class="go"> b  0.343054 -0.050390  1.912123</span>
<span class="go"> c  0.695246  1.227435  1.478369</span>
<span class="go"> d       NaN -0.613172  0.279344,</span>
<span class="go"> one      1.394981</span>
<span class="go"> three         NaN</span>
<span class="go"> two      1.772517</span>
<span class="go"> Name: a, dtype: float64)</span>
</pre></div>
</div>
</section>
<section id="filling-while-reindexing">
<span id="basics-reindex-fill"></span><h3>重新索引时填充<a class="headerlink" href="basics.html#filling-while-reindexing" title="Link to this heading">#</a></h3>
<p><a class="reference internal" href="../reference/api/pandas.Series.reindex.html#pandas.Series.reindex" title="pandas.Series.reindex"><code class="xref py py-meth docutils literal notranslate"><span class="pre">reindex()</span></code></a> 接受一个可选参数 <code class="docutils literal notranslate"><span class="pre">method</span></code>，它是一个从下表选择的填充方法。</p>
<table class="table">
<colgroup>
<col style="width: 37.5%" />
<col style="width: 62.5%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>方法</p></th>
<th class="head"><p>操作</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>pad / ffill</p></td>
<td><p>向前填充值</p></td>
</tr>
<tr class="row-odd"><td><p>bfill / backfill</p></td>
<td><p>向后填充值</p></td>
</tr>
<tr class="row-even"><td><p>nearest</p></td>
<td><p>从最近的索引值填充</p></td>
</tr>
</tbody>
</table>
<p>我们在一个简单的 Series 上演示这些填充方法。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [227]: </span><span class="n">rng</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">"1/3/2000"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<span class="gp">In [228]: </span><span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">rng</span><span class="p">)</span>

<span class="gp">In [229]: </span><span class="n">ts2</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">iloc</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">]]</span>

<span class="gp">In [230]: </span><span class="n">ts</span>
<span class="gh">Out[230]: </span>
<span class="go">2000-01-03    0.183051</span>
<span class="go">2000-01-04    0.400528</span>
<span class="go">2000-01-05   -0.015083</span>
<span class="go">2000-01-06    2.395489</span>
<span class="go">2000-01-07    1.414806</span>
<span class="go">2000-01-08    0.118428</span>
<span class="go">2000-01-09    0.733639</span>
<span class="go">2000-01-10   -0.936077</span>
<span class="go">Freq: D, dtype: float64</span>

<span class="gp">In [231]: </span><span class="n">ts2</span>
<span class="gh">Out[231]: </span>
<span class="go">2000-01-03    0.183051</span>
<span class="go">2000-01-06    2.395489</span>
<span class="go">2000-01-09    0.733639</span>
<span class="go">Freq: 3D, dtype: float64</span>

<span class="gp">In [232]: </span><span class="n">ts2</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="gh">Out[232]: </span>
<span class="go">2000-01-03    0.183051</span>
<span class="go">2000-01-04         NaN</span>
<span class="go">2000-01-05         NaN</span>
<span class="go">2000-01-06    2.395489</span>
<span class="go">2000-01-07         NaN</span>
<span class="go">2000-01-08         NaN</span>
<span class="go">2000-01-09    0.733639</span>
<span class="go">2000-01-10         NaN</span>
<span class="go">Freq: D, dtype: float64</span>

<span class="gp">In [233]: </span><span class="n">ts2</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">"ffill"</span><span class="p">)</span>
<span class="gh">Out[233]: </span>
<span class="go">2000-01-03    0.183051</span>
<span class="go">2000-01-04    0.183051</span>
<span class="go">2000-01-05    0.183051</span>
<span class="go">2000-01-06    2.395489</span>
<span class="go">2000-01-07    2.395489</span>
<span class="go">2000-01-08    2.395489</span>
<span class="go">2000-01-09    0.733639</span>
<span class="go">2000-01-10    0.733639</span>
<span class="go">Freq: D, dtype: float64</span>

<span class="gp">In [234]: </span><span class="n">ts2</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">"bfill"</span><span class="p">)</span>
<span class="gh">Out[234]: </span>
<span class="go">2000-01-03    0.183051</span>
<span class="go">2000-01-04    2.395489</span>
<span class="go">2000-01-05    2.395489</span>
<span class="go">2000-01-06    2.395489</span>
<span class="go">2000-01-07    0.733639</span>
<span class="go">2000-01-08    0.733639</span>
<span class="go">2000-01-09    0.733639</span>
<span class="go">2000-01-10         NaN</span>
<span class="go">Freq: D, dtype: float64</span>

<span class="gp">In [235]: </span><span class="n">ts2</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">"nearest"</span><span class="p">)</span>
<span class="gh">Out[235]: </span>
<span class="go">2000-01-03    0.183051</span>
<span class="go">2000-01-04    0.183051</span>
<span class="go">2000-01-05    2.395489</span>
<span class="go">2000-01-06    2.395489</span>
<span class="go">2000-01-07    2.395489</span>
<span class="go">2000-01-08    0.733639</span>
<span class="go">2000-01-09    0.733639</span>
<span class="go">2000-01-10    0.733639</span>
<span class="go">Freq: D, dtype: float64</span>
</pre></div>
</div>
<p>这些方法要求索引是<strong>有序的</strong>（递增或递减）。</p>
<p>请注意，除了 <code class="docutils literal notranslate"><span class="pre">method='nearest'</span></code> 之外，相同的结果也可以通过使用 <a class="reference internal" href="missing_data.html#missing-data-fillna"><span class="std std-ref">ffill</span></a> 或 <a class="reference internal" href="missing_data.html#missing-data-interpolate"><span class="std std-ref">interpolate</span></a> 实现。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [236]: </span><span class="n">ts2</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">ffill</span><span class="p">()</span>
<span class="gh">Out[236]: </span>
<span class="go">2000-01-03    0.183051</span>
<span class="go">2000-01-04    0.183051</span>
<span class="go">2000-01-05    0.183051</span>
<span class="go">2000-01-06    2.395489</span>
<span class="go">2000-01-07    2.395489</span>
<span class="go">2000-01-08    2.395489</span>
<span class="go">2000-01-09    0.733639</span>
<span class="go">2000-01-10    0.733639</span>
<span class="go">Freq: D, dtype: float64</span>
</pre></div>
</div>
<p>如果索引不是单调递增或递减的，<a class="reference internal" href="../reference/api/pandas.Series.reindex.html#pandas.Series.reindex" title="pandas.Series.reindex"><code class="xref py py-meth docutils literal notranslate"><span class="pre">reindex()</span></code></a> 将引发 ValueError。<a class="reference internal" href="../reference/api/pandas.Series.fillna.html#pandas.Series.fillna" title="pandas.Series.fillna"><code class="xref py py-meth docutils literal notranslate"><span class="pre">fillna()</span></code></a> 和 <a class="reference internal" href="../reference/api/pandas.Series.interpolate.html#pandas.Series.interpolate" title="pandas.Series.interpolate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">interpolate()</span></code></a> 不会对索引的顺序进行任何检查。</p>
</section>
<section id="limits-on-filling-while-reindexing">
<span id="basics-limits-on-reindex-fill"></span><h3>重新索引时填充的限制<a class="headerlink" href="basics.html#limits-on-filling-while-reindexing" title="Link to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">limit</span></code> 和 <code class="docutils literal notranslate"><span class="pre">tolerance</span></code> 参数提供了对重新索引时填充的额外控制。limit 指定连续匹配的最大数量。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [237]: </span><span class="n">ts2</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">"ffill"</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gh">Out[237]: </span>
<span class="go">2000-01-03    0.183051</span>
<span class="go">2000-01-04    0.183051</span>
<span class="go">2000-01-05         NaN</span>
<span class="go">2000-01-06    2.395489</span>
<span class="go">2000-01-07    2.395489</span>
<span class="go">2000-01-08         NaN</span>
<span class="go">2000-01-09    0.733639</span>
<span class="go">2000-01-10    0.733639</span>
<span class="go">Freq: D, dtype: float64</span>
</pre></div>
</div>
<p>相比之下，tolerance 指定索引和索引器值之间的最大距离。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [238]: </span><span class="n">ts2</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">"ffill"</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="s2">"1 day"</span><span class="p">)</span>
<span class="gh">Out[238]: </span>
<span class="go">2000-01-03    0.183051</span>
<span class="go">2000-01-04    0.183051</span>
<span class="go">2000-01-05         NaN</span>
<span class="go">2000-01-06    2.395489</span>
<span class="go">2000-01-07    2.395489</span>
<span class="go">2000-01-08         NaN</span>
<span class="go">2000-01-09    0.733639</span>
<span class="go">2000-01-10    0.733639</span>
<span class="go">Freq: D, dtype: float64</span>
</pre></div>
</div>
<p>请注意，当用于 <code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code>、<code class="docutils literal notranslate"><span class="pre">TimedeltaIndex</span></code> 或 <code class="docutils literal notranslate"><span class="pre">PeriodIndex</span></code> 时，如果可能，<code class="docutils literal notranslate"><span class="pre">tolerance</span></code> 将被强制转换为 <code class="docutils literal notranslate"><span class="pre">Timedelta</span></code>。这允许您使用适当的字符串指定容差。</p>
</section>
<section id="dropping-labels-from-an-axis">
<span id="basics-drop"></span><h3>从轴中删除标签<a class="headerlink" href="basics.html#dropping-labels-from-an-axis" title="Link to this heading">#</a></h3>
<p>与 <code class="docutils literal notranslate"><span class="pre">reindex</span></code> 密切相关的一个方法是 <a class="reference internal" href="../reference/api/pandas.DataFrame.drop.html#pandas.DataFrame.drop" title="pandas.DataFrame.drop"><code class="xref py py-meth docutils literal notranslate"><span class="pre">drop()</span></code></a> 函数。它从轴中移除一组标签。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [239]: </span><span class="n">df</span>
<span class="gh">Out[239]: </span>
<span class="go">        one       two     three</span>
<span class="go">a  1.394981  1.772517       NaN</span>
<span class="go">b  0.343054  1.912123 -0.050390</span>
<span class="go">c  0.695246  1.478369  1.227435</span>
<span class="go">d       NaN  0.279344 -0.613172</span>

<span class="gp">In [240]: </span><span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"d"</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="gh">Out[240]: </span>
<span class="go">        one       two     three</span>
<span class="go">b  0.343054  1.912123 -0.050390</span>
<span class="go">c  0.695246  1.478369  1.227435</span>

<span class="gp">In [241]: </span><span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">"one"</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gh">Out[241]: </span>
<span class="go">        two     three</span>
<span class="go">a  1.772517       NaN</span>
<span class="go">b  1.912123 -0.050390</span>
<span class="go">c  1.478369  1.227435</span>
<span class="go">d  0.279344 -0.613172</span>
</pre></div>
</div>
<p>请注意，以下方法也有效，但不太明显/简洁：</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [242]: </span><span class="n">df</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">difference</span><span class="p">([</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"d"</span><span class="p">]))</span>
<span class="gh">Out[242]: </span>
<span class="go">        one       two     three</span>
<span class="go">b  0.343054  1.912123 -0.050390</span>
<span class="go">c  0.695246  1.478369  1.227435</span>
</pre></div>
</div>
</section>
<section id="renaming-mapping-labels">
<span id="basics-rename"></span><h3>重命名 / 映射标签<a class="headerlink" href="basics.html#renaming-mapping-labels" title="Link to this heading">#</a></h3>
<p><a class="reference internal" href="../reference/api/pandas.DataFrame.rename.html#pandas.DataFrame.rename" title="pandas.DataFrame.rename"><code class="xref py py-meth docutils literal notranslate"><span class="pre">rename()</span></code></a> 方法允许您根据一些映射（字典或 Series）或任意函数重新标记轴。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [243]: </span><span class="n">s</span>
<span class="gh">Out[243]: </span>
<span class="go">a   -0.186646</span>
<span class="go">b   -1.692424</span>
<span class="go">c   -0.303893</span>
<span class="go">d   -1.425662</span>
<span class="go">e    1.114285</span>
<span class="go">dtype: float64</span>

<span class="gp">In [244]: </span><span class="n">s</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">upper</span><span class="p">)</span>
<span class="gh">Out[244]: </span>
<span class="go">A   -0.186646</span>
<span class="go">B   -1.692424</span>
<span class="go">C   -0.303893</span>
<span class="go">D   -1.425662</span>
<span class="go">E    1.114285</span>
<span class="go">dtype: float64</span>
</pre></div>
</div>
<p>如果您传递一个函数，它在用任何标签调用时必须返回一个值（并且必须生成一组唯一值）。也可以使用字典或 Series。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [245]: </span><span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">"one"</span><span class="p">:</span> <span class="s2">"foo"</span><span class="p">,</span> <span class="s2">"two"</span><span class="p">:</span> <span class="s2">"bar"</span><span class="p">},</span>
<span class="gp">   .....: </span>    <span class="n">index</span><span class="o">=</span><span class="p">{</span><span class="s2">"a"</span><span class="p">:</span> <span class="s2">"apple"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">:</span> <span class="s2">"banana"</span><span class="p">,</span> <span class="s2">"d"</span><span class="p">:</span> <span class="s2">"durian"</span><span class="p">},</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>
<span class="gh">Out[245]: </span>
<span class="go">             foo       bar     three</span>
<span class="go">apple   1.394981  1.772517       NaN</span>
<span class="go">banana  0.343054  1.912123 -0.050390</span>
<span class="go">c       0.695246  1.478369  1.227435</span>
<span class="go">durian       NaN  0.279344 -0.613172</span>
</pre></div>
</div>
<p>如果映射不包含列/索引标签，则不会重命名。请注意，映射中的额外标签不会引发错误。</p>
<p><a class="reference internal" href="../reference/api/pandas.DataFrame.rename.html#pandas.DataFrame.rename" title="pandas.DataFrame.rename"><code class="xref py py-meth docutils literal notranslate"><span class="pre">DataFrame.rename()</span></code></a> 还支持“轴样式”调用约定，您可以在其中指定单个 <code class="docutils literal notranslate"><span class="pre">mapper</span></code> 及其应用的 <code class="docutils literal notranslate"><span class="pre">axis</span></code>。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [246]: </span><span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s2">"one"</span><span class="p">:</span> <span class="s2">"foo"</span><span class="p">,</span> <span class="s2">"two"</span><span class="p">:</span> <span class="s2">"bar"</span><span class="p">},</span> <span class="n">axis</span><span class="o">=</span><span class="s2">"columns"</span><span class="p">)</span>
<span class="gh">Out[246]: </span>
<span class="go">        foo       bar     three</span>
<span class="go">a  1.394981  1.772517       NaN</span>
<span class="go">b  0.343054  1.912123 -0.050390</span>
<span class="go">c  0.695246  1.478369  1.227435</span>
<span class="go">d       NaN  0.279344 -0.613172</span>

<span class="gp">In [247]: </span><span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s2">"a"</span><span class="p">:</span> <span class="s2">"apple"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">:</span> <span class="s2">"banana"</span><span class="p">,</span> <span class="s2">"d"</span><span class="p">:</span> <span class="s2">"durian"</span><span class="p">},</span> <span class="n">axis</span><span class="o">=</span><span class="s2">"index"</span><span class="p">)</span>
<span class="gh">Out[247]: </span>
<span class="go">             one       two     three</span>
<span class="go">apple   1.394981  1.772517       NaN</span>
<span class="go">banana  0.343054  1.912123 -0.050390</span>
<span class="go">c       0.695246  1.478369  1.227435</span>
<span class="go">durian       NaN  0.279344 -0.613172</span>
</pre></div>
</div>
<p>最后，<a class="reference internal" href="../reference/api/pandas.Series.rename.html#pandas.Series.rename" title="pandas.Series.rename"><code class="xref py py-meth docutils literal notranslate"><span class="pre">rename()</span></code></a> 也接受一个标量或类列表来更改 <code class="docutils literal notranslate"><span class="pre">Series.name</span></code> 属性。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [248]: </span><span class="n">s</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s2">"scalar-name"</span><span class="p">)</span>
<span class="gh">Out[248]: </span>
<span class="go">a   -0.186646</span>
<span class="go">b   -1.692424</span>
<span class="go">c   -0.303893</span>
<span class="go">d   -1.425662</span>
<span class="go">e    1.114285</span>
<span class="go">Name: scalar-name, dtype: float64</span>
</pre></div>
</div>
<p id="basics-rename-axis">方法 <a class="reference internal" href="../reference/api/pandas.DataFrame.rename_axis.html#pandas.DataFrame.rename_axis" title="pandas.DataFrame.rename_axis"><code class="xref py py-meth docutils literal notranslate"><span class="pre">DataFrame.rename_axis()</span></code></a> 和 <a class="reference internal" href="../reference/api/pandas.Series.rename_axis.html#pandas.Series.rename_axis" title="pandas.Series.rename_axis"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Series.rename_axis()</span></code></a> 允许更改 <code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code> 的特定名称（与标签不同）。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [249]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="p">{</span><span class="s2">"x"</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="s2">"y"</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">60</span><span class="p">]},</span>
<span class="gp">   .....: </span>    <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_product</span><span class="p">(</span>
<span class="gp">   .....: </span>        <span class="p">[[</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">,</span> <span class="s2">"c"</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]],</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s2">"let"</span><span class="p">,</span> <span class="s2">"num"</span><span class="p">]</span>
<span class="gp">   .....: </span>    <span class="p">),</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [250]: </span><span class="n">df</span>
<span class="gh">Out[250]: </span>
<span class="go">         x   y</span>
<span class="go">let num       </span>
<span class="go">a   1    1  10</span>
<span class="go">    2    2  20</span>
<span class="go">b   1    3  30</span>
<span class="go">    2    4  40</span>
<span class="go">c   1    5  50</span>
<span class="go">    2    6  60</span>

<span class="gp">In [251]: </span><span class="n">df</span><span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">{</span><span class="s2">"let"</span><span class="p">:</span> <span class="s2">"abc"</span><span class="p">})</span>
<span class="gh">Out[251]: </span>
<span class="go">         x   y</span>
<span class="go">abc num       </span>
<span class="go">a   1    1  10</span>
<span class="go">    2    2  20</span>
<span class="go">b   1    3  30</span>
<span class="go">    2    4  40</span>
<span class="go">c   1    5  50</span>
<span class="go">    2    6  60</span>

<span class="gp">In [252]: </span><span class="n">df</span><span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="nb">str</span><span class="o">.</span><span class="n">upper</span><span class="p">)</span>
<span class="gh">Out[252]: </span>
<span class="go">         x   y</span>
<span class="go">LET NUM       </span>
<span class="go">a   1    1  10</span>
<span class="go">    2    2  20</span>
<span class="go">b   1    3  30</span>
<span class="go">    2    4  40</span>
<span class="go">c   1    5  50</span>
<span class="go">    2    6  60</span>
</pre></div>
</div>
</section>
</section>
<section id="iteration">
<span id="basics-iteration"></span><h2>迭代<a class="headerlink" href="basics.html#iteration" title="Link to this heading">#</a></h2>
<p>对 pandas 对象进行基本迭代的行为取决于其类型。迭代 Series 时，它被视为类数组，基本迭代会产生值。DataFrame 遵循类字典的约定，迭代对象的“键”。</p>
<p>简而言之，基本迭代（<code class="docutils literal notranslate"><span class="pre">for</span> <span class="pre">i</span> <span class="pre">in</span> <span class="pre">object</span></code>）产生：</p>
<ul class="simple">
<li><p><strong>Series</strong>：值</p></li>
<li><p><strong>DataFrame</strong>：列标签</p></li>
</ul>
<p>因此，例如，迭代 DataFrame 会给您列名。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [253]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="p">{</span><span class="s2">"col1"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="s2">"col2"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">3</span><span class="p">)},</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">,</span> <span class="s2">"c"</span><span class="p">]</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [254]: </span><span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="p">:</span>
<span class="gp">   .....: </span>    <span class="nb">print</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
<span class="gp">   .....: </span>
<span class="go">col1</span>
<span class="go">col2</span>
</pre></div>
</div>
<p>pandas 对象还具有类似字典的 <a class="reference internal" href="../reference/api/pandas.DataFrame.items.html#pandas.DataFrame.items" title="pandas.DataFrame.items"><code class="xref py py-meth docutils literal notranslate"><span class="pre">items()</span></code></a> 方法，用于迭代（键，值）对。</p>
<p>要迭代 DataFrame 的行，可以使用以下方法：</p>
<ul class="simple">
<li><p><a class="reference internal" href="../reference/api/pandas.DataFrame.iterrows.html#pandas.DataFrame.iterrows" title="pandas.DataFrame.iterrows"><code class="xref py py-meth docutils literal notranslate"><span class="pre">iterrows()</span></code></a>：将 DataFrame 的行作为（索引，Series）对进行迭代。这会将行转换为 Series 对象，这可能会改变数据类型并对性能产生影响。</p></li>
<li><p><a class="reference internal" href="../reference/api/pandas.DataFrame.itertuples.html#pandas.DataFrame.itertuples" title="pandas.DataFrame.itertuples"><code class="xref py py-meth docutils literal notranslate"><span class="pre">itertuples()</span></code></a>：将 DataFrame 的行作为值的命名元组进行迭代。这比 <a class="reference internal" href="../reference/api/pandas.DataFrame.iterrows.html#pandas.DataFrame.iterrows" title="pandas.DataFrame.iterrows"><code class="xref py py-meth docutils literal notranslate"><span class="pre">iterrows()</span></code></a> 快得多，在大多数情况下更适合用于迭代 DataFrame 的值。</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>迭代 pandas 对象通常**很慢**。在许多情况下，不需要手动迭代行，可以通过以下方法之一避免：</p>
<ul class="simple">
<li><p>寻找*向量化*解决方案：许多操作可以使用内置方法或 NumPy 函数、（布尔）索引等来执行。</p></li>
<li><p>当您有一个无法一次性处理整个 DataFrame/Series 的函数时，最好使用 <a class="reference internal" href="../reference/api/pandas.DataFrame.apply.html#pandas.DataFrame.apply" title="pandas.DataFrame.apply"><code class="xref py py-meth docutils literal notranslate"><span class="pre">apply()</span></code></a> 而不是迭代值。请参阅 <a class="reference internal" href="basics.html#basics-apply"><span class="std std-ref">函数应用</span></a> 的文档。</p></li>
<li><p>如果您需要在值上进行迭代操作但性能很重要，请考虑使用 Cython 或 Numba 编写内部循环。有关此方法的示例，请参阅 <a class="reference internal" href="enhancingperf.html#enhancingperf"><span class="std std-ref">性能优化</span></a> 部分。</p></li>
</ul>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>您**绝不应该修改**正在迭代的对象。这不保证在所有情况下都有效。根据数据类型，迭代器返回的是副本而不是视图，对其进行写入将无效！</p>
<p>例如，在以下情况下，设置值没有效果：</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [255]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">"a"</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="s2">"b"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">,</span> <span class="s2">"c"</span><span class="p">]})</span>

<span class="gp">In [256]: </span><span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
<span class="gp">   .....: </span>    <span class="n">row</span><span class="p">[</span><span class="s2">"a"</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
<span class="gp">   .....: </span>

<span class="gp">In [257]: </span><span class="n">df</span>
<span class="gh">Out[257]: </span>
<span class="go">   a  b</span>
<span class="go">0  1  a</span>
<span class="go">1  2  b</span>
<span class="go">2  3  c</span>
</pre></div>
</div>
</div>
<section id="items">
<h3>items<a class="headerlink" href="basics.html#items" title="Link to this heading">#</a></h3>
<p>与类字典接口一致，<a class="reference internal" href="../reference/api/pandas.DataFrame.items.html#pandas.DataFrame.items" title="pandas.DataFrame.items"><code class="xref py py-meth docutils literal notranslate"><span class="pre">items()</span></code></a> 迭代键值对。</p>
<ul class="simple">
<li><p><strong>Series</strong>：（索引，标量值）对</p></li>
<li><p><strong>DataFrame</strong>：（列，Series）对</p></li>
</ul>
<p>例如：</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [258]: </span><span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">ser</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<span class="gp">   .....: </span>    <span class="nb">print</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
<span class="gp">   .....: </span>    <span class="nb">print</span><span class="p">(</span><span class="n">ser</span><span class="p">)</span>
<span class="gp">   .....: </span>
<span class="go">a</span>
<span class="go">0    1</span>
<span class="go">1    2</span>
<span class="go">2    3</span>
<span class="go">Name: a, dtype: int64</span>
<span class="go">b</span>
<span class="go">0    a</span>
<span class="go">1    b</span>
<span class="go">2    c</span>
<span class="go">Name: b, dtype: object</span>
</pre></div>
</div>
</section>
<section id="iterrows">
<span id="basics-iterrows"></span><h3>iterrows<a class="headerlink" href="basics.html#iterrows" title="Link to this heading">#</a></h3>
<p><a class="reference internal" href="../reference/api/pandas.DataFrame.iterrows.html#pandas.DataFrame.iterrows" title="pandas.DataFrame.iterrows"><code class="xref py py-meth docutils literal notranslate"><span class="pre">iterrows()</span></code></a> 允许您将 DataFrame 的行作为 Series 对象进行迭代。它返回一个迭代器，生成每个索引值以及一个包含每行数据的 Series。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [259]: </span><span class="k">for</span> <span class="n">row_index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
<span class="gp">   .....: </span>    <span class="nb">print</span><span class="p">(</span><span class="n">row_index</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<span class="gp">   .....: </span>
<span class="go">0</span>
<span class="go">a    1</span>
<span class="go">b    a</span>
<span class="go">Name: 0, dtype: object</span>
<span class="go">1</span>
<span class="go">a    2</span>
<span class="go">b    b</span>
<span class="go">Name: 1, dtype: object</span>
<span class="go">2</span>
<span class="go">a    3</span>
<span class="go">b    c</span>
<span class="go">Name: 2, dtype: object</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p>因为 <a class="reference internal" href="../reference/api/pandas.DataFrame.iterrows.html#pandas.DataFrame.iterrows" title="pandas.DataFrame.iterrows"><code class="xref py py-meth docutils literal notranslate"><span class="pre">iterrows()</span></code></a> 为每一行返回一个 Series，所以它**不**保留跨行的 dtypes（DataFrames 的 dtypes 是跨列保留的）。例如：</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [260]: </span><span class="n">df_orig</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">]],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"int"</span><span class="p">,</span> <span class="s2">"float"</span><span class="p">])</span>

<span class="gp">In [261]: </span><span class="n">df_orig</span><span class="o">.</span><span class="n">dtypes</span>
<span class="gh">Out[261]: </span>
<span class="go">int        int64</span>
<span class="go">float    float64</span>
<span class="go">dtype: object</span>

<span class="gp">In [262]: </span><span class="n">row</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">df_orig</span><span class="o">.</span><span class="n">iterrows</span><span class="p">())[</span><span class="mi">1</span><span class="p">]</span>

<span class="gp">In [263]: </span><span class="n">row</span>
<span class="gh">Out[263]: </span>
<span class="go">int      1.0</span>
<span class="go">float    1.5</span>
<span class="go">Name: 0, dtype: float64</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">row</span></code> 中的所有值（作为 Series 返回）现在都向上转换为浮点数，包括列 <code class="docutils literal notranslate"><span class="pre">x</span></code> 中的原始整数值。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [264]: </span><span class="n">row</span><span class="p">[</span><span class="s2">"int"</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span>
<span class="gh">Out[264]: </span><span class="go">dtype('float64')</span>

<span class="gp">In [265]: </span><span class="n">df_orig</span><span class="p">[</span><span class="s2">"int"</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span>
<span class="gh">Out[265]: </span><span class="go">dtype('int64')</span>
</pre></div>
</div>
<p>为了在迭代行时保留 dtypes，最好使用 <a class="reference internal" href="../reference/api/pandas.DataFrame.itertuples.html#pandas.DataFrame.itertuples" title="pandas.DataFrame.itertuples"><code class="xref py py-meth docutils literal notranslate"><span class="pre">itertuples()</span></code></a>，它返回值的命名元组，并且通常比 <a class="reference internal" href="../reference/api/pandas.DataFrame.iterrows.html#pandas.DataFrame.iterrows" title="pandas.DataFrame.iterrows"><code class="xref py py-meth docutils literal notranslate"><span class="pre">iterrows()</span></code></a> 快得多。</p>
</div>
<p>例如，一种巧妙的转置 DataFrame 的方法是：</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [266]: </span><span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">"x"</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="s2">"y"</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]})</span>

<span class="gp">In [267]: </span><span class="nb">print</span><span class="p">(</span><span class="n">df2</span><span class="p">)</span>
<span class="go">   x  y</span>
<span class="go">0  1  4</span>
<span class="go">1  2  5</span>
<span class="go">2  3  6</span>

<span class="gp">In [268]: </span><span class="nb">print</span><span class="p">(</span><span class="n">df2</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="go">   0  1  2</span>
<span class="go">x  1  2  3</span>
<span class="go">y  4  5  6</span>

<span class="gp">In [269]: </span><span class="n">df2_t</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="n">idx</span><span class="p">:</span> <span class="n">values</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">df2</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()})</span>

<span class="gp">In [270]: </span><span class="nb">print</span><span class="p">(</span><span class="n">df2_t</span><span class="p">)</span>
<span class="go">   0  1  2</span>
<span class="go">x  1  2  3</span>
<span class="go">y  4  5  6</span>
</pre></div>
</div>
</section>
<section id="itertuples">
<h3>itertuples<a class="headerlink" href="basics.html#itertuples" title="Link to this heading">#</a></h3>
<p><a class="reference internal" href="../reference/api/pandas.DataFrame.itertuples.html#pandas.DataFrame.itertuples" title="pandas.DataFrame.itertuples"><code class="xref py py-meth docutils literal notranslate"><span class="pre">itertuples()</span></code></a> 方法将返回一个迭代器，为 DataFrame 中的每一行生成一个命名元组。元组的第一个元素将是行对应的索引值，而其余的值是行值。</p>
<p>例如：</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [271]: </span><span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">itertuples</span><span class="p">():</span>
<span class="gp">   .....: </span>    <span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
<span class="gp">   .....: </span>
<span class="go">Pandas(Index=0, a=1, b='a')</span>
<span class="go">Pandas(Index=1, a=2, b='b')</span>
<span class="go">Pandas(Index=2, a=3, b='c')</span>
</pre></div>
</div>
<p>此方法不会将行转换为 Series 对象；它只是将值返回到命名元组中。因此，<a class="reference internal" href="../reference/api/pandas.DataFrame.itertuples.html#pandas.DataFrame.itertuples" title="pandas.DataFrame.itertuples"><code class="xref py py-meth docutils literal notranslate"><span class="pre">itertuples()</span></code></a> 保留了值的数据类型，并且通常比 <a class="reference internal" href="../reference/api/pandas.DataFrame.iterrows.html#pandas.DataFrame.iterrows" title="pandas.DataFrame.iterrows"><code class="xref py py-meth docutils literal notranslate"><span class="pre">iterrows()</span></code></a> 更快。</p>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p>如果列名是无效的 Python 标识符、重复的或以下划线开头，则会被重命名为位置名称。当列数很多（>255）时，将返回普通元组。</p>
</div>
</section>
</section>
<section id="dt-accessor">
<span id="basics-dt-accessors"></span><h2>.dt 访问器<a class="headerlink" href="basics.html#dt-accessor" title="Link to this heading">#</a></h2>
<p>如果 Series 是日期时间/周期类型的 Series，它会有一个访问器，可以简洁地返回 Series *值*的日期时间属性。这将返回一个 Series，其索引与现有 Series 的索引相同。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="go"># datetime</span>
<span class="gp">In [272]: </span><span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">"20130101 09:10:12"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>

<span class="gp">In [273]: </span><span class="n">s</span>
<span class="gh">Out[273]: </span>
<span class="go">0   2013-01-01 09:10:12</span>
<span class="go">1   2013-01-02 09:10:12</span>
<span class="go">2   2013-01-03 09:10:12</span>
<span class="go">3   2013-01-04 09:10:12</span>
<span class="go">dtype: datetime64[ns]</span>

<span class="gp">In [274]: </span><span class="n">s</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span>
<span class="gh">Out[274]: </span>
<span class="go">0    9</span>
<span class="go">1    9</span>
<span class="go">2    9</span>
<span class="go">3    9</span>
<span class="go">dtype: int32</span>

<span class="gp">In [275]: </span><span class="n">s</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">second</span>
<span class="gh">Out[275]: </span>
<span class="go">0    12</span>
<span class="go">1    12</span>
<span class="go">2    12</span>
<span class="go">3    12</span>
<span class="go">dtype: int32</span>

<span class="gp">In [276]: </span><span class="n">s</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">day</span>
<span class="gh">Out[276]: </span>
<span class="go">0    1</span>
<span class="go">1    2</span>
<span class="go">2    3</span>
<span class="go">3    4</span>
<span class="go">dtype: int32</span>
</pre></div>
</div>
<p>这使得以下漂亮的表达式成为可能：</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [277]: </span><span class="n">s</span><span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">day</span> <span class="o">==</span> <span class="mi">2</span><span class="p">]</span>
<span class="gh">Out[277]: </span>
<span class="go">1   2013-01-02 09:10:12</span>
<span class="go">dtype: datetime64[ns]</span>
</pre></div>
</div>
<p>您可以轻松生成时区感知的转换。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [278]: </span><span class="n">stz</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="s2">"US/Eastern"</span><span class="p">)</span>

<span class="gp">In [279]: </span><span class="n">stz</span>
<span class="gh">Out[279]: </span>
<span class="go">0   2013-01-01 09:10:12-05:00</span>
<span class="go">1   2013-01-02 09:10:12-05:00</span>
<span class="go">2   2013-01-03 09:10:12-05:00</span>
<span class="go">3   2013-01-04 09:10:12-05:00</span>
<span class="go">dtype: datetime64[ns, US/Eastern]</span>

<span class="gp">In [280]: </span><span class="n">stz</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">tz</span>
<span class="gh">Out[280]: </span><span class="go">&lt;DstTzInfo 'US/Eastern' LMT-1 day, 19:04:00 STD&gt;</span>
</pre></div>
</div>
<p>您还可以链式调用这些类型的操作。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [281]: </span><span class="n">s</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="s2">"UTC"</span><span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">tz_convert</span><span class="p">(</span><span class="s2">"US/Eastern"</span><span class="p">)</span>
<span class="gh">Out[281]: </span>
<span class="go">0   2013-01-01 04:10:12-05:00</span>
<span class="go">1   2013-01-02 04:10:12-05:00</span>
<span class="go">2   2013-01-03 04:10:12-05:00</span>
<span class="go">3   2013-01-04 04:10:12-05:00</span>
<span class="go">dtype: datetime64[ns, US/Eastern]</span>
</pre></div>
</div>
<p>您还可以使用 <a class="reference internal" href="../reference/api/pandas.Series.dt.strftime.html#pandas.Series.dt.strftime" title="pandas.Series.dt.strftime"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Series.dt.strftime()</span></code></a> 将日期时间值格式化为字符串，该方法支持与标准 <a class="reference external" href="https://docs.pythonlang.cn/3/library/datetime.html#datetime.datetime.strftime" title="(in Python v3.13)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">strftime()</span></code></a> 相同的格式。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="go"># DatetimeIndex</span>
<span class="gp">In [282]: </span><span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">"20130101"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>

<span class="gp">In [283]: </span><span class="n">s</span>
<span class="gh">Out[283]: </span>
<span class="go">0   2013-01-01</span>
<span class="go">1   2013-01-02</span>
<span class="go">2   2013-01-03</span>
<span class="go">3   2013-01-04</span>
<span class="go">dtype: datetime64[ns]</span>

<span class="gp">In [284]: </span><span class="n">s</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">"%Y/%m/</span><span class="si">%d</span><span class="s2">"</span><span class="p">)</span>
<span class="gh">Out[284]: </span>
<span class="go">0    2013/01/01</span>
<span class="go">1    2013/01/02</span>
<span class="go">2    2013/01/03</span>
<span class="go">3    2013/01/04</span>
<span class="go">dtype: object</span>
</pre></div>
</div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="go"># PeriodIndex</span>
<span class="gp">In [285]: </span><span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">period_range</span><span class="p">(</span><span class="s2">"20130101"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>

<span class="gp">In [286]: </span><span class="n">s</span>
<span class="gh">Out[286]: </span>
<span class="go">0    2013-01-01</span>
<span class="go">1    2013-01-02</span>
<span class="go">2    2013-01-03</span>
<span class="go">3    2013-01-04</span>
<span class="go">dtype: period[D]</span>

<span class="gp">In [287]: </span><span class="n">s</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">"%Y/%m/</span><span class="si">%d</span><span class="s2">"</span><span class="p">)</span>
<span class="gh">Out[287]: </span>
<span class="go">0    2013/01/01</span>
<span class="go">1    2013/01/02</span>
<span class="go">2    2013/01/03</span>
<span class="go">3    2013/01/04</span>
<span class="go">dtype: object</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">.dt</span></code> 访问器适用于 period 和 timedelta 数据类型。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="go"># period</span>
<span class="gp">In [288]: </span><span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">period_range</span><span class="p">(</span><span class="s2">"20130101"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"D"</span><span class="p">))</span>

<span class="gp">In [289]: </span><span class="n">s</span>
<span class="gh">Out[289]: </span>
<span class="go">0    2013-01-01</span>
<span class="go">1    2013-01-02</span>
<span class="go">2    2013-01-03</span>
<span class="go">3    2013-01-04</span>
<span class="go">dtype: period[D]</span>

<span class="gp">In [290]: </span><span class="n">s</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>
<span class="gh">Out[290]: </span>
<span class="go">0    2013</span>
<span class="go">1    2013</span>
<span class="go">2    2013</span>
<span class="go">3    2013</span>
<span class="go">dtype: int64</span>

<span class="gp">In [291]: </span><span class="n">s</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">day</span>
<span class="gh">Out[291]: </span>
<span class="go">0    1</span>
<span class="go">1    2</span>
<span class="go">2    3</span>
<span class="go">3    4</span>
<span class="go">dtype: int64</span>
</pre></div>
</div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="go"># timedelta</span>
<span class="gp">In [292]: </span><span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">timedelta_range</span><span class="p">(</span><span class="s2">"1 day 00:00:05"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"s"</span><span class="p">))</span>

<span class="gp">In [293]: </span><span class="n">s</span>
<span class="gh">Out[293]: </span>
<span class="go">0   1 days 00:00:05</span>
<span class="go">1   1 days 00:00:06</span>
<span class="go">2   1 days 00:00:07</span>
<span class="go">3   1 days 00:00:08</span>
<span class="go">dtype: timedelta64[ns]</span>

<span class="gp">In [294]: </span><span class="n">s</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">days</span>
<span class="gh">Out[294]: </span>
<span class="go">0    1</span>
<span class="go">1    1</span>
<span class="go">2    1</span>
<span class="go">3    1</span>
<span class="go">dtype: int64</span>

<span class="gp">In [295]: </span><span class="n">s</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">seconds</span>
<span class="gh">Out[295]: </span>
<span class="go">0    5</span>
<span class="go">1    6</span>
<span class="go">2    7</span>
<span class="go">3    8</span>
<span class="go">dtype: int32</span>

<span class="gp">In [296]: </span><span class="n">s</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">components</span>
<span class="gh">Out[296]: </span>
<span class="go">   days  hours  minutes  seconds  milliseconds  microseconds  nanoseconds</span>
<span class="go">0     1      0        0        5             0             0            0</span>
<span class="go">1     1      0        0        6             0             0            0</span>
<span class="go">2     1      0        0        7             0             0            0</span>
<span class="go">3     1      0        0        8             0             0            0</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p>如果您使用非日期时间类型的值进行访问，<code class="docutils literal notranslate"><span class="pre">Series.dt</span></code> 将引发 <code class="docutils literal notranslate"><span class="pre">TypeError</span></code>。</p>
</div>
</section>
<section id="vectorized-string-methods">
<h2>向量化字符串方法<a class="headerlink" href="basics.html#vectorized-string-methods" title="Link to this heading">#</a></h2>
<p>Series 配备了一组字符串处理方法，使操作数组的每个元素变得容易。最重要的是，这些方法会自动排除缺失/NA 值。这些方法通过 Series 的 <code class="docutils literal notranslate"><span class="pre">str</span></code> 属性访问，并且通常具有与等效（标量）内置字符串方法匹配的名称。例如：</p>
<blockquote>
<div><div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [297]: </span><span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="p">[</span><span class="s2">"A"</span><span class="p">,</span> <span class="s2">"B"</span><span class="p">,</span> <span class="s2">"C"</span><span class="p">,</span> <span class="s2">"Aaba"</span><span class="p">,</span> <span class="s2">"Baca"</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="s2">"CABA"</span><span class="p">,</span> <span class="s2">"dog"</span><span class="p">,</span> <span class="s2">"cat"</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">"string"</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [298]: </span><span class="n">s</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
<span class="gh">Out[298]: </span>
<span class="go">0       a</span>
<span class="go">1       b</span>
<span class="go">2       c</span>
<span class="go">3    aaba</span>
<span class="go">4    baca</span>
<span class="go">5    &lt;NA&gt;</span>
<span class="go">6    caba</span>
<span class="go">7     dog</span>
<span class="go">8     cat</span>
<span class="go">dtype: string</span>
</pre></div>
</div>
</div></blockquote>
<p>还提供了强大的模式匹配方法，但请注意，模式匹配通常默认使用（在某些情况下总是使用）<a class="reference external" href="https://docs.pythonlang.cn/3/library/re.html">正则表达式</a>。</p>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p>在 pandas 1.0 之前，字符串方法仅适用于 <code class="docutils literal notranslate"><span class="pre">object</span></code> -dtype 的 <code class="docutils literal notranslate"><span class="pre">Series</span></code>。pandas 1.0 添加了专用于字符串的 <a class="reference internal" href="../reference/api/pandas.StringDtype.html#pandas.StringDtype" title="pandas.StringDtype"><code class="xref py py-class docutils literal notranslate"><span class="pre">StringDtype</span></code></a>。更多信息请参见 <a class="reference internal" href="text.html#text-types"><span class="std std-ref">文本数据类型</span></a>。</p>
</div>
<p>请参阅 <a class="reference internal" href="text.html#text-string-methods"><span class="std std-ref">向量化字符串方法</span></a> 以获得完整描述。</p>
</section>
<section id="sorting">
<span id="basics-sorting"></span><h2>排序<a class="headerlink" href="basics.html#sorting" title="Link to this heading">#</a></h2>
<p>pandas 支持三种排序：按索引标签排序、按列值排序以及按两者组合排序。</p>
<section id="by-index">
<span id="basics-sort-index"></span><h3>按索引<a class="headerlink" href="basics.html#by-index" title="Link to this heading">#</a></h3>
<p><a class="reference internal" href="../reference/api/pandas.Series.sort_index.html#pandas.Series.sort_index" title="pandas.Series.sort_index"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Series.sort_index()</span></code></a> 和 <a class="reference internal" href="../reference/api/pandas.DataFrame.sort_index.html#pandas.DataFrame.sort_index" title="pandas.DataFrame.sort_index"><code class="xref py py-meth docutils literal notranslate"><span class="pre">DataFrame.sort_index()</span></code></a> 方法用于根据索引级别对 pandas 对象进行排序。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [299]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="p">{</span>
<span class="gp">   .....: </span>        <span class="s2">"one"</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">,</span> <span class="s2">"c"</span><span class="p">]),</span>
<span class="gp">   .....: </span>        <span class="s2">"two"</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">,</span> <span class="s2">"c"</span><span class="p">,</span> <span class="s2">"d"</span><span class="p">]),</span>
<span class="gp">   .....: </span>        <span class="s2">"three"</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">"b"</span><span class="p">,</span> <span class="s2">"c"</span><span class="p">,</span> <span class="s2">"d"</span><span class="p">]),</span>
<span class="gp">   .....: </span>    <span class="p">}</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [300]: </span><span class="n">unsorted_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"d"</span><span class="p">,</span> <span class="s2">"c"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"three"</span><span class="p">,</span> <span class="s2">"two"</span><span class="p">,</span> <span class="s2">"one"</span><span class="p">]</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [301]: </span><span class="n">unsorted_df</span>
<span class="gh">Out[301]: </span>
<span class="go">      three       two       one</span>
<span class="go">a       NaN -1.152244  0.562973</span>
<span class="go">d -0.252916 -0.109597       NaN</span>
<span class="go">c  1.273388 -0.167123  0.640382</span>
<span class="go">b -0.098217  0.009797 -1.299504</span>

<span class="go"># DataFrame</span>
<span class="gp">In [302]: </span><span class="n">unsorted_df</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
<span class="gh">Out[302]: </span>
<span class="go">      three       two       one</span>
<span class="go">a       NaN -1.152244  0.562973</span>
<span class="go">b -0.098217  0.009797 -1.299504</span>
<span class="go">c  1.273388 -0.167123  0.640382</span>
<span class="go">d -0.252916 -0.109597       NaN</span>

<span class="gp">In [303]: </span><span class="n">unsorted_df</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gh">Out[303]: </span>
<span class="go">      three       two       one</span>
<span class="go">d -0.252916 -0.109597       NaN</span>
<span class="go">c  1.273388 -0.167123  0.640382</span>
<span class="go">b -0.098217  0.009797 -1.299504</span>
<span class="go">a       NaN -1.152244  0.562973</span>

<span class="gp">In [304]: </span><span class="n">unsorted_df</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gh">Out[304]: </span>
<span class="go">        one     three       two</span>
<span class="go">a  0.562973       NaN -1.152244</span>
<span class="go">d       NaN -0.252916 -0.109597</span>
<span class="go">c  0.640382  1.273388 -0.167123</span>
<span class="go">b -1.299504 -0.098217  0.009797</span>

<span class="go"># Series</span>
<span class="gp">In [305]: </span><span class="n">unsorted_df</span><span class="p">[</span><span class="s2">"three"</span><span class="p">]</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
<span class="gh">Out[305]: </span>
<span class="go">a         NaN</span>
<span class="go">b   -0.098217</span>
<span class="go">c    1.273388</span>
<span class="go">d   -0.252916</span>
<span class="go">Name: three, dtype: float64</span>
</pre></div>
</div>
<p id="basics-sort-index-key">按索引排序还支持一个 <code class="docutils literal notranslate"><span class="pre">key</span></code> 参数，该参数接受一个可调用函数，用于应用于正在排序的索引。对于 <code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code> 对象，键会按级别应用于由 <code class="docutils literal notranslate"><span class="pre">level</span></code> 指定的级别。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [306]: </span><span class="n">s1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">"a"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"B"</span><span class="p">,</span> <span class="s2">"a"</span><span class="p">,</span> <span class="s2">"C"</span><span class="p">],</span> <span class="s2">"b"</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="s2">"c"</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]})</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="nb">list</span><span class="p">(</span><span class="s2">"ab"</span><span class="p">)</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [307]: </span><span class="n">s1</span>
<span class="gh">Out[307]: </span>
<span class="go">     c</span>
<span class="go">a b   </span>
<span class="go">B 1  2</span>
<span class="go">a 2  3</span>
<span class="go">C 3  4</span>
</pre></div>
</div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [308]: </span><span class="n">s1</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s2">"a"</span><span class="p">)</span>
<span class="gh">Out[308]: </span>
<span class="go">     c</span>
<span class="go">a b   </span>
<span class="go">B 1  2</span>
<span class="go">C 3  4</span>
<span class="go">a 2  3</span>

<span class="gp">In [309]: </span><span class="n">s1</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s2">"a"</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">idx</span><span class="p">:</span> <span class="n">idx</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
<span class="gh">Out[309]: </span>
<span class="go">     c</span>
<span class="go">a b   </span>
<span class="go">a 2  3</span>
<span class="go">B 1  2</span>
<span class="go">C 3  4</span>
</pre></div>
</div>
<p>有关按值键排序的信息，请参阅 <a class="reference internal" href="basics.html#basics-sort-value-key"><span class="std std-ref">值排序</span></a>。</p>
</section>
<section id="by-values">
<span id="basics-sort-values"></span><h3>按值<a class="headerlink" href="basics.html#by-values" title="Link to this heading">#</a></h3>
<p><a class="reference internal" href="../reference/api/pandas.Series.sort_values.html#pandas.Series.sort_values" title="pandas.Series.sort_values"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Series.sort_values()</span></code></a> 方法用于根据值对 <code class="docutils literal notranslate"><span class="pre">Series</span></code> 进行排序。<a class="reference internal" href="../reference/api/pandas.DataFrame.sort_values.html#pandas.DataFrame.sort_values" title="pandas.DataFrame.sort_values"><code class="xref py py-meth docutils literal notranslate"><span class="pre">DataFrame.sort_values()</span></code></a> 方法用于根据其列或行值对 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> 进行排序。<a class="reference internal" href="../reference/api/pandas.DataFrame.sort_values.html#pandas.DataFrame.sort_values" title="pandas.DataFrame.sort_values"><code class="xref py py-meth docutils literal notranslate"><span class="pre">DataFrame.sort_values()</span></code></a> 的可选参数 <code class="docutils literal notranslate"><span class="pre">by</span></code> 可用于指定一个或多个列来确定排序顺序。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [310]: </span><span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="p">{</span><span class="s2">"one"</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s2">"two"</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="s2">"three"</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]}</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [311]: </span><span class="n">df1</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">"two"</span><span class="p">)</span>
<span class="gh">Out[311]: </span>
<span class="go">   one  two  three</span>
<span class="go">0    2    1      5</span>
<span class="go">2    1    2      3</span>
<span class="go">1    1    3      4</span>
<span class="go">3    1    4      2</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">by</span></code> 参数可以接受列名列表，例如：</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [312]: </span><span class="n">df1</span><span class="p">[[</span><span class="s2">"one"</span><span class="p">,</span> <span class="s2">"two"</span><span class="p">,</span> <span class="s2">"three"</span><span class="p">]]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">"one"</span><span class="p">,</span> <span class="s2">"two"</span><span class="p">])</span>
<span class="gh">Out[312]: </span>
<span class="go">   one  two  three</span>
<span class="go">2    1    2      3</span>
<span class="go">1    1    3      4</span>
<span class="go">3    1    4      2</span>
<span class="go">0    2    1      5</span>
</pre></div>
</div>
<p>这些方法通过 <code class="docutils literal notranslate"><span class="pre">na_position</span></code> 参数对 NA 值进行特殊处理。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [313]: </span><span class="n">s</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

<span class="gp">In [314]: </span><span class="n">s</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>
<span class="gh">Out[314]: </span>
<span class="go">0       A</span>
<span class="go">3    Aaba</span>
<span class="go">1       B</span>
<span class="go">4    Baca</span>
<span class="go">6    CABA</span>
<span class="go">8     cat</span>
<span class="go">7     dog</span>
<span class="go">2    &lt;NA&gt;</span>
<span class="go">5    &lt;NA&gt;</span>
<span class="go">dtype: string</span>

<span class="gp">In [315]: </span><span class="n">s</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">na_position</span><span class="o">=</span><span class="s2">"first"</span><span class="p">)</span>
<span class="gh">Out[315]: </span>
<span class="go">2    &lt;NA&gt;</span>
<span class="go">5    &lt;NA&gt;</span>
<span class="go">0       A</span>
<span class="go">3    Aaba</span>
<span class="go">1       B</span>
<span class="go">4    Baca</span>
<span class="go">6    CABA</span>
<span class="go">8     cat</span>
<span class="go">7     dog</span>
<span class="go">dtype: string</span>
</pre></div>
</div>
<p id="basics-sort-value-key">排序还支持一个 <code class="docutils literal notranslate"><span class="pre">key</span></code> 参数，该参数接受一个可调用函数，用于应用于正在排序的值。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [316]: </span><span class="n">s1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="s2">"B"</span><span class="p">,</span> <span class="s2">"a"</span><span class="p">,</span> <span class="s2">"C"</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [317]: </span><span class="n">s1</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>
<span class="gh">Out[317]: </span>
<span class="go">0    B</span>
<span class="go">2    C</span>
<span class="go">1    a</span>
<span class="go">dtype: object</span>

<span class="gp">In [318]: </span><span class="n">s1</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
<span class="gh">Out[318]: </span>
<span class="go">1    a</span>
<span class="go">0    B</span>
<span class="go">2    C</span>
<span class="go">dtype: object</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">key</span></code> 将获得值的 <a class="reference internal" href="../reference/api/pandas.Series.html#pandas.Series" title="pandas.Series"><code class="xref py py-class docutils literal notranslate"><span class="pre">Series</span></code></a>，并应返回一个形状相同且包含转换后值的 <code class="docutils literal notranslate"><span class="pre">Series</span></code> 或数组。对于 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> 对象，键会按列应用，因此键仍应期望一个 Series 并返回一个 Series，例如：</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [319]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">"a"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"B"</span><span class="p">,</span> <span class="s2">"a"</span><span class="p">,</span> <span class="s2">"C"</span><span class="p">],</span> <span class="s2">"b"</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]})</span>
</pre></div>
</div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [320]: </span><span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">"a"</span><span class="p">)</span>
<span class="gh">Out[320]: </span>
<span class="go">   a  b</span>
<span class="go">0  B  1</span>
<span class="go">2  C  3</span>
<span class="go">1  a  2</span>

<span class="gp">In [321]: </span><span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">"a"</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">col</span><span class="p">:</span> <span class="n">col</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
<span class="gh">Out[321]: </span>
<span class="go">   a  b</span>
<span class="go">1  a  2</span>
<span class="go">0  B  1</span>
<span class="go">2  C  3</span>
</pre></div>
</div>
<p>每列的名称或类型可以用于对不同的列应用不同的函数。</p>
</section>
<section id="by-indexes-and-values">
<span id="basics-sort-indexes-and-values"></span><h3>按索引和值<a class="headerlink" href="basics.html#by-indexes-and-values" title="Link to this heading">#</a></h3>
<p>传递给 <a class="reference internal" href="../reference/api/pandas.DataFrame.sort_values.html#pandas.DataFrame.sort_values" title="pandas.DataFrame.sort_values"><code class="xref py py-meth docutils literal notranslate"><span class="pre">DataFrame.sort_values()</span></code></a> 的 <code class="docutils literal notranslate"><span class="pre">by</span></code> 参数的字符串可以引用列名或索引级别名称。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="go"># Build MultiIndex</span>
<span class="gp">In [322]: </span><span class="n">idx</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="p">[(</span><span class="s2">"a"</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s2">"a"</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="s2">"a"</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="s2">"b"</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="s2">"b"</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s2">"b"</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [323]: </span><span class="n">idx</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"first"</span><span class="p">,</span> <span class="s2">"second"</span><span class="p">]</span>

<span class="go"># Build DataFrame</span>
<span class="gp">In [324]: </span><span class="n">df_multi</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">"A"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)},</span> <span class="n">index</span><span class="o">=</span><span class="n">idx</span><span class="p">)</span>

<span class="gp">In [325]: </span><span class="n">df_multi</span>
<span class="gh">Out[325]: </span>
<span class="go">              A</span>
<span class="go">first second   </span>
<span class="go">a     1       6</span>
<span class="go">      2       5</span>
<span class="go">      2       4</span>
<span class="go">b     2       3</span>
<span class="go">      1       2</span>
<span class="go">      1       1</span>
</pre></div>
</div>
<p>按“second”（索引）和“A”（列）排序</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [326]: </span><span class="n">df_multi</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">"second"</span><span class="p">,</span> <span class="s2">"A"</span><span class="p">])</span>
<span class="gh">Out[326]: </span>
<span class="go">              A</span>
<span class="go">first second   </span>
<span class="go">b     1       1</span>
<span class="go">      1       2</span>
<span class="go">a     1       6</span>
<span class="go">b     2       3</span>
<span class="go">a     2       4</span>
<span class="go">      2       5</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p>如果一个字符串同时匹配列名和索引级别名称，则会发出警告，并且列将优先。这将在未来版本中导致歧义错误。</p>
</div>
</section>
<section id="searchsorted">
<span id="basics-searchsorted"></span><h3>searchsorted<a class="headerlink" href="basics.html#searchsorted" title="Link to this heading">#</a></h3>
<p>Series 有 <a class="reference internal" href="../reference/api/pandas.Series.searchsorted.html#pandas.Series.searchsorted" title="pandas.Series.searchsorted"><code class="xref py py-meth docutils literal notranslate"><span class="pre">searchsorted()</span></code></a> 方法，其工作方式类似于 <a class="reference external" href="https://numpy.com.cn/doc/stable/reference/generated/numpy.ndarray.searchsorted.html#numpy.ndarray.searchsorted" title="(in NumPy v2.2)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">numpy.ndarray.searchsorted()</span></code></a>。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [327]: </span><span class="n">ser</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>

<span class="gp">In [328]: </span><span class="n">ser</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="gh">Out[328]: </span><span class="go">array([0, 2])</span>

<span class="gp">In [329]: </span><span class="n">ser</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="gh">Out[329]: </span><span class="go">array([0, 3])</span>

<span class="gp">In [330]: </span><span class="n">ser</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">side</span><span class="o">=</span><span class="s2">"right"</span><span class="p">)</span>
<span class="gh">Out[330]: </span><span class="go">array([1, 3])</span>

<span class="gp">In [331]: </span><span class="n">ser</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">side</span><span class="o">=</span><span class="s2">"left"</span><span class="p">)</span>
<span class="gh">Out[331]: </span><span class="go">array([0, 2])</span>

<span class="gp">In [332]: </span><span class="n">ser</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>

<span class="gp">In [333]: </span><span class="n">ser</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">sorter</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">ser</span><span class="p">))</span>
<span class="gh">Out[333]: </span><span class="go">array([0, 2])</span>
</pre></div>
</div>
</section>
<section id="smallest-largest-values">
<span id="basics-nsorted"></span><h3>最小值 / 最大值<a class="headerlink" href="basics.html#smallest-largest-values" title="Link to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Series</span></code> 有 <a class="reference internal" href="../reference/api/pandas.Series.nsmallest.html#pandas.Series.nsmallest" title="pandas.Series.nsmallest"><code class="xref py py-meth docutils literal notranslate"><span class="pre">nsmallest()</span></code></a> 和 <a class="reference internal" href="../reference/api/pandas.Series.nlargest.html#pandas.Series.nlargest" title="pandas.Series.nlargest"><code class="xref py py-meth docutils literal notranslate"><span class="pre">nlargest()</span></code></a> 方法，它们返回最小或最大的 <span class="math notranslate nohighlight">\(n\)</span> 个值。对于大型 <code class="docutils literal notranslate"><span class="pre">Series</span></code>，这比对整个 Series 进行排序并对结果调用 <code class="docutils literal notranslate"><span class="pre">head(n)</span></code> 要快得多。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [334]: </span><span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">permutation</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>

<span class="gp">In [335]: </span><span class="n">s</span>
<span class="gh">Out[335]: </span>
<span class="go">0    2</span>
<span class="go">1    0</span>
<span class="go">2    3</span>
<span class="go">3    7</span>
<span class="go">4    1</span>
<span class="go">5    5</span>
<span class="go">6    9</span>
<span class="go">7    6</span>
<span class="go">8    8</span>
<span class="go">9    4</span>
<span class="go">dtype: int64</span>

<span class="gp">In [336]: </span><span class="n">s</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>
<span class="gh">Out[336]: </span>
<span class="go">1    0</span>
<span class="go">4    1</span>
<span class="go">0    2</span>
<span class="go">2    3</span>
<span class="go">9    4</span>
<span class="go">5    5</span>
<span class="go">7    6</span>
<span class="go">3    7</span>
<span class="go">8    8</span>
<span class="go">6    9</span>
<span class="go">dtype: int64</span>

<span class="gp">In [337]: </span><span class="n">s</span><span class="o">.</span><span class="n">nsmallest</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="gh">Out[337]: </span>
<span class="go">1    0</span>
<span class="go">4    1</span>
<span class="go">0    2</span>
<span class="go">dtype: int64</span>

<span class="gp">In [338]: </span><span class="n">s</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="gh">Out[338]: </span>
<span class="go">6    9</span>
<span class="go">8    8</span>
<span class="go">3    7</span>
<span class="go">dtype: int64</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> 也有 <code class="docutils literal notranslate"><span class="pre">nlargest</span></code> 和 <code class="docutils literal notranslate"><span class="pre">nsmallest</span></code> 方法。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [339]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="p">{</span>
<span class="gp">   .....: </span>        <span class="s2">"a"</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>
<span class="gp">   .....: </span>        <span class="s2">"b"</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="s2">"abdceff"</span><span class="p">),</span>
<span class="gp">   .....: </span>        <span class="s2">"c"</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">3.2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">],</span>
<span class="gp">   .....: </span>    <span class="p">}</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [340]: </span><span class="n">df</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">"a"</span><span class="p">)</span>
<span class="gh">Out[340]: </span>
<span class="go">    a  b    c</span>
<span class="go">5  11  f  3.0</span>
<span class="go">3  10  c  3.2</span>
<span class="go">4   8  e  NaN</span>

<span class="gp">In [341]: </span><span class="n">df</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="p">[</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"c"</span><span class="p">])</span>
<span class="gh">Out[341]: </span>
<span class="go">    a  b    c</span>
<span class="go">5  11  f  3.0</span>
<span class="go">3  10  c  3.2</span>
<span class="go">4   8  e  NaN</span>
<span class="go">2   1  d  4.0</span>
<span class="go">6  -1  f  4.0</span>

<span class="gp">In [342]: </span><span class="n">df</span><span class="o">.</span><span class="n">nsmallest</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">"a"</span><span class="p">)</span>
<span class="gh">Out[342]: </span>
<span class="go">   a  b    c</span>
<span class="go">0 -2  a  1.0</span>
<span class="go">1 -1  b  2.0</span>
<span class="go">6 -1  f  4.0</span>

<span class="gp">In [343]: </span><span class="n">df</span><span class="o">.</span><span class="n">nsmallest</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="p">[</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"c"</span><span class="p">])</span>
<span class="gh">Out[343]: </span>
<span class="go">   a  b    c</span>
<span class="go">0 -2  a  1.0</span>
<span class="go">1 -1  b  2.0</span>
<span class="go">6 -1  f  4.0</span>
<span class="go">2  1  d  4.0</span>
<span class="go">4  8  e  NaN</span>
</pre></div>
</div>
</section>
<section id="sorting-by-a-multiindex-column">
<span id="basics-multiindex-sorting"></span><h3>按 MultiIndex 列排序<a class="headerlink" href="basics.html#sorting-by-a-multiindex-column" title="Link to this heading">#</a></h3>
<p>当列是 MultiIndex 时，必须明确指定排序，并完全指定 <code class="docutils literal notranslate"><span class="pre">by</span></code> 参数的所有级别。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [344]: </span><span class="n">df1</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="p">[(</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"one"</span><span class="p">),</span> <span class="p">(</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"two"</span><span class="p">),</span> <span class="p">(</span><span class="s2">"b"</span><span class="p">,</span> <span class="s2">"three"</span><span class="p">)]</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [345]: </span><span class="n">df1</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">(</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"two"</span><span class="p">))</span>
<span class="gh">Out[345]: </span>
<span class="go">    a         b</span>
<span class="go">  one two three</span>
<span class="go">0   2   1     5</span>
<span class="go">2   1   2     3</span>
<span class="go">1   1   3     4</span>
<span class="go">3   1   4     2</span>
</pre></div>
</div>
</section>
</section>
<section id="copying">
<h2>复制<a class="headerlink" href="basics.html#copying" title="Link to this heading">#</a></h2>
<p>pandas 对象上的 <a class="reference internal" href="../reference/api/pandas.DataFrame.copy.html#pandas.DataFrame.copy" title="pandas.DataFrame.copy"><code class="xref py py-meth docutils literal notranslate"><span class="pre">copy()</span></code></a> 方法会复制底层数据（但不复制轴索引，因为它们是不可变的）并返回一个新对象。请注意，**很少有必要复制对象**。例如，只有少数几种方式可以*原地*修改 DataFrame</p>
<ul class="simple">
<li><p>插入、删除或修改列。</p></li>
<li><p>为 <code class="docutils literal notranslate"><span class="pre">index</span></code> 或 <code class="docutils literal notranslate"><span class="pre">columns</span></code> 属性赋值。</p></li>
<li><p>对于同构数据，通过 <code class="docutils literal notranslate"><span class="pre">values</span></code> 属性或高级索引直接修改值。</p></li>
</ul>
<p>明确地说，没有 pandas 方法会产生修改数据的副作用；几乎所有方法都返回一个新对象，保持原始对象不变。如果数据被修改，那是因为您明确地这样做了。</p>
</section>
<section id="dtypes">
<span id="basics-dtypes"></span><h2>dtypes<a class="headerlink" href="basics.html#dtypes" title="Link to this heading">#</a></h2>
<p>在大多数情况下，pandas 将 NumPy 数组和 dtype 用于 Series 或 DataFrame 的单个列。NumPy 支持 <code class="docutils literal notranslate"><span class="pre">float</span></code>、<code class="docutils literal notranslate"><span class="pre">int</span></code>、<code class="docutils literal notranslate"><span class="pre">bool</span></code>、<code class="docutils literal notranslate"><span class="pre">timedelta64[ns]</span></code> 和 <code class="docutils literal notranslate"><span class="pre">datetime64[ns]</span></code>（请注意 NumPy 不支持时区感知的日期时间）。</p>
<p>pandas 和第三方库在某些地方**扩展**了 NumPy 的类型系统。本节描述了 pandas 在内部所做的扩展。有关如何编写自己的可与 pandas 配合使用的扩展，请参阅 <a class="reference internal" href="../development/extending.html#extending-extension-types"><span class="std std-ref">扩展类型</span></a>。有关已实现扩展的第三方库列表，请参阅 <a class="reference external" href="https://pandas.ac.cn/community/ecosystem.html">生态系统页面</a>。</p>
<p>下表列出了所有 pandas 扩展类型。对于需要 <code class="docutils literal notranslate"><span class="pre">dtype</span></code> 参数的方法，可以按指示指定字符串。有关每种类型的更多信息，请参阅相应的文档部分。</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>数据类型</p></th>
<th class="head" colspan="2"><p>数据类型</p></th>
<th class="head" colspan="2"><p>标量</p></th>
<th class="head"><p>数组</p></th>
<th class="head"><p>字符串别名</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference internal" href="timeseries.html#timeseries-timezone"><span class="std std-ref">时区感知日期时间</span></a></p></td>
<td colspan="2"><p><a class="reference internal" href="../reference/api/pandas.DatetimeTZDtype.html#pandas.DatetimeTZDtype" title="pandas.DatetimeTZDtype"><code class="xref py py-class docutils literal notranslate"><span class="pre">DatetimeTZDtype</span></code></a></p></td>
<td colspan="2"><p><a class="reference internal" href="../reference/api/pandas.Timestamp.html#pandas.Timestamp" title="pandas.Timestamp"><code class="xref py py-class docutils literal notranslate"><span class="pre">Timestamp</span></code></a></p></td>
<td><p><a class="reference internal" href="../reference/api/pandas.arrays.DatetimeArray.html#pandas.arrays.DatetimeArray" title="pandas.arrays.DatetimeArray"><code class="xref py py-class docutils literal notranslate"><span class="pre">arrays.DatetimeArray</span></code></a></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">'datetime64[ns,</span> <span class="pre">&lt;tz&gt;]'</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="categorical.html#categorical"><span class="std std-ref">Categorical</span></a></p></td>
<td colspan="2"><p><a class="reference internal" href="../reference/api/pandas.CategoricalDtype.html#pandas.CategoricalDtype" title="pandas.CategoricalDtype"><code class="xref py py-class docutils literal notranslate"><span class="pre">CategoricalDtype</span></code></a></p></td>
<td colspan="2"><p>（无）</p></td>
<td><p><a class="reference internal" href="../reference/api/pandas.Categorical.html#pandas.Categorical" title="pandas.Categorical"><code class="xref py py-class docutils literal notranslate"><span class="pre">Categorical</span></code></a></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">'category'</span></code></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="timeseries.html#timeseries-periods"><span class="std std-ref">周期（时间跨度）</span></a></p></td>
<td colspan="2"><p><a class="reference internal" href="../reference/api/pandas.PeriodDtype.html#pandas.PeriodDtype" title="pandas.PeriodDtype"><code class="xref py py-class docutils literal notranslate"><span class="pre">PeriodDtype</span></code></a></p></td>
<td colspan="2"><p><a class="reference internal" href="../reference/api/pandas.Period.html#pandas.Period" title="pandas.Period"><code class="xref py py-class docutils literal notranslate"><span class="pre">Period</span></code></a></p></td>
<td><p><a class="reference internal" href="../reference/api/pandas.arrays.PeriodArray.html#pandas.arrays.PeriodArray" title="pandas.arrays.PeriodArray"><code class="xref py py-class docutils literal notranslate"><span class="pre">arrays.PeriodArray</span></code></a> <code class="docutils literal notranslate"><span class="pre">'Period[&lt;freq&gt;]'</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">'period[&lt;freq&gt;]'</span></code>,</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="sparse.html#sparse"><span class="std std-ref">稀疏</span></a></p></td>
<td colspan="2"><p><a class="reference internal" href="../reference/api/pandas.SparseDtype.html#pandas.SparseDtype" title="pandas.SparseDtype"><code class="xref py py-class docutils literal notranslate"><span class="pre">SparseDtype</span></code></a></p></td>
<td colspan="2"><p>（无）</p></td>
<td><p><a class="reference internal" href="../reference/api/pandas.arrays.SparseArray.html#pandas.arrays.SparseArray" title="pandas.arrays.SparseArray"><code class="xref py py-class docutils literal notranslate"><span class="pre">arrays.SparseArray</span></code></a></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">'Sparse'</span></code>, <code class="docutils literal notranslate"><span class="pre">'Sparse[int]'</span></code>, <code class="docutils literal notranslate"><span class="pre">'Sparse[float]'</span></code></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="advanced.html#advanced-intervalindex"><span class="std std-ref">区间</span></a></p></td>
<td colspan="2"><p><a class="reference internal" href="../reference/api/pandas.IntervalDtype.html#pandas.IntervalDtype" title="pandas.IntervalDtype"><code class="xref py py-class docutils literal notranslate"><span class="pre">IntervalDtype</span></code></a></p></td>
<td colspan="2"><p><a class="reference internal" href="../reference/api/pandas.Interval.html#pandas.Interval" title="pandas.Interval"><code class="xref py py-class docutils literal notranslate"><span class="pre">Interval</span></code></a></p></td>
<td><p><a class="reference internal" href="../reference/api/pandas.arrays.IntervalArray.html#pandas.arrays.IntervalArray" title="pandas.arrays.IntervalArray"><code class="xref py py-class docutils literal notranslate"><span class="pre">arrays.IntervalArray</span></code></a></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">'interval'</span></code>, <code class="docutils literal notranslate"><span class="pre">'Interval'</span></code>, <code class="docutils literal notranslate"><span class="pre">'Interval[&lt;numpy_dtype&gt;]'</span></code>, <code class="docutils literal notranslate"><span class="pre">'Interval[datetime64[ns,</span> <span class="pre">&lt;tz&gt;]]'</span></code>, <code class="docutils literal notranslate"><span class="pre">'Interval[timedelta64[&lt;freq&gt;]]'</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="integer_na.html#integer-na"><span class="std std-ref">可空整数</span></a></p></td>
<td colspan="2"><p><a class="reference internal" href="../reference/api/pandas.Int64Dtype.html#pandas.Int64Dtype" title="pandas.Int64Dtype"><code class="xref py py-class docutils literal notranslate"><span class="pre">Int64Dtype</span></code></a>, …</p></td>
<td colspan="2"><p>（无）</p></td>
<td><p><a class="reference internal" href="../reference/api/pandas.arrays.IntegerArray.html#pandas.arrays.IntegerArray" title="pandas.arrays.IntegerArray"><code class="xref py py-class docutils literal notranslate"><span class="pre">arrays.IntegerArray</span></code></a></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">'Int8'</span></code>, <code class="docutils literal notranslate"><span class="pre">'Int16'</span></code>, <code class="docutils literal notranslate"><span class="pre">'Int32'</span></code>, <code class="docutils literal notranslate"><span class="pre">'Int64'</span></code>, <code class="docutils literal notranslate"><span class="pre">'UInt8'</span></code>, <code class="docutils literal notranslate"><span class="pre">'UInt16'</span></code>, <code class="docutils literal notranslate"><span class="pre">'UInt32'</span></code>, <code class="docutils literal notranslate"><span class="pre">'UInt64'</span></code></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../reference/arrays.html#api-arrays-float-na"><span class="std std-ref">可空浮点数</span></a></p></td>
<td colspan="2"><p><a class="reference internal" href="../reference/api/pandas.Float64Dtype.html#pandas.Float64Dtype" title="pandas.Float64Dtype"><code class="xref py py-class docutils literal notranslate"><span class="pre">Float64Dtype</span></code></a>, …</p></td>
<td colspan="2"><p>（无）</p></td>
<td><p><a class="reference internal" href="../reference/api/pandas.arrays.FloatingArray.html#pandas.arrays.FloatingArray" title="pandas.arrays.FloatingArray"><code class="xref py py-class docutils literal notranslate"><span class="pre">arrays.FloatingArray</span></code></a></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">'Float32'</span></code>, <code class="docutils literal notranslate"><span class="pre">'Float64'</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="text.html#text"><span class="std std-ref">字符串</span></a></p></td>
<td colspan="2"><p><a class="reference internal" href="../reference/api/pandas.StringDtype.html#pandas.StringDtype" title="pandas.StringDtype"><code class="xref py py-class docutils literal notranslate"><span class="pre">StringDtype</span></code></a></p></td>
<td colspan="2"><p><a class="reference external" href="https://docs.pythonlang.cn/3/library/stdtypes.html#str" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a></p></td>
<td><p><a class="reference internal" href="../reference/api/pandas.arrays.StringArray.html#pandas.arrays.StringArray" title="pandas.arrays.StringArray"><code class="xref py py-class docutils literal notranslate"><span class="pre">arrays.StringArray</span></code></a></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">'string'</span></code></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../reference/arrays.html#api-arrays-bool"><span class="std std-ref">布尔值 (带 NA)</span></a></p></td>
<td colspan="2"><p><a class="reference internal" href="../reference/api/pandas.BooleanDtype.html#pandas.BooleanDtype" title="pandas.BooleanDtype"><code class="xref py py-class docutils literal notranslate"><span class="pre">BooleanDtype</span></code></a></p></td>
<td colspan="2"><p><a class="reference external" href="https://docs.pythonlang.cn/3/library/functions.html#bool" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></a></p></td>
<td><p><a class="reference internal" href="../reference/api/pandas.arrays.BooleanArray.html#pandas.arrays.BooleanArray" title="pandas.arrays.BooleanArray"><code class="xref py py-class docutils literal notranslate"><span class="pre">arrays.BooleanArray</span></code></a></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">'boolean'</span></code></p></td>
</tr>
</tbody>
</table>
<p>pandas 有两种存储字符串的方式。</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">object</span></code> dtype，可以保存任何 Python 对象，包括字符串。</p></li>
<li><p><a class="reference internal" href="../reference/api/pandas.StringDtype.html#pandas.StringDtype" title="pandas.StringDtype"><code class="xref py py-class docutils literal notranslate"><span class="pre">StringDtype</span></code></a>，专门用于字符串。</p></li>
</ol>
<p>通常，我们建议使用 <a class="reference internal" href="../reference/api/pandas.StringDtype.html#pandas.StringDtype" title="pandas.StringDtype"><code class="xref py py-class docutils literal notranslate"><span class="pre">StringDtype</span></code></a>。更多信息请参见 <a class="reference internal" href="text.html#text-types"><span class="std std-ref">文本数据类型</span></a>。</p>
<p>最后，可以使用 <code class="docutils literal notranslate"><span class="pre">object</span></code> dtype 存储任意对象，但应尽可能避免使用（为了性能和与其他库及方法的互操作性。参见 <a class="reference internal" href="basics.html#basics-object-conversion"><span class="std std-ref">对象转换</span></a>）。</p>
<p>DataFrame 方便的 <a class="reference internal" href="../reference/api/pandas.DataFrame.dtypes.html#pandas.DataFrame.dtypes" title="pandas.DataFrame.dtypes"><code class="xref py py-attr docutils literal notranslate"><span class="pre">dtypes</span></code></a> 属性返回一个 Series，其中包含每列的数据类型。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [346]: </span><span class="n">dft</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="p">{</span>
<span class="gp">   .....: </span>        <span class="s2">"A"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
<span class="gp">   .....: </span>        <span class="s2">"B"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="gp">   .....: </span>        <span class="s2">"C"</span><span class="p">:</span> <span class="s2">"foo"</span><span class="p">,</span>
<span class="gp">   .....: </span>        <span class="s2">"D"</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">"20010102"</span><span class="p">),</span>
<span class="gp">   .....: </span>        <span class="s2">"E"</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mf">1.0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">"float32"</span><span class="p">),</span>
<span class="gp">   .....: </span>        <span class="s2">"F"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
<span class="gp">   .....: </span>        <span class="s2">"G"</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">"int8"</span><span class="p">),</span>
<span class="gp">   .....: </span>    <span class="p">}</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [347]: </span><span class="n">dft</span>
<span class="gh">Out[347]: </span>
<span class="go">          A  B    C          D    E      F  G</span>
<span class="go">0  0.035962  1  foo 2001-01-02  1.0  False  1</span>
<span class="go">1  0.701379  1  foo 2001-01-02  1.0  False  1</span>
<span class="go">2  0.281885  1  foo 2001-01-02  1.0  False  1</span>

<span class="gp">In [348]: </span><span class="n">dft</span><span class="o">.</span><span class="n">dtypes</span>
<span class="gh">Out[348]: </span>
<span class="go">A          float64</span>
<span class="go">B            int64</span>
<span class="go">C           object</span>
<span class="go">D    datetime64[s]</span>
<span class="go">E          float32</span>
<span class="go">F             bool</span>
<span class="go">G             int8</span>
<span class="go">dtype: object</span>
</pre></div>
</div>
<p>在 <code class="docutils literal notranslate"><span class="pre">Series</span></code> 对象上，使用 <a class="reference internal" href="../reference/api/pandas.Series.dtype.html#pandas.Series.dtype" title="pandas.Series.dtype"><code class="xref py py-attr docutils literal notranslate"><span class="pre">dtype</span></code></a> 属性。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [349]: </span><span class="n">dft</span><span class="p">[</span><span class="s2">"A"</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span>
<span class="gh">Out[349]: </span><span class="go">dtype('float64')</span>
</pre></div>
</div>
<p>如果 pandas 对象在**单个列中**包含多种 dtype 的数据，则该列的 dtype 将被选择为能够容纳所有数据类型（<code class="docutils literal notranslate"><span class="pre">object</span></code> 是最通用的）。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="go"># these ints are coerced to floats</span>
<span class="gp">In [350]: </span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">])</span>
<span class="gh">Out[350]: </span>
<span class="go">0    1.0</span>
<span class="go">1    2.0</span>
<span class="go">2    3.0</span>
<span class="go">3    4.0</span>
<span class="go">4    5.0</span>
<span class="go">5    6.0</span>
<span class="go">dtype: float64</span>

<span class="go"># string data forces an ``object`` dtype</span>
<span class="gp">In [351]: </span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">,</span> <span class="s2">"foo"</span><span class="p">])</span>
<span class="gh">Out[351]: </span>
<span class="go">0      1</span>
<span class="go">1      2</span>
<span class="go">2      3</span>
<span class="go">3    6.0</span>
<span class="go">4    foo</span>
<span class="go">dtype: object</span>
</pre></div>
</div>
<p>可以通过调用 <code class="docutils literal notranslate"><span class="pre">DataFrame.dtypes.value_counts()</span></code> 找到 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> 中每种类型的列数。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [352]: </span><span class="n">dft</span><span class="o">.</span><span class="n">dtypes</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="gh">Out[352]: </span>
<span class="go">float64          1</span>
<span class="go">int64            1</span>
<span class="go">object           1</span>
<span class="go">datetime64[s]    1</span>
<span class="go">float32          1</span>
<span class="go">bool             1</span>
<span class="go">int8             1</span>
<span class="go">Name: count, dtype: int64</span>
</pre></div>
</div>
<p>数值 dtype 将传播并可在 DataFrame 中共存。如果传递了 dtype（无论是通过 <code class="docutils literal notranslate"><span class="pre">dtype</span></code> 关键字直接传递，还是传递 <code class="docutils literal notranslate"><span class="pre">ndarray</span></code>，或传递 <code class="docutils literal notranslate"><span class="pre">Series</span></code>），则它将在 DataFrame 操作中保留。此外，不同的数值 dtype **不会**合并。下面的例子将让您略知一二。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [353]: </span><span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"A"</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">"float32"</span><span class="p">)</span>

<span class="gp">In [354]: </span><span class="n">df1</span>
<span class="gh">Out[354]: </span>
<span class="go">          A</span>
<span class="go">0  0.224364</span>
<span class="go">1  1.890546</span>
<span class="go">2  0.182879</span>
<span class="go">3  0.787847</span>
<span class="go">4 -0.188449</span>
<span class="go">5  0.667715</span>
<span class="go">6 -0.011736</span>
<span class="go">7 -0.399073</span>

<span class="gp">In [355]: </span><span class="n">df1</span><span class="o">.</span><span class="n">dtypes</span>
<span class="gh">Out[355]: </span>
<span class="go">A    float32</span>
<span class="go">dtype: object</span>

<span class="gp">In [356]: </span><span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="p">{</span>
<span class="gp">   .....: </span>        <span class="s2">"A"</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">"float16"</span><span class="p">),</span>
<span class="gp">   .....: </span>        <span class="s2">"B"</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">8</span><span class="p">)),</span>
<span class="gp">   .....: </span>        <span class="s2">"C"</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">"uint8"</span><span class="p">),</span>  <span class="c1"># [0,255] (range of uint8)</span>
<span class="gp">   .....: </span>    <span class="p">}</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [357]: </span><span class="n">df2</span>
<span class="gh">Out[357]: </span>
<span class="go">          A         B    C</span>
<span class="go">0  0.823242  0.256090   26</span>
<span class="go">1  1.607422  1.426469   86</span>
<span class="go">2 -0.333740 -0.416203   46</span>
<span class="go">3 -0.063477  1.139976  212</span>
<span class="go">4 -1.014648 -1.193477   26</span>
<span class="go">5  0.678711  0.096706    7</span>
<span class="go">6 -0.040863 -1.956850  184</span>
<span class="go">7 -0.357422 -0.714337  206</span>

<span class="gp">In [358]: </span><span class="n">df2</span><span class="o">.</span><span class="n">dtypes</span>
<span class="gh">Out[358]: </span>
<span class="go">A    float16</span>
<span class="go">B    float64</span>
<span class="go">C      uint8</span>
<span class="go">dtype: object</span>
</pre></div>
</div>
<section id="defaults">
<h3>默认值<a class="headerlink" href="basics.html#defaults" title="Link to this heading">#</a></h3>
<p>默认情况下，整数类型为 <code class="docutils literal notranslate"><span class="pre">int64</span></code>，浮点类型为 <code class="docutils literal notranslate"><span class="pre">float64</span></code>，**无论**平台是 32 位还是 64 位。以下所有操作都将导致 <code class="docutils literal notranslate"><span class="pre">int64</span></code> dtype。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [359]: </span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"a"</span><span class="p">])</span><span class="o">.</span><span class="n">dtypes</span>
<span class="gh">Out[359]: </span>
<span class="go">a    int64</span>
<span class="go">dtype: object</span>

<span class="gp">In [360]: </span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">"a"</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]})</span><span class="o">.</span><span class="n">dtypes</span>
<span class="gh">Out[360]: </span>
<span class="go">a    int64</span>
<span class="go">dtype: object</span>

<span class="gp">In [361]: </span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">"a"</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span> <span class="n">index</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">.</span><span class="n">dtypes</span>
<span class="gh">Out[361]: </span>
<span class="go">a    int64</span>
<span class="go">dtype: object</span>
</pre></div>
</div>
<p>请注意，Numpy 在创建数组时将选择**平台依赖**的类型。以下操作在 32 位平台上将**导致** <code class="docutils literal notranslate"><span class="pre">int32</span></code>。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [362]: </span><span class="n">frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]))</span>
</pre></div>
</div>
</section>
<section id="upcasting">
<h3>类型提升<a class="headerlink" href="basics.html#upcasting" title="Link to this heading">#</a></h3>
<p>当与其他类型组合时，类型可能会被**提升**，这意味着它们从当前类型（例如 <code class="docutils literal notranslate"><span class="pre">int</span></code> 到 <code class="docutils literal notranslate"><span class="pre">float</span></code>）提升。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [363]: </span><span class="n">df3</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">reindex_like</span><span class="p">(</span><span class="n">df2</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span> <span class="o">+</span> <span class="n">df2</span>

<span class="gp">In [364]: </span><span class="n">df3</span>
<span class="gh">Out[364]: </span>
<span class="go">          A         B      C</span>
<span class="go">0  1.047606  0.256090   26.0</span>
<span class="go">1  3.497968  1.426469   86.0</span>
<span class="go">2 -0.150862 -0.416203   46.0</span>
<span class="go">3  0.724370  1.139976  212.0</span>
<span class="go">4 -1.203098 -1.193477   26.0</span>
<span class="go">5  1.346426  0.096706    7.0</span>
<span class="go">6 -0.052599 -1.956850  184.0</span>
<span class="go">7 -0.756495 -0.714337  206.0</span>

<span class="gp">In [365]: </span><span class="n">df3</span><span class="o">.</span><span class="n">dtypes</span>
<span class="gh">Out[365]: </span>
<span class="go">A    float32</span>
<span class="go">B    float64</span>
<span class="go">C    float64</span>
<span class="go">dtype: object</span>
</pre></div>
</div>
<p><a class="reference internal" href="../reference/api/pandas.DataFrame.to_numpy.html#pandas.DataFrame.to_numpy" title="pandas.DataFrame.to_numpy"><code class="xref py py-meth docutils literal notranslate"><span class="pre">DataFrame.to_numpy()</span></code></a> 将返回 dtype 的**最低公分母**，这意味着该 dtype 可以容纳结果同构 dtyped NumPy 数组中的**所有**类型。这可能会强制进行一些**类型提升**。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [366]: </span><span class="n">df3</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span><span class="o">.</span><span class="n">dtype</span>
<span class="gh">Out[366]: </span><span class="go">dtype('float64')</span>
</pre></div>
</div>
</section>
<section id="astype">
<h3>astype<a class="headerlink" href="basics.html#astype" title="Link to this heading">#</a></h3>
<p id="basics-cast">您可以使用 <a class="reference internal" href="../reference/api/pandas.DataFrame.astype.html#pandas.DataFrame.astype" title="pandas.DataFrame.astype"><code class="xref py py-meth docutils literal notranslate"><span class="pre">astype()</span></code></a> 方法将 dtype 从一种显式转换为另一种。这些操作默认会返回一个副本，即使 dtype 没有改变（传递 <code class="docutils literal notranslate"><span class="pre">copy=False</span></code> 可以改变此行为）。此外，如果 astype 操作无效，它们将引发异常。</p>
<p>类型提升总是根据 **NumPy** 规则进行的。如果在操作中涉及两种不同的 dtype，则将使用更**通用**的一种作为操作的结果。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [367]: </span><span class="n">df3</span>
<span class="gh">Out[367]: </span>
<span class="go">          A         B      C</span>
<span class="go">0  1.047606  0.256090   26.0</span>
<span class="go">1  3.497968  1.426469   86.0</span>
<span class="go">2 -0.150862 -0.416203   46.0</span>
<span class="go">3  0.724370  1.139976  212.0</span>
<span class="go">4 -1.203098 -1.193477   26.0</span>
<span class="go">5  1.346426  0.096706    7.0</span>
<span class="go">6 -0.052599 -1.956850  184.0</span>
<span class="go">7 -0.756495 -0.714337  206.0</span>

<span class="gp">In [368]: </span><span class="n">df3</span><span class="o">.</span><span class="n">dtypes</span>
<span class="gh">Out[368]: </span>
<span class="go">A    float32</span>
<span class="go">B    float64</span>
<span class="go">C    float64</span>
<span class="go">dtype: object</span>

<span class="go"># conversion of dtypes</span>
<span class="gp">In [369]: </span><span class="n">df3</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">"float32"</span><span class="p">)</span><span class="o">.</span><span class="n">dtypes</span>
<span class="gh">Out[369]: </span>
<span class="go">A    float32</span>
<span class="go">B    float32</span>
<span class="go">C    float32</span>
<span class="go">dtype: object</span>
</pre></div>
</div>
<p>使用 <a class="reference internal" href="../reference/api/pandas.DataFrame.astype.html#pandas.DataFrame.astype" title="pandas.DataFrame.astype"><code class="xref py py-meth docutils literal notranslate"><span class="pre">astype()</span></code></a> 将列的子集转换为指定类型。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [370]: </span><span class="n">dft</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">"a"</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="s2">"b"</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="s2">"c"</span><span class="p">:</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]})</span>

<span class="gp">In [371]: </span><span class="n">dft</span><span class="p">[[</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">]]</span> <span class="o">=</span> <span class="n">dft</span><span class="p">[[</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>

<span class="gp">In [372]: </span><span class="n">dft</span>
<span class="gh">Out[372]: </span>
<span class="go">   a  b  c</span>
<span class="go">0  1  4  7</span>
<span class="go">1  2  5  8</span>
<span class="go">2  3  6  9</span>

<span class="gp">In [373]: </span><span class="n">dft</span><span class="o">.</span><span class="n">dtypes</span>
<span class="gh">Out[373]: </span>
<span class="go">a    uint8</span>
<span class="go">b    uint8</span>
<span class="go">c    int64</span>
<span class="go">dtype: object</span>
</pre></div>
</div>
<p>通过将字典传递给 <a class="reference internal" href="../reference/api/pandas.DataFrame.astype.html#pandas.DataFrame.astype" title="pandas.DataFrame.astype"><code class="xref py py-meth docutils literal notranslate"><span class="pre">astype()</span></code></a>，将某些列转换为特定的 dtype。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [374]: </span><span class="n">dft1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">"a"</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s2">"b"</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="s2">"c"</span><span class="p">:</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]})</span>

<span class="gp">In [375]: </span><span class="n">dft1</span> <span class="o">=</span> <span class="n">dft1</span><span class="o">.</span><span class="n">astype</span><span class="p">({</span><span class="s2">"a"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="s2">"c"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">})</span>

<span class="gp">In [376]: </span><span class="n">dft1</span>
<span class="gh">Out[376]: </span>
<span class="go">       a  b    c</span>
<span class="go">0   True  4  7.0</span>
<span class="go">1  False  5  8.0</span>
<span class="go">2   True  6  9.0</span>

<span class="gp">In [377]: </span><span class="n">dft1</span><span class="o">.</span><span class="n">dtypes</span>
<span class="gh">Out[377]: </span>
<span class="go">a       bool</span>
<span class="go">b      int64</span>
<span class="go">c    float64</span>
<span class="go">dtype: object</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p>当尝试使用 <a class="reference internal" href="../reference/api/pandas.DataFrame.astype.html#pandas.DataFrame.astype" title="pandas.DataFrame.astype"><code class="xref py py-meth docutils literal notranslate"><span class="pre">astype()</span></code></a> 和 <a class="reference internal" href="../reference/api/pandas.DataFrame.loc.html#pandas.DataFrame.loc" title="pandas.DataFrame.loc"><code class="xref py py-meth docutils literal notranslate"><span class="pre">loc()</span></code></a> 将列的子集转换为指定类型时，会发生类型提升。</p>
<p><a class="reference internal" href="../reference/api/pandas.DataFrame.loc.html#pandas.DataFrame.loc" title="pandas.DataFrame.loc"><code class="xref py py-meth docutils literal notranslate"><span class="pre">loc()</span></code></a> 尝试将我们分配的值适应当前的 dtype，而 <code class="docutils literal notranslate"><span class="pre">[]</span></code> 将覆盖它们并从右侧获取 dtype。因此，以下代码会产生意外结果。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [378]: </span><span class="n">dft</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">"a"</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="s2">"b"</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="s2">"c"</span><span class="p">:</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]})</span>

<span class="gp">In [379]: </span><span class="n">dft</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span><span class="o">.</span><span class="n">dtypes</span>
<span class="gh">Out[379]: </span>
<span class="go">a    uint8</span>
<span class="go">b    uint8</span>
<span class="go">dtype: object</span>

<span class="gp">In [380]: </span><span class="n">dft</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">]]</span> <span class="o">=</span> <span class="n">dft</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>

<span class="gp">In [381]: </span><span class="n">dft</span><span class="o">.</span><span class="n">dtypes</span>
<span class="gh">Out[381]: </span>
<span class="go">a    int64</span>
<span class="go">b    int64</span>
<span class="go">c    int64</span>
<span class="go">dtype: object</span>
</pre></div>
</div>
</div>
</section>
<section id="object-conversion">
<span id="basics-object-conversion"></span><h3>对象转换<a class="headerlink" href="basics.html#object-conversion" title="Link to this heading">#</a></h3>
<p>pandas 提供了各种函数来尝试强制将 <code class="docutils literal notranslate"><span class="pre">object</span></code> dtype 的类型转换为其他类型。在数据已经是正确类型但存储在 <code class="docutils literal notranslate"><span class="pre">object</span></code> 数组中的情况下，可以使用 <a class="reference internal" href="../reference/api/pandas.DataFrame.infer_objects.html#pandas.DataFrame.infer_objects" title="pandas.DataFrame.infer_objects"><code class="xref py py-meth docutils literal notranslate"><span class="pre">DataFrame.infer_objects()</span></code></a> 和 <a class="reference internal" href="../reference/api/pandas.Series.infer_objects.html#pandas.Series.infer_objects" title="pandas.Series.infer_objects"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Series.infer_objects()</span></code></a> 方法来软转换到正确类型。</p>
<blockquote>
<div><div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [382]: </span><span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>

<span class="gp">In [383]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="p">[</span>
<span class="gp">   .....: </span>        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
<span class="gp">   .....: </span>        <span class="p">[</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">],</span>
<span class="gp">   .....: </span>        <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2016</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2016</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)],</span>
<span class="gp">   .....: </span>    <span class="p">]</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [384]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">T</span>

<span class="gp">In [385]: </span><span class="n">df</span>
<span class="gh">Out[385]: </span>
<span class="go">   0  1                    2</span>
<span class="go">0  1  a  2016-03-02 00:00:00</span>
<span class="go">1  2  b  2016-03-02 00:00:00</span>

<span class="gp">In [386]: </span><span class="n">df</span><span class="o">.</span><span class="n">dtypes</span>
<span class="gh">Out[386]: </span>
<span class="go">0    object</span>
<span class="go">1    object</span>
<span class="go">2    object</span>
<span class="go">dtype: object</span>
</pre></div>
</div>
</div></blockquote>
<p>由于数据被转置，原始推断将所有列存储为对象，而 <code class="docutils literal notranslate"><span class="pre">infer_objects</span></code> 将进行纠正。</p>
<blockquote>
<div><div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [387]: </span><span class="n">df</span><span class="o">.</span><span class="n">infer_objects</span><span class="p">()</span><span class="o">.</span><span class="n">dtypes</span>
<span class="gh">Out[387]: </span>
<span class="go">0             int64</span>
<span class="go">1            object</span>
<span class="go">2    datetime64[ns]</span>
<span class="go">dtype: object</span>
</pre></div>
</div>
</div></blockquote>
<p>以下函数可用于一维对象数组或标量，以将对象强制转换为指定类型</p>
<ul>
<li><p><a class="reference internal" href="../reference/api/pandas.to_numeric.html#pandas.to_numeric" title="pandas.to_numeric"><code class="xref py py-meth docutils literal notranslate"><span class="pre">to_numeric()</span></code></a>（转换为数值 dtype）</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [388]: </span><span class="n">m</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"1.1"</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>

<span class="gp">In [389]: </span><span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="gh">Out[389]: </span><span class="go">array([1.1, 2. , 3. ])</span>
</pre></div>
</div>
</li>
<li><p><a class="reference internal" href="../reference/api/pandas.to_datetime.html#pandas.to_datetime" title="pandas.to_datetime"><code class="xref py py-meth docutils literal notranslate"><span class="pre">to_datetime()</span></code></a>（转换为日期时间对象）</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [390]: </span><span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>

<span class="gp">In [391]: </span><span class="n">m</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"2016-07-09"</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2016</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]</span>

<span class="gp">In [392]: </span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="gh">Out[392]: </span><span class="go">DatetimeIndex(['2016-07-09', '2016-03-02'], dtype='datetime64[ns]', freq=None)</span>
</pre></div>
</div>
</li>
<li><p><a class="reference internal" href="../reference/api/pandas.to_timedelta.html#pandas.to_timedelta" title="pandas.to_timedelta"><code class="xref py py-meth docutils literal notranslate"><span class="pre">to_timedelta()</span></code></a>（转换为 timedelta 对象）</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [393]: </span><span class="n">m</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"5us"</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="s2">"1day"</span><span class="p">)]</span>

<span class="gp">In [394]: </span><span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="gh">Out[394]: </span><span class="go">TimedeltaIndex(['0 days 00:00:00.000005', '1 days 00:00:00'], dtype='timedelta64[ns]', freq=None)</span>
</pre></div>
</div>
</li>
</ul>
<p>为了强制转换，我们可以传入一个 <code class="docutils literal notranslate"><span class="pre">errors</span></code> 参数，它指定 pandas 应该如何处理无法转换为所需 dtype 或对象的元素。默认情况下，<code class="docutils literal notranslate"><span class="pre">errors='raise'</span></code>，这意味着在转换过程中遇到的任何错误都将引发。但是，如果 <code class="docutils literal notranslate"><span class="pre">errors='coerce'</span></code>，这些错误将被忽略，并且 pandas 会将有问题元素转换为 <code class="docutils literal notranslate"><span class="pre">pd.NaT</span></code>（用于日期时间或时间差）或 <code class="docutils literal notranslate"><span class="pre">np.nan</span></code>（用于数值）。如果您正在读取的数据大部分是所需的 dtype（例如数值、日期时间），但偶尔混有不符合规范的元素，而您想将它们表示为缺失值，这可能会很有用</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [395]: </span><span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>

<span class="gp">In [396]: </span><span class="n">m</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"apple"</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2016</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]</span>

<span class="gp">In [397]: </span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">"coerce"</span><span class="p">)</span>
<span class="gh">Out[397]: </span><span class="go">DatetimeIndex(['NaT', '2016-03-02'], dtype='datetime64[ns]', freq=None)</span>

<span class="gp">In [398]: </span><span class="n">m</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"apple"</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>

<span class="gp">In [399]: </span><span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">"coerce"</span><span class="p">)</span>
<span class="gh">Out[399]: </span><span class="go">array([nan,  2.,  3.])</span>

<span class="gp">In [400]: </span><span class="n">m</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"apple"</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="s2">"1day"</span><span class="p">)]</span>

<span class="gp">In [401]: </span><span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">"coerce"</span><span class="p">)</span>
<span class="gh">Out[401]: </span><span class="go">TimedeltaIndex([NaT, '1 days'], dtype='timedelta64[ns]', freq=None)</span>
</pre></div>
</div>
<p>除了对象转换外，<a class="reference internal" href="../reference/api/pandas.to_numeric.html#pandas.to_numeric" title="pandas.to_numeric"><code class="xref py py-meth docutils literal notranslate"><span class="pre">to_numeric()</span></code></a> 还提供了另一个参数 <code class="docutils literal notranslate"><span class="pre">downcast</span></code>，它提供了将新（或已存在）的数值数据下转换为更小 dtype 的选项，这可以节省内存</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [402]: </span><span class="n">m</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"1"</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>

<span class="gp">In [403]: </span><span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">downcast</span><span class="o">=</span><span class="s2">"integer"</span><span class="p">)</span>  <span class="c1"># smallest signed int dtype</span>
<span class="gh">Out[403]: </span><span class="go">array([1, 2, 3], dtype=int8)</span>

<span class="gp">In [404]: </span><span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">downcast</span><span class="o">=</span><span class="s2">"signed"</span><span class="p">)</span>  <span class="c1"># same as 'integer'</span>
<span class="gh">Out[404]: </span><span class="go">array([1, 2, 3], dtype=int8)</span>

<span class="gp">In [405]: </span><span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">downcast</span><span class="o">=</span><span class="s2">"unsigned"</span><span class="p">)</span>  <span class="c1"># smallest unsigned int dtype</span>
<span class="gh">Out[405]: </span><span class="go">array([1, 2, 3], dtype=uint8)</span>

<span class="gp">In [406]: </span><span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">downcast</span><span class="o">=</span><span class="s2">"float"</span><span class="p">)</span>  <span class="c1"># smallest float dtype</span>
<span class="gh">Out[406]: </span><span class="go">array([1., 2., 3.], dtype=float32)</span>
</pre></div>
</div>
<p>由于这些方法仅适用于一维数组、列表或标量；它们不能直接用于多维对象，例如 DataFrame。但是，使用 <a class="reference internal" href="../reference/api/pandas.DataFrame.apply.html#pandas.DataFrame.apply" title="pandas.DataFrame.apply"><code class="xref py py-meth docutils literal notranslate"><span class="pre">apply()</span></code></a>，我们可以有效地将函数“应用”到每一列</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [407]: </span><span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>

<span class="gp">In [408]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="s2">"2016-07-09"</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2016</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">"O"</span><span class="p">)</span>

<span class="gp">In [409]: </span><span class="n">df</span>
<span class="gh">Out[409]: </span>
<span class="go">            0                    1</span>
<span class="go">0  2016-07-09  2016-03-02 00:00:00</span>
<span class="go">1  2016-07-09  2016-03-02 00:00:00</span>

<span class="gp">In [410]: </span><span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">)</span>
<span class="gh">Out[410]: </span>
<span class="go">           0          1</span>
<span class="go">0 2016-07-09 2016-03-02</span>
<span class="go">1 2016-07-09 2016-03-02</span>

<span class="gp">In [411]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="s2">"1.1"</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">"O"</span><span class="p">)</span>

<span class="gp">In [412]: </span><span class="n">df</span>
<span class="gh">Out[412]: </span>
<span class="go">     0  1  2</span>
<span class="go">0  1.1  2  3</span>
<span class="go">1  1.1  2  3</span>

<span class="gp">In [413]: </span><span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">)</span>
<span class="gh">Out[413]: </span>
<span class="go">     0  1  2</span>
<span class="go">0  1.1  2  3</span>
<span class="go">1  1.1  2  3</span>

<span class="gp">In [414]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="s2">"5us"</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="s2">"1day"</span><span class="p">)]]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">"O"</span><span class="p">)</span>

<span class="gp">In [415]: </span><span class="n">df</span>
<span class="gh">Out[415]: </span>
<span class="go">     0                1</span>
<span class="go">0  5us  1 days 00:00:00</span>
<span class="go">1  5us  1 days 00:00:00</span>

<span class="gp">In [416]: </span><span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">)</span>
<span class="gh">Out[416]: </span>
<span class="go">                       0      1</span>
<span class="go">0 0 days 00:00:00.000005 1 days</span>
<span class="go">1 0 days 00:00:00.000005 1 days</span>
</pre></div>
</div>
</section>
<section id="gotchas">
<h3>陷阱<a class="headerlink" href="basics.html#gotchas" title="Link to this heading">#</a></h3>
<p>对 <code class="docutils literal notranslate"><span class="pre">integer</span></code> 类型数据执行选择操作很容易将数据提升为 <code class="docutils literal notranslate"><span class="pre">floating</span></code> 类型。在不引入 <code class="docutils literal notranslate"><span class="pre">nans</span></code> 的情况下，输入数据的 dtype 将被保留。另请参见 <a class="reference internal" href="gotchas.html#gotchas-intna"><span class="std std-ref">对整数 NA 的支持</span></a>。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [417]: </span><span class="n">dfi</span> <span class="o">=</span> <span class="n">df3</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">"int32"</span><span class="p">)</span>

<span class="gp">In [418]: </span><span class="n">dfi</span><span class="p">[</span><span class="s2">"E"</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

<span class="gp">In [419]: </span><span class="n">dfi</span>
<span class="gh">Out[419]: </span>
<span class="go">   A  B    C  E</span>
<span class="go">0  1  0   26  1</span>
<span class="go">1  3  1   86  1</span>
<span class="go">2  0  0   46  1</span>
<span class="go">3  0  1  212  1</span>
<span class="go">4 -1 -1   26  1</span>
<span class="go">5  1  0    7  1</span>
<span class="go">6  0 -1  184  1</span>
<span class="go">7  0  0  206  1</span>

<span class="gp">In [420]: </span><span class="n">dfi</span><span class="o">.</span><span class="n">dtypes</span>
<span class="gh">Out[420]: </span>
<span class="go">A    int32</span>
<span class="go">B    int32</span>
<span class="go">C    int32</span>
<span class="go">E    int64</span>
<span class="go">dtype: object</span>

<span class="gp">In [421]: </span><span class="n">casted</span> <span class="o">=</span> <span class="n">dfi</span><span class="p">[</span><span class="n">dfi</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>

<span class="gp">In [422]: </span><span class="n">casted</span>
<span class="gh">Out[422]: </span>
<span class="go">     A    B    C  E</span>
<span class="go">0  1.0  NaN   26  1</span>
<span class="go">1  3.0  1.0   86  1</span>
<span class="go">2  NaN  NaN   46  1</span>
<span class="go">3  NaN  1.0  212  1</span>
<span class="go">4  NaN  NaN   26  1</span>
<span class="go">5  1.0  NaN    7  1</span>
<span class="go">6  NaN  NaN  184  1</span>
<span class="go">7  NaN  NaN  206  1</span>

<span class="gp">In [423]: </span><span class="n">casted</span><span class="o">.</span><span class="n">dtypes</span>
<span class="gh">Out[423]: </span>
<span class="go">A    float64</span>
<span class="go">B    float64</span>
<span class="go">C      int32</span>
<span class="go">E      int64</span>
<span class="go">dtype: object</span>
</pre></div>
</div>
<p>而浮点 dtype 保持不变。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [424]: </span><span class="n">dfa</span> <span class="o">=</span> <span class="n">df3</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="gp">In [425]: </span><span class="n">dfa</span><span class="p">[</span><span class="s2">"A"</span><span class="p">]</span> <span class="o">=</span> <span class="n">dfa</span><span class="p">[</span><span class="s2">"A"</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">"float32"</span><span class="p">)</span>

<span class="gp">In [426]: </span><span class="n">dfa</span><span class="o">.</span><span class="n">dtypes</span>
<span class="gh">Out[426]: </span>
<span class="go">A    float32</span>
<span class="go">B    float64</span>
<span class="go">C    float64</span>
<span class="go">dtype: object</span>

<span class="gp">In [427]: </span><span class="n">casted</span> <span class="o">=</span> <span class="n">dfa</span><span class="p">[</span><span class="n">df2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>

<span class="gp">In [428]: </span><span class="n">casted</span>
<span class="gh">Out[428]: </span>
<span class="go">          A         B      C</span>
<span class="go">0  1.047606  0.256090   26.0</span>
<span class="go">1  3.497968  1.426469   86.0</span>
<span class="go">2       NaN       NaN   46.0</span>
<span class="go">3       NaN  1.139976  212.0</span>
<span class="go">4       NaN       NaN   26.0</span>
<span class="go">5  1.346426  0.096706    7.0</span>
<span class="go">6       NaN       NaN  184.0</span>
<span class="go">7       NaN       NaN  206.0</span>

<span class="gp">In [429]: </span><span class="n">casted</span><span class="o">.</span><span class="n">dtypes</span>
<span class="gh">Out[429]: </span>
<span class="go">A    float32</span>
<span class="go">B    float64</span>
<span class="go">C    float64</span>
<span class="go">dtype: object</span>
</pre></div>
</div>
</section>
</section>
<section id="selecting-columns-based-on-dtype">
<h2>根据 <code class="docutils literal notranslate"><span class="pre">dtype</span></code> 选择列<a class="headerlink" href="basics.html#selecting-columns-based-on-dtype" title="Link to this heading">#</a></h2>
<p id="basics-selectdtypes"><a class="reference internal" href="../reference/api/pandas.DataFrame.select_dtypes.html#pandas.DataFrame.select_dtypes" title="pandas.DataFrame.select_dtypes"><code class="xref py py-meth docutils literal notranslate"><span class="pre">select_dtypes()</span></code></a> 方法根据列的 <code class="docutils literal notranslate"><span class="pre">dtype</span></code> 实现列的子集选择。</p>
<p>首先，让我们创建一个包含多种不同 dtype 的 <a class="reference internal" href="../reference/api/pandas.DataFrame.html#pandas.DataFrame" title="pandas.DataFrame"><code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code></a></p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [430]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="p">{</span>
<span class="gp">   .....: </span>        <span class="s2">"string"</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="s2">"abc"</span><span class="p">),</span>
<span class="gp">   .....: </span>        <span class="s2">"int64"</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)),</span>
<span class="gp">   .....: </span>        <span class="s2">"uint8"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">"u1"</span><span class="p">),</span>
<span class="gp">   .....: </span>        <span class="s2">"float64"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">),</span>
<span class="gp">   .....: </span>        <span class="s2">"bool1"</span><span class="p">:</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">],</span>
<span class="gp">   .....: </span>        <span class="s2">"bool2"</span><span class="p">:</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span>
<span class="gp">   .....: </span>        <span class="s2">"dates"</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">"now"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
<span class="gp">   .....: </span>        <span class="s2">"category"</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="s2">"ABC"</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">"category"</span><span class="p">),</span>
<span class="gp">   .....: </span>    <span class="p">}</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [431]: </span><span class="n">df</span><span class="p">[</span><span class="s2">"tdeltas"</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dates</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span>

<span class="gp">In [432]: </span><span class="n">df</span><span class="p">[</span><span class="s2">"uint64"</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">"u8"</span><span class="p">)</span>

<span class="gp">In [433]: </span><span class="n">df</span><span class="p">[</span><span class="s2">"other_dates"</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">"20130101"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="gp">In [434]: </span><span class="n">df</span><span class="p">[</span><span class="s2">"tz_aware_dates"</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">"20130101"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s2">"US/Eastern"</span><span class="p">)</span>

<span class="gp">In [435]: </span><span class="n">df</span>
<span class="gh">Out[435]: </span>
<span class="go">  string  int64  uint8  ...  uint64  other_dates            tz_aware_dates</span>
<span class="go">0      a      1      3  ...       3   2013-01-01 2013-01-01 00:00:00-05:00</span>
<span class="go">1      b      2      4  ...       4   2013-01-02 2013-01-02 00:00:00-05:00</span>
<span class="go">2      c      3      5  ...       5   2013-01-03 2013-01-03 00:00:00-05:00</span>

<span class="go">[3 rows x 12 columns]</span>
</pre></div>
</div>
<p>以及它们的 dtypes</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [436]: </span><span class="n">df</span><span class="o">.</span><span class="n">dtypes</span>
<span class="gh">Out[436]: </span>
<span class="go">string                                object</span>
<span class="go">int64                                  int64</span>
<span class="go">uint8                                  uint8</span>
<span class="go">float64                              float64</span>
<span class="go">bool1                                   bool</span>
<span class="go">bool2                                   bool</span>
<span class="go">dates                         datetime64[ns]</span>
<span class="go">category                            category</span>
<span class="go">tdeltas                      timedelta64[ns]</span>
<span class="go">uint64                                uint64</span>
<span class="go">other_dates                   datetime64[ns]</span>
<span class="go">tz_aware_dates    datetime64[ns, US/Eastern]</span>
<span class="go">dtype: object</span>
</pre></div>
</div>
<p><a class="reference internal" href="../reference/api/pandas.DataFrame.select_dtypes.html#pandas.DataFrame.select_dtypes" title="pandas.DataFrame.select_dtypes"><code class="xref py py-meth docutils literal notranslate"><span class="pre">select_dtypes()</span></code></a> 有两个参数 <code class="docutils literal notranslate"><span class="pre">include</span></code> 和 <code class="docutils literal notranslate"><span class="pre">exclude</span></code>，它们允许您说“给我**包含**这些 dtype 的列”（<code class="docutils literal notranslate"><span class="pre">include</span></code>）和/或“给我**不包含**这些 dtype 的列”（<code class="docutils literal notranslate"><span class="pre">exclude</span></code>）。</p>
<p>例如，选择 <code class="docutils literal notranslate"><span class="pre">bool</span></code> 列</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [437]: </span><span class="n">df</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="nb">bool</span><span class="p">])</span>
<span class="gh">Out[437]: </span>
<span class="go">   bool1  bool2</span>
<span class="go">0   True  False</span>
<span class="go">1  False   True</span>
<span class="go">2   True  False</span>
</pre></div>
</div>
<p>您也可以传递 NumPy dtype 层次结构中的 dtype 名称<a class="reference external" href="https://numpy.com.cn/doc/stable/reference/arrays.scalars.html">NumPy dtype 层次结构</a></p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [438]: </span><span class="n">df</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">"bool"</span><span class="p">])</span>
<span class="gh">Out[438]: </span>
<span class="go">   bool1  bool2</span>
<span class="go">0   True  False</span>
<span class="go">1  False   True</span>
<span class="go">2   True  False</span>
</pre></div>
</div>
<p><a class="reference internal" href="../reference/api/pandas.DataFrame.select_dtypes.html#pandas.DataFrame.select_dtypes" title="pandas.DataFrame.select_dtypes"><code class="xref py py-meth docutils literal notranslate"><span class="pre">select_dtypes()</span></code></a> 也适用于通用 dtypes。</p>
<p>例如，选择所有数值和布尔列，同时排除无符号整数</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [439]: </span><span class="n">df</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">"number"</span><span class="p">,</span> <span class="s2">"bool"</span><span class="p">],</span> <span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="s2">"unsignedinteger"</span><span class="p">])</span>
<span class="gh">Out[439]: </span>
<span class="go">   int64  float64  bool1  bool2 tdeltas</span>
<span class="go">0      1      4.0   True  False     NaT</span>
<span class="go">1      2      5.0  False   True  1 days</span>
<span class="go">2      3      6.0   True  False  1 days</span>
</pre></div>
</div>
<p>要选择字符串列，您必须使用 <code class="docutils literal notranslate"><span class="pre">object</span></code> dtype</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [440]: </span><span class="n">df</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">"object"</span><span class="p">])</span>
<span class="gh">Out[440]: </span>
<span class="go">  string</span>
<span class="go">0      a</span>
<span class="go">1      b</span>
<span class="go">2      c</span>
</pre></div>
</div>
<p>要查看通用 <code class="docutils literal notranslate"><span class="pre">dtype</span></code>（如 <code class="docutils literal notranslate"><span class="pre">numpy.number</span></code>）的所有子 dtypes，您可以定义一个函数来返回子 dtypes 树</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [441]: </span><span class="k">def</span><span class="w"> </span><span class="nf">subdtypes</span><span class="p">(</span><span class="n">dtype</span><span class="p">):</span>
<span class="gp">   .....: </span>    <span class="n">subs</span> <span class="o">=</span> <span class="n">dtype</span><span class="o">.</span><span class="n">__subclasses__</span><span class="p">()</span>
<span class="gp">   .....: </span>    <span class="k">if</span> <span class="ow">not</span> <span class="n">subs</span><span class="p">:</span>
<span class="gp">   .....: </span>        <span class="k">return</span> <span class="n">dtype</span>
<span class="gp">   .....: </span>    <span class="k">return</span> <span class="p">[</span><span class="n">dtype</span><span class="p">,</span> <span class="p">[</span><span class="n">subdtypes</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span> <span class="k">for</span> <span class="n">dt</span> <span class="ow">in</span> <span class="n">subs</span><span class="p">]]</span>
<span class="gp">   .....: </span>
</pre></div>
</div>
<p>所有 NumPy dtypes 都是 <code class="docutils literal notranslate"><span class="pre">numpy.generic</span></code> 的子类</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [442]: </span><span class="n">subdtypes</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">generic</span><span class="p">)</span>
<span class="gh">Out[442]: </span>
<span class="go">[numpy.generic,</span>
<span class="go"> [[numpy.number,</span>
<span class="go">   [[numpy.integer,</span>
<span class="go">     [[numpy.signedinteger,</span>
<span class="go">       [numpy.int8,</span>
<span class="go">        numpy.int16,</span>
<span class="go">        numpy.int32,</span>
<span class="go">        numpy.int64,</span>
<span class="go">        numpy.longlong,</span>
<span class="go">        numpy.timedelta64]],</span>
<span class="go">      [numpy.unsignedinteger,</span>
<span class="go">       [numpy.uint8,</span>
<span class="go">        numpy.uint16,</span>
<span class="go">        numpy.uint32,</span>
<span class="go">        numpy.uint64,</span>
<span class="go">        numpy.ulonglong]]]],</span>
<span class="go">    [numpy.inexact,</span>
<span class="go">     [[numpy.floating,</span>
<span class="go">       [numpy.float16, numpy.float32, numpy.float64, numpy.longdouble]],</span>
<span class="go">      [numpy.complexfloating,</span>
<span class="go">       [numpy.complex64, numpy.complex128, numpy.clongdouble]]]]]],</span>
<span class="go">  [numpy.flexible,</span>
<span class="go">   [[numpy.character, [numpy.bytes_, numpy.str_]],</span>
<span class="go">    [numpy.void, [numpy.record]]]],</span>
<span class="go">  numpy.bool_,</span>
<span class="go">  numpy.datetime64,</span>
<span class="go">  numpy.object_]]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p>pandas 还定义了 <code class="docutils literal notranslate"><span class="pre">category</span></code> 和 <code class="docutils literal notranslate"><span class="pre">datetime64[ns,</span> <span class="pre">tz]</span></code> 类型，它们未集成到正常的 NumPy 层次结构中，也不会显示在上述函数中。</p>
</div>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev" href="dsintro.html" title="previous page"> <i class="fa-solid fa-angle-left"></i> <div class="prev-next-info"> <p class="prev-next-subtitle">上一页</p> <p class="prev-next-title">数据结构简介</p> </div> </a> <a class="right-next" href="io.html" title="next page"> <div class="prev-next-info"> <p class="prev-next-subtitle">下一页</p> <p class="prev-next-title">IO 工具 (文本, CSV, HDF5, …)</p> </div> <i class="fa-solid fa-angle-right"></i> </a></div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">

  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> 本页目录</div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="basics.html#head-and-tail">头部和尾部</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="basics.html#attributes-and-underlying-data">属性和底层数据</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="basics.html#accelerated-operations">加速操作</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="basics.html#flexible-binary-operations">灵活的二元操作</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="basics.html#matching-broadcasting-behavior">匹配 / 广播行为</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="basics.html#missing-data-operations-with-fill-values">缺失数据 / 填充值操作</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="basics.html#flexible-comparisons">灵活的比较</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="basics.html#boolean-reductions">布尔归约</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="basics.html#comparing-if-objects-are-equivalent">比较对象是否等价</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="basics.html#comparing-array-like-objects">比较类数组对象</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="basics.html#combining-overlapping-data-sets">合并重叠数据集</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="basics.html#general-dataframe-combine">通用 DataFrame 合并</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="basics.html#descriptive-statistics">描述性统计</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="basics.html#summarizing-data-describe">数据汇总：describe</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="basics.html#index-of-min-max-values">最小值/最大值索引</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="basics.html#value-counts-histogramming-mode">值计数（直方图）/众数</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="basics.html#discretization-and-quantiling">离散化和分位数</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="basics.html#function-application">函数应用</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="basics.html#tablewise-function-application">整表函数应用</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="basics.html#row-or-column-wise-function-application">按行或按列函数应用</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="basics.html#aggregation-api">聚合 API</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="basics.html#aggregating-with-multiple-functions">使用多个函数进行聚合</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="basics.html#aggregating-with-a-dict">使用字典进行聚合</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="basics.html#custom-describe">自定义描述</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="basics.html#transform-api">转换 API</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="basics.html#transform-with-multiple-functions">使用多个函数进行转换</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="basics.html#transforming-with-a-dict">使用字典进行转换</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="basics.html#applying-elementwise-functions">应用元素级函数</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="basics.html#reindexing-and-altering-labels">重新索引和修改标签</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="basics.html#reindexing-to-align-with-another-object">重新索引以与另一个对象对齐</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="basics.html#aligning-objects-with-each-other-with-align">使用 <code class="docutils literal notranslate"><span class="pre">align</span></code> 使对象相互对齐</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="basics.html#filling-while-reindexing">重新索引时填充</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="basics.html#limits-on-filling-while-reindexing">重新索引时填充的限制</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="basics.html#dropping-labels-from-an-axis">从轴中删除标签</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="basics.html#renaming-mapping-labels">重命名 / 映射标签</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="basics.html#iteration">迭代</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="basics.html#items">items</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="basics.html#iterrows">iterrows</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="basics.html#itertuples">itertuples</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="basics.html#dt-accessor">.dt 访问器</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="basics.html#vectorized-string-methods">向量化字符串方法</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="basics.html#sorting">排序</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="basics.html#by-index">按索引</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="basics.html#by-values">按值</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="basics.html#by-indexes-and-values">按索引和值</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="basics.html#searchsorted">searchsorted</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="basics.html#smallest-largest-values">最小值 / 最大值</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="basics.html#sorting-by-a-multiindex-column">按 MultiIndex 列排序</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="basics.html#copying">复制</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="basics.html#dtypes">dtypes</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="basics.html#defaults">默认值</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="basics.html#upcasting">类型提升</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="basics.html#astype">astype</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="basics.html#object-conversion">对象转换</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="basics.html#gotchas">陷阱</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="basics.html#selecting-columns-based-on-dtype">根据 <code class="docutils literal notranslate"><span class="pre">dtype</span></code> 选择列</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  <div class="tocsection sourcelink">
    <a href="../_sources/user_guide/basics.rst.txt">
      <i class="fa-solid fa-file-lines"></i> 显示源代码</a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js%3Fdigest=5b4479735964841361fd"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js%3Fdigest=5b4479735964841361fd"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item"><p class="copyright">© 2025, pandas via <a href="https://numfocus.org">NumFOCUS, Inc.</a> 由 <a href="https://www.ovhcloud.com">OVHcloud</a> 托管。</p></div>
      
        <div class="footer-item">

  <p class="sphinx-version">使用 <a href="https://sphinx-doc.cn/">Sphinx</a> 8.1.3 创建。<br />
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">使用 <a href="https://pydata.sphinx-doc.cn/en/stable/index.html">PyData Sphinx Theme</a> 0.14.4 构建。</p></div>
      
    </div>
  
</div>

  </footer>
  
</body></html>