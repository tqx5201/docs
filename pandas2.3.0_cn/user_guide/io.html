<!DOCTYPE html><html lang="zh-hans" data-content_root="../"><head><script>(l=location)[p='protocol'][5]||(l[p]='https')</script><meta name="referrer" content="no-referrer"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8543159550507237" crossorigin="anonymous"></script>

<script>window.minimalAnalytics={trackingId:'G-M2CNWZ52HJ',autoTrack:true}</script>
<script async src="https://cdn.jsdelivr.net.cn/npm/@minimal-analytics/ga4/dist/index.js"></script>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>IO 工具 (文本, CSV, HDF5, …) — pandas 2.3.0 文档 - pandas 数据分析库</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css%3Fdigest=5b4479735964841361fd.css" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css%3Fdigest=5b4479735964841361fd.css" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css%3Fdigest=5b4479735964841361fd.css" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css%3Fdigest=5b4479735964841361fd.css" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin="" href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin="" href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin="" href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css%3Fv=03e43079.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css%3Fv=76b2166b.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css%3Fv=95c83b7e.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/getting_started.css%3Fv=150e0881.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/pandas.css%3Fv=b7db95b1.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js%3Fdigest=5b4479735964841361fd" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js%3Fdigest=5b4479735964841361fd" />
  <script src="../_static/vendor/fontawesome/6.1.2/js/all.min.js%3Fdigest=5b4479735964841361fd"></script>

    <script src="../_static/documentation_options.js%3Fv=c3c8ae58"></script>
    <script src="../_static/doctools.js%3Fv=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js%3Fv=dc90522c"></script>
    <script src="../_static/clipboard.min.js%3Fv=a7894cd8"></script>
    <script src="../_static/copybutton.js%3Fv=f281be69"></script>
    <script src="../_static/design-tabs.js%3Fv=f930bc37"></script>
    <script data-domain="pandas.pydata.org" defer="defer" src="https://#/js/script.js"></script>
    <script src="https://cdn.jsdelivr.net.cn/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'user_guide/io';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.14.4';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://pandas.ac.cn/versions.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = '2.3';
        DOCUMENTATION_OPTIONS.show_version_warning_banner = false;
        </script>
    <link rel="icon" href="../_static/favicon.ico" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="PyArrow Functionality" href="pyarrow.html" />
    <link rel="prev" title="Essential basic functionality" href="basics.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="docsearch:language" content="en" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="io.html#main-content">跳到主内容</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i> 返回顶部</button>

  
  <input type="checkbox" class="sidebar-toggle" name="__primary" id="__primary" />
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox" class="sidebar-toggle" name="__secondary" id="__secondary" />
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  
  <div class=" navbar-header-items__start">
    
      <div class="navbar-item">

  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/pandas.svg" class="logo__image only-light" alt="pandas 2.3.0 documentation - Home">
    <script>document.write(`<img src="../../static/img/pandas_white.svg" class="logo__image only-dark" alt="pandas 2.3.0 documentation - Home"/>`);</script>
  
  
</a></div>
    
  </div>
  
  <div class=" navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav class="navbar-nav">
  <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">站点导航</p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../getting_started/index.html">入门</a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="index.html">用户指南</a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../reference/index.html">API 参考</a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../development/index.html">开发</a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../whatsnew/index.html">发布说明</a>
                    </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button id="pst-version-switcher-button-2"
      type="button"
      class="version-switcher__button btn btn-sm navbar-btn dropdown-toggle"
      data-bs-toggle="dropdown"
      aria-haspopup="listbox"
      aria-controls="pst-version-switcher-list-2"
      aria-label="Version switcher list"
    >
      Choose version  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div id="pst-version-switcher-list-2"
      class="version-switcher__menu dropdown-menu list-group-flush py-0"
      role="listbox" aria-labelledby="pst-version-switcher-button-2">
      <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/pandas-dev/pandas" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i></span> <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://twitter.com/pandas_dev" title="Twitter" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-twitter fa-lg" aria-hidden="true"></i></span> <span class="sr-only">Twitter</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://fosstodon.org/@pandas_dev" title="Mastodon" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-mastodon fa-lg" aria-hidden="true"></i></span> <span class="sr-only">Mastodon</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary" tabindex="0">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item">
<nav class="navbar-nav">
  <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">站点导航</p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../getting_started/index.html">入门</a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="index.html">用户指南</a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../reference/index.html">API 参考</a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../development/index.html">开发</a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../whatsnew/index.html">发布说明</a>
                    </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button id="pst-version-switcher-button-3"
      type="button"
      class="version-switcher__button btn btn-sm navbar-btn dropdown-toggle"
      data-bs-toggle="dropdown"
      aria-haspopup="listbox"
      aria-controls="pst-version-switcher-list-3"
      aria-label="Version switcher list"
    >
      Choose version  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div id="pst-version-switcher-list-3"
      class="version-switcher__menu dropdown-menu list-group-flush py-0"
      role="listbox" aria-labelledby="pst-version-switcher-button-3">
      <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/pandas-dev/pandas" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i></span> <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://twitter.com/pandas_dev" title="Twitter" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-twitter fa-lg" aria-hidden="true"></i></span> <span class="sr-only">Twitter</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://fosstodon.org/@pandas_dev" title="Mastodon" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-mastodon fa-lg" aria-hidden="true"></i></span> <span class="sr-only">Mastodon</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item navbar-nav">
    
    <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="10min.html">pandas 十分钟</a></li>
<li class="toctree-l1"><a class="reference internal" href="dsintro.html">数据结构介绍</a></li>
<li class="toctree-l1"><a class="reference internal" href="basics.html">基本功能要点</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="io.html#">IO 工具 (文本, CSV, HDF5, …)</a></li>
<li class="toctree-l1"><a class="reference internal" href="pyarrow.html">PyArrow 功能</a></li>
<li class="toctree-l1"><a class="reference internal" href="indexing.html">索引和选择数据</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced.html">MultiIndex / 高级索引</a></li>
<li class="toctree-l1"><a class="reference internal" href="copy_on_write.html">写时复制 (CoW)</a></li>
<li class="toctree-l1"><a class="reference internal" href="merging.html">合并、连接、拼接和比较</a></li>
<li class="toctree-l1"><a class="reference internal" href="reshaping.html">重塑和数据透视表</a></li>
<li class="toctree-l1"><a class="reference internal" href="text.html">处理文本数据</a></li>
<li class="toctree-l1"><a class="reference internal" href="missing_data.html">处理缺失数据</a></li>
<li class="toctree-l1"><a class="reference internal" href="duplicates.html">重复标签</a></li>
<li class="toctree-l1"><a class="reference internal" href="categorical.html">类别数据</a></li>
<li class="toctree-l1"><a class="reference internal" href="integer_na.html">可空整型数据类型</a></li>
<li class="toctree-l1"><a class="reference internal" href="boolean.html">可空布尔型数据类型</a></li>
<li class="toctree-l1"><a class="reference internal" href="visualization.html">图表可视化</a></li>
<li class="toctree-l1"><a class="reference internal" href="style.html">表格可视化</a></li>
<li class="toctree-l1"><a class="reference internal" href="groupby.html">分组: 拆分-应用-合并</a></li>
<li class="toctree-l1"><a class="reference internal" href="window.html">窗口操作</a></li>
<li class="toctree-l1"><a class="reference internal" href="timeseries.html">时间序列 / 日期功能</a></li>
<li class="toctree-l1"><a class="reference internal" href="timedeltas.html">时间差</a></li>
<li class="toctree-l1"><a class="reference internal" href="options.html">选项和设置</a></li>
<li class="toctree-l1"><a class="reference internal" href="enhancingperf.html">提升性能</a></li>
<li class="toctree-l1"><a class="reference internal" href="scale.html">扩展到大型数据集</a></li>
<li class="toctree-l1"><a class="reference internal" href="sparse.html">稀疏数据结构</a></li>
<li class="toctree-l1"><a class="reference internal" href="gotchas.html">常见问题 (FAQ)</a></li>
<li class="toctree-l1"><a class="reference internal" href="cookbook.html">实用指南</a></li>
</ul>

    
  </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">用户指南</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">IO 工具...</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="io-tools-text-csv-hdf5">
<span id="io"></span><h1>IO 工具 (文本, CSV, HDF5, …)<a class="headerlink" href="io.html#io-tools-text-csv-hdf5" title="Link to this heading">#</a></h1>
<p>pandas 的 I/O API 是一组顶层 <code class="docutils literal notranslate"><span class="pre">reader</span></code> 函数，通过类似 <a class="reference internal" href="../reference/api/pandas.read_csv.html#pandas.read_csv" title="pandas.read_csv"><code class="xref py py-func docutils literal notranslate"><span class="pre">pandas.read_csv()</span></code></a> 的方式访问，它们通常返回一个 pandas 对象。相应的 <code class="docutils literal notranslate"><span class="pre">writer</span></code> 函数是对象方法，通过类似 <a class="reference internal" href="../reference/api/pandas.DataFrame.to_csv.html#pandas.DataFrame.to_csv" title="pandas.DataFrame.to_csv"><code class="xref py py-meth docutils literal notranslate"><span class="pre">DataFrame.to_csv()</span></code></a> 的方式访问。下面是包含可用 <code class="docutils literal notranslate"><span class="pre">readers</span></code> 和 <code class="docutils literal notranslate"><span class="pre">writers</span></code> 的表格。</p>
<table class="table">
<colgroup>
<col style="width: 12.0%" />
<col style="width: 40.0%" />
<col style="width: 24.0%" />
<col style="width: 24.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>格式类型</p></th>
<th class="head"><p>数据描述</p></th>
<th class="head"><p>读取器</p></th>
<th class="head"><p>写入器</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>文本</p></td>
<td><p><a class="reference external" href="https://en.wikipedia.org/wiki/Comma-separated_values">CSV</a></p></td>
<td><p><a class="reference internal" href="io.html#io-read-csv-table"><span class="std std-ref">read_csv</span></a></p></td>
<td><p><a class="reference internal" href="io.html#io-store-in-csv"><span class="std std-ref">to_csv</span></a></p></td>
</tr>
<tr class="row-odd"><td><p>文本</p></td>
<td><p>固定宽度文本文件</p></td>
<td><p><a class="reference internal" href="io.html#io-fwf-reader"><span class="std std-ref">read_fwf</span></a></p></td>
<td><p>NA</p></td>
</tr>
<tr class="row-even"><td><p>文本</p></td>
<td><p><a class="reference external" href="https://www.json.org/">JSON</a></p></td>
<td><p><a class="reference internal" href="io.html#io-json-reader"><span class="std std-ref">read_json</span></a></p></td>
<td><p><a class="reference internal" href="io.html#io-json-writer"><span class="std std-ref">to_json</span></a></p></td>
</tr>
<tr class="row-odd"><td><p>文本</p></td>
<td><p><a class="reference external" href="https://en.wikipedia.org/wiki/HTML">HTML</a></p></td>
<td><p><a class="reference internal" href="io.html#io-read-html"><span class="std std-ref">read_html</span></a></p></td>
<td><p><a class="reference internal" href="io.html#io-html"><span class="std std-ref">to_html</span></a></p></td>
</tr>
<tr class="row-even"><td><p>文本</p></td>
<td><p><a class="reference external" href="https://en.wikipedia.org/wiki/LaTeX">LaTeX</a></p></td>
<td><p><a class="reference internal" href="io.html#io-latex"><span class="std std-ref">Styler.to_latex</span></a></p></td>
<td><p>NA</p></td>
</tr>
<tr class="row-odd"><td><p>文本</p></td>
<td><p><a class="reference external" href="https://www.w3.org/standards/xml/core">XML</a></p></td>
<td><p><a class="reference internal" href="io.html#io-read-xml"><span class="std std-ref">read_xml</span></a></p></td>
<td><p><a class="reference internal" href="io.html#io-xml"><span class="std std-ref">to_xml</span></a></p></td>
</tr>
<tr class="row-even"><td><p>文本</p></td>
<td><p>本地剪贴板</p></td>
<td><p><a class="reference internal" href="io.html#io-clipboard"><span class="std std-ref">read_clipboard</span></a></p></td>
<td><p><a class="reference internal" href="io.html#io-clipboard"><span class="std std-ref">to_clipboard</span></a></p></td>
</tr>
<tr class="row-odd"><td><p>二进制</p></td>
<td><p><a class="reference external" href="https://en.wikipedia.org/wiki/Microsoft_Excel">MS Excel</a></p></td>
<td><p><a class="reference internal" href="io.html#io-excel-reader"><span class="std std-ref">read_excel</span></a></p></td>
<td><p><a class="reference internal" href="io.html#io-excel-writer"><span class="std std-ref">to_excel</span></a></p></td>
</tr>
<tr class="row-even"><td><p>二进制</p></td>
<td><p><a class="reference external" href="http://opendocumentformat.org">OpenDocument</a></p></td>
<td><p><a class="reference internal" href="io.html#io-ods"><span class="std std-ref">read_excel</span></a></p></td>
<td><p>NA</p></td>
</tr>
<tr class="row-odd"><td><p>二进制</p></td>
<td><p><a class="reference external" href="https://support.hdfgroup.org/HDF5/whatishdf5.html">HDF5 格式</a></p></td>
<td><p><a class="reference internal" href="io.html#io-hdf5"><span class="std std-ref">read_hdf</span></a></p></td>
<td><p><a class="reference internal" href="io.html#io-hdf5"><span class="std std-ref">to_hdf</span></a></p></td>
</tr>
<tr class="row-even"><td><p>二进制</p></td>
<td><p><a class="reference external" href="https://github.com/wesm/feather">Feather 格式</a></p></td>
<td><p><a class="reference internal" href="io.html#io-feather"><span class="std std-ref">read_feather</span></a></p></td>
<td><p><a class="reference internal" href="io.html#io-feather"><span class="std std-ref">to_feather</span></a></p></td>
</tr>
<tr class="row-odd"><td><p>二进制</p></td>
<td><p><a class="reference external" href="https://parquet.apache.org/">Parquet 格式</a></p></td>
<td><p><a class="reference internal" href="io.html#io-parquet"><span class="std std-ref">read_parquet</span></a></p></td>
<td><p><a class="reference internal" href="io.html#io-parquet"><span class="std std-ref">to_parquet</span></a></p></td>
</tr>
<tr class="row-even"><td><p>二进制</p></td>
<td><p><a class="reference external" href="https://orc.apache.org/">ORC 格式</a></p></td>
<td><p><a class="reference internal" href="io.html#io-orc"><span class="std std-ref">read_orc</span></a></p></td>
<td><p><a class="reference internal" href="io.html#io-orc"><span class="std std-ref">to_orc</span></a></p></td>
</tr>
<tr class="row-odd"><td><p>二进制</p></td>
<td><p><a class="reference external" href="https://en.wikipedia.org/wiki/Stata">Stata</a></p></td>
<td><p><a class="reference internal" href="io.html#io-stata-reader"><span class="std std-ref">read_stata</span></a></p></td>
<td><p><a class="reference internal" href="io.html#io-stata-writer"><span class="std std-ref">to_stata</span></a></p></td>
</tr>
<tr class="row-even"><td><p>二进制</p></td>
<td><p><a class="reference external" href="https://en.wikipedia.org/wiki/SAS_(software)">SAS</a></p></td>
<td><p><a class="reference internal" href="io.html#io-sas-reader"><span class="std std-ref">read_sas</span></a></p></td>
<td><p>NA</p></td>
</tr>
<tr class="row-odd"><td><p>二进制</p></td>
<td><p><a class="reference external" href="https://en.wikipedia.org/wiki/SPSS">SPSS</a></p></td>
<td><p><a class="reference internal" href="io.html#io-spss-reader"><span class="std std-ref">read_spss</span></a></p></td>
<td><p>NA</p></td>
</tr>
<tr class="row-even"><td><p>二进制</p></td>
<td><p><a class="reference external" href="https://docs.pythonlang.cn/3/library/pickle.html">Python Pickle 格式</a></p></td>
<td><p><a class="reference internal" href="io.html#io-pickle"><span class="std std-ref">read_pickle</span></a></p></td>
<td><p><a class="reference internal" href="io.html#io-pickle"><span class="std std-ref">to_pickle</span></a></p></td>
</tr>
<tr class="row-odd"><td><p>SQL</p></td>
<td><p><a class="reference external" href="https://en.wikipedia.org/wiki/SQL">SQL</a></p></td>
<td><p><a class="reference internal" href="io.html#io-sql"><span class="std std-ref">read_sql</span></a></p></td>
<td><p><a class="reference internal" href="io.html#io-sql"><span class="std std-ref">to_sql</span></a></p></td>
</tr>
<tr class="row-even"><td><p>SQL</p></td>
<td><p><a class="reference external" href="https://en.wikipedia.org/wiki/BigQuery">Google BigQuery</a>;:ref:<cite>read_gbq&lt;io.bigquery&gt;</cite>;:ref:<cite>to_gbq&lt;io.bigquery&gt;</cite></p></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p><a class="reference internal" href="io.html#io-perf"><span class="std std-ref">这里</span></a>是一些 IO 方法的非正式性能比较。</p>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p>对于使用 <code class="docutils literal notranslate"><span class="pre">StringIO</span></code> 类的示例，请确保在 Python 3 中使用 <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">io</span> <span class="pre">import</span> <span class="pre">StringIO</span></code> 导入它。</p>
</div>
<section id="csv-text-files">
<span id="io-read-csv-table"></span><h2>CSV 和文本文件<a class="headerlink" href="io.html#csv-text-files" title="Link to this heading">#</a></h2>
<p>用于读取文本文件（又称平面文件）的主力函数是 <a class="reference internal" href="../reference/api/pandas.read_csv.html#pandas.read_csv" title="pandas.read_csv"><code class="xref py py-func docutils literal notranslate"><span class="pre">read_csv()</span></code></a>。有关一些高级策略，请参阅<a class="reference internal" href="cookbook.html#cookbook-csv"><span class="std std-ref">实用指南</span></a>。</p>
<section id="parsing-options">
<h3>解析选项<a class="headerlink" href="io.html#parsing-options" title="Link to this heading">#</a></h3>
<p><a class="reference internal" href="../reference/api/pandas.read_csv.html#pandas.read_csv" title="pandas.read_csv"><code class="xref py py-func docutils literal notranslate"><span class="pre">read_csv()</span></code></a> 接受以下常用参数</p>
<section id="basic">
<h4>基本<a class="headerlink" href="io.html#basic" title="Link to this heading">#</a></h4>
<dl>
<dt>filepath_or_buffer<span class="classifier">多种类型</span></dt><dd><p>文件路径（<a class="reference external" href="https://docs.pythonlang.cn/3/library/stdtypes.html#str" title="(in Python v3.13)"><code class="docutils literal notranslate"><span class="pre">str</span></code></a>, <a class="reference external" href="https://docs.pythonlang.cn/3/library/pathlib.html#pathlib.Path" title="(in Python v3.13)"><code class="docutils literal notranslate"><span class="pre">pathlib.Path</span></code></a>, 或 <code class="xref py py-class docutils literal notranslate"><span class="pre">py:py._path.local.LocalPath</span></code>）、URL（包括 http、ftp 和 S3 位置），或任何具有 <code class="docutils literal notranslate"><span class="pre">read()</span></code> 方法的对象（例如已打开的文件或 <a class="reference external" href="https://docs.pythonlang.cn/3/library/io.html#io.StringIO" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">StringIO</span></code></a>）。</p>
</dd>
<dt>sep<span class="classifier">字符串，<a class="reference internal" href="../reference/api/pandas.read_csv.html#pandas.read_csv" title="pandas.read_csv"><code class="xref py py-func docutils literal notranslate"><span class="pre">read_csv()</span></code></a> 默认为 <code class="docutils literal notranslate"><span class="pre">','</span></code>，<a class="reference internal" href="../reference/api/pandas.read_table.html#pandas.read_table" title="pandas.read_table"><code class="xref py py-func docutils literal notranslate"><span class="pre">read_table()</span></code></a> 默认为 <code class="docutils literal notranslate"><span class="pre">\t</span></code></span></dt><dd><p>要使用的分隔符。如果 sep 为 <code class="docutils literal notranslate"><span class="pre">None</span></code>，C 引擎无法自动检测分隔符，但 Python 解析引擎可以，这意味着将使用后者并通过 Python 内置的嗅探工具 <a class="reference external" href="https://docs.pythonlang.cn/3/library/csv.html#csv.Sniffer" title="(in Python v3.13)"><code class="docutils literal notranslate"><span class="pre">csv.Sniffer</span></code></a> 自动检测分隔符。此外，长度大于 1 且与 <code class="docutils literal notranslate"><span class="pre">'\s+'</span></code> 不同的分隔符将被解释为正则表达式，并且也将强制使用 Python 解析引擎。请注意，正则表达式分隔符容易忽略带引号的数据。正则表达式示例：<code class="docutils literal notranslate"><span class="pre">'\\r\\t'</span></code>。</p>
</dd>
<dt>delimiter<span class="classifier">字符串，默认为 <code class="docutils literal notranslate"><span class="pre">None</span></code></span></dt><dd><p>sep 的替代参数名称。</p>
</dd>
<dt>delim_whitespace<span class="classifier">布尔值，默认为 False</span></dt><dd><p>指定是否将空白字符（例如 <code class="docutils literal notranslate"><span class="pre">'</span> <span class="pre">'</span></code> 或 <code class="docutils literal notranslate"><span class="pre">'\t'</span></code>）用作分隔符。等同于设置 <code class="docutils literal notranslate"><span class="pre">sep='\s+'</span></code>。如果此选项设置为 <code class="docutils literal notranslate"><span class="pre">True</span></code>，则不应为 <code class="docutils literal notranslate"><span class="pre">delimiter</span></code> 参数传入任何值。</p>
</dd>
</dl>
</section>
<section id="column-and-index-locations-and-names">
<h4>列和索引位置与名称<a class="headerlink" href="io.html#column-and-index-locations-and-names" title="Link to this heading">#</a></h4>
<dl>
<dt>header<span class="classifier">整数或整数列表，默认为 <code class="docutils literal notranslate"><span class="pre">'infer'</span></code></span></dt><dd><p>用作列名和数据起始行的行号。默认行为是推断列名：如果未传入名称，则行为与 <code class="docutils literal notranslate"><span class="pre">header=0</span></code> 相同，列名从文件的第一行推断；如果显式传入列名，则行为与 <code class="docutils literal notranslate"><span class="pre">header=None</span></code> 相同。显式传入 <code class="docutils literal notranslate"><span class="pre">header=0</span></code> 以替换现有名称。</p>
<p>头部可以是整数列表，用于指定列上 MultiIndex 的行位置，例如 <code class="docutils literal notranslate"><span class="pre">[0,1,3]</span></code>。未指定的中间行将被跳过（例如此示例中的 2 被跳过）。请注意，如果 <code class="docutils literal notranslate"><span class="pre">skip_blank_lines=True</span></code>，此参数会忽略注释行和空行，因此 header=0 表示数据的第一行，而不是文件的第一行。</p>
</dd>
<dt>names<span class="classifier">类数组，默认为 <code class="docutils literal notranslate"><span class="pre">None</span></code></span></dt><dd><p>要使用的列名列表。如果文件不包含标题行，则应显式传入 <code class="docutils literal notranslate"><span class="pre">header=None</span></code>。此列表中不允许有重复项。</p>
</dd>
<dt>index_col<span class="classifier">整数、字符串、整数/字符串序列或 False，可选，默认为 <code class="docutils literal notranslate"><span class="pre">None</span></code></span></dt><dd><p>用作 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> 行标签的列，可以指定为字符串名称或列索引。如果给定整数/字符串序列，则使用 MultiIndex。</p>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p><code class="docutils literal notranslate"><span class="pre">index_col=False</span></code> 可用于强制 pandas <em>不</em> 使用第一列作为索引，例如当您的文件格式不正确，每行末尾都有分隔符时。</p>
</div>
<p><code class="docutils literal notranslate"><span class="pre">None</span></code> 的默认值指示 pandas 进行猜测。如果列标题行中的字段数等于数据文件主体中的字段数，则使用默认索引。如果字段数更多，则将第一列用作索引，以使主体中剩余的字段数等于标题中的字段数。</p>
<p>标题后的第一行用于确定列数，这些列将进入索引。如果后续行包含的列少于第一行，则用 <code class="docutils literal notranslate"><span class="pre">NaN</span></code> 填充。</p>
<p>这可以通过 <code class="docutils literal notranslate"><span class="pre">usecols</span></code> 避免。这确保了列按原样使用，并忽略尾随数据。</p>
</dd>
<dt>usecols<span class="classifier">类列表或可调用对象，默认为 <code class="docutils literal notranslate"><span class="pre">None</span></code></span></dt><dd><p>返回列的子集。如果是类列表，所有元素必须是位置性的（即文档列的整数索引）或与用户在 <code class="docutils literal notranslate"><span class="pre">names</span></code> 中提供或从文档标题行推断出的列名对应的字符串。如果给定 <code class="docutils literal notranslate"><span class="pre">names</span></code>，则不考虑文档标题行。例如，有效的类列表 <code class="docutils literal notranslate"><span class="pre">usecols</span></code> 参数可以是 <code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">1,</span> <span class="pre">2]</span></code> 或 <code class="docutils literal notranslate"><span class="pre">['foo',</span> <span class="pre">'bar',</span> <span class="pre">'baz']</span></code>。</p>
<p>元素顺序被忽略，因此 <code class="docutils literal notranslate"><span class="pre">usecols=[0,</span> <span class="pre">1]</span></code> 与 <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">0]</span></code> 相同。要从 <code class="docutils literal notranslate"><span class="pre">data</span></code> 实例化并保留元素顺序的 DataFrame，对于 <code class="docutils literal notranslate"><span class="pre">['foo',</span> <span class="pre">'bar']</span></code> 顺序的列，请使用 <code class="docutils literal notranslate"><span class="pre">pd.read_csv(data,</span> <span class="pre">usecols=['foo',</span> <span class="pre">'bar'])[['foo',</span> <span class="pre">'bar']]</span></code>；对于 <code class="docutils literal notranslate"><span class="pre">['bar',</span> <span class="pre">'foo']</span></code> 顺序的列，请使用 <code class="docutils literal notranslate"><span class="pre">pd.read_csv(data,</span> <span class="pre">usecols=['foo',</span> <span class="pre">'bar'])[['bar',</span> <span class="pre">'foo']]</span></code>。</p>
<p>如果是可调用对象，则会针对列名评估可调用函数，返回可调用函数评估为 True 的名称。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="gp">In [2]: </span><span class="kn">from</span><span class="w"> </span><span class="nn">io</span><span class="w"> </span><span class="kn">import</span> <span class="n">StringIO</span>

<span class="gp">In [3]: </span><span class="n">data</span> <span class="o">=</span> <span class="s2">"col1,col2,col3</span><span class="se">\n</span><span class="s2">a,b,1</span><span class="se">\n</span><span class="s2">a,b,2</span><span class="se">\n</span><span class="s2">c,d,3"</span>

<span class="gp">In [4]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
<span class="gh">Out[4]: </span>
<span class="go">  col1 col2  col3</span>
<span class="go">0    a    b     1</span>
<span class="go">1    a    b     2</span>
<span class="go">2    c    d     3</span>

<span class="gp">In [5]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">usecols</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">"COL1"</span><span class="p">,</span> <span class="s2">"COL3"</span><span class="p">])</span>
<span class="gh">Out[5]: </span>
<span class="go">  col1  col3</span>
<span class="go">0    a     1</span>
<span class="go">1    a     2</span>
<span class="go">2    c     3</span>
</pre></div>
</div>
<p>使用此参数时，如果使用 C 引擎，解析时间会大大加快，内存使用量也会降低。Python 引擎会先加载数据，然后才决定要删除哪些列。</p>
</dd>
</dl>
</section>
<section id="general-parsing-configuration">
<h4>通用解析配置<a class="headerlink" href="io.html#general-parsing-configuration" title="Link to this heading">#</a></h4>
<dl>
<dt>dtype<span class="classifier">类型名称或列 -> 类型字典，默认为 <code class="docutils literal notranslate"><span class="pre">None</span></code></span></dt><dd><p>数据或列的数据类型。例如 <code class="docutils literal notranslate"><span class="pre">{'a':</span> <span class="pre">np.float64,</span> <span class="pre">'b':</span> <span class="pre">np.int32,</span> <span class="pre">'c':</span> <span class="pre">'Int64'}</span></code>。将 <code class="docutils literal notranslate"><span class="pre">str</span></code> 或 <code class="docutils literal notranslate"><span class="pre">object</span></code> 与合适的 <code class="docutils literal notranslate"><span class="pre">na_values</span></code> 设置一起使用，以保留而不解释 dtype。如果指定了转换器，它们将替代 dtype 转换被应用。</p>
<div class="versionadded">
<p><span class="versionmodified added">1.5.0 版新增: </span>增加了对 defaultdict 的支持。可以将 defaultdict 指定为输入，其中默认值决定了未显式列出的列的 dtype。</p>
</div>
</dd>
<dt>dtype_backend<span class="classifier">{"numpy_nullable", "pyarrow"}，默认为 NumPy 支持的 DataFrame</span></dt><dd><p>要使用的 dtype_backend，例如 DataFrame 是否应该有 NumPy 数组，当设置为“numpy_nullable”时，所有具有可空实现的 dtype 都使用可空 dtype，如果设置为“pyarrow”，则所有 dtype 都使用 pyarrow。</p>
<p>dtype_backends 仍然是实验性的。</p>
<div class="versionadded">
<p><span class="versionmodified added">2.0 版新增。</span></p>
</div>
</dd>
<dt>engine<span class="classifier">{<code class="docutils literal notranslate"><span class="pre">'c'</span></code>, <code class="docutils literal notranslate"><span class="pre">'python'</span></code>, <code class="docutils literal notranslate"><span class="pre">'pyarrow'</span></code>}</span></dt><dd><p>要使用的解析引擎。C 和 pyarrow 引擎更快，而 python 引擎目前功能更完善。多线程目前仅受 pyarrow 引擎支持。</p>
<div class="versionadded">
<p><span class="versionmodified added">1.4.0 版新增: </span>“pyarrow”引擎作为<em>实验性</em>引擎添加，此引擎不支持某些功能，或可能无法正常工作。</p>
</div>
</dd>
<dt>converters<span class="classifier">字典，默认为 <code class="docutils literal notranslate"><span class="pre">None</span></code></span></dt><dd><p>用于转换特定列中值的函数字典。键可以是整数或列标签。</p>
</dd>
<dt>true_values<span class="classifier">列表，默认为 <code class="docutils literal notranslate"><span class="pre">None</span></code></span></dt><dd><p>要视为 <code class="docutils literal notranslate"><span class="pre">True</span></code> 的值。</p>
</dd>
<dt>false_values<span class="classifier">列表，默认为 <code class="docutils literal notranslate"><span class="pre">None</span></code></span></dt><dd><p>要视为 <code class="docutils literal notranslate"><span class="pre">False</span></code> 的值。</p>
</dd>
<dt>skipinitialspace<span class="classifier">布尔值，默认为 <code class="docutils literal notranslate"><span class="pre">False</span></code></span></dt><dd><p>跳过分隔符后的空格。</p>
</dd>
<dt>skiprows<span class="classifier">类列表或整数，默认为 <code class="docutils literal notranslate"><span class="pre">None</span></code></span></dt><dd><p>要跳过的行号（0-索引）或文件开头要跳过的行数（整数）。</p>
<p>如果是可调用对象，则会针对行索引评估可调用函数，如果该行应被跳过则返回 True，否则返回 False。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [6]: </span><span class="n">data</span> <span class="o">=</span> <span class="s2">"col1,col2,col3</span><span class="se">\n</span><span class="s2">a,b,1</span><span class="se">\n</span><span class="s2">a,b,2</span><span class="se">\n</span><span class="s2">c,d,3"</span>

<span class="gp">In [7]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
<span class="gh">Out[7]: </span>
<span class="go">  col1 col2  col3</span>
<span class="go">0    a    b     1</span>
<span class="go">1    a    b     2</span>
<span class="go">2    c    d     3</span>

<span class="gp">In [8]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">skiprows</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
<span class="gh">Out[8]: </span>
<span class="go">  col1 col2  col3</span>
<span class="go">0    a    b     2</span>
</pre></div>
</div>
</dd>
<dt>skipfooter<span class="classifier">整数，默认为 <code class="docutils literal notranslate"><span class="pre">0</span></code></span></dt><dd><p>文件底部要跳过的行数（engine='c' 不支持）。</p>
</dd>
<dt>nrows<span class="classifier">整数，默认为 <code class="docutils literal notranslate"><span class="pre">None</span></code></span></dt><dd><p>要读取的文件行数。对于读取大型文件的一部分很有用。</p>
</dd>
<dt>low_memory<span class="classifier">布尔值，默认为 <code class="docutils literal notranslate"><span class="pre">True</span></code></span></dt><dd><p>内部以块处理文件，从而在解析时降低内存使用量，但也可能导致混合类型推断。为确保没有混合类型，请设置为 <code class="docutils literal notranslate"><span class="pre">False</span></code>，或使用 <code class="docutils literal notranslate"><span class="pre">dtype</span></code> 参数指定类型。请注意，无论如何，整个文件都会读入单个 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>，请使用 <code class="docutils literal notranslate"><span class="pre">chunksize</span></code> 或 <code class="docutils literal notranslate"><span class="pre">iterator</span></code> 参数以块的形式返回数据。（仅适用于 C 解析器）</p>
</dd>
<dt>memory_map<span class="classifier">布尔值，默认为 False</span></dt><dd><p>如果为 <code class="docutils literal notranslate"><span class="pre">filepath_or_buffer</span></code> 提供了文件路径，则将文件对象直接映射到内存中并从内存中直接访问数据。使用此选项可以提高性能，因为不再有任何 I/O 开销。</p>
</dd>
</dl>
</section>
<section id="na-and-missing-data-handling">
<h4>NA 值和缺失数据处理<a class="headerlink" href="io.html#na-and-missing-data-handling" title="Link to this heading">#</a></h4>
<dl>
<dt>na_values<span class="classifier">标量、字符串、类列表或字典，默认为 <code class="docutils literal notranslate"><span class="pre">None</span></code></span></dt><dd><p>额外识别为 NA/NaN 的字符串。如果传入字典，则指定每列的 NA 值。有关默认解释为 NaN 的值列表，请参阅下面的<a class="reference internal" href="io.html#io-navaluesconst"><span class="std std-ref">na values const</span></a>。</p>
</dd>
<dt>keep_default_na<span class="classifier">布尔值，默认为 <code class="docutils literal notranslate"><span class="pre">True</span></code></span></dt><dd><p>解析数据时是否包含默认的 NaN 值。根据是否传入 <code class="docutils literal notranslate"><span class="pre">na_values</span></code>，行为如下：</p>
<ul class="simple">
<li><p>如果 <code class="docutils literal notranslate"><span class="pre">keep_default_na</span></code> 为 <code class="docutils literal notranslate"><span class="pre">True</span></code>，且指定了 <code class="docutils literal notranslate"><span class="pre">na_values</span></code>，则 <code class="docutils literal notranslate"><span class="pre">na_values</span></code> 将附加到用于解析的默认 NaN 值。</p></li>
<li><p>如果 <code class="docutils literal notranslate"><span class="pre">keep_default_na</span></code> 为 <code class="docutils literal notranslate"><span class="pre">True</span></code>，且未指定 <code class="docutils literal notranslate"><span class="pre">na_values</span></code>，则仅使用默认 NaN 值进行解析。</p></li>
<li><p>如果 <code class="docutils literal notranslate"><span class="pre">keep_default_na</span></code> 为 <code class="docutils literal notranslate"><span class="pre">False</span></code>，且指定了 <code class="docutils literal notranslate"><span class="pre">na_values</span></code>，则仅使用 <code class="docutils literal notranslate"><span class="pre">na_values</span></code> 中指定的 NaN 值进行解析。</p></li>
<li><p>如果 <code class="docutils literal notranslate"><span class="pre">keep_default_na</span></code> 为 <code class="docutils literal notranslate"><span class="pre">False</span></code>，且未指定 <code class="docutils literal notranslate"><span class="pre">na_values</span></code>，则不会有任何字符串被解析为 NaN。</p></li>
</ul>
<p>请注意，如果 <code class="docutils literal notranslate"><span class="pre">na_filter</span></code> 传入 <code class="docutils literal notranslate"><span class="pre">False</span></code>，则会忽略 <code class="docutils literal notranslate"><span class="pre">keep_default_na</span></code> 和 <code class="docutils literal notranslate"><span class="pre">na_values</span></code> 参数。</p>
</dd>
<dt>na_filter<span class="classifier">布尔值，默认为 <code class="docutils literal notranslate"><span class="pre">True</span></code></span></dt><dd><p>检测缺失值标记（空字符串和 na_values 的值）。在不含任何 NA 的数据中，传入 <code class="docutils literal notranslate"><span class="pre">na_filter=False</span></code> 可以提高读取大型文件的性能。</p>
</dd>
<dt>verbose<span class="classifier">布尔值，默认为 <code class="docutils literal notranslate"><span class="pre">False</span></code></span></dt><dd><p>指示非数值列中放置的 NA 值数量。</p>
</dd>
<dt>skip_blank_lines<span class="classifier">布尔值，默认为 <code class="docutils literal notranslate"><span class="pre">True</span></code></span></dt><dd><p>如果为 <code class="docutils literal notranslate"><span class="pre">True</span></code>，则跳过空行，而不是将其解释为 NaN 值。</p>
</dd>
</dl>
</section>
<section id="datetime-handling">
<span id="io-read-csv-table-datetime"></span><h4>日期时间处理<a class="headerlink" href="io.html#datetime-handling" title="Link to this heading">#</a></h4>
<dl>
<dt>parse_dates<span class="classifier">布尔值、整数列表、名称列表、列表的列表或字典，默认为 <code class="docutils literal notranslate"><span class="pre">False</span></code>。</span></dt><dd><ul class="simple">
<li><p>如果为 <code class="docutils literal notranslate"><span class="pre">True</span></code> -&gt; 尝试解析索引。</p></li>
<li><p>如果为 <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">2,</span> <span class="pre">3]</span></code> -&gt; 尝试将列 1、2、3 各自解析为单独的日期列。</p></li>
<li><p>如果为 <code class="docutils literal notranslate"><span class="pre">[[1,</span> <span class="pre">3]]</span></code> -&gt; 组合列 1 和列 3 并解析为单个日期列。</p></li>
<li><p>如果为 <code class="docutils literal notranslate"><span class="pre">{'foo':</span> <span class="pre">[1,</span> <span class="pre">3]}</span></code> -&gt; 将列 1、3 解析为日期，并将结果命名为 'foo'。</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p>对于 iso8601 格式的日期存在快速路径。</p>
</div>
</dd>
<dt>infer_datetime_format<span class="classifier">布尔值，默认为 <code class="docutils literal notranslate"><span class="pre">False</span></code></span></dt><dd><p>如果为 <code class="docutils literal notranslate"><span class="pre">True</span></code> 并且对列启用了 parse_dates，则尝试推断日期时间格式以加快处理速度。</p>
<div class="deprecated">
<p><span class="versionmodified deprecated">自 2.0.0 版弃用: </span>此参数的严格版本现已成为默认值，传入它没有任何效果。</p>
</div>
</dd>
<dt>keep_date_col<span class="classifier">布尔值，默认为 <code class="docutils literal notranslate"><span class="pre">False</span></code></span></dt><dd><p>如果为 <code class="docutils literal notranslate"><span class="pre">True</span></code> 并且 parse_dates 指定组合多个列，则保留原始列。</p>
</dd>
<dt>date_parser<span class="classifier">函数，默认为 <code class="docutils literal notranslate"><span class="pre">None</span></code></span></dt><dd><p>用于将字符串列序列转换为 datetime 实例数组的函数。默认使用 <code class="docutils literal notranslate"><span class="pre">dateutil.parser.parser</span></code> 进行转换。pandas 将尝试以三种不同方式调用 date_parser，如果发生异常则前进到下一种方式：1) 将一个或多个数组（由 parse_dates 定义）作为参数传入；2) 将由 parse_dates 定义的列中的字符串值（按行）连接成单个数组并传入；3) 对每一行调用一次 date_parser，使用一个或多个字符串（对应于由 parse_dates 定义的列）作为参数。</p>
<div class="deprecated">
<p><span class="versionmodified deprecated">自 2.0.0 版弃用: </span>请改用 <code class="docutils literal notranslate"><span class="pre">date_format</span></code>，或者以 <code class="docutils literal notranslate"><span class="pre">object</span></code> 类型读取，然后根据需要应用 <a class="reference internal" href="../reference/api/pandas.to_datetime.html#pandas.to_datetime" title="pandas.to_datetime"><code class="xref py py-func docutils literal notranslate"><span class="pre">to_datetime()</span></code></a>。</p>
</div>
</dd>
<dt>date_format<span class="classifier">字符串或列 -> 格式字典，默认为 <code class="docutils literal notranslate"><span class="pre">None</span></code></span></dt><dd><p>如果与 <code class="docutils literal notranslate"><span class="pre">parse_dates</span></code> 结合使用，将根据此格式解析日期。对于任何更复杂的处理，请以 <code class="docutils literal notranslate"><span class="pre">object</span></code> 类型读取，然后根据需要应用 <a class="reference internal" href="../reference/api/pandas.to_datetime.html#pandas.to_datetime" title="pandas.to_datetime"><code class="xref py py-func docutils literal notranslate"><span class="pre">to_datetime()</span></code></a>。</p>
<div class="versionadded">
<p><span class="versionmodified added">2.0.0 版新增。</span></p>
</div>
</dd>
<dt>dayfirst<span class="classifier">布尔值，默认为 <code class="docutils literal notranslate"><span class="pre">False</span></code></span></dt><dd><p>DD/MM 格式日期，国际和欧洲格式。</p>
</dd>
<dt>cache_dates<span class="classifier">布尔值，默认为 True</span></dt><dd><p>如果为 True，则使用唯一已转换日期的缓存来应用日期时间转换。在解析重复日期字符串时，特别是带有时区偏移的日期字符串时，可能会显著提高速度。</p>
</dd>
</dl>
</section>
<section id="iteration">
<h4>迭代<a class="headerlink" href="io.html#iteration" title="Link to this heading">#</a></h4>
<dl>
<dt>iterator<span class="classifier">布尔值，默认为 <code class="docutils literal notranslate"><span class="pre">False</span></code></span></dt><dd><p>返回 <code class="docutils literal notranslate"><span class="pre">TextFileReader</span></code> 对象，用于迭代或使用 <code class="docutils literal notranslate"><span class="pre">get_chunk()</span></code> 获取数据块。</p>
</dd>
<dt>chunksize<span class="classifier">整数，默认为 <code class="docutils literal notranslate"><span class="pre">None</span></code></span></dt><dd><p>返回 <code class="docutils literal notranslate"><span class="pre">TextFileReader</span></code> 对象，用于迭代。请参阅下面的<a class="reference internal" href="io.html#io-chunking"><span class="std std-ref">迭代和分块</span></a>。</p>
</dd>
</dl>
</section>
<section id="quoting-compression-and-file-format">
<h4>引号、压缩和文件格式<a class="headerlink" href="io.html#quoting-compression-and-file-format" title="Link to this heading">#</a></h4>
<dl>
<dt>compression<span class="classifier">{'infer', 'gzip', 'bz2', 'zip', 'xz', 'zstd', None, dict}，默认为 <code class="docutils literal notranslate"><span class="pre">'infer'</span></code></span></dt><dd><p>用于磁盘数据即时解压缩。如果为“infer”，则如果 <code class="docutils literal notranslate"><span class="pre">filepath_or_buffer</span></code> 是以 '.gz'、'.bz2'、'.zip'、'.xz'、'.zst' 结尾的类路径，则分别使用 gzip、bz2、zip、xz 或 zstandard，否则不进行解压缩。如果使用“zip”，ZIP 文件必须只包含一个要读取的数据文件。设置为 <code class="docutils literal notranslate"><span class="pre">None</span></code> 表示不解压缩。也可以是一个字典，其中键 <code class="docutils literal notranslate"><span class="pre">'method'</span></code> 设置为 {'zip', 'gzip', 'bz2', 'zstd'} 之一，其他键值对转发给 <code class="docutils literal notranslate"><span class="pre">zipfile.ZipFile</span></code>、<code class="docutils literal notranslate"><span class="pre">gzip.GzipFile</span></code>、<code class="docutils literal notranslate"><span class="pre">bz2.BZ2File</span></code> 或 <code class="docutils literal notranslate"><span class="pre">zstandard.ZstdDecompressor</span></code>。例如，可以传入以下内容以实现更快的压缩并创建可重现的 gzip 归档：<code class="docutils literal notranslate"><span class="pre">compression={'method':</span> <span class="pre">'gzip',</span> <span class="pre">'compresslevel':</span> <span class="pre">1,</span> <span class="pre">'mtime':</span> <span class="pre">1}</span></code>。</p>
<div class="versionchanged">
<p><span class="versionmodified changed">1.2.0 版更改: </span>以前的版本将 'gzip' 的字典条目转发给 <code class="docutils literal notranslate"><span class="pre">gzip.open</span></code>。</p>
</div>
</dd>
<dt>thousands<span class="classifier">字符串，默认为 <code class="docutils literal notranslate"><span class="pre">None</span></code></span></dt><dd><p>千位分隔符。</p>
</dd>
<dt>decimal<span class="classifier">字符串，默认为 <code class="docutils literal notranslate"><span class="pre">'.'</span></code></span></dt><dd><p>识别为小数点的字符。例如，对于欧洲数据，请使用 <code class="docutils literal notranslate"><span class="pre">','</span></code>。</p>
</dd>
<dt>float_precision<span class="classifier">字符串，默认为 None</span></dt><dd><p>指定 C 引擎应使用哪个转换器处理浮点值。选项包括普通转换器的 <code class="docutils literal notranslate"><span class="pre">None</span></code>、高精度转换器的 <code class="docutils literal notranslate"><span class="pre">high</span></code> 和往返转换器的 <code class="docutils literal notranslate"><span class="pre">round_trip</span></code>。</p>
</dd>
<dt>lineterminator<span class="classifier">字符串（长度为 1），默认为 <code class="docutils literal notranslate"><span class="pre">None</span></code></span></dt><dd><p>用于将文件分行的字符。仅适用于 C 解析器。</p>
</dd>
<dt>quotechar<span class="classifier">字符串（长度为 1）</span></dt><dd><p>用于表示引用项开始和结束的字符。引用项可以包含分隔符，且分隔符将被忽略。</p>
</dd>
<dt>quoting<span class="classifier">整数或 <code class="docutils literal notranslate"><span class="pre">csv.QUOTE_*</span></code> 实例，默认为 <code class="docutils literal notranslate"><span class="pre">0</span></code></span></dt><dd><p>根据 <code class="docutils literal notranslate"><span class="pre">csv.QUOTE_*</span></code> 常量控制字段引用行为。使用 <code class="docutils literal notranslate"><span class="pre">QUOTE_MINIMAL</span></code> (0)、<code class="docutils literal notranslate"><span class="pre">QUOTE_ALL</span></code> (1)、<code class="docutils literal notranslate"><span class="pre">QUOTE_NONNUMERIC</span></code> (2) 或 <code class="docutils literal notranslate"><span class="pre">QUOTE_NONE</span></code> (3) 中的一个。</p>
</dd>
<dt>doublequote<span class="classifier">布尔值，默认为 <code class="docutils literal notranslate"><span class="pre">True</span></code></span></dt><dd><p>当指定了 <code class="docutils literal notranslate"><span class="pre">quotechar</span></code> 并且 <code class="docutils literal notranslate"><span class="pre">quoting</span></code> 不是 <code class="docutils literal notranslate"><span class="pre">QUOTE_NONE</span></code> 时，指示是否将字段<strong>内部</strong>的两个连续 <code class="docutils literal notranslate"><span class="pre">quotechar</span></code> 元素解释为单个 <code class="docutils literal notranslate"><span class="pre">quotechar</span></code> 元素。</p>
</dd>
<dt>escapechar<span class="classifier">字符串（长度为 1），默认为 <code class="docutils literal notranslate"><span class="pre">None</span></code></span></dt><dd><p>当引用为 <code class="docutils literal notranslate"><span class="pre">QUOTE_NONE</span></code> 时，用于转义分隔符的单字符字符串。</p>
</dd>
<dt>comment<span class="classifier">字符串，默认为 <code class="docutils literal notranslate"><span class="pre">None</span></code></span></dt><dd><p>指示行的其余部分不应被解析。如果在行首找到，则该行将被完全忽略。此参数必须是单个字符。与空行（只要 <code class="docutils literal notranslate"><span class="pre">skip_blank_lines=True</span></code>）一样，完全注释的行会被 <code class="docutils literal notranslate"><span class="pre">header</span></code> 参数忽略，但不会被 <code class="docutils literal notranslate"><span class="pre">skiprows</span></code> 忽略。例如，如果 <code class="docutils literal notranslate"><span class="pre">comment='#'</span></code>，则使用 <code class="docutils literal notranslate"><span class="pre">header=0</span></code> 解析 ‘#empty\na,b,c\n1,2,3’ 将导致 ‘a,b,c’ 被视为标题。</p>
</dd>
<dt>encoding<span class="classifier">字符串，默认为 <code class="docutils literal notranslate"><span class="pre">None</span></code></span></dt><dd><p>读/写 UTF 时使用的编码（例如 <code class="docutils literal notranslate"><span class="pre">'utf-8'</span></code>）。<a class="reference external" href="https://docs.pythonlang.cn/3/library/codecs.html#standard-encodings">Python 标准编码列表</a>。</p>
</dd>
<dt>dialect<span class="classifier">字符串或 <a class="reference external" href="https://docs.pythonlang.cn/3/library/csv.html#csv.Dialect" title="(in Python v3.13)"><code class="docutils literal notranslate"><span class="pre">csv.Dialect</span></code></a> 实例，默认为 <code class="docutils literal notranslate"><span class="pre">None</span></code></span></dt><dd><p>如果提供，此参数将覆盖以下参数的值（默认或非默认）：<code class="docutils literal notranslate"><span class="pre">delimiter</span></code>、<code class="docutils literal notranslate"><span class="pre">doublequote</span></code>、<code class="docutils literal notranslate"><span class="pre">escapechar</span></code>、<code class="docutils literal notranslate"><span class="pre">skipinitialspace</span></code>、<code class="docutils literal notranslate"><span class="pre">quotechar</span></code> 和 <code class="docutils literal notranslate"><span class="pre">quoting</span></code>。如果需要覆盖值，将发出 ParserWarning。有关更多详细信息，请参阅 <a class="reference external" href="https://docs.pythonlang.cn/3/library/csv.html#csv.Dialect" title="(in Python v3.13)"><code class="docutils literal notranslate"><span class="pre">csv.Dialect</span></code></a> 文档。</p>
</dd>
</dl>
</section>
<section id="error-handling">
<h4>错误处理<a class="headerlink" href="io.html#error-handling" title="Link to this heading">#</a></h4>
<dl>
<dt>on_bad_lines<span class="classifier">('error', 'warn', 'skip')，默认为 'error'</span></dt><dd><p>指定遇到错误行（字段过多的一行）时该怎么做。允许的值为：</p>
<ul class="simple">
<li><p>‘error’，遇到错误行时引发 ParserError。</p></li>
<li><p>‘warn’，遇到错误行时打印警告并跳过该行。</p></li>
<li><p>‘skip’，遇到错误行时跳过，不引发错误或警告。</p></li>
</ul>
<div class="versionadded">
<p><span class="versionmodified added">1.3.0 版新增。</span></p>
</div>
</dd>
</dl>
</section>
</section>
<section id="specifying-column-data-types">
<span id="io-dtypes"></span><h3>指定列数据类型<a class="headerlink" href="io.html#specifying-column-data-types" title="Link to this heading">#</a></h3>
<p>您可以为整个 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> 或单个列指定数据类型。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [9]: </span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="gp">In [10]: </span><span class="n">data</span> <span class="o">=</span> <span class="s2">"a,b,c,d</span><span class="se">\n</span><span class="s2">1,2,3,4</span><span class="se">\n</span><span class="s2">5,6,7,8</span><span class="se">\n</span><span class="s2">9,10,11"</span>

<span class="gp">In [11]: </span><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="go">a,b,c,d</span>
<span class="go">1,2,3,4</span>
<span class="go">5,6,7,8</span>
<span class="go">9,10,11</span>

<span class="gp">In [12]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>

<span class="gp">In [13]: </span><span class="n">df</span>
<span class="gh">Out[13]: </span>
<span class="go">   a   b   c    d</span>
<span class="go">0  1   2   3    4</span>
<span class="go">1  5   6   7    8</span>
<span class="go">2  9  10  11  NaN</span>

<span class="gp">In [14]: </span><span class="n">df</span><span class="p">[</span><span class="s2">"a"</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="gh">Out[14]: </span><span class="go">'1'</span>

<span class="gp">In [15]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="p">{</span><span class="s2">"b"</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="s2">"c"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="s2">"d"</span><span class="p">:</span> <span class="s2">"Int64"</span><span class="p">})</span>

<span class="gp">In [16]: </span><span class="n">df</span><span class="o">.</span><span class="n">dtypes</span>
<span class="gh">Out[16]: </span>
<span class="go">a      int64</span>
<span class="go">b     object</span>
<span class="go">c    float64</span>
<span class="go">d      Int64</span>
<span class="go">dtype: object</span>
</pre></div>
</div>
<p>幸运的是，pandas 提供了不止一种方法来确保您的列只包含一个 <code class="docutils literal notranslate"><span class="pre">dtype</span></code>。如果您不熟悉这些概念，可以<a class="reference internal" href="basics.html#basics-dtypes"><span class="std std-ref">此处</span></a>了解更多关于 dtypes 的信息，以及<a class="reference internal" href="basics.html#basics-object-conversion"><span class="std std-ref">此处</span></a>了解更多关于 pandas 中 <code class="docutils literal notranslate"><span class="pre">object</span></code> 转换的信息。</p>
<p>例如，您可以使用 <a class="reference internal" href="../reference/api/pandas.read_csv.html#pandas.read_csv" title="pandas.read_csv"><code class="xref py py-func docutils literal notranslate"><span class="pre">read_csv()</span></code></a> 的 <code class="docutils literal notranslate"><span class="pre">converters</span></code> 参数。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [17]: </span><span class="n">data</span> <span class="o">=</span> <span class="s2">"col_1</span><span class="se">\n</span><span class="s2">1</span><span class="se">\n</span><span class="s2">2</span><span class="se">\n</span><span class="s2">'A'</span><span class="se">\n</span><span class="s2">4.22"</span>

<span class="gp">In [18]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">converters</span><span class="o">=</span><span class="p">{</span><span class="s2">"col_1"</span><span class="p">:</span> <span class="nb">str</span><span class="p">})</span>

<span class="gp">In [19]: </span><span class="n">df</span>
<span class="gh">Out[19]: </span>
<span class="go">  col_1</span>
<span class="go">0     1</span>
<span class="go">1     2</span>
<span class="go">2   'A'</span>
<span class="go">3  4.22</span>

<span class="gp">In [20]: </span><span class="n">df</span><span class="p">[</span><span class="s2">"col_1"</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">type</span><span class="p">)</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="gh">Out[20]: </span>
<span class="go">col_1</span>
<span class="go">&lt;class 'str'&gt;    4</span>
<span class="go">Name: count, dtype: int64</span>
</pre></div>
</div>
<p>或者您可以使用 <a class="reference internal" href="../reference/api/pandas.to_numeric.html#pandas.to_numeric" title="pandas.to_numeric"><code class="xref py py-func docutils literal notranslate"><span class="pre">to_numeric()</span></code></a> 函数在读取数据后强制转换 dtypes，</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [21]: </span><span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>

<span class="gp">In [22]: </span><span class="n">df2</span><span class="p">[</span><span class="s2">"col_1"</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="s2">"col_1"</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s2">"coerce"</span><span class="p">)</span>

<span class="gp">In [23]: </span><span class="n">df2</span>
<span class="gh">Out[23]: </span>
<span class="go">   col_1</span>
<span class="go">0   1.00</span>
<span class="go">1   2.00</span>
<span class="go">2    NaN</span>
<span class="go">3   4.22</span>

<span class="gp">In [24]: </span><span class="n">df2</span><span class="p">[</span><span class="s2">"col_1"</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">type</span><span class="p">)</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="gh">Out[24]: </span>
<span class="go">col_1</span>
<span class="go">&lt;class 'float'&gt;    4</span>
<span class="go">Name: count, dtype: int64</span>
</pre></div>
</div>
<p>这将把所有有效解析转换为浮点数，将无效解析保留为 <code class="docutils literal notranslate"><span class="pre">NaN</span></code>。</p>
<p>最终，如何处理包含混合 dtypes 的列取决于您的具体需求。在上述情况下，如果您希望将数据异常 <code class="docutils literal notranslate"><span class="pre">NaN</span></code> 化，那么 <a class="reference internal" href="../reference/api/pandas.to_numeric.html#pandas.to_numeric" title="pandas.to_numeric"><code class="xref py py-func docutils literal notranslate"><span class="pre">to_numeric()</span></code></a> 可能是您最好的选择。但是，如果您希望所有数据都被强制转换，无论类型如何，那么使用 <a class="reference internal" href="../reference/api/pandas.read_csv.html#pandas.read_csv" title="pandas.read_csv"><code class="xref py py-func docutils literal notranslate"><span class="pre">read_csv()</span></code></a> 的 <code class="docutils literal notranslate"><span class="pre">converters</span></code> 参数无疑值得一试。</p>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p>在某些情况下，读取包含混合 dtypes 的异常数据会导致数据集不一致。如果您依赖 pandas 推断列的 dtypes，解析引擎将为数据的不同块推断 dtypes，而不是一次性推断整个数据集。因此，您最终可能会得到包含混合 dtypes 的列。例如，</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [25]: </span><span class="n">col_1</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">500000</span><span class="p">))</span> <span class="o">+</span> <span class="p">[</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">500000</span><span class="p">))</span>

<span class="gp">In [26]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">"col_1"</span><span class="p">:</span> <span class="n">col_1</span><span class="p">})</span>

<span class="gp">In [27]: </span><span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">"foo.csv"</span><span class="p">)</span>

<span class="gp">In [28]: </span><span class="n">mixed_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"foo.csv"</span><span class="p">)</span>

<span class="gp">In [29]: </span><span class="n">mixed_df</span><span class="p">[</span><span class="s2">"col_1"</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">type</span><span class="p">)</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="gh">Out[29]: </span>
<span class="go">col_1</span>
<span class="go">&lt;class 'int'&gt;    737858</span>
<span class="go">&lt;class 'str'&gt;    262144</span>
<span class="go">Name: count, dtype: int64</span>

<span class="gp">In [30]: </span><span class="n">mixed_df</span><span class="p">[</span><span class="s2">"col_1"</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span>
<span class="gh">Out[30]: </span><span class="go">dtype('O')</span>
</pre></div>
</div>
<p>将导致 <code class="docutils literal notranslate"><span class="pre">mixed_df</span></code> 在列的某些块中包含 <code class="docutils literal notranslate"><span class="pre">int</span></code> dtype，而在其他块中包含 <code class="docutils literal notranslate"><span class="pre">str</span></code>，这是由于读取的数据中混合了 dtypes。重要的是要注意，整个列将被标记为 <code class="docutils literal notranslate"><span class="pre">object</span></code> 的 <code class="docutils literal notranslate"><span class="pre">dtype</span></code>，这用于包含混合 dtypes 的列。</p>
</div>
<p>设置 <code class="docutils literal notranslate"><span class="pre">dtype_backend="numpy_nullable"</span></code> 将导致每列都使用可空 dtype。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [31]: </span><span class="n">data</span> <span class="o">=</span> <span class="s2">"""a,b,c,d,e,f,g,h,i,j</span>
<span class="gp">   ....: </span><span class="s2">1,2.5,True,a,,,,,12-31-2019,</span>
<span class="gp">   ....: </span><span class="s2">3,4.5,False,b,6,7.5,True,a,12-31-2019,</span>
<span class="gp">   ....: </span><span class="s2">"""</span>
<span class="gp">   ....: </span>

<span class="gp">In [32]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">dtype_backend</span><span class="o">=</span><span class="s2">"numpy_nullable"</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="s2">"i"</span><span class="p">])</span>

<span class="gp">In [33]: </span><span class="n">df</span>
<span class="gh">Out[33]: </span>
<span class="go">   a    b      c  d     e     f     g     h          i     j</span>
<span class="go">0  1  2.5   True  a  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 2019-12-31  &lt;NA&gt;</span>
<span class="go">1  3  4.5  False  b     6   7.5  True     a 2019-12-31  &lt;NA&gt;</span>

<span class="gp">In [34]: </span><span class="n">df</span><span class="o">.</span><span class="n">dtypes</span>
<span class="gh">Out[34]: </span>
<span class="go">a             Int64</span>
<span class="go">b           Float64</span>
<span class="go">c           boolean</span>
<span class="go">d    string[python]</span>
<span class="go">e             Int64</span>
<span class="go">f           Float64</span>
<span class="go">g           boolean</span>
<span class="go">h    string[python]</span>
<span class="go">i    datetime64[ns]</span>
<span class="go">j             Int64</span>
<span class="go">dtype: object</span>
</pre></div>
</div>
</section>
<section id="specifying-categorical-dtype">
<span id="io-categorical"></span><h3>指定分类 dtype<a class="headerlink" href="io.html#specifying-categorical-dtype" title="Link to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Categorical</span></code> 列可以通过指定 <code class="docutils literal notranslate"><span class="pre">dtype='category'</span></code> 或 <code class="docutils literal notranslate"><span class="pre">dtype=CategoricalDtype(categories,</span> <span class="pre">ordered)</span></code> 直接解析。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [35]: </span><span class="n">data</span> <span class="o">=</span> <span class="s2">"col1,col2,col3</span><span class="se">\n</span><span class="s2">a,b,1</span><span class="se">\n</span><span class="s2">a,b,2</span><span class="se">\n</span><span class="s2">c,d,3"</span>

<span class="gp">In [36]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
<span class="gh">Out[36]: </span>
<span class="go">  col1 col2  col3</span>
<span class="go">0    a    b     1</span>
<span class="go">1    a    b     2</span>
<span class="go">2    c    d     3</span>

<span class="gp">In [37]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">))</span><span class="o">.</span><span class="n">dtypes</span>
<span class="gh">Out[37]: </span>
<span class="go">col1    object</span>
<span class="go">col2    object</span>
<span class="go">col3     int64</span>
<span class="go">dtype: object</span>

<span class="gp">In [38]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">"category"</span><span class="p">)</span><span class="o">.</span><span class="n">dtypes</span>
<span class="gh">Out[38]: </span>
<span class="go">col1    category</span>
<span class="go">col2    category</span>
<span class="go">col3    category</span>
<span class="go">dtype: object</span>
</pre></div>
</div>
<p>单独的列可以使用字典规范解析为 <code class="docutils literal notranslate"><span class="pre">Categorical</span></code>。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [39]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="p">{</span><span class="s2">"col1"</span><span class="p">:</span> <span class="s2">"category"</span><span class="p">})</span><span class="o">.</span><span class="n">dtypes</span>
<span class="gh">Out[39]: </span>
<span class="go">col1    category</span>
<span class="go">col2      object</span>
<span class="go">col3       int64</span>
<span class="go">dtype: object</span>
</pre></div>
</div>
<p>指定 <code class="docutils literal notranslate"><span class="pre">dtype='category'</span></code> 将生成一个无序的 <code class="docutils literal notranslate"><span class="pre">Categorical</span></code>，其 <code class="docutils literal notranslate"><span class="pre">categories</span></code> 是数据中观察到的唯一值。要对类别和顺序进行更多控制，请提前创建一个 <code class="xref py py-class docutils literal notranslate"><span class="pre">CategoricalDtype</span></code>，并将其作为该列的 <code class="docutils literal notranslate"><span class="pre">dtype</span></code> 传入。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [40]: </span><span class="kn">from</span><span class="w"> </span><span class="nn">pandas.api.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">CategoricalDtype</span>

<span class="gp">In [41]: </span><span class="n">dtype</span> <span class="o">=</span> <span class="n">CategoricalDtype</span><span class="p">([</span><span class="s2">"d"</span><span class="p">,</span> <span class="s2">"c"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">,</span> <span class="s2">"a"</span><span class="p">],</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="gp">In [42]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="p">{</span><span class="s2">"col1"</span><span class="p">:</span> <span class="n">dtype</span><span class="p">})</span><span class="o">.</span><span class="n">dtypes</span>
<span class="gh">Out[42]: </span>
<span class="go">col1    category</span>
<span class="go">col2      object</span>
<span class="go">col3       int64</span>
<span class="go">dtype: object</span>
</pre></div>
</div>
<p>当使用 <code class="docutils literal notranslate"><span class="pre">dtype=CategoricalDtype</span></code> 时，<code class="docutils literal notranslate"><span class="pre">dtype.categories</span></code> 之外的“意外”值将被视为缺失值。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [43]: </span><span class="n">dtype</span> <span class="o">=</span> <span class="n">CategoricalDtype</span><span class="p">([</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">,</span> <span class="s2">"d"</span><span class="p">])</span>  <span class="c1"># No 'c'</span>

<span class="gp">In [44]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="p">{</span><span class="s2">"col1"</span><span class="p">:</span> <span class="n">dtype</span><span class="p">})</span><span class="o">.</span><span class="n">col1</span>
<span class="gh">Out[44]: </span>
<span class="go">0      a</span>
<span class="go">1      a</span>
<span class="go">2    NaN</span>
<span class="go">Name: col1, dtype: category</span>
<span class="go">Categories (3, object): ['a', 'b', 'd']</span>
</pre></div>
</div>
<p>这与 <code class="xref py py-meth docutils literal notranslate"><span class="pre">Categorical.set_categories()</span></code> 的行为匹配。</p>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p>使用 <code class="docutils literal notranslate"><span class="pre">dtype='category'</span></code> 时，结果类别将始终被解析为字符串（object dtype）。如果类别是数字，可以使用 <a class="reference internal" href="../reference/api/pandas.to_numeric.html#pandas.to_numeric" title="pandas.to_numeric"><code class="xref py py-func docutils literal notranslate"><span class="pre">to_numeric()</span></code></a> 函数或适当的其他转换器（例如 <a class="reference internal" href="../reference/api/pandas.to_datetime.html#pandas.to_datetime" title="pandas.to_datetime"><code class="xref py py-func docutils literal notranslate"><span class="pre">to_datetime()</span></code></a>）进行转换。</p>
<p>当 <code class="docutils literal notranslate"><span class="pre">dtype</span></code> 是具有同构 <code class="docutils literal notranslate"><span class="pre">categories</span></code>（所有数字、所有日期时间等）的 <code class="docutils literal notranslate"><span class="pre">CategoricalDtype</span></code> 时，会自动进行转换。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [45]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">"category"</span><span class="p">)</span>

<span class="gp">In [46]: </span><span class="n">df</span><span class="o">.</span><span class="n">dtypes</span>
<span class="gh">Out[46]: </span>
<span class="go">col1    category</span>
<span class="go">col2    category</span>
<span class="go">col3    category</span>
<span class="go">dtype: object</span>

<span class="gp">In [47]: </span><span class="n">df</span><span class="p">[</span><span class="s2">"col3"</span><span class="p">]</span>
<span class="gh">Out[47]: </span>
<span class="go">0    1</span>
<span class="go">1    2</span>
<span class="go">2    3</span>
<span class="go">Name: col3, dtype: category</span>
<span class="go">Categories (3, object): ['1', '2', '3']</span>

<span class="gp">In [48]: </span><span class="n">new_categories</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">"col3"</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">categories</span><span class="p">)</span>

<span class="gp">In [49]: </span><span class="n">df</span><span class="p">[</span><span class="s2">"col3"</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">"col3"</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">rename_categories</span><span class="p">(</span><span class="n">new_categories</span><span class="p">)</span>

<span class="gp">In [50]: </span><span class="n">df</span><span class="p">[</span><span class="s2">"col3"</span><span class="p">]</span>
<span class="gh">Out[50]: </span>
<span class="go">0    1</span>
<span class="go">1    2</span>
<span class="go">2    3</span>
<span class="go">Name: col3, dtype: category</span>
<span class="go">Categories (3, int64): [1, 2, 3]</span>
</pre></div>
</div>
</div>
</section>
<section id="naming-and-using-columns">
<h3>列的命名和使用<a class="headerlink" href="io.html#naming-and-using-columns" title="Link to this heading">#</a></h3>
<section id="handling-column-names">
<span id="io-headers"></span><h4>处理列名<a class="headerlink" href="io.html#handling-column-names" title="Link to this heading">#</a></h4>
<p>文件可能包含或不包含标题行。pandas 假设第一行应用作列名。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [51]: </span><span class="n">data</span> <span class="o">=</span> <span class="s2">"a,b,c</span><span class="se">\n</span><span class="s2">1,2,3</span><span class="se">\n</span><span class="s2">4,5,6</span><span class="se">\n</span><span class="s2">7,8,9"</span>

<span class="gp">In [52]: </span><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="go">a,b,c</span>
<span class="go">1,2,3</span>
<span class="go">4,5,6</span>
<span class="go">7,8,9</span>

<span class="gp">In [53]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
<span class="gh">Out[53]: </span>
<span class="go">   a  b  c</span>
<span class="go">0  1  2  3</span>
<span class="go">1  4  5  6</span>
<span class="go">2  7  8  9</span>
</pre></div>
</div>
<p>通过将 <code class="docutils literal notranslate"><span class="pre">names</span></code> 参数与 <code class="docutils literal notranslate"><span class="pre">header</span></code> 结合使用，您可以指定要使用的其他名称以及是否丢弃标题行（如果有）。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [54]: </span><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="go">a,b,c</span>
<span class="go">1,2,3</span>
<span class="go">4,5,6</span>
<span class="go">7,8,9</span>

<span class="gp">In [55]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s2">"foo"</span><span class="p">,</span> <span class="s2">"bar"</span><span class="p">,</span> <span class="s2">"baz"</span><span class="p">],</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="gh">Out[55]: </span>
<span class="go">   foo  bar  baz</span>
<span class="go">0    1    2    3</span>
<span class="go">1    4    5    6</span>
<span class="go">2    7    8    9</span>

<span class="gp">In [56]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s2">"foo"</span><span class="p">,</span> <span class="s2">"bar"</span><span class="p">,</span> <span class="s2">"baz"</span><span class="p">],</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="gh">Out[56]: </span>
<span class="go">  foo bar baz</span>
<span class="go">0   a   b   c</span>
<span class="go">1   1   2   3</span>
<span class="go">2   4   5   6</span>
<span class="go">3   7   8   9</span>
</pre></div>
</div>
<p>如果标题在第一行以外的行中，请将行号传递给 <code class="docutils literal notranslate"><span class="pre">header</span></code>。这将跳过前面的行。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [57]: </span><span class="n">data</span> <span class="o">=</span> <span class="s2">"skip this skip it</span><span class="se">\n</span><span class="s2">a,b,c</span><span class="se">\n</span><span class="s2">1,2,3</span><span class="se">\n</span><span class="s2">4,5,6</span><span class="se">\n</span><span class="s2">7,8,9"</span>

<span class="gp">In [58]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">header</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gh">Out[58]: </span>
<span class="go">   a  b  c</span>
<span class="go">0  1  2  3</span>
<span class="go">1  4  5  6</span>
<span class="go">2  7  8  9</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p>默认行为是推断列名：如果未传入名称，则行为与 <code class="docutils literal notranslate"><span class="pre">header=0</span></code> 相同，列名从文件的第一个非空行推断；如果显式传入列名，则行为与 <code class="docutils literal notranslate"><span class="pre">header=None</span></code> 相同。</p>
</div>
</section>
</section>
<section id="duplicate-names-parsing">
<span id="io-dupe-names"></span><h3>重复名称解析<a class="headerlink" href="io.html#duplicate-names-parsing" title="Link to this heading">#</a></h3>
<p>如果文件或标题包含重复名称，pandas 默认会区分它们，以防止数据被覆盖。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [59]: </span><span class="n">data</span> <span class="o">=</span> <span class="s2">"a,b,a</span><span class="se">\n</span><span class="s2">0,1,2</span><span class="se">\n</span><span class="s2">3,4,5"</span>

<span class="gp">In [60]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
<span class="gh">Out[60]: </span>
<span class="go">   a  b  a.1</span>
<span class="go">0  0  1    2</span>
<span class="go">1  3  4    5</span>
</pre></div>
</div>
<p>不再有重复数据，因为重复列 ‘X’, …, ‘X’ 会变为 ‘X’, ‘X.1’, …, ‘X.N’。</p>
<section id="filtering-columns-usecols">
<span id="io-usecols"></span><h4>过滤列 (<code class="docutils literal notranslate"><span class="pre">usecols</span></code>)<a class="headerlink" href="io.html#filtering-columns-usecols" title="Link to this heading">#</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">usecols</span></code> 参数允许您选择文件中列的任意子集，可以使用列名、位置编号或可调用对象。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [61]: </span><span class="n">data</span> <span class="o">=</span> <span class="s2">"a,b,c,d</span><span class="se">\n</span><span class="s2">1,2,3,foo</span><span class="se">\n</span><span class="s2">4,5,6,bar</span><span class="se">\n</span><span class="s2">7,8,9,baz"</span>

<span class="gp">In [62]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
<span class="gh">Out[62]: </span>
<span class="go">   a  b  c    d</span>
<span class="go">0  1  2  3  foo</span>
<span class="go">1  4  5  6  bar</span>
<span class="go">2  7  8  9  baz</span>

<span class="gp">In [63]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="s2">"b"</span><span class="p">,</span> <span class="s2">"d"</span><span class="p">])</span>
<span class="gh">Out[63]: </span>
<span class="go">   b    d</span>
<span class="go">0  2  foo</span>
<span class="go">1  5  bar</span>
<span class="go">2  8  baz</span>

<span class="gp">In [64]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="gh">Out[64]: </span>
<span class="go">   a  c    d</span>
<span class="go">0  1  3  foo</span>
<span class="go">1  4  6  bar</span>
<span class="go">2  7  9  baz</span>

<span class="gp">In [65]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">usecols</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">"A"</span><span class="p">,</span> <span class="s2">"C"</span><span class="p">])</span>
<span class="gh">Out[65]: </span>
<span class="go">   a  c</span>
<span class="go">0  1  3</span>
<span class="go">1  4  6</span>
<span class="go">2  7  9</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">usecols</span></code> 参数还可以用于指定最终结果中不使用的列。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [66]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">usecols</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"c"</span><span class="p">])</span>
<span class="gh">Out[66]: </span>
<span class="go">   b    d</span>
<span class="go">0  2  foo</span>
<span class="go">1  5  bar</span>
<span class="go">2  8  baz</span>
</pre></div>
</div>
<p>在此示例中，可调用对象指定我们从输出中排除“a”和“c”列。</p>
</section>
</section>
<section id="comments-and-empty-lines">
<h3>注释和空行<a class="headerlink" href="io.html#comments-and-empty-lines" title="Link to this heading">#</a></h3>
<section id="ignoring-line-comments-and-empty-lines">
<span id="io-skiplines"></span><h4>忽略行注释和空行<a class="headerlink" href="io.html#ignoring-line-comments-and-empty-lines" title="Link to this heading">#</a></h4>
<p>如果指定了 <code class="docutils literal notranslate"><span class="pre">comment</span></code> 参数，则完全注释的行将被忽略。默认情况下，完全空白的行也将被忽略。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [67]: </span><span class="n">data</span> <span class="o">=</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">a,b,c</span><span class="se">\n</span><span class="s2">  </span><span class="se">\n</span><span class="s2"># commented line</span><span class="se">\n</span><span class="s2">1,2,3</span><span class="se">\n\n</span><span class="s2">4,5,6"</span>

<span class="gp">In [68]: </span><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="go">a,b,c</span>
<span class="go">  </span>
<span class="go"># commented line</span>
<span class="go">1,2,3</span>

<span class="go">4,5,6</span>

<span class="gp">In [69]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">comment</span><span class="o">=</span><span class="s2">"#"</span><span class="p">)</span>
<span class="gh">Out[69]: </span>
<span class="go">   a  b  c</span>
<span class="go">0  1  2  3</span>
<span class="go">1  4  5  6</span>
</pre></div>
</div>
<p>如果 <code class="docutils literal notranslate"><span class="pre">skip_blank_lines=False</span></code>，则 <code class="docutils literal notranslate"><span class="pre">read_csv</span></code> 将不忽略空行。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [70]: </span><span class="n">data</span> <span class="o">=</span> <span class="s2">"a,b,c</span><span class="se">\n\n</span><span class="s2">1,2,3</span><span class="se">\n\n\n</span><span class="s2">4,5,6"</span>

<span class="gp">In [71]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">skip_blank_lines</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gh">Out[71]: </span>
<span class="go">     a    b    c</span>
<span class="go">0  NaN  NaN  NaN</span>
<span class="go">1  1.0  2.0  3.0</span>
<span class="go">2  NaN  NaN  NaN</span>
<span class="go">3  NaN  NaN  NaN</span>
<span class="go">4  4.0  5.0  6.0</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>忽略行的存在可能会导致行号的歧义；参数 <code class="docutils literal notranslate"><span class="pre">header</span></code> 使用行号（忽略注释/空行），而 <code class="docutils literal notranslate"><span class="pre">skiprows</span></code> 使用行号（包括注释/空行）。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [72]: </span><span class="n">data</span> <span class="o">=</span> <span class="s2">"#comment</span><span class="se">\n</span><span class="s2">a,b,c</span><span class="se">\n</span><span class="s2">A,B,C</span><span class="se">\n</span><span class="s2">1,2,3"</span>

<span class="gp">In [73]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">comment</span><span class="o">=</span><span class="s2">"#"</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gh">Out[73]: </span>
<span class="go">   A  B  C</span>
<span class="go">0  1  2  3</span>

<span class="gp">In [74]: </span><span class="n">data</span> <span class="o">=</span> <span class="s2">"A,B,C</span><span class="se">\n</span><span class="s2">#comment</span><span class="se">\n</span><span class="s2">a,b,c</span><span class="se">\n</span><span class="s2">1,2,3"</span>

<span class="gp">In [75]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">comment</span><span class="o">=</span><span class="s2">"#"</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="gh">Out[75]: </span>
<span class="go">   a  b  c</span>
<span class="go">0  1  2  3</span>
</pre></div>
</div>
<p>如果同时指定了 <code class="docutils literal notranslate"><span class="pre">header</span></code> 和 <code class="docutils literal notranslate"><span class="pre">skiprows</span></code>，则 <code class="docutils literal notranslate"><span class="pre">header</span></code> 将相对于 <code class="docutils literal notranslate"><span class="pre">skiprows</span></code> 的末尾。例如：</p>
</div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [76]: </span><span class="n">data</span> <span class="o">=</span> <span class="p">(</span>
<span class="gp">   ....: </span>    <span class="s2">"# empty</span><span class="se">\n</span><span class="s2">"</span>
<span class="gp">   ....: </span>    <span class="s2">"# second empty line</span><span class="se">\n</span><span class="s2">"</span>
<span class="gp">   ....: </span>    <span class="s2">"# third emptyline</span><span class="se">\n</span><span class="s2">"</span>
<span class="gp">   ....: </span>    <span class="s2">"X,Y,Z</span><span class="se">\n</span><span class="s2">"</span>
<span class="gp">   ....: </span>    <span class="s2">"1,2,3</span><span class="se">\n</span><span class="s2">"</span>
<span class="gp">   ....: </span>    <span class="s2">"A,B,C</span><span class="se">\n</span><span class="s2">"</span>
<span class="gp">   ....: </span>    <span class="s2">"1,2.,4.</span><span class="se">\n</span><span class="s2">"</span>
<span class="gp">   ....: </span>    <span class="s2">"5.,NaN,10.0</span><span class="se">\n</span><span class="s2">"</span>
<span class="gp">   ....: </span><span class="p">)</span>
<span class="gp">   ....: </span>

<span class="gp">In [77]: </span><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="go"># empty</span>
<span class="go"># second empty line</span>
<span class="go"># third emptyline</span>
<span class="go">X,Y,Z</span>
<span class="go">1,2,3</span>
<span class="go">A,B,C</span>
<span class="go">1,2.,4.</span>
<span class="go">5.,NaN,10.0</span>


<span class="gp">In [78]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">comment</span><span class="o">=</span><span class="s2">"#"</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gh">Out[78]: </span>
<span class="go">     A    B     C</span>
<span class="go">0  1.0  2.0   4.0</span>
<span class="go">1  5.0  NaN  10.0</span>
</pre></div>
</div>
</section>
<section id="comments">
<span id="io-comments"></span><h4>注释<a class="headerlink" href="io.html#comments" title="Link to this heading">#</a></h4>
<p>有时文件可能包含注释或元数据。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [79]: </span><span class="n">data</span> <span class="o">=</span> <span class="p">(</span>
<span class="gp">   ....: </span>    <span class="s2">"ID,level,category</span><span class="se">\n</span><span class="s2">"</span>
<span class="gp">   ....: </span>    <span class="s2">"Patient1,123000,x # really unpleasant</span><span class="se">\n</span><span class="s2">"</span>
<span class="gp">   ....: </span>    <span class="s2">"Patient2,23000,y # wouldn't take his medicine</span><span class="se">\n</span><span class="s2">"</span>
<span class="gp">   ....: </span>    <span class="s2">"Patient3,1234018,z # awesome"</span>
<span class="gp">   ....: </span><span class="p">)</span>
<span class="gp">   ....: </span>

<span class="gp">In [80]: </span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"tmp.csv"</span><span class="p">,</span> <span class="s2">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
<span class="gp">   ....: </span>    <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="gp">   ....: </span>

<span class="gp">In [81]: </span><span class="nb">print</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s2">"tmp.csv"</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
<span class="go">ID,level,category</span>
<span class="go">Patient1,123000,x # really unpleasant</span>
<span class="go">Patient2,23000,y # wouldn't take his medicine</span>
<span class="go">Patient3,1234018,z # awesome</span>
</pre></div>
</div>
<p>默认情况下，解析器会在输出中包含注释。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [82]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"tmp.csv"</span><span class="p">)</span>

<span class="gp">In [83]: </span><span class="n">df</span>
<span class="gh">Out[83]: </span>
<span class="go">         ID    level                        category</span>
<span class="go">0  Patient1   123000           x # really unpleasant</span>
<span class="go">1  Patient2    23000  y # wouldn't take his medicine</span>
<span class="go">2  Patient3  1234018                     z # awesome</span>
</pre></div>
</div>
<p>我们可以使用 <code class="docutils literal notranslate"><span class="pre">comment</span></code> 关键字来抑制注释。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [84]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"tmp.csv"</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s2">"#"</span><span class="p">)</span>

<span class="gp">In [85]: </span><span class="n">df</span>
<span class="gh">Out[85]: </span>
<span class="go">         ID    level category</span>
<span class="go">0  Patient1   123000       x </span>
<span class="go">1  Patient2    23000       y </span>
<span class="go">2  Patient3  1234018       z </span>
</pre></div>
</div>
</section>
</section>
<section id="dealing-with-unicode-data">
<span id="io-unicode"></span><h3>处理 Unicode 数据<a class="headerlink" href="io.html#dealing-with-unicode-data" title="Link to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">encoding</span></code> 参数应用于编码的 unicode 数据，这将导致结果中的字节字符串被解码为 unicode。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [86]: </span><span class="kn">from</span><span class="w"> </span><span class="nn">io</span><span class="w"> </span><span class="kn">import</span> <span class="n">BytesIO</span>

<span class="gp">In [87]: </span><span class="n">data</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">"word,length</span><span class="se">\n</span><span class="s2">"</span> <span class="sa">b</span><span class="s2">"Tr</span><span class="se">\xc3\xa4</span><span class="s2">umen,7</span><span class="se">\n</span><span class="s2">"</span> <span class="sa">b</span><span class="s2">"Gr</span><span class="se">\xc3\xbc\xc3\x9f</span><span class="s2">e,5"</span>

<span class="gp">In [88]: </span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">"utf8"</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">"latin-1"</span><span class="p">)</span>

<span class="gp">In [89]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">"latin-1"</span><span class="p">)</span>

<span class="gp">In [90]: </span><span class="n">df</span>
<span class="gh">Out[90]: </span>
<span class="go">      word  length</span>
<span class="go">0  Träumen       7</span>
<span class="go">1    Grüße       5</span>

<span class="gp">In [91]: </span><span class="n">df</span><span class="p">[</span><span class="s2">"word"</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
<span class="gh">Out[91]: </span><span class="go">'Grüße'</span>
</pre></div>
</div>
<p>某些将所有字符编码为多字节的格式（例如 UTF-16），如果不指定编码，将完全无法正确解析。<a class="reference external" href="https://docs.pythonlang.cn/3/library/codecs.html#standard-encodings">Python 标准编码的完整列表</a>。</p>
</section>
<section id="index-columns-and-trailing-delimiters">
<span id="io-index-col"></span><h3>索引列和尾随分隔符<a class="headerlink" href="io.html#index-columns-and-trailing-delimiters" title="Link to this heading">#</a></h3>
<p>如果一个文件的数据列比列名多一列，则第一列将用作 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> 的行名称。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [92]: </span><span class="n">data</span> <span class="o">=</span> <span class="s2">"a,b,c</span><span class="se">\n</span><span class="s2">4,apple,bat,5.7</span><span class="se">\n</span><span class="s2">8,orange,cow,10"</span>

<span class="gp">In [93]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
<span class="gh">Out[93]: </span>
<span class="go">        a    b     c</span>
<span class="go">4   apple  bat   5.7</span>
<span class="go">8  orange  cow  10.0</span>
</pre></div>
</div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [94]: </span><span class="n">data</span> <span class="o">=</span> <span class="s2">"index,a,b,c</span><span class="se">\n</span><span class="s2">4,apple,bat,5.7</span><span class="se">\n</span><span class="s2">8,orange,cow,10"</span>

<span class="gp">In [95]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="gh">Out[95]: </span>
<span class="go">            a    b     c</span>
<span class="go">index                   </span>
<span class="go">4       apple  bat   5.7</span>
<span class="go">8      orange  cow  10.0</span>
</pre></div>
</div>
<p>通常，您可以使用 <code class="docutils literal notranslate"><span class="pre">index_col</span></code> 选项来实现此行为。</p>
<p>在某些例外情况下，文件可能在每行数据末尾都带有分隔符，这会混淆解析器。要显式禁用索引列推断并丢弃最后一列，请传入 <code class="docutils literal notranslate"><span class="pre">index_col=False</span></code>。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [96]: </span><span class="n">data</span> <span class="o">=</span> <span class="s2">"a,b,c</span><span class="se">\n</span><span class="s2">4,apple,bat,</span><span class="se">\n</span><span class="s2">8,orange,cow,"</span>

<span class="gp">In [97]: </span><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="go">a,b,c</span>
<span class="go">4,apple,bat,</span>
<span class="go">8,orange,cow,</span>

<span class="gp">In [98]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
<span class="gh">Out[98]: </span>
<span class="go">        a    b   c</span>
<span class="go">4   apple  bat NaN</span>
<span class="go">8  orange  cow NaN</span>

<span class="gp">In [99]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">index_col</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gh">Out[99]: </span>
<span class="go">   a       b    c</span>
<span class="go">0  4   apple  bat</span>
<span class="go">1  8  orange  cow</span>
</pre></div>
</div>
<p>如果使用 <code class="docutils literal notranslate"><span class="pre">usecols</span></code> 选项解析数据子集，则 <code class="docutils literal notranslate"><span class="pre">index_col</span></code> 规范将基于该子集，而不是原始数据。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [100]: </span><span class="n">data</span> <span class="o">=</span> <span class="s2">"a,b,c</span><span class="se">\n</span><span class="s2">4,apple,bat,</span><span class="se">\n</span><span class="s2">8,orange,cow,"</span>

<span class="gp">In [101]: </span><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="go">a,b,c</span>
<span class="go">4,apple,bat,</span>
<span class="go">8,orange,cow,</span>

<span class="gp">In [102]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="s2">"b"</span><span class="p">,</span> <span class="s2">"c"</span><span class="p">])</span>
<span class="gh">Out[102]: </span>
<span class="go">     b   c</span>
<span class="go">4  bat NaN</span>
<span class="go">8  cow NaN</span>

<span class="gp">In [103]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="s2">"b"</span><span class="p">,</span> <span class="s2">"c"</span><span class="p">],</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="gh">Out[103]: </span>
<span class="go">     b   c</span>
<span class="go">4  bat NaN</span>
<span class="go">8  cow NaN</span>
</pre></div>
</div>
</section>
<section id="date-handling">
<span id="io-parse-dates"></span><h3>日期处理<a class="headerlink" href="io.html#date-handling" title="Link to this heading">#</a></h3>
<section id="specifying-date-columns">
<h4>指定日期列<a class="headerlink" href="io.html#specifying-date-columns" title="Link to this heading">#</a></h4>
<p>为了更好地处理日期时间数据，<a class="reference internal" href="../reference/api/pandas.read_csv.html#pandas.read_csv" title="pandas.read_csv"><code class="xref py py-func docutils literal notranslate"><span class="pre">read_csv()</span></code></a> 使用关键字参数 <code class="docutils literal notranslate"><span class="pre">parse_dates</span></code> 和 <code class="docutils literal notranslate"><span class="pre">date_format</span></code>，允许用户指定各种列和日期/时间格式，将输入文本数据转换为 <code class="docutils literal notranslate"><span class="pre">datetime</span></code> 对象。</p>
<p>最简单的情况是只传入 <code class="docutils literal notranslate"><span class="pre">parse_dates=True</span></code>。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [104]: </span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"foo.csv"</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="gp">   .....: </span>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">"date,A,B,C</span><span class="se">\n</span><span class="s2">20090101,a,1,2</span><span class="se">\n</span><span class="s2">20090102,b,3,4</span><span class="se">\n</span><span class="s2">20090103,c,4,5"</span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="go"># Use a column as an index, and parse it as dates.</span>
<span class="gp">In [105]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"foo.csv"</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="gp">In [106]: </span><span class="n">df</span>
<span class="gh">Out[106]: </span>
<span class="go">            A  B  C</span>
<span class="go">date               </span>
<span class="go">2009-01-01  a  1  2</span>
<span class="go">2009-01-02  b  3  4</span>
<span class="go">2009-01-03  c  4  5</span>

<span class="go"># These are Python datetime objects</span>
<span class="gp">In [107]: </span><span class="n">df</span><span class="o">.</span><span class="n">index</span>
<span class="gh">Out[107]: </span><span class="go">DatetimeIndex(['2009-01-01', '2009-01-02', '2009-01-03'], dtype='datetime64[ns]', name='date', freq=None)</span>
</pre></div>
</div>
<p>通常，我们可能希望将日期和时间数据分开存储，或将各种日期字段分开存储。 <code class="docutils literal notranslate"><span class="pre">parse_dates</span></code> 关键字可用于指定列组合，以从中解析日期和/或时间。</p>
<p>您可以将列列表的列表指定给 <code class="docutils literal notranslate"><span class="pre">parse_dates</span></code>，生成的日期列将前置到输出（以不影响现有列顺序），新列名将是组成列名的串联。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [108]: </span><span class="n">data</span> <span class="o">=</span> <span class="p">(</span>
<span class="gp">   .....: </span>    <span class="s2">"KORD,19990127, 19:00:00, 18:56:00, 0.8100</span><span class="se">\n</span><span class="s2">"</span>
<span class="gp">   .....: </span>    <span class="s2">"KORD,19990127, 20:00:00, 19:56:00, 0.0100</span><span class="se">\n</span><span class="s2">"</span>
<span class="gp">   .....: </span>    <span class="s2">"KORD,19990127, 21:00:00, 20:56:00, -0.5900</span><span class="se">\n</span><span class="s2">"</span>
<span class="gp">   .....: </span>    <span class="s2">"KORD,19990127, 21:00:00, 21:18:00, -0.9900</span><span class="se">\n</span><span class="s2">"</span>
<span class="gp">   .....: </span>    <span class="s2">"KORD,19990127, 22:00:00, 21:56:00, -0.5900</span><span class="se">\n</span><span class="s2">"</span>
<span class="gp">   .....: </span>    <span class="s2">"KORD,19990127, 23:00:00, 22:56:00, -0.5900"</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [109]: </span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"tmp.csv"</span><span class="p">,</span> <span class="s2">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
<span class="gp">   .....: </span>    <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [110]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"tmp.csv"</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]])</span>

<span class="gp">In [111]: </span><span class="n">df</span>
<span class="gh">Out[111]: </span>
<span class="go">                  1_2                 1_3     0     4</span>
<span class="go">0 1999-01-27 19:00:00 1999-01-27 18:56:00  KORD  0.81</span>
<span class="go">1 1999-01-27 20:00:00 1999-01-27 19:56:00  KORD  0.01</span>
<span class="go">2 1999-01-27 21:00:00 1999-01-27 20:56:00  KORD -0.59</span>
<span class="go">3 1999-01-27 21:00:00 1999-01-27 21:18:00  KORD -0.99</span>
<span class="go">4 1999-01-27 22:00:00 1999-01-27 21:56:00  KORD -0.59</span>
<span class="go">5 1999-01-27 23:00:00 1999-01-27 22:56:00  KORD -0.59</span>
</pre></div>
</div>
<p>默认情况下，解析器会删除组成日期列，但您可以通过 <code class="docutils literal notranslate"><span class="pre">keep_date_col</span></code> 关键字选择保留它们。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [112]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="s2">"tmp.csv"</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]],</span> <span class="n">keep_date_col</span><span class="o">=</span><span class="kc">True</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [113]: </span><span class="n">df</span>
<span class="gh">Out[113]: </span>
<span class="go">                  1_2                 1_3     0  ...          2          3     4</span>
<span class="go">0 1999-01-27 19:00:00 1999-01-27 18:56:00  KORD  ...   19:00:00   18:56:00  0.81</span>
<span class="go">1 1999-01-27 20:00:00 1999-01-27 19:56:00  KORD  ...   20:00:00   19:56:00  0.01</span>
<span class="go">2 1999-01-27 21:00:00 1999-01-27 20:56:00  KORD  ...   21:00:00   20:56:00 -0.59</span>
<span class="go">3 1999-01-27 21:00:00 1999-01-27 21:18:00  KORD  ...   21:00:00   21:18:00 -0.99</span>
<span class="go">4 1999-01-27 22:00:00 1999-01-27 21:56:00  KORD  ...   22:00:00   21:56:00 -0.59</span>
<span class="go">5 1999-01-27 23:00:00 1999-01-27 22:56:00  KORD  ...   23:00:00   22:56:00 -0.59</span>

<span class="go">[6 rows x 7 columns]</span>
</pre></div>
</div>
<p>请注意，如果您希望将多个列组合成单个日期列，则必须使用嵌套列表。换句话说，<code class="docutils literal notranslate"><span class="pre">parse_dates=[1,</span> <span class="pre">2]</span></code> 表示第二列和第三列应分别解析为单独的日期列，而 <code class="docutils literal notranslate"><span class="pre">parse_dates=[[1,</span> <span class="pre">2]]</span></code> 表示这两列应解析为单个列。</p>
<p>您还可以使用字典来指定自定义名称列。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [114]: </span><span class="n">date_spec</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"nominal"</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="s2">"actual"</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]}</span>

<span class="gp">In [115]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"tmp.csv"</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="n">date_spec</span><span class="p">)</span>

<span class="gp">In [116]: </span><span class="n">df</span>
<span class="gh">Out[116]: </span>
<span class="go">              nominal              actual     0     4</span>
<span class="go">0 1999-01-27 19:00:00 1999-01-27 18:56:00  KORD  0.81</span>
<span class="go">1 1999-01-27 20:00:00 1999-01-27 19:56:00  KORD  0.01</span>
<span class="go">2 1999-01-27 21:00:00 1999-01-27 20:56:00  KORD -0.59</span>
<span class="go">3 1999-01-27 21:00:00 1999-01-27 21:18:00  KORD -0.99</span>
<span class="go">4 1999-01-27 22:00:00 1999-01-27 21:56:00  KORD -0.59</span>
<span class="go">5 1999-01-27 23:00:00 1999-01-27 22:56:00  KORD -0.59</span>
</pre></div>
</div>
<p>重要的是要记住，如果多个文本列要解析为单个日期列，则会在数据前添加一个新列。<code class="docutils literal notranslate"><span class="pre">index_col</span></code> 规范基于这组新列，而不是原始数据列。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [117]: </span><span class="n">date_spec</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"nominal"</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="s2">"actual"</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]}</span>

<span class="gp">In [118]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="s2">"tmp.csv"</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="n">date_spec</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span>
<span class="gp">   .....: </span><span class="p">)</span>  <span class="c1"># index is the nominal column</span>
<span class="gp">   .....: </span>

<span class="gp">In [119]: </span><span class="n">df</span>
<span class="gh">Out[119]: </span>
<span class="go">                                 actual     0     4</span>
<span class="go">nominal                                            </span>
<span class="go">1999-01-27 19:00:00 1999-01-27 18:56:00  KORD  0.81</span>
<span class="go">1999-01-27 20:00:00 1999-01-27 19:56:00  KORD  0.01</span>
<span class="go">1999-01-27 21:00:00 1999-01-27 20:56:00  KORD -0.59</span>
<span class="go">1999-01-27 21:00:00 1999-01-27 21:18:00  KORD -0.99</span>
<span class="go">1999-01-27 22:00:00 1999-01-27 21:56:00  KORD -0.59</span>
<span class="go">1999-01-27 23:00:00 1999-01-27 22:56:00  KORD -0.59</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p>如果列或索引包含无法解析的日期，则整个列或索引将以对象数据类型原样返回。对于非标准日期时间解析，请在 <code class="docutils literal notranslate"><span class="pre">pd.read_csv</span></code> 之后使用 <a class="reference internal" href="../reference/api/pandas.to_datetime.html#pandas.to_datetime" title="pandas.to_datetime"><code class="xref py py-func docutils literal notranslate"><span class="pre">to_datetime()</span></code></a>。</p>
</div>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p>read_csv 具有用于解析 iso8601 格式日期时间字符串的快速路径，例如 “2000-01-01T00:01:02+00:00” 和类似变体。如果能将数据存储为这种日期时间格式，加载时间将显著加快，已观察到大约 20 倍的提速。</p>
</div>
<div class="deprecated">
<p><span class="versionmodified deprecated">自 2.2.0 版弃用: </span>在 read_csv 内部组合日期列已被弃用。请改用 <code class="docutils literal notranslate"><span class="pre">pd.to_datetime</span></code> 处理相关的结果列。</p>
</div>
</section>
<section id="date-parsing-functions">
<h4>日期解析函数<a class="headerlink" href="io.html#date-parsing-functions" title="Link to this heading">#</a></h4>
<p>最后，解析器允许您指定自定义的 <code class="docutils literal notranslate"><span class="pre">date_format</span></code>。从性能角度考虑，您应该按顺序尝试这些日期解析方法：</p>
<ol class="arabic simple">
<li><p>如果您知道格式，请使用 <code class="docutils literal notranslate"><span class="pre">date_format</span></code>，例如：<code class="docutils literal notranslate"><span class="pre">date_format="%d/%m/%Y"</span></code> 或 <code class="docutils literal notranslate"><span class="pre">date_format={column_name:</span> <span class="pre">"%d/%m/%Y"}</span></code>。</p></li>
<li><p>如果您不同列有不同的格式，或者想要将任何额外选项（例如 <code class="docutils literal notranslate"><span class="pre">utc</span></code>）传递给 <code class="docutils literal notranslate"><span class="pre">to_datetime</span></code>，那么您应该将数据读取为 <code class="docutils literal notranslate"><span class="pre">object</span></code> dtype，然后使用 <code class="docutils literal notranslate"><span class="pre">to_datetime</span></code>。</p></li>
</ol>
</section>
<section id="parsing-a-csv-with-mixed-timezones">
<span id="io-csv-mixed-timezones"></span><h4>解析包含混合时区的 CSV<a class="headerlink" href="io.html#parsing-a-csv-with-mixed-timezones" title="Link to this heading">#</a></h4>
<p>pandas 无法原生表示包含混合时区的列或索引。如果您的 CSV 文件包含混合时区的列，即使使用 <code class="docutils literal notranslate"><span class="pre">parse_dates</span></code>，默认结果也将是一个包含字符串的对象-dtype 列。要将混合时区值解析为日期时间列，请以 <code class="docutils literal notranslate"><span class="pre">object</span></code> dtype 读取，然后使用 <code class="docutils literal notranslate"><span class="pre">utc=True</span></code> 调用 <a class="reference internal" href="../reference/api/pandas.to_datetime.html#pandas.to_datetime" title="pandas.to_datetime"><code class="xref py py-func docutils literal notranslate"><span class="pre">to_datetime()</span></code></a>。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [120]: </span><span class="n">content</span> <span class="o">=</span> <span class="s2">"""</span><span class="se">\</span>
<span class="gp">   .....: </span><span class="s2">a</span>
<span class="gp">   .....: </span><span class="s2">2000-01-01T00:00:00+05:00</span>
<span class="gp">   .....: </span><span class="s2">2000-01-01T00:00:00+06:00"""</span>
<span class="gp">   .....: </span>

<span class="gp">In [121]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">content</span><span class="p">))</span>

<span class="gp">In [122]: </span><span class="n">df</span><span class="p">[</span><span class="s2">"a"</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">"a"</span><span class="p">],</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="gp">In [123]: </span><span class="n">df</span><span class="p">[</span><span class="s2">"a"</span><span class="p">]</span>
<span class="gh">Out[123]: </span>
<span class="go">0   1999-12-31 19:00:00+00:00</span>
<span class="go">1   1999-12-31 18:00:00+00:00</span>
<span class="go">Name: a, dtype: datetime64[ns, UTC]</span>
</pre></div>
</div>
</section>
<section id="inferring-datetime-format">
<span id="io-dayfirst"></span><h4>推断日期时间格式<a class="headerlink" href="io.html#inferring-datetime-format" title="Link to this heading">#</a></h4>
<p>以下是一些可以推断的日期时间字符串示例（所有这些都表示 2011 年 12 月 30 日 00:00:00）：</p>
<ul class="simple">
<li><p>“20111230”</p></li>
<li><p>“2011/12/30”</p></li>
<li><p>“20111230 00:00:00”</p></li>
<li><p>“12/30/2011 00:00:00”</p></li>
<li><p>“30/Dec/2011 00:00:00”</p></li>
<li><p>“30/December/2011 00:00:00”</p></li>
</ul>
<p>请注意，格式推断对 <code class="docutils literal notranslate"><span class="pre">dayfirst</span></code> 很敏感。当 <code class="docutils literal notranslate"><span class="pre">dayfirst=True</span></code> 时，它将猜测“01/12/2011”为 12 月 1 日。当 <code class="docutils literal notranslate"><span class="pre">dayfirst=False</span></code>（默认）时，它将猜测“01/12/2011”为 1 月 12 日。</p>
<p>如果您尝试解析日期字符串列，pandas 将尝试从第一个非 NaN 元素中猜测格式，然后用该格式解析列的其余部分。如果 pandas 未能猜测格式（例如，如果您的第一个字符串是 <code class="docutils literal notranslate"><span class="pre">'01</span> <span class="pre">December</span> <span class="pre">US/Pacific</span> <span class="pre">2000'</span></code>），则会引发警告，并且每行将由 <code class="docutils literal notranslate"><span class="pre">dateutil.parser.parse</span></code> 单独解析。解析日期最安全的方法是显式设置 <code class="docutils literal notranslate"><span class="pre">format=</span></code>。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [124]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="s2">"foo.csv"</span><span class="p">,</span>
<span class="gp">   .....: </span>    <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<span class="gp">   .....: </span>    <span class="n">parse_dates</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [125]: </span><span class="n">df</span>
<span class="gh">Out[125]: </span>
<span class="go">            A  B  C</span>
<span class="go">date               </span>
<span class="go">2009-01-01  a  1  2</span>
<span class="go">2009-01-02  b  3  4</span>
<span class="go">2009-01-03  c  4  5</span>
</pre></div>
</div>
<p>如果您在同一列中混合了日期时间格式，您可以传入 <code class="docutils literal notranslate"><span class="pre">format='mixed'</span></code>。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [126]: </span><span class="n">data</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">(</span><span class="s2">"date</span><span class="se">\n</span><span class="s2">12 Jan 2000</span><span class="se">\n</span><span class="s2">2000-01-13</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>

<span class="gp">In [127]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="gp">In [128]: </span><span class="n">df</span><span class="p">[</span><span class="s1">'date'</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">'date'</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s1">'mixed'</span><span class="p">)</span>

<span class="gp">In [129]: </span><span class="n">df</span>
<span class="gh">Out[129]: </span>
<span class="go">        date</span>
<span class="go">0 2000-01-12</span>
<span class="go">1 2000-01-13</span>
</pre></div>
</div>
<p>或者，如果您的日期时间格式都是 ISO8601（可能格式不完全相同）：</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [130]: </span><span class="n">data</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">(</span><span class="s2">"date</span><span class="se">\n</span><span class="s2">2020-01-01</span><span class="se">\n</span><span class="s2">2020-01-01 03:00</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>

<span class="gp">In [131]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="gp">In [132]: </span><span class="n">df</span><span class="p">[</span><span class="s1">'date'</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">'date'</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s1">'ISO8601'</span><span class="p">)</span>

<span class="gp">In [133]: </span><span class="n">df</span>
<span class="gh">Out[133]: </span>
<span class="go">                 date</span>
<span class="go">0 2020-01-01 00:00:00</span>
<span class="go">1 2020-01-01 03:00:00</span>
</pre></div>
</div>
</section>
<section id="international-date-formats">
<h4>国际日期格式<a class="headerlink" href="io.html#international-date-formats" title="Link to this heading">#</a></h4>
<p>尽管美国日期格式通常是 MM/DD/YYYY，但许多国际格式使用 DD/MM/YYYY。为了方便起见，提供了 <code class="docutils literal notranslate"><span class="pre">dayfirst</span></code> 关键字。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [134]: </span><span class="n">data</span> <span class="o">=</span> <span class="s2">"date,value,cat</span><span class="se">\n</span><span class="s2">1/6/2000,5,a</span><span class="se">\n</span><span class="s2">2/6/2000,10,b</span><span class="se">\n</span><span class="s2">3/6/2000,15,c"</span>

<span class="gp">In [135]: </span><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="go">date,value,cat</span>
<span class="go">1/6/2000,5,a</span>
<span class="go">2/6/2000,10,b</span>
<span class="go">3/6/2000,15,c</span>

<span class="gp">In [136]: </span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"tmp.csv"</span><span class="p">,</span> <span class="s2">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
<span class="gp">   .....: </span>    <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [137]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"tmp.csv"</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="gh">Out[137]: </span>
<span class="go">        date  value cat</span>
<span class="go">0 2000-01-06      5   a</span>
<span class="go">1 2000-02-06     10   b</span>
<span class="go">2 2000-03-06     15   c</span>

<span class="gp">In [138]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"tmp.csv"</span><span class="p">,</span> <span class="n">dayfirst</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="gh">Out[138]: </span>
<span class="go">        date  value cat</span>
<span class="go">0 2000-06-01      5   a</span>
<span class="go">1 2000-06-02     10   b</span>
<span class="go">2 2000-06-03     15   c</span>
</pre></div>
</div>
</section>
<section id="writing-csvs-to-binary-file-objects">
<h4>将 CSV 写入二进制文件对象<a class="headerlink" href="io.html#writing-csvs-to-binary-file-objects" title="Link to this heading">#</a></h4>
<div class="versionadded">
<p><span class="versionmodified added">1.2.0 版新增。</span></p>
</div>
<p><code class="docutils literal notranslate"><span class="pre">df.to_csv(...,</span> <span class="pre">mode="wb")</span></code> 允许将 CSV 写入以二进制模式打开的文件对象。在大多数情况下，无需指定 <code class="docutils literal notranslate"><span class="pre">mode</span></code>，因为 Pandas 会自动检测文件对象是以文本模式还是二进制模式打开。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [139]: </span><span class="kn">import</span><span class="w"> </span><span class="nn">io</span>

<span class="gp">In [140]: </span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>

<span class="gp">In [141]: </span><span class="n">buffer</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>

<span class="gp">In [142]: </span><span class="n">data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">"utf-8"</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="s2">"gzip"</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="specifying-method-for-floating-point-conversion">
<span id="io-float-precision"></span><h3>指定浮点转换方法<a class="headerlink" href="io.html#specifying-method-for-floating-point-conversion" title="Link to this heading">#</a></h3>
<p>可以指定参数 <code class="docutils literal notranslate"><span class="pre">float_precision</span></code>，以便在用 C 引擎解析时使用特定的浮点转换器。选项包括普通转换器的 <code class="docutils literal notranslate"><span class="pre">None</span></code>、高精度转换器的 <code class="docutils literal notranslate"><span class="pre">high</span></code> 和往返转换器（保证在写入文件后往返值）。例如：</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [143]: </span><span class="n">val</span> <span class="o">=</span> <span class="s2">"0.3066101993807095471566981359501369297504425048828125"</span>

<span class="gp">In [144]: </span><span class="n">data</span> <span class="o">=</span> <span class="s2">"a,b,c</span><span class="se">\n</span><span class="s2">1,2,</span><span class="si">{0}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

<span class="gp">In [145]: </span><span class="nb">abs</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
<span class="gp">   .....: </span>        <span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">),</span>
<span class="gp">   .....: </span>        <span class="n">engine</span><span class="o">=</span><span class="s2">"c"</span><span class="p">,</span>
<span class="gp">   .....: </span>        <span class="n">float_precision</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="gp">   .....: </span>    <span class="p">)[</span><span class="s2">"c"</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>
<span class="gh">Out[145]: </span><span class="go">5.551115123125783e-17</span>

<span class="gp">In [146]: </span><span class="nb">abs</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
<span class="gp">   .....: </span>        <span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">),</span>
<span class="gp">   .....: </span>        <span class="n">engine</span><span class="o">=</span><span class="s2">"c"</span><span class="p">,</span>
<span class="gp">   .....: </span>        <span class="n">float_precision</span><span class="o">=</span><span class="s2">"high"</span><span class="p">,</span>
<span class="gp">   .....: </span>    <span class="p">)[</span><span class="s2">"c"</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>
<span class="gh">Out[146]: </span><span class="go">5.551115123125783e-17</span>

<span class="gp">In [147]: </span><span class="nb">abs</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">engine</span><span class="o">=</span><span class="s2">"c"</span><span class="p">,</span> <span class="n">float_precision</span><span class="o">=</span><span class="s2">"round_trip"</span><span class="p">)[</span><span class="s2">"c"</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">   .....: </span>    <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>
<span class="gh">Out[147]: </span><span class="go">0.0</span>
</pre></div>
</div>
</section>
<section id="thousand-separators">
<span id="io-thousands"></span><h3>千位分隔符<a class="headerlink" href="io.html#thousand-separators" title="Link to this heading">#</a></h3>
<p>对于用千位分隔符写入的大数字，可以将 <code class="docutils literal notranslate"><span class="pre">thousands</span></code> 关键字设置为长度为 1 的字符串，以便正确解析整数。</p>
<p>默认情况下，带有千位分隔符的数字将被解析为字符串。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [148]: </span><span class="n">data</span> <span class="o">=</span> <span class="p">(</span>
<span class="gp">   .....: </span>    <span class="s2">"ID|level|category</span><span class="se">\n</span><span class="s2">"</span>
<span class="gp">   .....: </span>    <span class="s2">"Patient1|123,000|x</span><span class="se">\n</span><span class="s2">"</span>
<span class="gp">   .....: </span>    <span class="s2">"Patient2|23,000|y</span><span class="se">\n</span><span class="s2">"</span>
<span class="gp">   .....: </span>    <span class="s2">"Patient3|1,234,018|z"</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [149]: </span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"tmp.csv"</span><span class="p">,</span> <span class="s2">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
<span class="gp">   .....: </span>    <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [150]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"tmp.csv"</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">"|"</span><span class="p">)</span>

<span class="gp">In [151]: </span><span class="n">df</span>
<span class="gh">Out[151]: </span>
<span class="go">         ID      level category</span>
<span class="go">0  Patient1    123,000        x</span>
<span class="go">1  Patient2     23,000        y</span>
<span class="go">2  Patient3  1,234,018        z</span>

<span class="gp">In [152]: </span><span class="n">df</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">dtype</span>
<span class="gh">Out[152]: </span><span class="go">dtype('O')</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">thousands</span></code> 关键字允许正确解析整数。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [153]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"tmp.csv"</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">"|"</span><span class="p">,</span> <span class="n">thousands</span><span class="o">=</span><span class="s2">","</span><span class="p">)</span>

<span class="gp">In [154]: </span><span class="n">df</span>
<span class="gh">Out[154]: </span>
<span class="go">         ID    level category</span>
<span class="go">0  Patient1   123000        x</span>
<span class="go">1  Patient2    23000        y</span>
<span class="go">2  Patient3  1234018        z</span>

<span class="gp">In [155]: </span><span class="n">df</span><span class="o">.</span><span class="n">level</span><span class="o">.</span><span class="n">dtype</span>
<span class="gh">Out[155]: </span><span class="go">dtype('int64')</span>
</pre></div>
</div>
</section>
<section id="na-values">
<span id="io-na-values"></span><h3>NA 值<a class="headerlink" href="io.html#na-values" title="Link to this heading">#</a></h3>
<p>要控制哪些值被解析为缺失值（由 <code class="docutils literal notranslate"><span class="pre">NaN</span></code> 表示），请在 <code class="docutils literal notranslate"><span class="pre">na_values</span></code> 中指定一个字符串。如果您指定一个字符串列表，则其中的所有值都被视为缺失值。如果您指定一个数字（一个 <code class="docutils literal notranslate"><span class="pre">float</span></code>，例如 <code class="docutils literal notranslate"><span class="pre">5.0</span></code>，或者一个 <code class="docutils literal notranslate"><span class="pre">integer</span></code>，例如 <code class="docutils literal notranslate"><span class="pre">5</span></code>），则相应的等效值也将表示一个缺失值（在这种情况下，<code class="docutils literal notranslate"><span class="pre">[5.0,</span> <span class="pre">5]</span></code> 实际上都被识别为 <code class="docutils literal notranslate"><span class="pre">NaN</span></code>）。</p>
<p>要完全覆盖被识别为缺失值的默认值，请指定 <code class="docutils literal notranslate"><span class="pre">keep_default_na=False</span></code>。</p>
<p id="io-navaluesconst">默认识别的 <code class="docutils literal notranslate"><span class="pre">NaN</span></code> 值包括 <code class="docutils literal notranslate"><span class="pre">['-1.#IND',</span> <span class="pre">'1.#QNAN',</span> <span class="pre">'1.#IND',</span> <span class="pre">'-1.#QNAN',</span> <span class="pre">'#N/A</span> <span class="pre">N/A',</span> <span class="pre">'#N/A',</span> <span class="pre">'N/A',</span> <span class="pre">'n/a',</span> <span class="pre">'NA',</span> <span class="pre">'&lt;NA&gt;',</span> <span class="pre">'#NA',</span> <span class="pre">'NULL',</span> <span class="pre">'null',</span> <span class="pre">'NaN',</span> <span class="pre">'-NaN',</span> <span class="pre">'nan',</span> <span class="pre">'-nan',</span> <span class="pre">'None',</span> <span class="pre">'']</span></code>。</p>
<p>让我们看一些例子。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"path_to_file.csv"</span><span class="p">,</span> <span class="n">na_values</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
</pre></div>
</div>
<p>在上述示例中，<code class="docutils literal notranslate"><span class="pre">5</span></code> 和 <code class="docutils literal notranslate"><span class="pre">5.0</span></code> 除了默认值外，也将被识别为 <code class="docutils literal notranslate"><span class="pre">NaN</span></code>。字符串将首先被解释为数字 <code class="docutils literal notranslate"><span class="pre">5</span></code>，然后被解释为 <code class="docutils literal notranslate"><span class="pre">NaN</span></code>。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"path_to_file.csv"</span><span class="p">,</span> <span class="n">keep_default_na</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">na_values</span><span class="o">=</span><span class="p">[</span><span class="s2">""</span><span class="p">])</span>
</pre></div>
</div>
<p>上述示例中，只有空字段会被识别为 <code class="docutils literal notranslate"><span class="pre">NaN</span></code>。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"path_to_file.csv"</span><span class="p">,</span> <span class="n">keep_default_na</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">na_values</span><span class="o">=</span><span class="p">[</span><span class="s2">"NA"</span><span class="p">,</span> <span class="s2">"0"</span><span class="p">])</span>
</pre></div>
</div>
<p>上述示例中，字符串 <code class="docutils literal notranslate"><span class="pre">NA</span></code> 和 <code class="docutils literal notranslate"><span class="pre">0</span></code> 都为 <code class="docutils literal notranslate"><span class="pre">NaN</span></code>。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"path_to_file.csv"</span><span class="p">,</span> <span class="n">na_values</span><span class="o">=</span><span class="p">[</span><span class="s2">"Nope"</span><span class="p">])</span>
</pre></div>
</div>
<p>默认值以及字符串 <code class="docutils literal notranslate"><span class="pre">"Nope"</span></code> 都被识别为 <code class="docutils literal notranslate"><span class="pre">NaN</span></code>。</p>
</section>
<section id="infinity">
<span id="io-infinity"></span><h3>无穷大<a class="headerlink" href="io.html#infinity" title="Link to this heading">#</a></h3>
<p>类似 <code class="docutils literal notranslate"><span class="pre">inf</span></code> 的值将被解析为 <code class="docutils literal notranslate"><span class="pre">np.inf</span></code>（正无穷大），而 <code class="docutils literal notranslate"><span class="pre">-inf</span></code> 将被解析为 <code class="docutils literal notranslate"><span class="pre">-np.inf</span></code>（负无穷大）。这些解析会忽略值的大小写，这意味着 <code class="docutils literal notranslate"><span class="pre">Inf</span></code> 也将被解析为 <code class="docutils literal notranslate"><span class="pre">np.inf</span></code>。</p>
</section>
<section id="boolean-values">
<span id="io-boolean"></span><h3>布尔值<a class="headerlink" href="io.html#boolean-values" title="Link to this heading">#</a></h3>
<p>常见的 <code class="docutils literal notranslate"><span class="pre">True</span></code>, <code class="docutils literal notranslate"><span class="pre">False</span></code>, <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> 和 <code class="docutils literal notranslate"><span class="pre">FALSE</span></code> 值都被识别为布尔值。偶尔您可能希望将其他值识别为布尔值。为此，请按以下方式使用 <code class="docutils literal notranslate"><span class="pre">true_values</span></code> 和 <code class="docutils literal notranslate"><span class="pre">false_values</span></code> 选项。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [156]: </span><span class="n">data</span> <span class="o">=</span> <span class="s2">"a,b,c</span><span class="se">\n</span><span class="s2">1,Yes,2</span><span class="se">\n</span><span class="s2">3,No,4"</span>

<span class="gp">In [157]: </span><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="go">a,b,c</span>
<span class="go">1,Yes,2</span>
<span class="go">3,No,4</span>

<span class="gp">In [158]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
<span class="gh">Out[158]: </span>
<span class="go">   a    b  c</span>
<span class="go">0  1  Yes  2</span>
<span class="go">1  3   No  4</span>

<span class="gp">In [159]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">true_values</span><span class="o">=</span><span class="p">[</span><span class="s2">"Yes"</span><span class="p">],</span> <span class="n">false_values</span><span class="o">=</span><span class="p">[</span><span class="s2">"No"</span><span class="p">])</span>
<span class="gh">Out[159]: </span>
<span class="go">   a      b  c</span>
<span class="go">0  1   True  2</span>
<span class="go">1  3  False  4</span>
</pre></div>
</div>
</section>
<section id="handling-bad-lines">
<span id="io-bad-lines"></span><h3>处理“坏”行<a class="headerlink" href="io.html#handling-bad-lines" title="Link to this heading">#</a></h3>
<p>某些文件可能包含格式错误的行，字段过少或过多。字段过少的行将在尾随字段中填充 NA 值。默认情况下，字段过多的行会引发错误。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [160]: </span><span class="n">data</span> <span class="o">=</span> <span class="s2">"a,b,c</span><span class="se">\n</span><span class="s2">1,2,3</span><span class="se">\n</span><span class="s2">4,5,6,7</span><span class="se">\n</span><span class="s2">8,9,10"</span>

<span class="gp">In [161]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ParserError</span><span class="g g-Whitespace">                               </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">161</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>

<span class="nn">File ~/work/pandas/pandas/pandas/io/parsers/readers.py:1026,</span> in <span class="ni">read_csv</span><span class="nt">(filepath_or_buffer, sep, delimiter, header, names, index_col, usecols, dtype, engine, converters, true_values, false_values, skipinitialspace, skiprows, skipfooter, nrows, na_values, keep_default_na, na_filter, verbose, skip_blank_lines, parse_dates, infer_datetime_format, keep_date_col, date_parser, date_format, dayfirst, cache_dates, iterator, chunksize, compression, thousands, decimal, lineterminator, quotechar, quoting, doublequote, escapechar, comment, encoding, encoding_errors, dialect, on_bad_lines, delim_whitespace, low_memory, memory_map, float_precision, storage_options, dtype_backend)</span>
<span class="g g-Whitespace">   </span><span class="mi">1013</span> <span class="n">kwds_defaults</span> <span class="o">=</span> <span class="n">_refine_defaults_read</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1014</span>     <span class="n">dialect</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1015</span>     <span class="n">delimiter</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1022</span>     <span class="n">dtype_backend</span><span class="o">=</span><span class="n">dtype_backend</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1023</span> <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1024</span> <span class="n">kwds</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwds_defaults</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">1026</span> <span class="k">return</span> <span class="n">_read</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>

<span class="nn">File ~/work/pandas/pandas/pandas/io/parsers/readers.py:626,</span> in <span class="ni">_read</span><span class="nt">(filepath_or_buffer, kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">623</span>     <span class="k">return</span> <span class="n">parser</span>
<span class="g g-Whitespace">    </span><span class="mi">625</span> <span class="k">with</span> <span class="n">parser</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">626</span>     <span class="k">return</span> <span class="n">parser</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">nrows</span><span class="p">)</span>

<span class="nn">File ~/work/pandas/pandas/pandas/io/parsers/readers.py:1923,</span> in <span class="ni">TextFileReader.read</span><span class="nt">(self, nrows)</span>
<span class="g g-Whitespace">   </span><span class="mi">1916</span> <span class="n">nrows</span> <span class="o">=</span> <span class="n">validate_integer</span><span class="p">(</span><span class="s2">"nrows"</span><span class="p">,</span> <span class="n">nrows</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1917</span> <span class="k">try</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1918</span>     <span class="c1"># error: "ParserBase" has no attribute "read"</span>
<span class="g g-Whitespace">   </span><span class="mi">1919</span>     <span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1920</span>         <span class="n">index</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1921</span>         <span class="n">columns</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1922</span>         <span class="n">col_dict</span><span class="p">,</span>
<span class="ne">-&gt; </span><span class="mi">1923</span>     <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">read</span><span class="p">(</span>  <span class="c1"># type: ignore[attr-defined]</span>
<span class="g g-Whitespace">   </span><span class="mi">1924</span>         <span class="n">nrows</span>
<span class="g g-Whitespace">   </span><span class="mi">1925</span>     <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1926</span> <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1927</span>     <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="nn">File ~/work/pandas/pandas/pandas/io/parsers/c_parser_wrapper.py:234,</span> in <span class="ni">CParserWrapper.read</span><span class="nt">(self, nrows)</span>
<span class="g g-Whitespace">    </span><span class="mi">232</span> <span class="k">try</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">233</span>     <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">low_memory</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">234</span>         <span class="n">chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="o">.</span><span class="n">read_low_memory</span><span class="p">(</span><span class="n">nrows</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">235</span>         <span class="c1"># destructive to chunks</span>
<span class="g g-Whitespace">    </span><span class="mi">236</span>         <span class="n">data</span> <span class="o">=</span> <span class="n">_concatenate_chunks</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span>

<span class="nn">File ~/work/pandas/pandas/pandas/_libs/parsers.pyx:838,</span> in <span class="ni">pandas._libs.parsers.TextReader.read_low_memory</span><span class="nt">()</span>

<span class="nn">File ~/work/pandas/pandas/pandas/_libs/parsers.pyx:905,</span> in <span class="ni">pandas._libs.parsers.TextReader._read_rows</span><span class="nt">()</span>

<span class="nn">File ~/work/pandas/pandas/pandas/_libs/parsers.pyx:874,</span> in <span class="ni">pandas._libs.parsers.TextReader._tokenize_rows</span><span class="nt">()</span>

<span class="nn">File ~/work/pandas/pandas/pandas/_libs/parsers.pyx:891,</span> in <span class="ni">pandas._libs.parsers.TextReader._check_tokenize_status</span><span class="nt">()</span>

<span class="nn">File ~/work/pandas/pandas/pandas/_libs/parsers.pyx:2061,</span> in <span class="ni">pandas._libs.parsers.raise_parser_error</span><span class="nt">()</span>

<span class="ne">ParserError</span>: Error tokenizing data. C error: Expected 3 fields in line 3, saw 4
</pre></div>
</div>
<p>您可以选择跳过坏行。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [162]: </span><span class="n">data</span> <span class="o">=</span> <span class="s2">"a,b,c</span><span class="se">\n</span><span class="s2">1,2,3</span><span class="se">\n</span><span class="s2">4,5,6,7</span><span class="se">\n</span><span class="s2">8,9,10"</span>

<span class="gp">In [163]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">on_bad_lines</span><span class="o">=</span><span class="s2">"skip"</span><span class="p">)</span>
<span class="gh">Out[163]: </span>
<span class="go">   a  b   c</span>
<span class="go">0  1  2   3</span>
<span class="go">1  8  9  10</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">1.4.0 版新增。</span></p>
</div>
<p>或者，如果 <code class="docutils literal notranslate"><span class="pre">engine="python"</span></code>，可以传入一个可调用函数来处理坏行。坏行将是一个由 <code class="docutils literal notranslate"><span class="pre">sep</span></code> 分割的字符串列表。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [164]: </span><span class="n">external_list</span> <span class="o">=</span> <span class="p">[]</span>

<span class="gp">In [165]: </span><span class="k">def</span><span class="w"> </span><span class="nf">bad_lines_func</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
<span class="gp">   .....: </span>    <span class="n">external_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
<span class="gp">   .....: </span>    <span class="k">return</span> <span class="n">line</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span>
<span class="gp">   .....: </span>

<span class="gp">In [166]: </span><span class="n">external_list</span>
<span class="gh">Out[166]: </span><span class="go">[]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p>可调用函数只会处理字段过多的行。由其他错误导致的坏行将被静默跳过。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [167]: </span><span class="n">bad_lines_func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">line</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

<span class="gp">In [168]: </span><span class="n">data</span> <span class="o">=</span> <span class="s1">'name,type</span><span class="se">\n</span><span class="s1">name a,a is of type a</span><span class="se">\n</span><span class="s1">name b,"b</span><span class="se">\"</span><span class="s1"> is of type b"'</span>

<span class="gp">In [169]: </span><span class="n">data</span>
<span class="gh">Out[169]: </span><span class="go">'name,type\nname a,a is of type a\nname b,"b" is of type b"'</span>

<span class="gp">In [170]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">on_bad_lines</span><span class="o">=</span><span class="n">bad_lines_func</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">"python"</span><span class="p">)</span>
<span class="gh">Out[170]: </span>
<span class="go">     name            type</span>
<span class="go">0  name a  a is of type a</span>
</pre></div>
</div>
<p>在这种情况下，该行未被处理，因为此处的“坏行”是由转义字符引起的。</p>
</div>
<p>您还可以使用 <code class="docutils literal notranslate"><span class="pre">usecols</span></code> 参数来消除在某些行中出现但其他行中不出现的额外列数据。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [171]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ValueError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">171</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>

<span class="nn">File ~/work/pandas/pandas/pandas/io/parsers/readers.py:1026,</span> in <span class="ni">read_csv</span><span class="nt">(filepath_or_buffer, sep, delimiter, header, names, index_col, usecols, dtype, engine, converters, true_values, false_values, skipinitialspace, skiprows, skipfooter, nrows, na_values, keep_default_na, na_filter, verbose, skip_blank_lines, parse_dates, infer_datetime_format, keep_date_col, date_parser, date_format, dayfirst, cache_dates, iterator, chunksize, compression, thousands, decimal, lineterminator, quotechar, quoting, doublequote, escapechar, comment, encoding, encoding_errors, dialect, on_bad_lines, delim_whitespace, low_memory, memory_map, float_precision, storage_options, dtype_backend)</span>
<span class="g g-Whitespace">   </span><span class="mi">1013</span> <span class="n">kwds_defaults</span> <span class="o">=</span> <span class="n">_refine_defaults_read</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1014</span>     <span class="n">dialect</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1015</span>     <span class="n">delimiter</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1022</span>     <span class="n">dtype_backend</span><span class="o">=</span><span class="n">dtype_backend</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1023</span> <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1024</span> <span class="n">kwds</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwds_defaults</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">1026</span> <span class="k">return</span> <span class="n">_read</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>

<span class="nn">File ~/work/pandas/pandas/pandas/io/parsers/readers.py:620,</span> in <span class="ni">_read</span><span class="nt">(filepath_or_buffer, kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">617</span> <span class="n">_validate_names</span><span class="p">(</span><span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"names"</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
<span class="g g-Whitespace">    </span><span class="mi">619</span> <span class="c1"># Create the parser.</span>
<span class="ne">--&gt; </span><span class="mi">620</span> <span class="n">parser</span> <span class="o">=</span> <span class="n">TextFileReader</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">622</span> <span class="k">if</span> <span class="n">chunksize</span> <span class="ow">or</span> <span class="n">iterator</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">623</span>     <span class="k">return</span> <span class="n">parser</span>

<span class="nn">File ~/work/pandas/pandas/pandas/io/parsers/readers.py:1620,</span> in <span class="ni">TextFileReader.__init__</span><span class="nt">(self, f, engine, **kwds)</span>
<span class="g g-Whitespace">   </span><span class="mi">1617</span>     <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">"has_index_names"</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwds</span><span class="p">[</span><span class="s2">"has_index_names"</span><span class="p">]</span>
<span class="g g-Whitespace">   </span><span class="mi">1619</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="p">:</span> <span class="n">IOHandles</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<span class="ne">-&gt; </span><span class="mi">1620</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_engine</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span>

<span class="nn">File ~/work/pandas/pandas/pandas/io/parsers/readers.py:1898,</span> in <span class="ni">TextFileReader._make_engine</span><span class="nt">(self, f, engine)</span>
<span class="g g-Whitespace">   </span><span class="mi">1895</span>     <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1897</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">1898</span>     <span class="k">return</span> <span class="n">mapping</span><span class="p">[</span><span class="n">engine</span><span class="p">](</span><span class="n">f</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1899</span> <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1900</span>     <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

<span class="nn">File ~/work/pandas/pandas/pandas/io/parsers/c_parser_wrapper.py:155,</span> in <span class="ni">CParserWrapper.__init__</span><span class="nt">(self, src, **kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">152</span>     <span class="c1"># error: Cannot determine type of 'names'</span>
<span class="g g-Whitespace">    </span><span class="mi">153</span>     <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">usecols</span><span class="p">):</span>  <span class="c1"># type: ignore[has-type]</span>
<span class="g g-Whitespace">    </span><span class="mi">154</span>         <span class="c1"># error: Cannot determine type of 'names'</span>
<span class="ne">--&gt; </span><span class="mi">155</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_validate_usecols_names</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">156</span>             <span class="n">usecols</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">157</span>             <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">,</span>  <span class="c1"># type: ignore[has-type]</span>
<span class="g g-Whitespace">    </span><span class="mi">158</span>         <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">160</span> <span class="c1"># error: Cannot determine type of 'names'</span>
<span class="g g-Whitespace">    </span><span class="mi">161</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_parse_dates_presence</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>  <span class="c1"># type: ignore[has-type]</span>

<span class="nn">File ~/work/pandas/pandas/pandas/io/parsers/base_parser.py:988,</span> in <span class="ni">ParserBase._validate_usecols_names</span><span class="nt">(self, usecols, names)</span>
<span class="g g-Whitespace">    </span><span class="mi">986</span> <span class="n">missing</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">usecols</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">names</span><span class="p">]</span>
<span class="g g-Whitespace">    </span><span class="mi">987</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">missing</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">988</span>     <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">989</span>         <span class="sa">f</span><span class="s2">"Usecols do not match columns, columns expected but not found: "</span>
<span class="g g-Whitespace">    </span><span class="mi">990</span>         <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">missing</span><span class="si">}</span><span class="s2">"</span>
<span class="g g-Whitespace">    </span><span class="mi">991</span>     <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">993</span> <span class="k">return</span> <span class="n">usecols</span>

<span class="ne">ValueError</span>: Usecols do not match columns, columns expected but not found: [0, 1, 2]
</pre></div>
</div>
<p>如果您想保留所有数据，包括字段过多的行，可以指定足够数量的 <code class="docutils literal notranslate"><span class="pre">names</span></code>。这确保了字段不足的行将填充 <code class="docutils literal notranslate"><span class="pre">NaN</span></code>。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [172]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">'a'</span><span class="p">,</span> <span class="s1">'b'</span><span class="p">,</span> <span class="s1">'c'</span><span class="p">,</span> <span class="s1">'d'</span><span class="p">])</span>
<span class="gh">Out[172]: </span>
<span class="go">        a                b   c   d</span>
<span class="go">0    name             type NaN NaN</span>
<span class="go">1  name a   a is of type a NaN NaN</span>
<span class="go">2  name b  b is of type b" NaN NaN</span>
</pre></div>
</div>
</section>
<section id="dialect">
<span id="io-dialect"></span><h3>方言<a class="headerlink" href="io.html#dialect" title="Link to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">dialect</span></code> 关键字在指定文件格式方面提供了更大的灵活性。默认情况下，它使用 Excel 方言，但您可以指定方言名称或 <a class="reference external" href="https://docs.pythonlang.cn/3/library/csv.html#csv.Dialect" title="(in Python v3.13)"><code class="docutils literal notranslate"><span class="pre">csv.Dialect</span></code></a> 实例。</p>
<p>假设您有未加引号的数据。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [173]: </span><span class="n">data</span> <span class="o">=</span> <span class="s2">"label1,label2,label3</span><span class="se">\n</span><span class="s2">"</span> <span class="s1">'index1,"a,c,e</span><span class="se">\n</span><span class="s1">'</span> <span class="s2">"index2,b,d,f"</span>

<span class="gp">In [174]: </span><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="go">label1,label2,label3</span>
<span class="go">index1,"a,c,e</span>
<span class="go">index2,b,d,f</span>
</pre></div>
</div>
<p>默认情况下，<code class="docutils literal notranslate"><span class="pre">read_csv</span></code> 使用 Excel 方言并将双引号视为引用字符，这导致它在找到闭合双引号之前遇到换行符时失败。</p>
<p>我们可以使用 <code class="docutils literal notranslate"><span class="pre">dialect</span></code> 来解决这个问题。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [175]: </span><span class="kn">import</span><span class="w"> </span><span class="nn">csv</span>

<span class="gp">In [176]: </span><span class="n">dia</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">excel</span><span class="p">()</span>

<span class="gp">In [177]: </span><span class="n">dia</span><span class="o">.</span><span class="n">quoting</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">QUOTE_NONE</span>

<span class="gp">In [178]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">dialect</span><span class="o">=</span><span class="n">dia</span><span class="p">)</span>
<span class="gh">Out[178]: </span>
<span class="go">       label1 label2 label3</span>
<span class="go">index1     "a      c      e</span>
<span class="go">index2      b      d      f</span>
</pre></div>
</div>
<p>所有方言选项都可以通过关键字参数单独指定。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [179]: </span><span class="n">data</span> <span class="o">=</span> <span class="s2">"a,b,c~1,2,3~4,5,6"</span>

<span class="gp">In [180]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">lineterminator</span><span class="o">=</span><span class="s2">"~"</span><span class="p">)</span>
<span class="gh">Out[180]: </span>
<span class="go">   a  b  c</span>
<span class="go">0  1  2  3</span>
<span class="go">1  4  5  6</span>
</pre></div>
</div>
<p>另一个常见的方言选项是 <code class="docutils literal notranslate"><span class="pre">skipinitialspace</span></code>，用于跳过分隔符后的任何空白字符。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [181]: </span><span class="n">data</span> <span class="o">=</span> <span class="s2">"a, b, c</span><span class="se">\n</span><span class="s2">1, 2, 3</span><span class="se">\n</span><span class="s2">4, 5, 6"</span>

<span class="gp">In [182]: </span><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="go">a, b, c</span>
<span class="go">1, 2, 3</span>
<span class="go">4, 5, 6</span>

<span class="gp">In [183]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">skipinitialspace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gh">Out[183]: </span>
<span class="go">   a  b  c</span>
<span class="go">0  1  2  3</span>
<span class="go">1  4  5  6</span>
</pre></div>
</div>
<p>解析器会尽力“做正确的事”并且不脆弱。类型推断是一个相当重要的问题。如果一列可以在不改变内容的情况下强制转换为整数 dtype，解析器就会这样做。任何非数字列将像其他 pandas 对象一样以 object dtype 形式通过。</p>
</section>
<section id="quoting-and-escape-characters">
<span id="io-quoting"></span><h3>引号和转义字符<a class="headerlink" href="io.html#quoting-and-escape-characters" title="Link to this heading">#</a></h3>
<p>嵌入字段中的引号（和其他转义字符）可以通过多种方式处理。一种方法是使用反斜杠；要正确解析此数据，您应该传入 <code class="docutils literal notranslate"><span class="pre">escapechar</span></code> 选项。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [184]: </span><span class="n">data</span> <span class="o">=</span> <span class="s1">'a,b</span><span class="se">\n</span><span class="s1">"hello, </span><span class="se">\\</span><span class="s1">"Bob</span><span class="se">\\</span><span class="s1">", nice to see you",5'</span>

<span class="gp">In [185]: </span><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="go">a,b</span>
<span class="go">"hello, \"Bob\", nice to see you",5</span>

<span class="gp">In [186]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">escapechar</span><span class="o">=</span><span class="s2">"</span><span class="se">\\</span><span class="s2">"</span><span class="p">)</span>
<span class="gh">Out[186]: </span>
<span class="go">                               a  b</span>
<span class="go">0  hello, "Bob", nice to see you  5</span>
</pre></div>
</div>
</section>
<section id="files-with-fixed-width-columns">
<span id="io-fwf"></span><span id="io-fwf-reader"></span><h3>固定宽度列的文件<a class="headerlink" href="io.html#files-with-fixed-width-columns" title="Link to this heading">#</a></h3>
<p>尽管 <a class="reference internal" href="../reference/api/pandas.read_csv.html#pandas.read_csv" title="pandas.read_csv"><code class="xref py py-func docutils literal notranslate"><span class="pre">read_csv()</span></code></a> 读取带分隔符的数据，但 <a class="reference internal" href="../reference/api/pandas.read_fwf.html#pandas.read_fwf" title="pandas.read_fwf"><code class="xref py py-func docutils literal notranslate"><span class="pre">read_fwf()</span></code></a> 函数处理具有已知固定列宽的数据文件。<code class="docutils literal notranslate"><span class="pre">read_fwf</span></code> 的函数参数与 <code class="docutils literal notranslate"><span class="pre">read_csv</span></code> 大致相同，但增加了两个额外参数，并且 <code class="docutils literal notranslate"><span class="pre">delimiter</span></code> 参数的使用方式不同。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">colspecs</span></code>：一个对（元组）列表，给出每行固定宽度字段的范围，表示为半开区间（即 [from, to[）。字符串值 ‘infer’ 可用于指示解析器尝试从数据的前 100 行检测列规范。如果未指定，默认行为是推断。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">widths</span></code>：一个字段宽度列表，如果区间是连续的，可以用它代替 ‘colspecs’。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">delimiter</span></code>：在固定宽度文件中视为填充字符的字符。如果字段的填充字符不是空格（例如 ‘~’），则可以使用此参数指定。</p></li>
</ul>
<p>考虑一个典型的固定宽度数据文件。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [187]: </span><span class="n">data1</span> <span class="o">=</span> <span class="p">(</span>
<span class="gp">   .....: </span>    <span class="s2">"id8141    360.242940   149.910199   11950.7</span><span class="se">\n</span><span class="s2">"</span>
<span class="gp">   .....: </span>    <span class="s2">"id1594    444.953632   166.985655   11788.4</span><span class="se">\n</span><span class="s2">"</span>
<span class="gp">   .....: </span>    <span class="s2">"id1849    364.136849   183.628767   11806.2</span><span class="se">\n</span><span class="s2">"</span>
<span class="gp">   .....: </span>    <span class="s2">"id1230    413.836124   184.375703   11916.8</span><span class="se">\n</span><span class="s2">"</span>
<span class="gp">   .....: </span>    <span class="s2">"id1948    502.953953   173.237159   12468.3"</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [188]: </span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"bar.csv"</span><span class="p">,</span> <span class="s2">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="gp">   .....: </span>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data1</span><span class="p">)</span>
<span class="gp">   .....: </span>
</pre></div>
</div>
<p>为了将此文件解析为 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>，我们只需将列规范和文件名提供给 <code class="docutils literal notranslate"><span class="pre">read_fwf</span></code> 函数。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="go"># Column specifications are a list of half-intervals</span>
<span class="gp">In [189]: </span><span class="n">colspecs</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span> <span class="p">(</span><span class="mi">21</span><span class="p">,</span> <span class="mi">33</span><span class="p">),</span> <span class="p">(</span><span class="mi">34</span><span class="p">,</span> <span class="mi">43</span><span class="p">)]</span>

<span class="gp">In [190]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_fwf</span><span class="p">(</span><span class="s2">"bar.csv"</span><span class="p">,</span> <span class="n">colspecs</span><span class="o">=</span><span class="n">colspecs</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="gp">In [191]: </span><span class="n">df</span>
<span class="gh">Out[191]: </span>
<span class="go">                 1           2        3</span>
<span class="go">0                                      </span>
<span class="go">id8141  360.242940  149.910199  11950.7</span>
<span class="go">id1594  444.953632  166.985655  11788.4</span>
<span class="go">id1849  364.136849  183.628767  11806.2</span>
<span class="go">id1230  413.836124  184.375703  11916.8</span>
<span class="go">id1948  502.953953  173.237159  12468.3</span>
</pre></div>
</div>
<p>请注意，当指定 <code class="docutils literal notranslate"><span class="pre">header=None</span></code> 参数时，解析器会自动选择列名 X.<列号>。或者，您也可以只提供连续列的列宽。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="go"># Widths are a list of integers</span>
<span class="gp">In [192]: </span><span class="n">widths</span> <span class="o">=</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>

<span class="gp">In [193]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_fwf</span><span class="p">(</span><span class="s2">"bar.csv"</span><span class="p">,</span> <span class="n">widths</span><span class="o">=</span><span class="n">widths</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

<span class="gp">In [194]: </span><span class="n">df</span>
<span class="gh">Out[194]: </span>
<span class="go">        0           1           2        3</span>
<span class="go">0  id8141  360.242940  149.910199  11950.7</span>
<span class="go">1  id1594  444.953632  166.985655  11788.4</span>
<span class="go">2  id1849  364.136849  183.628767  11806.2</span>
<span class="go">3  id1230  413.836124  184.375703  11916.8</span>
<span class="go">4  id1948  502.953953  173.237159  12468.3</span>
</pre></div>
</div>
<p>解析器将处理列周围的额外空白，因此文件中列之间有额外的分隔符也没关系。</p>
<p>默认情况下，<code class="docutils literal notranslate"><span class="pre">read_fwf</span></code> 会尝试使用文件的前 100 行来推断文件的 <code class="docutils literal notranslate"><span class="pre">colspecs</span></code>。只有当列对齐并由提供的 <code class="docutils literal notranslate"><span class="pre">delimiter</span></code>（默认分隔符为空格）正确分隔时，它才能做到这一点。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [195]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_fwf</span><span class="p">(</span><span class="s2">"bar.csv"</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="gp">In [196]: </span><span class="n">df</span>
<span class="gh">Out[196]: </span>
<span class="go">                 1           2        3</span>
<span class="go">0                                      </span>
<span class="go">id8141  360.242940  149.910199  11950.7</span>
<span class="go">id1594  444.953632  166.985655  11788.4</span>
<span class="go">id1849  364.136849  183.628767  11806.2</span>
<span class="go">id1230  413.836124  184.375703  11916.8</span>
<span class="go">id1948  502.953953  173.237159  12468.3</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">read_fwf</span></code> 支持 <code class="docutils literal notranslate"><span class="pre">dtype</span></code> 参数，用于指定解析列的类型与推断类型不同。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [197]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_fwf</span><span class="p">(</span><span class="s2">"bar.csv"</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">dtypes</span>
<span class="gh">Out[197]: </span>
<span class="go">1    float64</span>
<span class="go">2    float64</span>
<span class="go">3    float64</span>
<span class="go">dtype: object</span>

<span class="gp">In [198]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_fwf</span><span class="p">(</span><span class="s2">"bar.csv"</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="p">{</span><span class="mi">2</span><span class="p">:</span> <span class="s2">"object"</span><span class="p">})</span><span class="o">.</span><span class="n">dtypes</span>
<span class="gh">Out[198]: </span>
<span class="go">0     object</span>
<span class="go">1    float64</span>
<span class="go">2     object</span>
<span class="go">3    float64</span>
<span class="go">dtype: object</span>
</pre></div>
</div>
</section>
<section id="indexes">
<h3>索引<a class="headerlink" href="io.html#indexes" title="Link to this heading">#</a></h3>
<section id="files-with-an-implicit-index-column">
<h4>带有“隐式”索引列的文件<a class="headerlink" href="io.html#files-with-an-implicit-index-column" title="Link to this heading">#</a></h4>
<p>考虑一个文件，其头部条目比数据列数少一个</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [199]: </span><span class="n">data</span> <span class="o">=</span> <span class="s2">"A,B,C</span><span class="se">\n</span><span class="s2">20090101,a,1,2</span><span class="se">\n</span><span class="s2">20090102,b,3,4</span><span class="se">\n</span><span class="s2">20090103,c,4,5"</span>

<span class="gp">In [200]: </span><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="go">A,B,C</span>
<span class="go">20090101,a,1,2</span>
<span class="go">20090102,b,3,4</span>
<span class="go">20090103,c,4,5</span>

<span class="gp">In [201]: </span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"foo.csv"</span><span class="p">,</span> <span class="s2">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="gp">   .....: </span>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="gp">   .....: </span>
</pre></div>
</div>
<p>在这种特殊情况下，<code class="docutils literal notranslate"><span class="pre">read_csv</span></code> 假定第一列将用作 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> 的索引。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [202]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"foo.csv"</span><span class="p">)</span>
<span class="gh">Out[202]: </span>
<span class="go">          A  B  C</span>
<span class="go">20090101  a  1  2</span>
<span class="go">20090102  b  3  4</span>
<span class="go">20090103  c  4  5</span>
</pre></div>
</div>
<p>请注意，日期没有自动解析。在这种情况下，您需要像以前一样操作。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [203]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"foo.csv"</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="gp">In [204]: </span><span class="n">df</span><span class="o">.</span><span class="n">index</span>
<span class="gh">Out[204]: </span><span class="go">DatetimeIndex(['2009-01-01', '2009-01-02', '2009-01-03'], dtype='datetime64[ns]', freq=None)</span>
</pre></div>
</div>
</section>
<section id="reading-an-index-with-a-multiindex">
<h4>读取带有 <code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code> 的索引<a class="headerlink" href="io.html#reading-an-index-with-a-multiindex" title="Link to this heading">#</a></h4>
<p id="io-csv-multiindex">假设您的数据由两列索引</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [205]: </span><span class="n">data</span> <span class="o">=</span> <span class="s1">'year,indiv,zit,xit</span><span class="se">\n</span><span class="s1">1977,"A",1.2,.6</span><span class="se">\n</span><span class="s1">1977,"B",1.5,.5'</span>

<span class="gp">In [206]: </span><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="go">year,indiv,zit,xit</span>
<span class="go">1977,"A",1.2,.6</span>
<span class="go">1977,"B",1.5,.5</span>

<span class="gp">In [207]: </span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"mindex_ex.csv"</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="gp">   .....: </span>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="gp">   .....: </span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">read_csv</span></code> 的 <code class="docutils literal notranslate"><span class="pre">index_col</span></code> 参数可以接受列号列表，将多列转换为返回对象的索引的 <code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code>。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [208]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"mindex_ex.csv"</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

<span class="gp">In [209]: </span><span class="n">df</span>
<span class="gh">Out[209]: </span>
<span class="go">            zit  xit</span>
<span class="go">year indiv          </span>
<span class="go">1977 A      1.2  0.6</span>
<span class="go">     B      1.5  0.5</span>

<span class="gp">In [210]: </span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">1977</span><span class="p">]</span>
<span class="gh">Out[210]: </span>
<span class="go">       zit  xit</span>
<span class="go">indiv          </span>
<span class="go">A      1.2  0.6</span>
<span class="go">B      1.5  0.5</span>
</pre></div>
</div>
</section>
<section id="reading-columns-with-a-multiindex">
<span id="io-multi-index-columns"></span><h4>读取带有 <code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code> 的列<a class="headerlink" href="io.html#reading-columns-with-a-multiindex" title="Link to this heading">#</a></h4>
<p>通过为 <code class="docutils literal notranslate"><span class="pre">header</span></code> 参数指定行位置列表，您可以为列读取 <code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code>。指定不连续的行将跳过中间的行。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [211]: </span><span class="n">mi_idx</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_arrays</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="nb">list</span><span class="p">(</span><span class="s2">"abcd"</span><span class="p">)],</span> <span class="n">names</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="s2">"ab"</span><span class="p">))</span>

<span class="gp">In [212]: </span><span class="n">mi_col</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_arrays</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="nb">list</span><span class="p">(</span><span class="s2">"ab"</span><span class="p">)],</span> <span class="n">names</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="s2">"cd"</span><span class="p">))</span>

<span class="gp">In [213]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span> <span class="n">index</span><span class="o">=</span><span class="n">mi_idx</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">mi_col</span><span class="p">)</span>

<span class="gp">In [214]: </span><span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">"mi.csv"</span><span class="p">)</span>

<span class="gp">In [215]: </span><span class="nb">print</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s2">"mi.csv"</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
<span class="go">c,,1,2</span>
<span class="go">d,,a,b</span>
<span class="go">a,b,,</span>
<span class="go">1,a,1.0,1.0</span>
<span class="go">2,b,1.0,1.0</span>
<span class="go">3,c,1.0,1.0</span>
<span class="go">4,d,1.0,1.0</span>


<span class="gp">In [216]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"mi.csv"</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">index_col</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="gh">Out[216]: </span>
<span class="go">c                    1                  2</span>
<span class="go">d                    a                  b</span>
<span class="go">a   Unnamed: 2_level_2 Unnamed: 3_level_2</span>
<span class="go">1                  1.0                1.0</span>
<span class="go">2 b                1.0                1.0</span>
<span class="go">3 c                1.0                1.0</span>
<span class="go">4 d                1.0                1.0</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">read_csv</span></code> 也能够解释更常见的多列索引格式。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [217]: </span><span class="n">data</span> <span class="o">=</span> <span class="s2">",a,a,a,b,c,c</span><span class="se">\n</span><span class="s2">,q,r,s,t,u,v</span><span class="se">\n</span><span class="s2">one,1,2,3,4,5,6</span><span class="se">\n</span><span class="s2">two,7,8,9,10,11,12"</span>

<span class="gp">In [218]: </span><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="go">,a,a,a,b,c,c</span>
<span class="go">,q,r,s,t,u,v</span>
<span class="go">one,1,2,3,4,5,6</span>
<span class="go">two,7,8,9,10,11,12</span>

<span class="gp">In [219]: </span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"mi2.csv"</span><span class="p">,</span> <span class="s2">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
<span class="gp">   .....: </span>    <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [220]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"mi2.csv"</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="gh">Out[220]: </span>
<span class="go">     a         b   c    </span>
<span class="go">     q  r  s   t   u   v</span>
<span class="go">one  1  2  3   4   5   6</span>
<span class="go">two  7  8  9  10  11  12</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p>如果未指定 <code class="docutils literal notranslate"><span class="pre">index_col</span></code>（例如，您没有索引，或者使用 <code class="docutils literal notranslate"><span class="pre">df.to_csv(...,</span> <span class="pre">index=False)</span></code> 写入），则列索引上的任何 <code class="docutils literal notranslate"><span class="pre">names</span></code> 都将<em>丢失</em>。</p>
</div>
</section>
</section>
<section id="automatically-sniffing-the-delimiter">
<span id="io-sniff"></span><h3>自动“嗅探”分隔符<a class="headerlink" href="io.html#automatically-sniffing-the-delimiter" title="Link to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">read_csv</span></code> 能够推断带分隔符（不一定是逗号分隔）的文件，因为 pandas 使用 csv 模块的 <a class="reference external" href="https://docs.pythonlang.cn/3/library/csv.html#csv.Sniffer" title="(in Python v3.13)"><code class="docutils literal notranslate"><span class="pre">csv.Sniffer</span></code></a> 类。为此，您必须指定 <code class="docutils literal notranslate"><span class="pre">sep=None</span></code>。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [221]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="gp">In [222]: </span><span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">"tmp2.csv"</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">":"</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="gp">In [223]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"tmp2.csv"</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">"python"</span><span class="p">)</span>
<span class="gh">Out[223]: </span>
<span class="go">          0         1         2         3</span>
<span class="go">0  0.469112 -0.282863 -1.509059 -1.135632</span>
<span class="go">1  1.212112 -0.173215  0.119209 -1.044236</span>
<span class="go">2 -0.861849 -2.104569 -0.494929  1.071804</span>
<span class="go">3  0.721555 -0.706771 -1.039575  0.271860</span>
<span class="go">4 -0.424972  0.567020  0.276232 -1.087401</span>
<span class="go">5 -0.673690  0.113648 -1.478427  0.524988</span>
<span class="go">6  0.404705  0.577046 -1.715002 -1.039268</span>
<span class="go">7 -0.370647 -1.157892 -1.344312  0.844885</span>
<span class="go">8  1.075770 -0.109050  1.643563 -1.469388</span>
<span class="go">9  0.357021 -0.674600 -1.776904 -0.968914</span>
</pre></div>
</div>
</section>
<section id="reading-multiple-files-to-create-a-single-dataframe">
<span id="io-multiple-files"></span><h3>读取多个文件以创建一个单独的 DataFrame<a class="headerlink" href="io.html#reading-multiple-files-to-create-a-single-dataframe" title="Link to this heading">#</a></h3>
<p>最好使用 <a class="reference internal" href="../reference/api/pandas.concat.html#pandas.concat" title="pandas.concat"><code class="xref py py-func docutils literal notranslate"><span class="pre">concat()</span></code></a> 来组合多个文件。请参阅<a class="reference internal" href="cookbook.html#cookbook-csv-multiple-files"><span class="std std-ref">cookbook</span></a> 以获取示例。</p>
</section>
<section id="iterating-through-files-chunk-by-chunk">
<span id="io-chunking"></span><h3>逐块迭代文件<a class="headerlink" href="io.html#iterating-through-files-chunk-by-chunk" title="Link to this heading">#</a></h3>
<p>假设您希望懒惰地迭代一个（可能非常大）文件，而不是将整个文件读入内存，例如以下情况：</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [224]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="gp">In [225]: </span><span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">"tmp.csv"</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="gp">In [226]: </span><span class="n">table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"tmp.csv"</span><span class="p">)</span>

<span class="gp">In [227]: </span><span class="n">table</span>
<span class="gh">Out[227]: </span>
<span class="go">          0         1         2         3</span>
<span class="go">0 -1.294524  0.413738  0.276662 -0.472035</span>
<span class="go">1 -0.013960 -0.362543 -0.006154 -0.923061</span>
<span class="go">2  0.895717  0.805244 -1.206412  2.565646</span>
<span class="go">3  1.431256  1.340309 -1.170299 -0.226169</span>
<span class="go">4  0.410835  0.813850  0.132003 -0.827317</span>
<span class="go">5 -0.076467 -1.187678  1.130127 -1.436737</span>
<span class="go">6 -1.413681  1.607920  1.024180  0.569605</span>
<span class="go">7  0.875906 -2.211372  0.974466 -2.006747</span>
<span class="go">8 -0.410001 -0.078638  0.545952 -1.219217</span>
<span class="go">9 -1.226825  0.769804 -1.281247 -0.727707</span>
</pre></div>
</div>
<p>通过为 <code class="docutils literal notranslate"><span class="pre">read_csv</span></code> 指定 <code class="docutils literal notranslate"><span class="pre">chunksize</span></code>，返回值将是 <code class="docutils literal notranslate"><span class="pre">TextFileReader</span></code> 类型的可迭代对象。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [228]: </span><span class="k">with</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"tmp.csv"</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span> <span class="k">as</span> <span class="n">reader</span><span class="p">:</span>
<span class="gp">   .....: </span>    <span class="nb">print</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span>
<span class="gp">   .....: </span>    <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">:</span>
<span class="gp">   .....: </span>        <span class="nb">print</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
<span class="gp">   .....: </span>
<span class="go">&lt;pandas.io.parsers.readers.TextFileReader object at 0x7f9452705a80&gt;</span>
<span class="go">          0         1         2         3</span>
<span class="go">0 -1.294524  0.413738  0.276662 -0.472035</span>
<span class="go">1 -0.013960 -0.362543 -0.006154 -0.923061</span>
<span class="go">2  0.895717  0.805244 -1.206412  2.565646</span>
<span class="go">3  1.431256  1.340309 -1.170299 -0.226169</span>
<span class="go">          0         1         2         3</span>
<span class="go">4  0.410835  0.813850  0.132003 -0.827317</span>
<span class="go">5 -0.076467 -1.187678  1.130127 -1.436737</span>
<span class="go">6 -1.413681  1.607920  1.024180  0.569605</span>
<span class="go">7  0.875906 -2.211372  0.974466 -2.006747</span>
<span class="go">          0         1         2         3</span>
<span class="go">8 -0.410001 -0.078638  0.545952 -1.219217</span>
<span class="go">9 -1.226825  0.769804 -1.281247 -0.727707</span>
</pre></div>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">1.2 版本中的变化：</span><code class="docutils literal notranslate"><span class="pre">read_csv/json/sas</span></code> 在迭代文件时返回一个上下文管理器。</p>
</div>
<p>指定 <code class="docutils literal notranslate"><span class="pre">iterator=True</span></code> 也将返回 <code class="docutils literal notranslate"><span class="pre">TextFileReader</span></code> 对象。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [229]: </span><span class="k">with</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"tmp.csv"</span><span class="p">,</span> <span class="n">iterator</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">reader</span><span class="p">:</span>
<span class="gp">   .....: </span>    <span class="nb">print</span><span class="p">(</span><span class="n">reader</span><span class="o">.</span><span class="n">get_chunk</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="gp">   .....: </span>
<span class="go">          0         1         2         3</span>
<span class="go">0 -1.294524  0.413738  0.276662 -0.472035</span>
<span class="go">1 -0.013960 -0.362543 -0.006154 -0.923061</span>
<span class="go">2  0.895717  0.805244 -1.206412  2.565646</span>
<span class="go">3  1.431256  1.340309 -1.170299 -0.226169</span>
<span class="go">4  0.410835  0.813850  0.132003 -0.827317</span>
</pre></div>
</div>
</section>
<section id="specifying-the-parser-engine">
<h3>指定解析器引擎<a class="headerlink" href="io.html#specifying-the-parser-engine" title="Link to this heading">#</a></h3>
<p>Pandas 目前支持三种引擎：C 引擎、Python 引擎和实验性的 pyarrow 引擎（需要 <code class="docutils literal notranslate"><span class="pre">pyarrow</span></code> 包）。一般来说，pyarrow 引擎在大型工作负载上速度最快，并且在大多数其他工作负载上与 C 引擎速度相当。Python 引擎在大多数工作负载上往往比 pyarrow 和 C 引擎慢。然而，pyarrow 引擎的健壮性远低于 C 引擎，而 C 引擎又比 Python 引擎缺少一些功能。</p>
<p>如果可能，pandas 使用 C 解析器（指定为 <code class="docutils literal notranslate"><span class="pre">engine='c'</span></code>），但如果指定了 C 不支持的选项，它可能会回退到 Python。</p>
<p>目前，C 和 pyarrow 引擎不支持的选项包括：</p>
<ul class="simple">
<li><p>除了单个字符之外的 <code class="docutils literal notranslate"><span class="pre">sep</span></code>（例如正则表达式分隔符）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">skipfooter</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sep=None</span></code> 与 <code class="docutils literal notranslate"><span class="pre">delim_whitespace=False</span></code></p></li>
</ul>
<p>指定上述任何选项都将生成 <code class="docutils literal notranslate"><span class="pre">ParserWarning</span></code>，除非使用 <code class="docutils literal notranslate"><span class="pre">engine='python'</span></code> 显式选择 Python 引擎。</p>
<p>pyarrow 引擎不支持但未在上述列表中涵盖的选项包括：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">float_precision</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">chunksize</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">comment</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nrows</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">thousands</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">memory_map</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dialect</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">on_bad_lines</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">delim_whitespace</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">quoting</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lineterminator</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">converters</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">decimal</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">iterator</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dayfirst</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">infer_datetime_format</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">verbose</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">skipinitialspace</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">low_memory</span></code></p></li>
</ul>
<p>将这些选项与 <code class="docutils literal notranslate"><span class="pre">engine='pyarrow'</span></code> 一起指定将引发 <code class="docutils literal notranslate"><span class="pre">ValueError</span></code>。</p>
</section>
<section id="reading-writing-remote-files">
<span id="io-remote"></span><h3>读取/写入远程文件<a class="headerlink" href="io.html#reading-writing-remote-files" title="Link to this heading">#</a></h3>
<p>您可以将 URL 传递给 pandas 的许多 IO 函数以读取或写入远程文件——以下示例展示了读取 CSV 文件：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"https://download.bls.gov/pub/time.series/cu/cu.item"</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">"</span><span class="se">\t</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">1.3.0 版新增。</span></p>
</div>
<p>可以通过将标头键值映射字典传递给 <code class="docutils literal notranslate"><span class="pre">storage_options</span></code> 关键字参数，如下所示，随 HTTP(s) 请求发送自定义标头：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"User-Agent"</span><span class="p">:</span> <span class="s2">"pandas"</span><span class="p">}</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="s2">"https://download.bls.gov/pub/time.series/cu/cu.item"</span><span class="p">,</span>
    <span class="n">sep</span><span class="o">=</span><span class="s2">"</span><span class="se">\t</span><span class="s2">"</span><span class="p">,</span>
    <span class="n">storage_options</span><span class="o">=</span><span class="n">headers</span>
<span class="p">)</span>
</pre></div>
</div>
<p>所有非本地文件或 HTTP(s) 的 URL 都由 <a class="reference external" href="https://filesystem-spec.readthedocs.io/en/latest/">fsspec</a>（如果已安装）及其各种文件系统实现（包括 Amazon S3、Google Cloud、SSH、FTP、webHDFS…）处理。其中一些实现将需要安装额外的包，例如 S3 URL 需要 <a class="reference external" href="https://pypi.ac.cn/project/s3fs/">s3fs</a> 库。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="s2">"s3://pandas-test/adatafile.json"</span><span class="p">)</span>
</pre></div>
</div>
<p>在处理远程存储系统时，您可能需要在特殊位置使用环境变量或配置文件进行额外配置。例如，要访问 S3 存储桶中的数据，您需要以 <a class="reference external" href="https://s3fs.readthedocs.io/en/latest/#credentials">S3Fs 文档</a>中列出的几种方式之一定义凭据。对于某些存储后端也是如此，您应该遵循 <a class="reference external" href="https://filesystem-spec.readthedocs.io/en/latest/api.html#built-in-implementations">fsimpl1</a> 中内置于 <code class="docutils literal notranslate"><span class="pre">fsspec</span></code> 的实现链接，以及 <a class="reference external" href="https://filesystem-spec.readthedocs.io/en/latest/api.html#other-known-implementations">fsimpl2</a> 中未包含在主 <code class="docutils literal notranslate"><span class="pre">fsspec</span></code> 分发中的实现链接。</p>
<p>您也可以直接将参数传递给后端驱动程序。由于 <code class="docutils literal notranslate"><span class="pre">fsspec</span></code> 不使用 <code class="docutils literal notranslate"><span class="pre">AWS_S3_HOST</span></code> 环境变量，我们可以直接定义一个包含 endpoint_url 的字典，并将该对象传递给存储选项参数。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">storage_options</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"client_kwargs"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"endpoint_url"</span><span class="p">:</span> <span class="s2">"http://127.0.0.1:5555"</span><span class="p">}}}</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="s2">"s3://pandas-test/test-1"</span><span class="p">,</span> <span class="n">storage_options</span><span class="o">=</span><span class="n">storage_options</span><span class="p">)</span>
</pre></div>
</div>
<p>更多示例配置和文档可在 <a class="reference external" href="https://s3fs.readthedocs.io/en/latest/index.html?highlight=host#s3-compatible-storage">S3Fs 文档</a>中找到。</p>
<p>如果您<em>没有</em>S3 凭据，您仍然可以通过指定匿名连接来访问公共数据，例如：</p>
<div class="versionadded">
<p><span class="versionmodified added">1.2.0 版新增。</span></p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="s2">"s3://ncei-wcsd-archive/data/processed/SH1305/18kHz/SaKe2013"</span>
    <span class="s2">"-D20130523-T080854_to_SaKe2013-D20130523-T085643.csv"</span><span class="p">,</span>
    <span class="n">storage_options</span><span class="o">=</span><span class="p">{</span><span class="s2">"anon"</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
<span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">fsspec</span></code> 还允许复杂的 URL，用于访问压缩档案中的数据、本地文件缓存等。要本地缓存上述示例，您将修改调用为：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="s2">"simplecache::s3://ncei-wcsd-archive/data/processed/SH1305/18kHz/"</span>
    <span class="s2">"SaKe2013-D20130523-T080854_to_SaKe2013-D20130523-T085643.csv"</span><span class="p">,</span>
    <span class="n">storage_options</span><span class="o">=</span><span class="p">{</span><span class="s2">"s3"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"anon"</span><span class="p">:</span> <span class="kc">True</span><span class="p">}},</span>
<span class="p">)</span>
</pre></div>
</div>
<p>在这里，我们指定“anon”参数是用于实现的“s3”部分，而不是用于缓存实现。请注意，这仅在会话期间缓存到临时目录，但您也可以指定永久存储。</p>
</section>
<section id="writing-out-data">
<h3>写入数据<a class="headerlink" href="io.html#writing-out-data" title="Link to this heading">#</a></h3>
<section id="writing-to-csv-format">
<span id="io-store-in-csv"></span><h4>写入 CSV 格式<a class="headerlink" href="io.html#writing-to-csv-format" title="Link to this heading">#</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">Series</span></code> 和 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> 对象有一个实例方法 <code class="docutils literal notranslate"><span class="pre">to_csv</span></code>，它允许将对象内容存储为逗号分隔值文件。该函数接受许多参数，其中只有第一个是必需的。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">path_or_buf</span></code>：要写入的文件路径字符串或文件对象。如果为文件对象，则必须以 <code class="docutils literal notranslate"><span class="pre">newline=''</span></code> 打开。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sep</span></code>：输出文件的字段分隔符（默认为“,”）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">na_rep</span></code>：缺失值的字符串表示（默认为‘’）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">float_format</span></code>：浮点数的格式字符串</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">columns</span></code>：要写入的列（默认为 None）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">header</span></code>：是否写入列名（默认为 True）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">index</span></code>：是否写入行（索引）名称（默认为 True）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">index_label</span></code>：如果需要，索引列的列标签。如果为 None（默认），并且 <code class="docutils literal notranslate"><span class="pre">header</span></code> 和 <code class="docutils literal notranslate"><span class="pre">index</span></code> 为 True，则使用索引名称。（如果 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> 使用 MultiIndex，则应提供序列。）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mode</span></code>：Python 写入模式，默认为 'w'</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">encoding</span></code>：一个字符串，表示如果内容是非 ASCII，则要使用的编码，适用于 Python 3 之前的版本。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lineterminator</span></code>：表示行尾的字符序列（默认为 <code class="docutils literal notranslate"><span class="pre">os.linesep</span></code>）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">quoting</span></code>：设置引用规则，如 csv 模块所示（默认为 csv.QUOTE_MINIMAL）。请注意，如果您设置了 <code class="docutils literal notranslate"><span class="pre">float_format</span></code>，则浮点数将转换为字符串，并且 csv.QUOTE_NONNUMERIC 会将其视为非数字。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">quotechar</span></code>：用于引用字段的字符（默认为 '”'）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">doublequote</span></code>：控制字段中 <code class="docutils literal notranslate"><span class="pre">quotechar</span></code> 的引用（默认为 True）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">escapechar</span></code>：在适当情况下用于转义 <code class="docutils literal notranslate"><span class="pre">sep</span></code> 和 <code class="docutils literal notranslate"><span class="pre">quotechar</span></code> 的字符（默认为 None）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">chunksize</span></code>：每次写入的行数</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">date_format</span></code>：datetime 对象的格式字符串</p></li>
</ul>
</section>
<section id="writing-a-formatted-string">
<h4>写入格式化字符串<a class="headerlink" href="io.html#writing-a-formatted-string" title="Link to this heading">#</a></h4>
<p id="io-formatting"><code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> 对象有一个实例方法 <code class="docutils literal notranslate"><span class="pre">to_string</span></code>，它允许控制对象的字符串表示。所有参数都是可选的。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">buf</span></code> 默认为 None，例如 StringIO 对象。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">columns</span></code> 默认为 None，要写入的列。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">col_space</span></code> 默认为 None，每列的最小宽度。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">na_rep</span></code> 默认为 <code class="docutils literal notranslate"><span class="pre">NaN</span></code>，NA 值的表示。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">formatters</span></code> 默认为 None，一个（按列分组的）函数字典，每个函数接受一个参数并返回一个格式化字符串。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">float_format</span></code> 默认为 None，一个函数，它接受一个（浮点数）参数并返回一个格式化字符串；应用于 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> 中的浮点数。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sparsify</span></code> 默认为 True，对于带有层次索引的 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>，将其设置为 False 可在每行打印每个 MultiIndex 键。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">index_names</span></code> 默认为 True，将打印索引的名称。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">index</span></code> 默认为 True，将打印索引（即行标签）。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">header</span></code> 默认为 True，将打印列标签。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">justify</span></code> 默认为 <code class="docutils literal notranslate"><span class="pre">left</span></code>，将打印左对齐或右对齐的列标题。</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">Series</span></code> 对象也有一个 <code class="docutils literal notranslate"><span class="pre">to_string</span></code> 方法，但只有 <code class="docutils literal notranslate"><span class="pre">buf</span></code>、<code class="docutils literal notranslate"><span class="pre">na_rep</span></code>、<code class="docutils literal notranslate"><span class="pre">float_format</span></code> 参数。还有一个 <code class="docutils literal notranslate"><span class="pre">length</span></code> 参数，如果设置为 <code class="docutils literal notranslate"><span class="pre">True</span></code>，还将额外输出 Series 的长度。</p>
</section>
</section>
</section>
<section id="json">
<span id="io-json"></span><h2>JSON<a class="headerlink" href="io.html#json" title="Link to this heading">#</a></h2>
<p>读取和写入 <code class="docutils literal notranslate"><span class="pre">JSON</span></code> 格式文件和字符串。</p>
<section id="writing-json">
<span id="io-json-writer"></span><h3>写入 JSON<a class="headerlink" href="io.html#writing-json" title="Link to this heading">#</a></h3>
<p>可以将 <code class="docutils literal notranslate"><span class="pre">Series</span></code> 或 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> 转换为有效的 JSON 字符串。使用带有可选参数的 <code class="docutils literal notranslate"><span class="pre">to_json</span></code>。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">path_or_buf</span></code>：写入输出的路径名或缓冲区。这可以是 <code class="docutils literal notranslate"><span class="pre">None</span></code>，在这种情况下将返回一个 JSON 字符串。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">orient</span></code> :</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">Series</span></code>:</dt><dd><ul class="simple">
<li><p>默认为 <code class="docutils literal notranslate"><span class="pre">index</span></code></p></li>
<li><p>允许值为 {<code class="docutils literal notranslate"><span class="pre">split</span></code>, <code class="docutils literal notranslate"><span class="pre">records</span></code>, <code class="docutils literal notranslate"><span class="pre">index</span></code>}</p></li>
</ul>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>:</dt><dd><ul class="simple">
<li><p>默认为 <code class="docutils literal notranslate"><span class="pre">columns</span></code></p></li>
<li><p>允许值为 {<code class="docutils literal notranslate"><span class="pre">split</span></code>, <code class="docutils literal notranslate"><span class="pre">records</span></code>, <code class="docutils literal notranslate"><span class="pre">index</span></code>, <code class="docutils literal notranslate"><span class="pre">columns</span></code>, <code class="docutils literal notranslate"><span class="pre">values</span></code>, <code class="docutils literal notranslate"><span class="pre">table</span></code>}</p></li>
</ul>
</dd>
</dl>
<p>JSON 字符串的格式</p>
<table class="table">
<colgroup>
<col style="width: 11.8%" />
<col style="width: 88.2%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">split</span></code></p></td>
<td><p>字典格式：{index -> [index]; columns -> [columns]; data -> [values]}</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">records</span></code></p></td>
<td><p>列表格式：[{column -> value}; … ]</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">index</span></code></p></td>
<td><p>字典格式：{index -> {column -> value}}</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">columns</span></code></p></td>
<td><p>字典格式：{column -> {index -> value}}</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">values</span></code></p></td>
<td><p>仅值数组</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">table</span></code></p></td>
<td><p>符合 JSON <a class="reference external" href="https://specs.frictionlessdata.io/table-schema/">Table Schema</a></p></td>
</tr>
</tbody>
</table>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">date_format</span></code>：字符串，日期转换类型，'epoch' 表示时间戳，'iso' 表示 ISO8601。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">double_precision</span></code>：编码浮点值时使用的十进制位数，默认为 10。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">force_ascii</span></code>：强制编码字符串为 ASCII，默认为 True。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">date_unit</span></code>：编码的时间单位，控制时间戳和 ISO8601 精度。可选择 's'、'ms'、'us' 或 'ns'，分别表示秒、毫秒、微秒和纳秒。默认为 'ms'。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">default_handler</span></code>：如果对象无法转换为 JSON 的合适格式，则调用的处理程序。它接受一个参数，即要转换的对象，并返回一个可序列化的对象。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lines</span></code>：如果为 <code class="docutils literal notranslate"><span class="pre">records</span></code>  orient，则将每条记录作为一行写入 JSON。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mode</span></code>：字符串，写入路径时的写入模式。'w' 表示写入，'a' 表示追加。默认为 'w'。</p></li>
</ul>
<p>请注意，<code class="docutils literal notranslate"><span class="pre">NaN</span></code>、<code class="docutils literal notranslate"><span class="pre">NaT</span></code> 和 <code class="docutils literal notranslate"><span class="pre">None</span></code> 将转换为 <code class="docutils literal notranslate"><span class="pre">null</span></code>，<code class="docutils literal notranslate"><span class="pre">datetime</span></code> 对象将根据 <code class="docutils literal notranslate"><span class="pre">date_format</span></code> 和 <code class="docutils literal notranslate"><span class="pre">date_unit</span></code> 参数进行转换。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [230]: </span><span class="n">dfj</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="s2">"AB"</span><span class="p">))</span>

<span class="gp">In [231]: </span><span class="n">json</span> <span class="o">=</span> <span class="n">dfj</span><span class="o">.</span><span class="n">to_json</span><span class="p">()</span>

<span class="gp">In [232]: </span><span class="n">json</span>
<span class="gh">Out[232]: </span><span class="go">'{"A":{"0":-0.1213062281,"1":0.6957746499,"2":0.9597255933,"3":-0.6199759194,"4":-0.7323393705},"B":{"0":-0.0978826728,"1":0.3417343559,"2":-1.1103361029,"3":0.1497483186,"4":0.6877383895}}'</span>
</pre></div>
</div>
<section id="orient-options">
<h4>Orient 选项<a class="headerlink" href="io.html#orient-options" title="Link to this heading">#</a></h4>
<p>生成 JSON 文件/字符串的格式有许多不同的选项。考虑以下 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> 和 <code class="docutils literal notranslate"><span class="pre">Series</span></code>：</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [233]: </span><span class="n">dfjo</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="nb">dict</span><span class="p">(</span><span class="n">A</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">B</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="n">C</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">)),</span>
<span class="gp">   .....: </span>    <span class="n">columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="s2">"ABC"</span><span class="p">),</span>
<span class="gp">   .....: </span>    <span class="n">index</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="s2">"xyz"</span><span class="p">),</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [234]: </span><span class="n">dfjo</span>
<span class="gh">Out[234]: </span>
<span class="go">   A  B  C</span>
<span class="go">x  1  4  7</span>
<span class="go">y  2  5  8</span>
<span class="go">z  3  6  9</span>

<span class="gp">In [235]: </span><span class="n">sjo</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">17</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">"D"</span><span class="p">)</span>

<span class="gp">In [236]: </span><span class="n">sjo</span>
<span class="gh">Out[236]: </span>
<span class="go">x    15</span>
<span class="go">y    16</span>
<span class="go">z    17</span>
<span class="go">Name: D, dtype: int64</span>
</pre></div>
</div>
<p><strong>列导向</strong>（<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> 的默认设置）将数据序列化为嵌套的 JSON 对象，其中列标签作为主索引。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [237]: </span><span class="n">dfjo</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s2">"columns"</span><span class="p">)</span>
<span class="gh">Out[237]: </span><span class="go">'{"A":{"x":1,"y":2,"z":3},"B":{"x":4,"y":5,"z":6},"C":{"x":7,"y":8,"z":9}}'</span>

<span class="go"># Not available for Series</span>
</pre></div>
</div>
<p><strong>索引导向</strong>（<code class="docutils literal notranslate"><span class="pre">Series</span></code> 的默认设置）类似于列导向，但索引标签现在是主要的。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [238]: </span><span class="n">dfjo</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s2">"index"</span><span class="p">)</span>
<span class="gh">Out[238]: </span><span class="go">'{"x":{"A":1,"B":4,"C":7},"y":{"A":2,"B":5,"C":8},"z":{"A":3,"B":6,"C":9}}'</span>

<span class="gp">In [239]: </span><span class="n">sjo</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s2">"index"</span><span class="p">)</span>
<span class="gh">Out[239]: </span><span class="go">'{"x":15,"y":16,"z":17}'</span>
</pre></div>
</div>
<p><strong>记录导向</strong>将数据序列化为列 -> 值记录的 JSON 数组，不包含索引标签。这对于将 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> 数据传递给绘图库非常有用，例如 JavaScript 库 <code class="docutils literal notranslate"><span class="pre">d3.js</span></code>。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [240]: </span><span class="n">dfjo</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s2">"records"</span><span class="p">)</span>
<span class="gh">Out[240]: </span><span class="go">'[{"A":1,"B":4,"C":7},{"A":2,"B":5,"C":8},{"A":3,"B":6,"C":9}]'</span>

<span class="gp">In [241]: </span><span class="n">sjo</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s2">"records"</span><span class="p">)</span>
<span class="gh">Out[241]: </span><span class="go">'[15,16,17]'</span>
</pre></div>
</div>
<p><strong>值导向</strong>是一个最简选项，它仅序列化为嵌套的值 JSON 数组，不包含列和索引标签。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [242]: </span><span class="n">dfjo</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s2">"values"</span><span class="p">)</span>
<span class="gh">Out[242]: </span><span class="go">'[[1,4,7],[2,5,8],[3,6,9]]'</span>

<span class="go"># Not available for Series</span>
</pre></div>
</div>
<p><strong>拆分导向</strong>序列化为一个 JSON 对象，其中包含值、索引和列的单独条目。<code class="docutils literal notranslate"><span class="pre">Series</span></code> 也包含名称。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [243]: </span><span class="n">dfjo</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s2">"split"</span><span class="p">)</span>
<span class="gh">Out[243]: </span><span class="go">'{"columns":["A","B","C"],"index":["x","y","z"],"data":[[1,4,7],[2,5,8],[3,6,9]]}'</span>

<span class="gp">In [244]: </span><span class="n">sjo</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s2">"split"</span><span class="p">)</span>
<span class="gh">Out[244]: </span><span class="go">'{"name":"D","index":["x","y","z"],"data":[15,16,17]}'</span>
</pre></div>
</div>
<p><strong>表格导向</strong>序列化为 JSON <a class="reference external" href="https://specs.frictionlessdata.io/table-schema/">Table Schema</a>，允许保留元数据，包括但不限于 dtypes 和索引名称。</p>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p>任何编码为 JSON 对象的 orient 选项在往返序列化期间都不会保留索引和列标签的顺序。如果您希望保留标签顺序，请使用 <code class="docutils literal notranslate"><span class="pre">split</span></code> 选项，因为它使用有序容器。</p>
</div>
</section>
<section id="id1">
<h4>日期处理<a class="headerlink" href="io.html#id1" title="Link to this heading">#</a></h4>
<p>以 ISO 日期格式写入</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [245]: </span><span class="n">dfd</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="s2">"AB"</span><span class="p">))</span>

<span class="gp">In [246]: </span><span class="n">dfd</span><span class="p">[</span><span class="s2">"date"</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">"20130101"</span><span class="p">)</span>

<span class="gp">In [247]: </span><span class="n">dfd</span> <span class="o">=</span> <span class="n">dfd</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="gp">In [248]: </span><span class="n">json</span> <span class="o">=</span> <span class="n">dfd</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">date_format</span><span class="o">=</span><span class="s2">"iso"</span><span class="p">)</span>

<span class="gp">In [249]: </span><span class="n">json</span>
<span class="gh">Out[249]: </span><span class="go">'{"date":{"0":"2013-01-01T00:00:00.000","1":"2013-01-01T00:00:00.000","2":"2013-01-01T00:00:00.000","3":"2013-01-01T00:00:00.000","4":"2013-01-01T00:00:00.000"},"B":{"0":0.403309524,"1":0.3016244523,"2":-1.3698493577,"3":1.4626960492,"4":-0.8265909164},"A":{"0":0.1764443426,"1":-0.1549507744,"2":-2.1798606054,"3":-0.9542078401,"4":-1.7431609117}}'</span>
</pre></div>
</div>
<p>以 ISO 日期格式写入，带微秒</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [250]: </span><span class="n">json</span> <span class="o">=</span> <span class="n">dfd</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">date_format</span><span class="o">=</span><span class="s2">"iso"</span><span class="p">,</span> <span class="n">date_unit</span><span class="o">=</span><span class="s2">"us"</span><span class="p">)</span>

<span class="gp">In [251]: </span><span class="n">json</span>
<span class="gh">Out[251]: </span><span class="go">'{"date":{"0":"2013-01-01T00:00:00.000000","1":"2013-01-01T00:00:00.000000","2":"2013-01-01T00:00:00.000000","3":"2013-01-01T00:00:00.000000","4":"2013-01-01T00:00:00.000000"},"B":{"0":0.403309524,"1":0.3016244523,"2":-1.3698493577,"3":1.4626960492,"4":-0.8265909164},"A":{"0":0.1764443426,"1":-0.1549507744,"2":-2.1798606054,"3":-0.9542078401,"4":-1.7431609117}}'</span>
</pre></div>
</div>
<p>Epoch 时间戳，以秒为单位</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [252]: </span><span class="n">json</span> <span class="o">=</span> <span class="n">dfd</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">date_format</span><span class="o">=</span><span class="s2">"epoch"</span><span class="p">,</span> <span class="n">date_unit</span><span class="o">=</span><span class="s2">"s"</span><span class="p">)</span>

<span class="gp">In [253]: </span><span class="n">json</span>
<span class="gh">Out[253]: </span><span class="go">'{"date":{"0":1,"1":1,"2":1,"3":1,"4":1},"B":{"0":0.403309524,"1":0.3016244523,"2":-1.3698493577,"3":1.4626960492,"4":-0.8265909164},"A":{"0":0.1764443426,"1":-0.1549507744,"2":-2.1798606054,"3":-0.9542078401,"4":-1.7431609117}}'</span>
</pre></div>
</div>
<p>写入文件，带日期索引和日期列</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [254]: </span><span class="n">dfj2</span> <span class="o">=</span> <span class="n">dfj</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="gp">In [255]: </span><span class="n">dfj2</span><span class="p">[</span><span class="s2">"date"</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">"20130101"</span><span class="p">)</span>

<span class="gp">In [256]: </span><span class="n">dfj2</span><span class="p">[</span><span class="s2">"ints"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>

<span class="gp">In [257]: </span><span class="n">dfj2</span><span class="p">[</span><span class="s2">"bools"</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

<span class="gp">In [258]: </span><span class="n">dfj2</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">"20130101"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="gp">In [259]: </span><span class="n">dfj2</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="s2">"test.json"</span><span class="p">)</span>

<span class="gp">In [260]: </span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"test.json"</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
<span class="gp">   .....: </span>    <span class="nb">print</span><span class="p">(</span><span class="n">fh</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
<span class="gp">   .....: </span>
<span class="go">{"A":{"1356998400000":-0.1213062281,"1357084800000":0.6957746499,"1357171200000":0.9597255933,"1357257600000":-0.6199759194,"1357344000000":-0.7323393705},"B":{"1356998400000":-0.0978826728,"1357084800000":0.3417343559,"1357171200000":-1.1103361029,"1357257600000":0.1497483186,"1357344000000":0.6877383895},"date":{"1356998400000":1356,"1357084800000":1356,"1357171200000":1356,"1357257600000":1356,"1357344000000":1356},"ints":{"1356998400000":0,"1357084800000":1,"1357171200000":2,"1357257600000":3,"1357344000000":4},"bools":{"1356998400000":true,"1357084800000":true,"1357171200000":true,"1357257600000":true,"1357344000000":true}}</span>
</pre></div>
</div>
</section>
<section id="fallback-behavior">
<h4>回退行为<a class="headerlink" href="io.html#fallback-behavior" title="Link to this heading">#</a></h4>
<p>如果 JSON 序列化器不能直接处理容器内容，它将以下列方式回退：</p>
<ul>
<li><p>如果 dtype 不受支持（例如 <code class="docutils literal notranslate"><span class="pre">np.complex_</span></code>），则如果提供了 <code class="docutils literal notranslate"><span class="pre">default_handler</span></code>，则将为每个值调用它，否则将引发异常。</p></li>
<li><p>如果对象不受支持，它将尝试以下操作：</p>
<blockquote>
<div><ul class="simple">
<li><p>检查对象是否定义了 <code class="docutils literal notranslate"><span class="pre">toDict</span></code> 方法并调用它。<code class="docutils literal notranslate"><span class="pre">toDict</span></code> 方法应返回一个 <code class="docutils literal notranslate"><span class="pre">dict</span></code>，然后将其 JSON 序列化。</p></li>
<li><p>如果提供了 <code class="docutils literal notranslate"><span class="pre">default_handler</span></code>，则调用它。</p></li>
<li><p>通过遍历其内容将对象转换为 <code class="docutils literal notranslate"><span class="pre">dict</span></code>。但是，这通常会因 <code class="docutils literal notranslate"><span class="pre">OverflowError</span></code> 而失败或给出意外结果。</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<p>通常，对于不支持的对象或 dtype，最好的方法是提供 <code class="docutils literal notranslate"><span class="pre">default_handler</span></code>。例如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">DataFrame</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="nb">complex</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">)])</span><span class="o">.</span><span class="n">to_json</span><span class="p">()</span>  <span class="c1"># raises</span>
<span class="go">RuntimeError: Unhandled numpy dtype 15</span>
</pre></div>
</div>
<p>可以通过指定简单的 <code class="docutils literal notranslate"><span class="pre">default_handler</span></code> 来处理</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [261]: </span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="nb">complex</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">)])</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">default_handler</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
<span class="gh">Out[261]: </span><span class="go">'{"0":{"0":"(1+0j)","1":"(2+0j)","2":"(1+2j)"}}'</span>
</pre></div>
</div>
</section>
</section>
<section id="reading-json">
<span id="io-json-reader"></span><h3>读取 JSON<a class="headerlink" href="io.html#reading-json" title="Link to this heading">#</a></h3>
<p>将 JSON 字符串读取到 pandas 对象可以接受许多参数。如果未提供 <code class="docutils literal notranslate"><span class="pre">typ</span></code> 或其为 <code class="docutils literal notranslate"><span class="pre">None</span></code>，则解析器将尝试解析 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>。要明确强制解析 <code class="docutils literal notranslate"><span class="pre">Series</span></code>，请传递 <code class="docutils literal notranslate"><span class="pre">typ=series</span></code>。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">filepath_or_buffer</span></code>：一个<strong>有效</strong>的 JSON 字符串或文件句柄/StringIO。字符串可以是 URL。有效的 URL 方案包括 http、ftp、S3 和 file。对于文件 URL，需要一个主机。例如，本地文件可以是 file:///path/to/table.json</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">typ</span></code>：要恢复的对象类型（series 或 frame），默认为 'frame'。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">orient</span></code> :</p>
<dl class="simple">
<dt>Series</dt><dd><ul class="simple">
<li><p>默认为 <code class="docutils literal notranslate"><span class="pre">index</span></code></p></li>
<li><p>允许值为 {<code class="docutils literal notranslate"><span class="pre">split</span></code>, <code class="docutils literal notranslate"><span class="pre">records</span></code>, <code class="docutils literal notranslate"><span class="pre">index</span></code>}</p></li>
</ul>
</dd>
<dt>DataFrame</dt><dd><ul class="simple">
<li><p>默认为 <code class="docutils literal notranslate"><span class="pre">columns</span></code></p></li>
<li><p>允许值为 {<code class="docutils literal notranslate"><span class="pre">split</span></code>, <code class="docutils literal notranslate"><span class="pre">records</span></code>, <code class="docutils literal notranslate"><span class="pre">index</span></code>, <code class="docutils literal notranslate"><span class="pre">columns</span></code>, <code class="docutils literal notranslate"><span class="pre">values</span></code>, <code class="docutils literal notranslate"><span class="pre">table</span></code>}</p></li>
</ul>
</dd>
</dl>
<p>JSON 字符串的格式</p>
<table class="table">
<colgroup>
<col style="width: 11.8%" />
<col style="width: 88.2%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">split</span></code></p></td>
<td><p>字典格式：{index -> [index]; columns -> [columns]; data -> [values]}</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">records</span></code></p></td>
<td><p>列表格式：[{column -> value} …]</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">index</span></code></p></td>
<td><p>字典格式：{index -> {column -> value}}</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">columns</span></code></p></td>
<td><p>字典格式：{column -> {index -> value}}</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">values</span></code></p></td>
<td><p>仅值数组</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">table</span></code></p></td>
<td><p>符合 JSON <a class="reference external" href="https://specs.frictionlessdata.io/table-schema/">Table Schema</a></p></td>
</tr>
</tbody>
</table>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">dtype</span></code>：如果为 True，则推断 dtypes；如果为列到 dtype 的字典，则使用这些；如果为 <code class="docutils literal notranslate"><span class="pre">False</span></code>，则完全不推断 dtypes，默认为 True，仅应用于数据。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">convert_axes</span></code>：布尔值，尝试将轴转换为正确的 dtypes，默认为 <code class="docutils literal notranslate"><span class="pre">True</span></code>。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">convert_dates</span></code>：要解析日期的列列表；如果为 <code class="docutils literal notranslate"><span class="pre">True</span></code>，则尝试解析日期类列，默认为 <code class="docutils literal notranslate"><span class="pre">True</span></code>。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">keep_default_dates</span></code>：布尔值，默认为 <code class="docutils literal notranslate"><span class="pre">True</span></code>。如果解析日期，则解析默认的日期类列。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">precise_float</span></code>：布尔值，默认为 <code class="docutils literal notranslate"><span class="pre">False</span></code>。设置为 True 可在将字符串解码为双精度值时使用更高精度 (strtod) 函数。默认值 (<code class="docutils literal notranslate"><span class="pre">False</span></code>) 是使用快速但精度较低的内置功能。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">date_unit</span></code>：字符串，如果转换日期，要检测的时间戳单位。默认为 None。默认情况下将检测时间戳精度，如果不需要，则传递 's'、'ms'、'us' 或 'ns' 之一，以强制时间戳精度为秒、毫秒、微秒或纳秒。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lines</span></code>：将文件读取为每行一个 json 对象。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">encoding</span></code>：用于解码 py3 字节的编码。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">chunksize</span></code>：与 <code class="docutils literal notranslate"><span class="pre">lines=True</span></code> 结合使用时，返回一个 <code class="docutils literal notranslate"><span class="pre">pandas.api.typing.JsonReader</span></code>，它每次迭代读取 <code class="docutils literal notranslate"><span class="pre">chunksize</span></code> 行。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">engine</span></code>：可以是 <code class="docutils literal notranslate"><span class="pre">"ujson"</span></code>（内置 JSON 解析器），也可以是 <code class="docutils literal notranslate"><span class="pre">"pyarrow"</span></code>（分派给 pyarrow 的 <code class="docutils literal notranslate"><span class="pre">pyarrow.json.read_json</span></code>）。<code class="docutils literal notranslate"><span class="pre">"pyarrow"</span></code> 仅在 <code class="docutils literal notranslate"><span class="pre">lines=True</span></code> 时可用。</p></li>
</ul>
<p>如果 JSON 无法解析，解析器将引发 <code class="docutils literal notranslate"><span class="pre">ValueError/TypeError/AssertionError</span></code> 之一。</p>
<p>如果在编码为 JSON 时使用了非默认的 <code class="docutils literal notranslate"><span class="pre">orient</span></code>，请务必在此处传递相同的选项，以便解码产生合理的结果，请参阅 <a class="reference internal" href="io.html#orient-options">Orient 选项</a>以获取概述。</p>
<section id="data-conversion">
<h4>数据转换<a class="headerlink" href="io.html#data-conversion" title="Link to this heading">#</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">convert_axes=True</span></code>、<code class="docutils literal notranslate"><span class="pre">dtype=True</span></code> 和 <code class="docutils literal notranslate"><span class="pre">convert_dates=True</span></code> 的默认设置将尝试将轴和所有数据解析为适当的类型，包括日期。如果您需要覆盖特定的 dtype，请将字典传递给 <code class="docutils literal notranslate"><span class="pre">dtype</span></code>。<code class="docutils literal notranslate"><span class="pre">convert_axes</span></code> 仅当您需要保留轴中的字符串类数字（例如“1”、“2”）时才应设置为 <code class="docutils literal notranslate"><span class="pre">False</span></code>。</p>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p>如果 <code class="docutils literal notranslate"><span class="pre">convert_dates=True</span></code> 且数据和/或列标签看起来像“日期”，则大整数值可能会转换为日期。确切的阈值取决于指定的 <code class="docutils literal notranslate"><span class="pre">date_unit</span></code>。“日期类”表示列标签符合以下条件之一：</p>
<ul class="simple">
<li><p>它以 <code class="docutils literal notranslate"><span class="pre">'_at'</span></code> 结尾</p></li>
<li><p>它以 <code class="docutils literal notranslate"><span class="pre">'_time'</span></code> 结尾</p></li>
<li><p>它以 <code class="docutils literal notranslate"><span class="pre">'timestamp'</span></code> 开头</p></li>
<li><p>它是 <code class="docutils literal notranslate"><span class="pre">'modified'</span></code></p></li>
<li><p>它是 <code class="docutils literal notranslate"><span class="pre">'date'</span></code></p></li>
</ul>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>读取 JSON 数据时，自动强制转换为 dtypes 有一些奇怪之处：</p>
<ul class="simple">
<li><p>索引可以以与序列化不同的顺序重建，即，返回的顺序不保证与序列化之前相同。</p></li>
<li><p>如果可以安全地将 <code class="docutils literal notranslate"><span class="pre">float</span></code> 数据列转换为 <code class="docutils literal notranslate"><span class="pre">integer</span></code>（例如，一列 <code class="docutils literal notranslate"><span class="pre">1.</span></code>），则会进行转换。</p></li>
<li><p>布尔列在重建时将转换为 <code class="docutils literal notranslate"><span class="pre">integer</span></code>。</p></li>
</ul>
<p>因此，有时您可能希望通过 <code class="docutils literal notranslate"><span class="pre">dtype</span></code> 关键字参数指定特定的 dtypes。</p>
</div>
<p>从 JSON 字符串读取</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [262]: </span><span class="kn">from</span><span class="w"> </span><span class="nn">io</span><span class="w"> </span><span class="kn">import</span> <span class="n">StringIO</span>

<span class="gp">In [263]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">json</span><span class="p">))</span>
<span class="gh">Out[263]: </span>
<span class="go">   date         B         A</span>
<span class="go">0     1  0.403310  0.176444</span>
<span class="go">1     1  0.301624 -0.154951</span>
<span class="go">2     1 -1.369849 -2.179861</span>
<span class="go">3     1  1.462696 -0.954208</span>
<span class="go">4     1 -0.826591 -1.743161</span>
</pre></div>
</div>
<p>从文件读取</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [264]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="s2">"test.json"</span><span class="p">)</span>
<span class="gh">Out[264]: </span>
<span class="go">                   A         B  date  ints  bools</span>
<span class="go">2013-01-01 -0.121306 -0.097883  1356     0   True</span>
<span class="go">2013-01-02  0.695775  0.341734  1356     1   True</span>
<span class="go">2013-01-03  0.959726 -1.110336  1356     2   True</span>
<span class="go">2013-01-04 -0.619976  0.149748  1356     3   True</span>
<span class="go">2013-01-05 -0.732339  0.687738  1356     4   True</span>
</pre></div>
</div>
<p>不转换任何数据（但仍转换轴和日期）</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [265]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="s2">"test.json"</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span><span class="o">.</span><span class="n">dtypes</span>
<span class="gh">Out[265]: </span>
<span class="go">A        object</span>
<span class="go">B        object</span>
<span class="go">date     object</span>
<span class="go">ints     object</span>
<span class="go">bools    object</span>
<span class="go">dtype: object</span>
</pre></div>
</div>
<p>为转换指定 dtypes</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [266]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="s2">"test.json"</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="p">{</span><span class="s2">"A"</span><span class="p">:</span> <span class="s2">"float32"</span><span class="p">,</span> <span class="s2">"bools"</span><span class="p">:</span> <span class="s2">"int8"</span><span class="p">})</span><span class="o">.</span><span class="n">dtypes</span>
<span class="gh">Out[266]: </span>
<span class="go">A        float32</span>
<span class="go">B        float64</span>
<span class="go">date       int64</span>
<span class="go">ints       int64</span>
<span class="go">bools       int8</span>
<span class="go">dtype: object</span>
</pre></div>
</div>
<p>保留字符串索引</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [267]: </span><span class="kn">from</span><span class="w"> </span><span class="nn">io</span><span class="w"> </span><span class="kn">import</span> <span class="n">StringIO</span>

<span class="gp">In [268]: </span><span class="n">si</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)),</span> <span class="n">columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)),</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)]</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [269]: </span><span class="n">si</span>
<span class="gh">Out[269]: </span>
<span class="go">     0    1    2    3</span>
<span class="go">0  0.0  0.0  0.0  0.0</span>
<span class="go">1  0.0  0.0  0.0  0.0</span>
<span class="go">2  0.0  0.0  0.0  0.0</span>
<span class="go">3  0.0  0.0  0.0  0.0</span>

<span class="gp">In [270]: </span><span class="n">si</span><span class="o">.</span><span class="n">index</span>
<span class="gh">Out[270]: </span><span class="go">Index(['0', '1', '2', '3'], dtype='object')</span>

<span class="gp">In [271]: </span><span class="n">si</span><span class="o">.</span><span class="n">columns</span>
<span class="gh">Out[271]: </span><span class="go">Index([0, 1, 2, 3], dtype='int64')</span>

<span class="gp">In [272]: </span><span class="n">json</span> <span class="o">=</span> <span class="n">si</span><span class="o">.</span><span class="n">to_json</span><span class="p">()</span>

<span class="gp">In [273]: </span><span class="n">sij</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">json</span><span class="p">),</span> <span class="n">convert_axes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="gp">In [274]: </span><span class="n">sij</span>
<span class="gh">Out[274]: </span>
<span class="go">   0  1  2  3</span>
<span class="go">0  0  0  0  0</span>
<span class="go">1  0  0  0  0</span>
<span class="go">2  0  0  0  0</span>
<span class="go">3  0  0  0  0</span>

<span class="gp">In [275]: </span><span class="n">sij</span><span class="o">.</span><span class="n">index</span>
<span class="gh">Out[275]: </span><span class="go">Index(['0', '1', '2', '3'], dtype='object')</span>

<span class="gp">In [276]: </span><span class="n">sij</span><span class="o">.</span><span class="n">columns</span>
<span class="gh">Out[276]: </span><span class="go">Index(['0', '1', '2', '3'], dtype='object')</span>
</pre></div>
</div>
<p>以纳秒写入的日期需要以纳秒读回</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [277]: </span><span class="kn">from</span><span class="w"> </span><span class="nn">io</span><span class="w"> </span><span class="kn">import</span> <span class="n">StringIO</span>

<span class="gp">In [278]: </span><span class="n">json</span> <span class="o">=</span> <span class="n">dfj2</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">date_unit</span><span class="o">=</span><span class="s2">"ns"</span><span class="p">)</span>

<span class="go"># Try to parse timestamps as milliseconds -&gt; Won't Work</span>
<span class="gp">In [279]: </span><span class="n">dfju</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">json</span><span class="p">),</span> <span class="n">date_unit</span><span class="o">=</span><span class="s2">"ms"</span><span class="p">)</span>

<span class="gp">In [280]: </span><span class="n">dfju</span>
<span class="gh">Out[280]: </span>
<span class="go">                            A         B        date  ints  bools</span>
<span class="go">1356998400000000000 -0.121306 -0.097883  1356998400     0   True</span>
<span class="go">1357084800000000000  0.695775  0.341734  1356998400     1   True</span>
<span class="go">1357171200000000000  0.959726 -1.110336  1356998400     2   True</span>
<span class="go">1357257600000000000 -0.619976  0.149748  1356998400     3   True</span>
<span class="go">1357344000000000000 -0.732339  0.687738  1356998400     4   True</span>

<span class="go"># Let pandas detect the correct precision</span>
<span class="gp">In [281]: </span><span class="n">dfju</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">json</span><span class="p">))</span>

<span class="gp">In [282]: </span><span class="n">dfju</span>
<span class="gh">Out[282]: </span>
<span class="go">                   A         B       date  ints  bools</span>
<span class="go">2013-01-01 -0.121306 -0.097883 2013-01-01     0   True</span>
<span class="go">2013-01-02  0.695775  0.341734 2013-01-01     1   True</span>
<span class="go">2013-01-03  0.959726 -1.110336 2013-01-01     2   True</span>
<span class="go">2013-01-04 -0.619976  0.149748 2013-01-01     3   True</span>
<span class="go">2013-01-05 -0.732339  0.687738 2013-01-01     4   True</span>

<span class="go"># Or specify that all timestamps are in nanoseconds</span>
<span class="gp">In [283]: </span><span class="n">dfju</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">json</span><span class="p">),</span> <span class="n">date_unit</span><span class="o">=</span><span class="s2">"ns"</span><span class="p">)</span>

<span class="gp">In [284]: </span><span class="n">dfju</span>
<span class="gh">Out[284]: </span>
<span class="go">                   A         B        date  ints  bools</span>
<span class="go">2013-01-01 -0.121306 -0.097883  1356998400     0   True</span>
<span class="go">2013-01-02  0.695775  0.341734  1356998400     1   True</span>
<span class="go">2013-01-03  0.959726 -1.110336  1356998400     2   True</span>
<span class="go">2013-01-04 -0.619976  0.149748  1356998400     3   True</span>
<span class="go">2013-01-05 -0.732339  0.687738  1356998400     4   True</span>
</pre></div>
</div>
<p>通过设置 <code class="docutils literal notranslate"><span class="pre">dtype_backend</span></code> 参数，您可以控制生成的 DataFrame 的默认 dtypes。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [285]: </span><span class="n">data</span> <span class="o">=</span> <span class="p">(</span>
<span class="gp">   .....: </span> <span class="s1">'{"a":{"0":1,"1":3},"b":{"0":2.5,"1":4.5},"c":{"0":true,"1":false},"d":{"0":"a","1":"b"},'</span>
<span class="gp">   .....: </span> <span class="s1">'"e":{"0":null,"1":6.0},"f":{"0":null,"1":7.5},"g":{"0":null,"1":true},"h":{"0":null,"1":"a"},'</span>
<span class="gp">   .....: </span> <span class="s1">'"i":{"0":"12-31-2019","1":"12-31-2019"},"j":{"0":null,"1":null}}'</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [286]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">dtype_backend</span><span class="o">=</span><span class="s2">"pyarrow"</span><span class="p">)</span>

<span class="gp">In [287]: </span><span class="n">df</span>
<span class="gh">Out[287]: </span>
<span class="go">   a    b      c  d     e     f     g     h           i     j</span>
<span class="go">0  1  2.5   True  a  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  12-31-2019  None</span>
<span class="go">1  3  4.5  False  b     6   7.5  True     a  12-31-2019  None</span>

<span class="gp">In [288]: </span><span class="n">df</span><span class="o">.</span><span class="n">dtypes</span>
<span class="gh">Out[288]: </span>
<span class="go">a     int64[pyarrow]</span>
<span class="go">b    double[pyarrow]</span>
<span class="go">c      bool[pyarrow]</span>
<span class="go">d    string[pyarrow]</span>
<span class="go">e     int64[pyarrow]</span>
<span class="go">f    double[pyarrow]</span>
<span class="go">g      bool[pyarrow]</span>
<span class="go">h    string[pyarrow]</span>
<span class="go">i    string[pyarrow]</span>
<span class="go">j      null[pyarrow]</span>
<span class="go">dtype: object</span>
</pre></div>
</div>
</section>
</section>
<section id="normalization">
<span id="io-json-normalize"></span><h3>规范化<a class="headerlink" href="io.html#normalization" title="Link to this heading">#</a></h3>
<p>pandas 提供了一个实用函数，可以将字典或字典列表<em>规范化</em>为平面表。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [289]: </span><span class="n">data</span> <span class="o">=</span> <span class="p">[</span>
<span class="gp">   .....: </span>    <span class="p">{</span><span class="s2">"id"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"name"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"first"</span><span class="p">:</span> <span class="s2">"Coleen"</span><span class="p">,</span> <span class="s2">"last"</span><span class="p">:</span> <span class="s2">"Volk"</span><span class="p">}},</span>
<span class="gp">   .....: </span>    <span class="p">{</span><span class="s2">"name"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"given"</span><span class="p">:</span> <span class="s2">"Mark"</span><span class="p">,</span> <span class="s2">"family"</span><span class="p">:</span> <span class="s2">"Regner"</span><span class="p">}},</span>
<span class="gp">   .....: </span>    <span class="p">{</span><span class="s2">"id"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"Faye Raker"</span><span class="p">},</span>
<span class="gp">   .....: </span><span class="p">]</span>
<span class="gp">   .....: </span>

<span class="gp">In [290]: </span><span class="n">pd</span><span class="o">.</span><span class="n">json_normalize</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="gh">Out[290]: </span>
<span class="go">    id name.first name.last name.given name.family        name</span>
<span class="go">0  1.0     Coleen      Volk        NaN         NaN         NaN</span>
<span class="go">1  NaN        NaN       NaN       Mark      Regner         NaN</span>
<span class="go">2  2.0        NaN       NaN        NaN         NaN  Faye Raker</span>
</pre></div>
</div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [291]: </span><span class="n">data</span> <span class="o">=</span> <span class="p">[</span>
<span class="gp">   .....: </span>    <span class="p">{</span>
<span class="gp">   .....: </span>        <span class="s2">"state"</span><span class="p">:</span> <span class="s2">"Florida"</span><span class="p">,</span>
<span class="gp">   .....: </span>        <span class="s2">"shortname"</span><span class="p">:</span> <span class="s2">"FL"</span><span class="p">,</span>
<span class="gp">   .....: </span>        <span class="s2">"info"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"governor"</span><span class="p">:</span> <span class="s2">"Rick Scott"</span><span class="p">},</span>
<span class="gp">   .....: </span>        <span class="s2">"county"</span><span class="p">:</span> <span class="p">[</span>
<span class="gp">   .....: </span>            <span class="p">{</span><span class="s2">"name"</span><span class="p">:</span> <span class="s2">"Dade"</span><span class="p">,</span> <span class="s2">"population"</span><span class="p">:</span> <span class="mi">12345</span><span class="p">},</span>
<span class="gp">   .....: </span>            <span class="p">{</span><span class="s2">"name"</span><span class="p">:</span> <span class="s2">"Broward"</span><span class="p">,</span> <span class="s2">"population"</span><span class="p">:</span> <span class="mi">40000</span><span class="p">},</span>
<span class="gp">   .....: </span>            <span class="p">{</span><span class="s2">"name"</span><span class="p">:</span> <span class="s2">"Palm Beach"</span><span class="p">,</span> <span class="s2">"population"</span><span class="p">:</span> <span class="mi">60000</span><span class="p">},</span>
<span class="gp">   .....: </span>        <span class="p">],</span>
<span class="gp">   .....: </span>    <span class="p">},</span>
<span class="gp">   .....: </span>    <span class="p">{</span>
<span class="gp">   .....: </span>        <span class="s2">"state"</span><span class="p">:</span> <span class="s2">"Ohio"</span><span class="p">,</span>
<span class="gp">   .....: </span>        <span class="s2">"shortname"</span><span class="p">:</span> <span class="s2">"OH"</span><span class="p">,</span>
<span class="gp">   .....: </span>        <span class="s2">"info"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"governor"</span><span class="p">:</span> <span class="s2">"John Kasich"</span><span class="p">},</span>
<span class="gp">   .....: </span>        <span class="s2">"county"</span><span class="p">:</span> <span class="p">[</span>
<span class="gp">   .....: </span>            <span class="p">{</span><span class="s2">"name"</span><span class="p">:</span> <span class="s2">"Summit"</span><span class="p">,</span> <span class="s2">"population"</span><span class="p">:</span> <span class="mi">1234</span><span class="p">},</span>
<span class="gp">   .....: </span>            <span class="p">{</span><span class="s2">"name"</span><span class="p">:</span> <span class="s2">"Cuyahoga"</span><span class="p">,</span> <span class="s2">"population"</span><span class="p">:</span> <span class="mi">1337</span><span class="p">},</span>
<span class="gp">   .....: </span>        <span class="p">],</span>
<span class="gp">   .....: </span>    <span class="p">},</span>
<span class="gp">   .....: </span><span class="p">]</span>
<span class="gp">   .....: </span>

<span class="gp">In [292]: </span><span class="n">pd</span><span class="o">.</span><span class="n">json_normalize</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">"county"</span><span class="p">,</span> <span class="p">[</span><span class="s2">"state"</span><span class="p">,</span> <span class="s2">"shortname"</span><span class="p">,</span> <span class="p">[</span><span class="s2">"info"</span><span class="p">,</span> <span class="s2">"governor"</span><span class="p">]])</span>
<span class="gh">Out[292]: </span>
<span class="go">         name  population    state shortname info.governor</span>
<span class="go">0        Dade       12345  Florida        FL    Rick Scott</span>
<span class="go">1     Broward       40000  Florida        FL    Rick Scott</span>
<span class="go">2  Palm Beach       60000  Florida        FL    Rick Scott</span>
<span class="go">3      Summit        1234     Ohio        OH   John Kasich</span>
<span class="go">4    Cuyahoga        1337     Ohio        OH   John Kasich</span>
</pre></div>
</div>
<p>max_level 参数提供了对规范化结束级别的更多控制。使用 max_level=1，以下代码段将规范化到提供的字典的第一个嵌套级别。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [293]: </span><span class="n">data</span> <span class="o">=</span> <span class="p">[</span>
<span class="gp">   .....: </span>    <span class="p">{</span>
<span class="gp">   .....: </span>        <span class="s2">"CreatedBy"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"Name"</span><span class="p">:</span> <span class="s2">"User001"</span><span class="p">},</span>
<span class="gp">   .....: </span>        <span class="s2">"Lookup"</span><span class="p">:</span> <span class="p">{</span>
<span class="gp">   .....: </span>            <span class="s2">"TextField"</span><span class="p">:</span> <span class="s2">"Some text"</span><span class="p">,</span>
<span class="gp">   .....: </span>            <span class="s2">"UserField"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"Id"</span><span class="p">:</span> <span class="s2">"ID001"</span><span class="p">,</span> <span class="s2">"Name"</span><span class="p">:</span> <span class="s2">"Name001"</span><span class="p">},</span>
<span class="gp">   .....: </span>        <span class="p">},</span>
<span class="gp">   .....: </span>        <span class="s2">"Image"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"a"</span><span class="p">:</span> <span class="s2">"b"</span><span class="p">},</span>
<span class="gp">   .....: </span>    <span class="p">}</span>
<span class="gp">   .....: </span><span class="p">]</span>
<span class="gp">   .....: </span>

<span class="gp">In [294]: </span><span class="n">pd</span><span class="o">.</span><span class="n">json_normalize</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">max_level</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gh">Out[294]: </span>
<span class="go">  CreatedBy.Name Lookup.TextField                    Lookup.UserField Image.a</span>
<span class="go">0        User001        Some text  {'Id': 'ID001', 'Name': 'Name001'}       b</span>
</pre></div>
</div>
</section>
<section id="line-delimited-json">
<span id="io-jsonl"></span><h3>行分隔 JSON<a class="headerlink" href="io.html#line-delimited-json" title="Link to this heading">#</a></h3>
<p>pandas 能够读取和写入在 Hadoop 或 Spark 数据处理管道中常见的行分隔 JSON 文件。</p>
<p>对于行分隔 JSON 文件，pandas 还可以返回一个迭代器，每次读取 <code class="docutils literal notranslate"><span class="pre">chunksize</span></code> 行。这对于大型文件或从流中读取非常有用。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [295]: </span><span class="kn">from</span><span class="w"> </span><span class="nn">io</span><span class="w"> </span><span class="kn">import</span> <span class="n">StringIO</span>

<span class="gp">In [296]: </span><span class="n">jsonl</span> <span class="o">=</span> <span class="s2">"""</span>
<span class="gp">   .....: </span><span class="s2">    {"a": 1, "b": 2}</span>
<span class="gp">   .....: </span><span class="s2">    {"a": 3, "b": 4}</span>
<span class="gp">   .....: </span><span class="s2">"""</span>
<span class="gp">   .....: </span>

<span class="gp">In [297]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">jsonl</span><span class="p">),</span> <span class="n">lines</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="gp">In [298]: </span><span class="n">df</span>
<span class="gh">Out[298]: </span>
<span class="go">   a  b</span>
<span class="go">0  1  2</span>
<span class="go">1  3  4</span>

<span class="gp">In [299]: </span><span class="n">df</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s2">"records"</span><span class="p">,</span> <span class="n">lines</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gh">Out[299]: </span><span class="go">'{"a":1,"b":2}\n{"a":3,"b":4}\n'</span>

<span class="go"># reader is an iterator that returns ``chunksize`` lines each iteration</span>
<span class="gp">In [300]: </span><span class="k">with</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">jsonl</span><span class="p">),</span> <span class="n">lines</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="k">as</span> <span class="n">reader</span><span class="p">:</span>
<span class="gp">   .....: </span>    <span class="n">reader</span>
<span class="gp">   .....: </span>    <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">:</span>
<span class="gp">   .....: </span>        <span class="nb">print</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
<span class="gp">   .....: </span>
<span class="go">Empty DataFrame</span>
<span class="go">Columns: []</span>
<span class="go">Index: []</span>
<span class="go">   a  b</span>
<span class="go">0  1  2</span>
<span class="go">   a  b</span>
<span class="go">1  3  4</span>
</pre></div>
</div>
<p>也可以使用 pyarrow 读取器通过指定 <code class="docutils literal notranslate"><span class="pre">engine="pyarrow"</span></code> 来读取行分隔 JSON。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [301]: </span><span class="kn">from</span><span class="w"> </span><span class="nn">io</span><span class="w"> </span><span class="kn">import</span> <span class="n">BytesIO</span>

<span class="gp">In [302]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">jsonl</span><span class="o">.</span><span class="n">encode</span><span class="p">()),</span> <span class="n">lines</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">"pyarrow"</span><span class="p">)</span>

<span class="gp">In [303]: </span><span class="n">df</span>
<span class="gh">Out[303]: </span>
<span class="go">   a  b</span>
<span class="go">0  1  2</span>
<span class="go">1  3  4</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">2.0.0 版新增。</span></p>
</div>
</section>
<section id="table-schema">
<span id="io-table-schema"></span><h3>表模式<a class="headerlink" href="io.html#table-schema" title="Link to this heading">#</a></h3>
<p><a class="reference external" href="https://specs.frictionlessdata.io/table-schema/">Table Schema</a> 是一种将表格数据集描述为 JSON 对象的规范。JSON 包含字段名称、类型和其他属性的信息。您可以使用 orient <code class="docutils literal notranslate"><span class="pre">table</span></code> 来构建一个包含两个字段 <code class="docutils literal notranslate"><span class="pre">schema</span></code> 和 <code class="docutils literal notranslate"><span class="pre">data</span></code> 的 JSON 字符串。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [304]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="p">{</span>
<span class="gp">   .....: </span>        <span class="s2">"A"</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
<span class="gp">   .....: </span>        <span class="s2">"B"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">,</span> <span class="s2">"c"</span><span class="p">],</span>
<span class="gp">   .....: </span>        <span class="s2">"C"</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">"2016-01-01"</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"d"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
<span class="gp">   .....: </span>    <span class="p">},</span>
<span class="gp">   .....: </span>    <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">"idx"</span><span class="p">),</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [305]: </span><span class="n">df</span>
<span class="gh">Out[305]: </span>
<span class="go">     A  B          C</span>
<span class="go">idx                 </span>
<span class="go">0    1  a 2016-01-01</span>
<span class="go">1    2  b 2016-01-02</span>
<span class="go">2    3  c 2016-01-03</span>

<span class="gp">In [306]: </span><span class="n">df</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s2">"table"</span><span class="p">,</span> <span class="n">date_format</span><span class="o">=</span><span class="s2">"iso"</span><span class="p">)</span>
<span class="gh">Out[306]: </span><span class="go">'{"schema":{"fields":[{"name":"idx","type":"integer"},{"name":"A","type":"integer"},{"name":"B","type":"string"},{"name":"C","type":"datetime"}],"primaryKey":["idx"],"pandas_version":"1.4.0"},"data":[{"idx":0,"A":1,"B":"a","C":"2016-01-01T00:00:00.000"},{"idx":1,"A":2,"B":"b","C":"2016-01-02T00:00:00.000"},{"idx":2,"A":3,"B":"c","C":"2016-01-03T00:00:00.000"}]}'</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">schema</span></code> 字段包含 <code class="docutils literal notranslate"><span class="pre">fields</span></code> 键，它本身包含一个列名到类型对的列表，包括 <code class="docutils literal notranslate"><span class="pre">Index</span></code> 或 <code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code>（有关类型列表，请参见下文）。如果 (Multi)index 是唯一的，则 <code class="docutils literal notranslate"><span class="pre">schema</span></code> 字段还包含一个 <code class="docutils literal notranslate"><span class="pre">primaryKey</span></code> 字段。</p>
<p>第二个字段 <code class="docutils literal notranslate"><span class="pre">data</span></code> 包含带有 <code class="docutils literal notranslate"><span class="pre">records</span></code> orient 的序列化数据。索引包含在内，并且所有日期时间都以 ISO 8601 格式化，正如 Table Schema 规范所要求的那样。</p>
<p>支持的类型完整列表在 Table Schema 规范中描述。此表显示了从 pandas 类型到 Table Schema 类型的映射：</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>pandas 类型</p></th>
<th class="head"><p>Table Schema 类型</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>int64</p></td>
<td><p>integer</p></td>
</tr>
<tr class="row-odd"><td><p>float64</p></td>
<td><p>number</p></td>
</tr>
<tr class="row-even"><td><p>bool</p></td>
<td><p>boolean</p></td>
</tr>
<tr class="row-odd"><td><p>datetime64[ns]</p></td>
<td><p>datetime</p></td>
</tr>
<tr class="row-even"><td><p>timedelta64[ns]</p></td>
<td><p>duration</p></td>
</tr>
<tr class="row-odd"><td><p>categorical</p></td>
<td><p>any</p></td>
</tr>
<tr class="row-even"><td><p>object</p></td>
<td><p>str</p></td>
</tr>
</tbody>
</table>
<p>关于生成的表模式的一些注意事项：</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">schema</span></code> 对象包含一个 <code class="docutils literal notranslate"><span class="pre">pandas_version</span></code> 字段。这包含 pandas 方言的模式版本，并将随着每次修订而增加。</p></li>
<li><p>所有日期在序列化时都转换为 UTC。即使是时区无关的值，也会被视为 UTC，偏移量为 0。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [307]: </span><span class="kn">from</span><span class="w"> </span><span class="nn">pandas.io.json</span><span class="w"> </span><span class="kn">import</span> <span class="n">build_table_schema</span>

<span class="gp">In [308]: </span><span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">"2016"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>

<span class="gp">In [309]: </span><span class="n">build_table_schema</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="gh">Out[309]: </span>
<span class="go">{'fields': [{'name': 'index', 'type': 'integer'},</span>
<span class="go">  {'name': 'values', 'type': 'datetime'}],</span>
<span class="go"> 'primaryKey': ['index'],</span>
<span class="go"> 'pandas_version': '1.4.0'}</span>
</pre></div>
</div>
</li>
<li><p>带有时区（序列化之前）的日期时间，包含一个额外的字段 <code class="docutils literal notranslate"><span class="pre">tz</span></code>，其中包含时区名称（例如 <code class="docutils literal notranslate"><span class="pre">'US/Central'</span></code>）。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [310]: </span><span class="n">s_tz</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">"2016"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s2">"US/Central"</span><span class="p">))</span>

<span class="gp">In [311]: </span><span class="n">build_table_schema</span><span class="p">(</span><span class="n">s_tz</span><span class="p">)</span>
<span class="gh">Out[311]: </span>
<span class="go">{'fields': [{'name': 'index', 'type': 'integer'},</span>
<span class="go">  {'name': 'values', 'type': 'datetime', 'tz': 'US/Central'}],</span>
<span class="go"> 'primaryKey': ['index'],</span>
<span class="go"> 'pandas_version': '1.4.0'}</span>
</pre></div>
</div>
</li>
<li><p>周期在序列化之前转换为时间戳，因此具有与转换为 UTC 相同的行为。此外，周期将包含一个额外的字段 <code class="docutils literal notranslate"><span class="pre">freq</span></code>，其中包含周期的频率，例如 <code class="docutils literal notranslate"><span class="pre">'A-DEC'</span></code>。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [312]: </span><span class="n">s_per</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">period_range</span><span class="p">(</span><span class="s2">"2016"</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"Y-DEC"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>

<span class="gp">In [313]: </span><span class="n">build_table_schema</span><span class="p">(</span><span class="n">s_per</span><span class="p">)</span>
<span class="gh">Out[313]: </span>
<span class="go">{'fields': [{'name': 'index', 'type': 'datetime', 'freq': 'YE-DEC'},</span>
<span class="go">  {'name': 'values', 'type': 'integer'}],</span>
<span class="go"> 'primaryKey': ['index'],</span>
<span class="go"> 'pandas_version': '1.4.0'}</span>
</pre></div>
</div>
</li>
<li><p>Categoricals 使用 <code class="docutils literal notranslate"><span class="pre">any</span></code> 类型和一个 <code class="docutils literal notranslate"><span class="pre">enum</span></code> 约束，列出所有可能的值。此外，还包含一个 <code class="docutils literal notranslate"><span class="pre">ordered</span></code> 字段。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [314]: </span><span class="n">s_cat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">([</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">,</span> <span class="s2">"a"</span><span class="p">]))</span>

<span class="gp">In [315]: </span><span class="n">build_table_schema</span><span class="p">(</span><span class="n">s_cat</span><span class="p">)</span>
<span class="gh">Out[315]: </span>
<span class="go">{'fields': [{'name': 'index', 'type': 'integer'},</span>
<span class="go">  {'name': 'values',</span>
<span class="go">   'type': 'any',</span>
<span class="go">   'constraints': {'enum': ['a', 'b']},</span>
<span class="go">   'ordered': False}],</span>
<span class="go"> 'primaryKey': ['index'],</span>
<span class="go"> 'pandas_version': '1.4.0'}</span>
</pre></div>
</div>
</li>
<li><p>如果索引是唯一的，则包含一个 <code class="docutils literal notranslate"><span class="pre">primaryKey</span></code> 字段，其中包含一个标签数组。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [316]: </span><span class="n">s_dupe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

<span class="gp">In [317]: </span><span class="n">build_table_schema</span><span class="p">(</span><span class="n">s_dupe</span><span class="p">)</span>
<span class="gh">Out[317]: </span>
<span class="go">{'fields': [{'name': 'index', 'type': 'integer'},</span>
<span class="go">  {'name': 'values', 'type': 'integer'}],</span>
<span class="go"> 'pandas_version': '1.4.0'}</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">primaryKey</span></code> 的行为与 MultiIndexes 相同，但在这种情况下，<code class="docutils literal notranslate"><span class="pre">primaryKey</span></code> 是一个数组。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [318]: </span><span class="n">s_multi</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_product</span><span class="p">([(</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]))</span>

<span class="gp">In [319]: </span><span class="n">build_table_schema</span><span class="p">(</span><span class="n">s_multi</span><span class="p">)</span>
<span class="gh">Out[319]: </span>
<span class="go">{'fields': [{'name': 'level_0', 'type': 'string'},</span>
<span class="go">  {'name': 'level_1', 'type': 'integer'},</span>
<span class="go">  {'name': 'values', 'type': 'integer'}],</span>
<span class="go"> 'primaryKey': FrozenList(['level_0', 'level_1']),</span>
<span class="go"> 'pandas_version': '1.4.0'}</span>
</pre></div>
</div>
</li>
<li><p>默认命名大致遵循以下规则：</p>
<blockquote>
<div><ul class="simple">
<li><p>对于 Series，使用 <code class="docutils literal notranslate"><span class="pre">object.name</span></code>。如果为 None，则名称为 <code class="docutils literal notranslate"><span class="pre">values</span></code>。</p></li>
<li><p>对于 <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code>，使用列名的字符串化版本。</p></li>
<li><p>对于 <code class="docutils literal notranslate"><span class="pre">Index</span></code>（不是 <code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code>），使用 <code class="docutils literal notranslate"><span class="pre">index.name</span></code>，如果为 None 则回退到 <code class="docutils literal notranslate"><span class="pre">index</span></code>。</p></li>
<li><p>对于 <code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code>，使用 <code class="docutils literal notranslate"><span class="pre">mi.names</span></code>。如果任何级别没有名称，则使用 <code class="docutils literal notranslate"><span class="pre">level_&lt;i&gt;</span></code>。</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">read_json</span></code> 也接受 <code class="docutils literal notranslate"><span class="pre">orient='table'</span></code> 作为参数。这允许以可往返的方式保留元数据，例如 dtypes 和索引名称。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [320]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="p">{</span>
<span class="gp">   .....: </span>        <span class="s2">"foo"</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
<span class="gp">   .....: </span>        <span class="s2">"bar"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">,</span> <span class="s2">"c"</span><span class="p">,</span> <span class="s2">"d"</span><span class="p">],</span>
<span class="gp">   .....: </span>        <span class="s2">"baz"</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">"2018-01-01"</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"d"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span>
<span class="gp">   .....: </span>        <span class="s2">"qux"</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">([</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">,</span> <span class="s2">"c"</span><span class="p">,</span> <span class="s2">"c"</span><span class="p">]),</span>
<span class="gp">   .....: </span>    <span class="p">},</span>
<span class="gp">   .....: </span>    <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">"idx"</span><span class="p">),</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [321]: </span><span class="n">df</span>
<span class="gh">Out[321]: </span>
<span class="go">     foo bar        baz qux</span>
<span class="go">idx                        </span>
<span class="go">0      1   a 2018-01-01   a</span>
<span class="go">1      2   b 2018-01-02   b</span>
<span class="go">2      3   c 2018-01-03   c</span>
<span class="go">3      4   d 2018-01-04   c</span>

<span class="gp">In [322]: </span><span class="n">df</span><span class="o">.</span><span class="n">dtypes</span>
<span class="gh">Out[322]: </span>
<span class="go">foo             int64</span>
<span class="go">bar            object</span>
<span class="go">baz    datetime64[ns]</span>
<span class="go">qux          category</span>
<span class="go">dtype: object</span>

<span class="gp">In [323]: </span><span class="n">df</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="s2">"test.json"</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s2">"table"</span><span class="p">)</span>

<span class="gp">In [324]: </span><span class="n">new_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="s2">"test.json"</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s2">"table"</span><span class="p">)</span>

<span class="gp">In [325]: </span><span class="n">new_df</span>
<span class="gh">Out[325]: </span>
<span class="go">     foo bar        baz qux</span>
<span class="go">idx                        </span>
<span class="go">0      1   a 2018-01-01   a</span>
<span class="go">1      2   b 2018-01-02   b</span>
<span class="go">2      3   c 2018-01-03   c</span>
<span class="go">3      4   d 2018-01-04   c</span>

<span class="gp">In [326]: </span><span class="n">new_df</span><span class="o">.</span><span class="n">dtypes</span>
<span class="gh">Out[326]: </span>
<span class="go">foo             int64</span>
<span class="go">bar            object</span>
<span class="go">baz    datetime64[ns]</span>
<span class="go">qux          category</span>
<span class="go">dtype: object</span>
</pre></div>
</div>
<p>请注意，字面字符串“index”作为 <a class="reference internal" href="../reference/api/pandas.Index.html#pandas.Index" title="pandas.Index"><code class="xref py py-class docutils literal notranslate"><span class="pre">Index</span></code></a> 的名称不可往返，<a class="reference internal" href="../reference/api/pandas.MultiIndex.html#pandas.MultiIndex" title="pandas.MultiIndex"><code class="xref py py-class docutils literal notranslate"><span class="pre">MultiIndex</span></code></a> 中任何以 <code class="docutils literal notranslate"><span class="pre">'level_'</span></code> 开头的名称也不可往返。它们被 <a class="reference internal" href="../reference/api/pandas.DataFrame.to_json.html#pandas.DataFrame.to_json" title="pandas.DataFrame.to_json"><code class="xref py py-func docutils literal notranslate"><span class="pre">DataFrame.to_json()</span></code></a> 默认用于表示缺失值，后续读取无法区分其意图。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [327]: </span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">"index"</span>

<span class="gp">In [328]: </span><span class="n">df</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="s2">"test.json"</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s2">"table"</span><span class="p">)</span>

<span class="gp">In [329]: </span><span class="n">new_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="s2">"test.json"</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s2">"table"</span><span class="p">)</span>

<span class="gp">In [330]: </span><span class="nb">print</span><span class="p">(</span><span class="n">new_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="go">None</span>
</pre></div>
</div>
<p>当使用 <code class="docutils literal notranslate"><span class="pre">orient='table'</span></code> 以及用户定义的 <code class="docutils literal notranslate"><span class="pre">ExtensionArray</span></code> 时，生成的模式将在相应的 <code class="docutils literal notranslate"><span class="pre">fields</span></code> 元素中包含一个额外的 <code class="docutils literal notranslate"><span class="pre">extDtype</span></code> 键。这个额外的键不是标准键，但它确实能够为扩展类型进行 JSON 往返（例如 <code class="docutils literal notranslate"><span class="pre">read_json(df.to_json(orient="table"),</span> <span class="pre">orient="table")</span></code>）。</p>
<p><code class="docutils literal notranslate"><span class="pre">extDtype</span></code> 键带有扩展的名称，如果您已正确注册 <code class="docutils literal notranslate"><span class="pre">ExtensionDtype</span></code>，pandas 将使用该名称在注册表中查找并将其序列化数据重新转换为您的自定义 dtype。</p>
</section>
</section>
<section id="html">
<h2>HTML<a class="headerlink" href="io.html#html" title="Link to this heading">#</a></h2>
<section id="reading-html-content">
<span id="io-read-html"></span><h3>读取 HTML 内容<a class="headerlink" href="io.html#reading-html-content" title="Link to this heading">#</a></h3>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>我们<strong>强烈建议</strong>您阅读下面的<a class="reference internal" href="io.html#io-html-gotchas"><span class="std std-ref">HTML 表格解析陷阱</span></a>，了解 BeautifulSoup4/html5lib/lxml 解析器相关的问题。</p>
</div>
<p>顶层函数 <code class="xref py py-func docutils literal notranslate"><span class="pre">read_html()</span></code> 可以接受 HTML 字符串/文件/URL，并将 HTML 表格解析为 pandas <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code> 列表。我们来看几个例子。</p>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p><code class="docutils literal notranslate"><span class="pre">read_html</span></code> 返回一个 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> 对象列表，即使 HTML 内容中只包含一个表格。</p>
</div>
<p>不带任何选项读取 URL</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [320]: </span><span class="n">url</span> <span class="o">=</span> <span class="s2">"https://www.fdic.gov/resources/resolutions/bank-failures/failed-bank-list"</span>
<span class="gp">In [321]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="gh">Out[321]:</span>
<span class="go">[                         Bank NameBank           CityCity StateSt  ...              Acquiring InstitutionAI Closing DateClosing FundFund</span>
<span class="go"> 0                    Almena State Bank             Almena      KS  ...                          Equity Bank    October 23, 2020    10538</span>
<span class="go"> 1           First City Bank of Florida  Fort Walton Beach      FL  ...            United Fidelity Bank, fsb    October 16, 2020    10537</span>
<span class="go"> 2                 The First State Bank      Barboursville      WV  ...                       MVB Bank, Inc.       April 3, 2020    10536</span>
<span class="go"> 3                   Ericson State Bank            Ericson      NE  ...           Farmers and Merchants Bank   February 14, 2020    10535</span>
<span class="go"> 4     City National Bank of New Jersey             Newark      NJ  ...                      Industrial Bank    November 1, 2019    10534</span>
<span class="go"> ..                                 ...                ...     ...  ...                                  ...                 ...      ...</span>
<span class="go"> 558                 Superior Bank, FSB           Hinsdale      IL  ...                Superior Federal, FSB       July 27, 2001     6004</span>
<span class="go"> 559                Malta National Bank              Malta      OH  ...                    North Valley Bank         May 3, 2001     4648</span>
<span class="go"> 560    First Alliance Bank &amp; Trust Co.         Manchester      NH  ...  Southern New Hampshire Bank &amp; Trust    February 2, 2001     4647</span>
<span class="go"> 561  National State Bank of Metropolis         Metropolis      IL  ...              Banterra Bank of Marion   December 14, 2000     4646</span>
<span class="go"> 562                   Bank of Honolulu           Honolulu      HI  ...                   Bank of the Orient    October 13, 2000     4645</span>

<span class="go"> [563 rows x 7 columns]]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p>上述 URL 的数据每周一都会更改，因此上述结果数据可能略有不同。</p>
</div>
<p>读取 URL 时随 HTTP 请求传递标头</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [322]: </span><span class="n">url</span> <span class="o">=</span> <span class="s1">'https://www.sump.org/notes/request/'</span> <span class="c1"># HTTP request reflector</span>
<span class="gp">In [323]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="gh">Out[323]:</span>
<span class="go">[                   0                    1</span>
<span class="go"> 0     Remote Socket:  51.15.105.256:51760</span>
<span class="go"> 1  Protocol Version:             HTTP/1.1</span>
<span class="go"> 2    Request Method:                  GET</span>
<span class="go"> 3       Request URI:      /notes/request/</span>
<span class="go"> 4     Request Query:                  NaN,</span>
<span class="go"> 0   Accept-Encoding:             identity</span>
<span class="go"> 1              Host:         www.sump.org</span>
<span class="go"> 2        User-Agent:    Python-urllib/3.8</span>
<span class="go"> 3        Connection:                close]</span>
<span class="gp">In [324]: </span><span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">In [325]: </span>   <span class="s1">'User-Agent'</span><span class="p">:</span><span class="s1">'Mozilla Firefox v14.0'</span><span class="p">,</span>
<span class="gp">In [326]: </span>   <span class="s1">'Accept'</span><span class="p">:</span><span class="s1">'application/json'</span><span class="p">,</span>
<span class="gp">In [327]: </span>   <span class="s1">'Connection'</span><span class="p">:</span><span class="s1">'keep-alive'</span><span class="p">,</span>
<span class="gp">In [328]: </span>   <span class="s1">'Auth'</span><span class="p">:</span><span class="s1">'Bearer 2*/f3+fe68df*4'</span>
<span class="gp">In [329]: </span><span class="p">}</span>
<span class="gp">In [340]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">storage_options</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
<span class="gh">Out[340]:</span>
<span class="go">[                   0                    1</span>
<span class="go"> 0     Remote Socket:  51.15.105.256:51760</span>
<span class="go"> 1  Protocol Version:             HTTP/1.1</span>
<span class="go"> 2    Request Method:                  GET</span>
<span class="go"> 3       Request URI:      /notes/request/</span>
<span class="go"> 4     Request Query:                  NaN,</span>
<span class="go"> 0        User-Agent: Mozilla Firefox v14.0</span>
<span class="go"> 1    AcceptEncoding:   gzip,  deflate,  br</span>
<span class="go"> 2            Accept:      application/json</span>
<span class="go"> 3        Connection:             keep-alive</span>
<span class="go"> 4              Auth:  Bearer 2*/f3+fe68df*4]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p>我们看到上面我们传递的标头反映在 HTTP 请求中。</p>
</div>
<p>读取上述 URL 文件内容并将其作为字符串传递给 <code class="docutils literal notranslate"><span class="pre">read_html</span></code></p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [331]: </span><span class="n">html_str</span> <span class="o">=</span> <span class="s2">"""</span>
<span class="gp">   .....: </span><span class="s2">         &lt;table&gt;</span>
<span class="gp">   .....: </span><span class="s2">             &lt;tr&gt;</span>
<span class="gp">   .....: </span><span class="s2">                 &lt;th&gt;A&lt;/th&gt;</span>
<span class="gp">   .....: </span><span class="s2">                 &lt;th colspan="1"&gt;B&lt;/th&gt;</span>
<span class="gp">   .....: </span><span class="s2">                 &lt;th rowspan="1"&gt;C&lt;/th&gt;</span>
<span class="gp">   .....: </span><span class="s2">             &lt;/tr&gt;</span>
<span class="gp">   .....: </span><span class="s2">             &lt;tr&gt;</span>
<span class="gp">   .....: </span><span class="s2">                 &lt;td&gt;a&lt;/td&gt;</span>
<span class="gp">   .....: </span><span class="s2">                 &lt;td&gt;b&lt;/td&gt;</span>
<span class="gp">   .....: </span><span class="s2">                 &lt;td&gt;c&lt;/td&gt;</span>
<span class="gp">   .....: </span><span class="s2">             &lt;/tr&gt;</span>
<span class="gp">   .....: </span><span class="s2">         &lt;/table&gt;</span>
<span class="gp">   .....: </span><span class="s2">     """</span>
<span class="gp">   .....: </span>

<span class="gp">In [332]: </span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"tmp.html"</span><span class="p">,</span> <span class="s2">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="gp">   .....: </span>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">html_str</span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [333]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="s2">"tmp.html"</span><span class="p">)</span>

<span class="gp">In [334]: </span><span class="n">df</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gh">Out[334]: </span>
<span class="go">   A  B  C</span>
<span class="go">0  a  b  c</span>
</pre></div>
</div>
<p>如果您愿意，甚至可以传入 <code class="docutils literal notranslate"><span class="pre">StringIO</span></code> 的实例</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [335]: </span><span class="n">dfs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">html_str</span><span class="p">))</span>

<span class="gp">In [336]: </span><span class="n">dfs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gh">Out[336]: </span>
<span class="go">   A  B  C</span>
<span class="go">0  a  b  c</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p>以下示例未由 IPython 评估器运行，因为有太多网络访问功能会减慢文档构建速度。如果您发现错误或示例无法运行，请随时在 <a class="reference external" href="https://github.com/pandas-dev/pandas/issues">pandas GitHub issues 页面</a>上报告。</p>
</div>
<p>读取 URL 并匹配包含特定文本的表格</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">match</span> <span class="o">=</span> <span class="s2">"Metcalf Bank"</span>
<span class="n">df_list</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="n">match</span><span class="p">)</span>
</pre></div>
</div>
<p>指定一个标题行（默认情况下，<code class="docutils literal notranslate"><span class="pre">&lt;thead&gt;</span></code> 内的 <code class="docutils literal notranslate"><span class="pre">&lt;th&gt;</span></code> 或 <code class="docutils literal notranslate"><span class="pre">&lt;td&gt;</span></code> 元素用于形成列索引；如果 <code class="docutils literal notranslate"><span class="pre">&lt;thead&gt;</span></code> 包含多行，则创建 MultiIndex）；如果指定，标题行取自数据减去已解析的标题元素（<code class="docutils literal notranslate"><span class="pre">&lt;th&gt;</span></code> 元素）。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dfs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>指定索引列</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dfs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>指定要跳过的行数</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dfs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>使用列表指定要跳过的行数（<code class="docutils literal notranslate"><span class="pre">range</span></code> 也适用）</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dfs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
<p>指定 HTML 属性</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dfs1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s2">"id"</span><span class="p">:</span> <span class="s2">"table"</span><span class="p">})</span>
<span class="n">dfs2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s2">"class"</span><span class="p">:</span> <span class="s2">"sortable"</span><span class="p">})</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">dfs1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dfs2</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>  <span class="c1"># Should be True</span>
</pre></div>
</div>
<p>指定应转换为 NaN 的值</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dfs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">na_values</span><span class="o">=</span><span class="p">[</span><span class="s2">"No Acquirer"</span><span class="p">])</span>
</pre></div>
</div>
<p>指定是否保留默认的 NaN 值集</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dfs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">keep_default_na</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>指定列的转换器。这对于带有前导零的数值文本数据非常有用。默认情况下，数值列会转换为数值类型，并且前导零会丢失。为了避免这种情况，我们可以将这些列转换为字符串。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">url_mcc</span> <span class="o">=</span> <span class="s2">"https://en.wikipedia.org/wiki/Mobile_country_code?oldid=899173761"</span>
<span class="n">dfs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span>
    <span class="n">url_mcc</span><span class="p">,</span>
    <span class="n">match</span><span class="o">=</span><span class="s2">"Telekom Albania"</span><span class="p">,</span>
    <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">converters</span><span class="o">=</span><span class="p">{</span><span class="s2">"MNC"</span><span class="p">:</span> <span class="nb">str</span><span class="p">},</span>
<span class="p">)</span>
</pre></div>
</div>
<p>使用上述某些组合</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dfs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">"Metcalf Bank"</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>读取 pandas <code class="docutils literal notranslate"><span class="pre">to_html</span></code> 输出（浮点精度有所损失）</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">float_format</span><span class="o">=</span><span class="s2">"</span><span class="si">{0:.40g}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">)</span>
<span class="n">dfin</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>如果 <code class="docutils literal notranslate"><span class="pre">lxml</span></code> 后端是您提供的唯一解析器，则它将在解析失败时引发错误。如果您只有一个解析器，则可以只提供一个字符串，但通常建议传递一个包含一个字符串的列表，例如，如果函数期望字符串序列。您可以使用：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dfs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s2">"Metcalf Bank"</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">flavor</span><span class="o">=</span><span class="p">[</span><span class="s2">"lxml"</span><span class="p">])</span>
</pre></div>
</div>
<p>或者您可以不带列表地传递 <code class="docutils literal notranslate"><span class="pre">flavor='lxml'</span></code>。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dfs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s2">"Metcalf Bank"</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">flavor</span><span class="o">=</span><span class="s2">"lxml"</span><span class="p">)</span>
</pre></div>
</div>
<p>然而，如果您安装了 bs4 和 html5lib 并传递 <code class="docutils literal notranslate"><span class="pre">None</span></code> 或 <code class="docutils literal notranslate"><span class="pre">['lxml',</span> <span class="pre">'bs4']</span></code>，那么解析很可能会成功。请注意，<em>一旦解析成功，函数将立即返回</em>。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dfs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s2">"Metcalf Bank"</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">flavor</span><span class="o">=</span><span class="p">[</span><span class="s2">"lxml"</span><span class="p">,</span> <span class="s2">"bs4"</span><span class="p">])</span>
</pre></div>
</div>
<p>可以使用 <code class="docutils literal notranslate"><span class="pre">extract_links="all"</span></code> 从单元格中提取链接以及文本。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [337]: </span><span class="n">html_table</span> <span class="o">=</span> <span class="s2">"""</span>
<span class="gp">   .....: </span><span class="s2">&lt;table&gt;</span>
<span class="gp">   .....: </span><span class="s2">  &lt;tr&gt;</span>
<span class="gp">   .....: </span><span class="s2">    &lt;th&gt;GitHub&lt;/th&gt;</span>
<span class="gp">   .....: </span><span class="s2">  &lt;/tr&gt;</span>
<span class="gp">   .....: </span><span class="s2">  &lt;tr&gt;</span>
<span class="gp">   .....: </span><span class="s2">    &lt;td&gt;&lt;a href="https://github.com/pandas-dev/pandas"&gt;pandas&lt;/a&gt;&lt;/td&gt;</span>
<span class="gp">   .....: </span><span class="s2">  &lt;/tr&gt;</span>
<span class="gp">   .....: </span><span class="s2">&lt;/table&gt;</span>
<span class="gp">   .....: </span><span class="s2">"""</span>
<span class="gp">   .....: </span>

<span class="gp">In [338]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="n">StringIO</span><span class="p">(</span><span class="n">html_table</span><span class="p">),</span>
<span class="gp">   .....: </span>    <span class="n">extract_links</span><span class="o">=</span><span class="s2">"all"</span>
<span class="gp">   .....: </span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">   .....: </span>

<span class="gp">In [339]: </span><span class="n">df</span>
<span class="gh">Out[339]: </span>
<span class="go">                                   (GitHub, None)</span>
<span class="go">0  (pandas, https://github.com/pandas-dev/pandas)</span>

<span class="gp">In [340]: </span><span class="n">df</span><span class="p">[(</span><span class="s2">"GitHub"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)]</span>
<span class="gh">Out[340]: </span>
<span class="go">0    (pandas, https://github.com/pandas-dev/pandas)</span>
<span class="go">Name: (GitHub, None), dtype: object</span>

<span class="gp">In [341]: </span><span class="n">df</span><span class="p">[(</span><span class="s2">"GitHub"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)]</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="gh">Out[341]: </span>
<span class="go">0    https://github.com/pandas-dev/pandas</span>
<span class="go">Name: (GitHub, None), dtype: object</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">1.5.0 版本新增。</span></p>
</div>
</section>
<section id="writing-to-html-files">
<span id="io-html"></span><h3>写入 HTML 文件<a class="headerlink" href="io.html#writing-to-html-files" title="Link to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> 对象有一个实例方法 <code class="docutils literal notranslate"><span class="pre">to_html</span></code>，它将 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> 的内容渲染为 HTML 表格。函数参数与上面描述的 <code class="docutils literal notranslate"><span class="pre">to_string</span></code> 方法相同。</p>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p>为简洁起见，这里没有显示 <code class="docutils literal notranslate"><span class="pre">DataFrame.to_html</span></code> 的所有可能选项。有关完整选项集，请参阅 <code class="xref py py-func docutils literal notranslate"><span class="pre">DataFrame.to_html()</span></code>。</p>
</div>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p>在 Jupyter Notebook 等支持 HTML 渲染的环境中，<code class="docutils literal notranslate"><span class="pre">display(HTML(...))`</span></code> 将把原始 HTML 渲染到环境中。</p>
</div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [342]: </span><span class="kn">from</span><span class="w"> </span><span class="nn">IPython.display</span><span class="w"> </span><span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">HTML</span>

<span class="gp">In [343]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

<span class="gp">In [344]: </span><span class="n">df</span>
<span class="gh">Out[344]: </span>
<span class="go">          0         1</span>
<span class="go">0 -0.345352  1.314232</span>
<span class="go">1  0.690579  0.995761</span>

<span class="gp">In [345]: </span><span class="n">html</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">to_html</span><span class="p">()</span>

<span class="gp">In [346]: </span><span class="nb">print</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>  <span class="c1"># raw html</span>
<span class="go">&lt;table border="1" class="dataframe"&gt;</span>
<span class="go">  &lt;thead&gt;</span>
<span class="go">    &lt;tr style="text-align: right;"&gt;</span>
<span class="go">      &lt;th&gt;&lt;/th&gt;</span>
<span class="go">      &lt;th&gt;0&lt;/th&gt;</span>
<span class="go">      &lt;th&gt;1&lt;/th&gt;</span>
<span class="go">    &lt;/tr&gt;</span>
<span class="go">  &lt;/thead&gt;</span>
<span class="go">  &lt;tbody&gt;</span>
<span class="go">    &lt;tr&gt;</span>
<span class="go">      &lt;th&gt;0&lt;/th&gt;</span>
<span class="go">      &lt;td&gt;-0.345352&lt;/td&gt;</span>
<span class="go">      &lt;td&gt;1.314232&lt;/td&gt;</span>
<span class="go">    &lt;/tr&gt;</span>
<span class="go">    &lt;tr&gt;</span>
<span class="go">      &lt;th&gt;1&lt;/th&gt;</span>
<span class="go">      &lt;td&gt;0.690579&lt;/td&gt;</span>
<span class="go">      &lt;td&gt;0.995761&lt;/td&gt;</span>
<span class="go">    &lt;/tr&gt;</span>
<span class="go">  &lt;/tbody&gt;</span>
<span class="go">&lt;/table&gt;</span>

<span class="gp">In [347]: </span><span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="n">html</span><span class="p">))</span>
<span class="go">&lt;IPython.core.display.HTML object&gt;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">columns</span></code> 参数将限制显示的列。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [348]: </span><span class="n">html</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="gp">In [349]: </span><span class="nb">print</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
<span class="go">&lt;table border="1" class="dataframe"&gt;</span>
<span class="go">  &lt;thead&gt;</span>
<span class="go">    &lt;tr style="text-align: right;"&gt;</span>
<span class="go">      &lt;th&gt;&lt;/th&gt;</span>
<span class="go">      &lt;th&gt;0&lt;/th&gt;</span>
<span class="go">    &lt;/tr&gt;</span>
<span class="go">  &lt;/thead&gt;</span>
<span class="go">  &lt;tbody&gt;</span>
<span class="go">    &lt;tr&gt;</span>
<span class="go">      &lt;th&gt;0&lt;/th&gt;</span>
<span class="go">      &lt;td&gt;-0.345352&lt;/td&gt;</span>
<span class="go">    &lt;/tr&gt;</span>
<span class="go">    &lt;tr&gt;</span>
<span class="go">      &lt;th&gt;1&lt;/th&gt;</span>
<span class="go">      &lt;td&gt;0.690579&lt;/td&gt;</span>
<span class="go">    &lt;/tr&gt;</span>
<span class="go">  &lt;/tbody&gt;</span>
<span class="go">&lt;/table&gt;</span>

<span class="gp">In [350]: </span><span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="n">html</span><span class="p">))</span>
<span class="go">&lt;IPython.core.display.HTML object&gt;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">float_format</span></code> 接受一个 Python 可调用对象来控制浮点值的精度。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [351]: </span><span class="n">html</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">float_format</span><span class="o">=</span><span class="s2">"</span><span class="si">{0:.10f}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">)</span>

<span class="gp">In [352]: </span><span class="nb">print</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
<span class="go">&lt;table border="1" class="dataframe"&gt;</span>
<span class="go">  &lt;thead&gt;</span>
<span class="go">    &lt;tr style="text-align: right;"&gt;</span>
<span class="go">      &lt;th&gt;&lt;/th&gt;</span>
<span class="go">      &lt;th&gt;0&lt;/th&gt;</span>
<span class="go">      &lt;th&gt;1&lt;/th&gt;</span>
<span class="go">    &lt;/tr&gt;</span>
<span class="go">  &lt;/thead&gt;</span>
<span class="go">  &lt;tbody&gt;</span>
<span class="go">    &lt;tr&gt;</span>
<span class="go">      &lt;th&gt;0&lt;/th&gt;</span>
<span class="go">      &lt;td&gt;-0.3453521949&lt;/td&gt;</span>
<span class="go">      &lt;td&gt;1.3142323796&lt;/td&gt;</span>
<span class="go">    &lt;/tr&gt;</span>
<span class="go">    &lt;tr&gt;</span>
<span class="go">      &lt;th&gt;1&lt;/th&gt;</span>
<span class="go">      &lt;td&gt;0.6905793352&lt;/td&gt;</span>
<span class="go">      &lt;td&gt;0.9957609037&lt;/td&gt;</span>
<span class="go">    &lt;/tr&gt;</span>
<span class="go">  &lt;/tbody&gt;</span>
<span class="go">&lt;/table&gt;</span>

<span class="gp">In [353]: </span><span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="n">html</span><span class="p">))</span>
<span class="go">&lt;IPython.core.display.HTML object&gt;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">bold_rows</span></code> 默认会将行标签加粗，但您可以将其关闭。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [354]: </span><span class="n">html</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">bold_rows</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="gp">In [355]: </span><span class="nb">print</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
<span class="go">&lt;table border="1" class="dataframe"&gt;</span>
<span class="go">  &lt;thead&gt;</span>
<span class="go">    &lt;tr style="text-align: right;"&gt;</span>
<span class="go">      &lt;th&gt;&lt;/th&gt;</span>
<span class="go">      &lt;th&gt;0&lt;/th&gt;</span>
<span class="go">      &lt;th&gt;1&lt;/th&gt;</span>
<span class="go">    &lt;/tr&gt;</span>
<span class="go">  &lt;/thead&gt;</span>
<span class="go">  &lt;tbody&gt;</span>
<span class="go">    &lt;tr&gt;</span>
<span class="go">      &lt;td&gt;0&lt;/td&gt;</span>
<span class="go">      &lt;td&gt;-0.345352&lt;/td&gt;</span>
<span class="go">      &lt;td&gt;1.314232&lt;/td&gt;</span>
<span class="go">    &lt;/tr&gt;</span>
<span class="go">    &lt;tr&gt;</span>
<span class="go">      &lt;td&gt;1&lt;/td&gt;</span>
<span class="go">      &lt;td&gt;0.690579&lt;/td&gt;</span>
<span class="go">      &lt;td&gt;0.995761&lt;/td&gt;</span>
<span class="go">    &lt;/tr&gt;</span>
<span class="go">  &lt;/tbody&gt;</span>
<span class="go">&lt;/table&gt;</span>

<span class="gp">In [356]: </span><span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="n">html</span><span class="p">))</span>
<span class="go">&lt;IPython.core.display.HTML object&gt;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">classes</span></code> 参数提供了为生成的 HTML 表格提供 CSS 类的功能。请注意，这些类是<em>附加</em>到现有 <code class="docutils literal notranslate"><span class="pre">'dataframe'</span></code> 类上的。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [357]: </span><span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">classes</span><span class="o">=</span><span class="p">[</span><span class="s2">"awesome_table_class"</span><span class="p">,</span> <span class="s2">"even_more_awesome_class"</span><span class="p">]))</span>
<span class="go">&lt;table border="1" class="dataframe awesome_table_class even_more_awesome_class"&gt;</span>
<span class="go">  &lt;thead&gt;</span>
<span class="go">    &lt;tr style="text-align: right;"&gt;</span>
<span class="go">      &lt;th&gt;&lt;/th&gt;</span>
<span class="go">      &lt;th&gt;0&lt;/th&gt;</span>
<span class="go">      &lt;th&gt;1&lt;/th&gt;</span>
<span class="go">    &lt;/tr&gt;</span>
<span class="go">  &lt;/thead&gt;</span>
<span class="go">  &lt;tbody&gt;</span>
<span class="go">    &lt;tr&gt;</span>
<span class="go">      &lt;th&gt;0&lt;/th&gt;</span>
<span class="go">      &lt;td&gt;-0.345352&lt;/td&gt;</span>
<span class="go">      &lt;td&gt;1.314232&lt;/td&gt;</span>
<span class="go">    &lt;/tr&gt;</span>
<span class="go">    &lt;tr&gt;</span>
<span class="go">      &lt;th&gt;1&lt;/th&gt;</span>
<span class="go">      &lt;td&gt;0.690579&lt;/td&gt;</span>
<span class="go">      &lt;td&gt;0.995761&lt;/td&gt;</span>
<span class="go">    &lt;/tr&gt;</span>
<span class="go">  &lt;/tbody&gt;</span>
<span class="go">&lt;/table&gt;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">render_links</span></code> 参数提供了向包含 URL 的单元格添加超链接的功能。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [358]: </span><span class="n">url_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="p">{</span>
<span class="gp">   .....: </span>        <span class="s2">"name"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"Python"</span><span class="p">,</span> <span class="s2">"pandas"</span><span class="p">],</span>
<span class="gp">   .....: </span>        <span class="s2">"url"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"https://pythonlang.cn/"</span><span class="p">,</span> <span class="s2">"https://pandas.ac.cn"</span><span class="p">],</span>
<span class="gp">   .....: </span>    <span class="p">}</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [359]: </span><span class="n">html</span> <span class="o">=</span> <span class="n">url_df</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">render_links</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="gp">In [360]: </span><span class="nb">print</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
<span class="go">&lt;table border="1" class="dataframe"&gt;</span>
<span class="go">  &lt;thead&gt;</span>
<span class="go">    &lt;tr style="text-align: right;"&gt;</span>
<span class="go">      &lt;th&gt;&lt;/th&gt;</span>
<span class="go">      &lt;th&gt;name&lt;/th&gt;</span>
<span class="go">      &lt;th&gt;url&lt;/th&gt;</span>
<span class="go">    &lt;/tr&gt;</span>
<span class="go">  &lt;/thead&gt;</span>
<span class="go">  &lt;tbody&gt;</span>
<span class="go">    &lt;tr&gt;</span>
<span class="go">      &lt;th&gt;0&lt;/th&gt;</span>
<span class="go">      &lt;td&gt;Python&lt;/td&gt;</span>
<span class="go">      &lt;td&gt;&lt;a href="https://pythonlang.cn/" target="_blank"&gt;https://pythonlang.cn/&lt;/a&gt;&lt;/td&gt;</span>
<span class="go">    &lt;/tr&gt;</span>
<span class="go">    &lt;tr&gt;</span>
<span class="go">      &lt;th&gt;1&lt;/th&gt;</span>
<span class="go">      &lt;td&gt;pandas&lt;/td&gt;</span>
<span class="go">      &lt;td&gt;&lt;a href="https://pandas.ac.cn" target="_blank"&gt;https://pandas.ac.cn&lt;/a&gt;&lt;/td&gt;</span>
<span class="go">    &lt;/tr&gt;</span>
<span class="go">  &lt;/tbody&gt;</span>
<span class="go">&lt;/table&gt;</span>

<span class="gp">In [361]: </span><span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="n">html</span><span class="p">))</span>
<span class="go">&lt;IPython.core.display.HTML object&gt;</span>
</pre></div>
</div>
<p>最后，<code class="docutils literal notranslate"><span class="pre">escape</span></code> 参数允许您控制是否在生成的 HTML 中转义“&lt;”、“&gt;”和“&amp;”字符（默认为 <code class="docutils literal notranslate"><span class="pre">True</span></code>）。因此，要获取未转义字符的 HTML，请传递 <code class="docutils literal notranslate"><span class="pre">escape=False</span></code>。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [362]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">"a"</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="s2">"&amp;&lt;&gt;"</span><span class="p">),</span> <span class="s2">"b"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">3</span><span class="p">)})</span>
</pre></div>
</div>
<p>已转义</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [363]: </span><span class="n">html</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">to_html</span><span class="p">()</span>

<span class="gp">In [364]: </span><span class="nb">print</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
<span class="go">&lt;table border="1" class="dataframe"&gt;</span>
<span class="go">  &lt;thead&gt;</span>
<span class="go">    &lt;tr style="text-align: right;"&gt;</span>
<span class="go">      &lt;th&gt;&lt;/th&gt;</span>
<span class="go">      &lt;th&gt;a&lt;/th&gt;</span>
<span class="go">      &lt;th&gt;b&lt;/th&gt;</span>
<span class="go">    &lt;/tr&gt;</span>
<span class="go">  &lt;/thead&gt;</span>
<span class="go">  &lt;tbody&gt;</span>
<span class="go">    &lt;tr&gt;</span>
<span class="go">      &lt;th&gt;0&lt;/th&gt;</span>
<span class="go">      &lt;td&gt;&amp;amp;&lt;/td&gt;</span>
<span class="go">      &lt;td&gt;2.396780&lt;/td&gt;</span>
<span class="go">    &lt;/tr&gt;</span>
<span class="go">    &lt;tr&gt;</span>
<span class="go">      &lt;th&gt;1&lt;/th&gt;</span>
<span class="go">      &lt;td&gt;&amp;lt;&lt;/td&gt;</span>
<span class="go">      &lt;td&gt;0.014871&lt;/td&gt;</span>
<span class="go">    &lt;/tr&gt;</span>
<span class="go">    &lt;tr&gt;</span>
<span class="go">      &lt;th&gt;2&lt;/th&gt;</span>
<span class="go">      &lt;td&gt;&amp;gt;&lt;/td&gt;</span>
<span class="go">      &lt;td&gt;3.357427&lt;/td&gt;</span>
<span class="go">    &lt;/tr&gt;</span>
<span class="go">  &lt;/tbody&gt;</span>
<span class="go">&lt;/table&gt;</span>

<span class="gp">In [365]: </span><span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="n">html</span><span class="p">))</span>
<span class="go">&lt;IPython.core.display.HTML object&gt;</span>
</pre></div>
</div>
<p>未转义</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [366]: </span><span class="n">html</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">escape</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="gp">In [367]: </span><span class="nb">print</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
<span class="go">&lt;table border="1" class="dataframe"&gt;</span>
<span class="go">  &lt;thead&gt;</span>
<span class="go">    &lt;tr style="text-align: right;"&gt;</span>
<span class="go">      &lt;th&gt;&lt;/th&gt;</span>
<span class="go">      &lt;th&gt;a&lt;/th&gt;</span>
<span class="go">      &lt;th&gt;b&lt;/th&gt;</span>
<span class="go">    &lt;/tr&gt;</span>
<span class="go">  &lt;/thead&gt;</span>
<span class="go">  &lt;tbody&gt;</span>
<span class="go">    &lt;tr&gt;</span>
<span class="go">      &lt;th&gt;0&lt;/th&gt;</span>
<span class="go">      &lt;td&gt;&amp;&lt;/td&gt;</span>
<span class="go">      &lt;td&gt;2.396780&lt;/td&gt;</span>
<span class="go">    &lt;/tr&gt;</span>
<span class="go">    &lt;tr&gt;</span>
<span class="go">      &lt;th&gt;1&lt;/th&gt;</span>
<span class="go">      &lt;td&gt;&lt;&lt;/td&gt;</span>
<span class="go">      &lt;td&gt;0.014871&lt;/td&gt;</span>
<span class="go">    &lt;/tr&gt;</span>
<span class="go">    &lt;tr&gt;</span>
<span class="go">      &lt;th&gt;2&lt;/th&gt;</span>
<span class="go">      &lt;td&gt;&gt;&lt;/td&gt;</span>
<span class="go">      &lt;td&gt;3.357427&lt;/td&gt;</span>
<span class="go">    &lt;/tr&gt;</span>
<span class="go">  &lt;/tbody&gt;</span>
<span class="go">&lt;/table&gt;</span>

<span class="gp">In [368]: </span><span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="n">html</span><span class="p">))</span>
<span class="go">&lt;IPython.core.display.HTML object&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p>一些浏览器可能不会显示前两个 HTML 表格在渲染上的差异。</p>
</div>
</section>
<section id="html-table-parsing-gotchas">
<span id="io-html-gotchas"></span><h3>HTML 表格解析陷阱<a class="headerlink" href="io.html#html-table-parsing-gotchas" title="Link to this heading">#</a></h3>
<p>在顶层 pandas IO 函数 <code class="docutils literal notranslate"><span class="pre">read_html</span></code> 中，用于解析 HTML 表格的库存在一些版本问题。</p>
<p><strong><a class="reference external" href="https://lxml.de">lxml</a> 的问题</strong></p>
<ul>
<li><p>优点</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference external" href="https://lxml.de"><strong>lxml</strong></a> 速度非常快。</p></li>
<li><p><a class="reference external" href="https://lxml.de"><strong>lxml</strong></a> 需要正确安装 Cython。</p></li>
</ul>
</div></blockquote>
</li>
<li><p>缺点</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference external" href="https://lxml.de"><strong>lxml</strong></a> 除非给定<a class="reference external" href="https://validator.w3.org/docs/help.html#validation_basics"><strong>严格有效的标记</strong></a>，否则<em>不</em>保证其解析结果。</p></li>
<li><p>鉴于上述情况，我们选择允许您使用 <a class="reference external" href="https://lxml.de"><strong>lxml</strong></a> 后端，但<strong>如果 <a class="reference external" href="https://lxml.de">lxml</a> 解析失败，此后端将使用</strong> <a class="reference external" href="https://github.com/html5lib/html5lib-python"><strong>html5lib</strong></a>。</p></li>
<li><p>因此，<em>强烈建议</em>您安装 <a class="reference external" href="https://www.crummy.com/software/BeautifulSoup"><strong>BeautifulSoup4</strong></a> 和 <a class="reference external" href="https://github.com/html5lib/html5lib-python"><strong>html5lib</strong></a>，这样即使 <a class="reference external" href="https://lxml.de">lxml</a> 失败，您仍然会得到有效的结果（如果其他一切都有效）。</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<p><strong>使用 <a class="reference external" href="https://lxml.de">lxml</a> 作为后端时 <a class="reference external" href="https://www.crummy.com/software/BeautifulSoup">BeautifulSoup4</a> 的问题</strong></p>
<ul class="simple">
<li><p>上述问题在这里也适用，因为 <a class="reference external" href="https://www.crummy.com/software/BeautifulSoup"><strong>BeautifulSoup4</strong></a> 本质上只是一个解析器后端的一个包装器。</p></li>
</ul>
<p><strong>使用 <a class="reference external" href="https://github.com/html5lib/html5lib-python">html5lib</a> 作为后端时 <a class="reference external" href="https://www.crummy.com/software/BeautifulSoup">BeautifulSoup4</a> 的问题</strong></p>
<ul>
<li><p>优点</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference external" href="https://github.com/html5lib/html5lib-python"><strong>html5lib</strong></a> 比 <a class="reference external" href="https://lxml.de"><strong>lxml</strong></a> 宽松得多，因此以一种更合理的方式处理<em>现实生活中的标记</em>，而不是仅仅，例如，在不通知您的情况下删除一个元素。</p></li>
<li><p><a class="reference external" href="https://github.com/html5lib/html5lib-python"><strong>html5lib</strong></a> <em>能够自动从无效标记生成有效的 HTML5 标记</em>。这对于解析 HTML 表格极其重要，因为它保证了一个有效文档。然而，这并不意味着它是“正确”的，因为修复标记的过程没有单一的定义。</p></li>
<li><p><a class="reference external" href="https://github.com/html5lib/html5lib-python"><strong>html5lib</strong></a> 是纯 Python 实现，除了自身的安装之外不需要额外的构建步骤。</p></li>
</ul>
</div></blockquote>
</li>
<li><p>缺点</p>
<blockquote>
<div><ul class="simple">
<li><p>使用 <a class="reference external" href="https://github.com/html5lib/html5lib-python"><strong>html5lib</strong></a> 最大的缺点是它慢如蜗牛。然而，考虑到 Web 上许多表格不够大，解析算法的运行时间并不重要。瓶颈更可能在于从 Web 上通过 URL 读取原始文本的过程，即 IO（输入-输出）。对于非常大的表格，情况可能并非如此。</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</section>
</section>
<section id="latex">
<span id="io-latex"></span><h2>LaTeX<a class="headerlink" href="io.html#latex" title="Link to this heading">#</a></h2>
<div class="versionadded">
<p><span class="versionmodified added">1.3.0 版新增。</span></p>
</div>
<p>目前没有从 LaTeX 读取的方法，只有输出方法。</p>
<section id="writing-to-latex-files">
<h3>写入 LaTeX 文件<a class="headerlink" href="io.html#writing-to-latex-files" title="Link to this heading">#</a></h3>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p>DataFrame <em>和</em> Styler 对象目前都有 <code class="docutils literal notranslate"><span class="pre">to_latex</span></code> 方法。我们建议使用 <a class="reference internal" href="../reference/api/pandas.io.formats.style.Styler.to_latex.html"><span class="doc">Styler.to_latex()</span></a> 方法，而不是 <a class="reference internal" href="../reference/api/pandas.DataFrame.to_latex.html"><span class="doc">DataFrame.to_latex()</span></a>，因为前者在条件样式方面更灵活，后者可能在未来被弃用。</p>
</div>
<p>查阅 <a class="reference internal" href="../reference/api/pandas.io.formats.style.Styler.to_latex.html"><span class="doc">Styler.to_latex</span></a> 的文档，其中提供了条件样式示例并解释了其关键字参数的操作。</p>
<p>对于简单的应用，以下模式就足够了。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [369]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"c"</span><span class="p">,</span> <span class="s2">"d"</span><span class="p">])</span>

<span class="gp">In [370]: </span><span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">to_latex</span><span class="p">())</span>
<span class="go">\begin{tabular}{lrr}</span>
<span class="go"> &amp; c &amp; d \\</span>
<span class="go">a &amp; 1 &amp; 2 \\</span>
<span class="go">b &amp; 3 &amp; 4 \\</span>
<span class="go">\end{tabular}</span>
</pre></div>
</div>
<p>要在输出前格式化值，请链接 <a class="reference internal" href="../reference/api/pandas.io.formats.style.Styler.format.html"><span class="doc">Styler.format</span></a> 方法。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [371]: </span><span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"€ </span><span class="si">{}</span><span class="s2">"</span><span class="p">)</span><span class="o">.</span><span class="n">to_latex</span><span class="p">())</span>
<span class="go">\begin{tabular}{lrr}</span>
<span class="go"> &amp; c &amp; d \\</span>
<span class="go">a &amp; € 1 &amp; € 2 \\</span>
<span class="go">b &amp; € 3 &amp; € 4 \\</span>
<span class="go">\end{tabular}</span>
</pre></div>
</div>
</section>
</section>
<section id="xml">
<h2>XML<a class="headerlink" href="io.html#xml" title="Link to this heading">#</a></h2>
<section id="reading-xml">
<span id="io-read-xml"></span><h3>读取 XML<a class="headerlink" href="io.html#reading-xml" title="Link to this heading">#</a></h3>
<div class="versionadded">
<p><span class="versionmodified added">1.3.0 版新增。</span></p>
</div>
<p>顶层函数 <code class="xref py py-func docutils literal notranslate"><span class="pre">read_xml()</span></code> 可以接受 XML 字符串/文件/URL，并将节点和属性解析为 pandas <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>。</p>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p>由于没有标准的 XML 结构，设计类型可能多种多样，<code class="docutils literal notranslate"><span class="pre">read_xml</span></code> 最适用于更扁平、更浅的版本。如果 XML 文档嵌套很深，请使用 <code class="docutils literal notranslate"><span class="pre">stylesheet</span></code> 功能将 XML 转换为更扁平的版本。</p>
</div>
<p>我们来看几个例子。</p>
<p>读取 XML 字符串</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [372]: </span><span class="kn">from</span><span class="w"> </span><span class="nn">io</span><span class="w"> </span><span class="kn">import</span> <span class="n">StringIO</span>

<span class="gp">In [373]: </span><span class="n">xml</span> <span class="o">=</span> <span class="s2">"""&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="gp">   .....: </span><span class="s2">&lt;bookstore&gt;</span>
<span class="gp">   .....: </span><span class="s2">  &lt;book category="cooking"&gt;</span>
<span class="gp">   .....: </span><span class="s2">    &lt;title lang="en"&gt;Everyday Italian&lt;/title&gt;</span>
<span class="gp">   .....: </span><span class="s2">    &lt;author&gt;Giada De Laurentiis&lt;/author&gt;</span>
<span class="gp">   .....: </span><span class="s2">    &lt;year&gt;2005&lt;/year&gt;</span>
<span class="gp">   .....: </span><span class="s2">    &lt;price&gt;30.00&lt;/price&gt;</span>
<span class="gp">   .....: </span><span class="s2">  &lt;/book&gt;</span>
<span class="gp">   .....: </span><span class="s2">  &lt;book category="children"&gt;</span>
<span class="gp">   .....: </span><span class="s2">    &lt;title lang="en"&gt;Harry Potter&lt;/title&gt;</span>
<span class="gp">   .....: </span><span class="s2">    &lt;author&gt;J K. Rowling&lt;/author&gt;</span>
<span class="gp">   .....: </span><span class="s2">    &lt;year&gt;2005&lt;/year&gt;</span>
<span class="gp">   .....: </span><span class="s2">    &lt;price&gt;29.99&lt;/price&gt;</span>
<span class="gp">   .....: </span><span class="s2">  &lt;/book&gt;</span>
<span class="gp">   .....: </span><span class="s2">  &lt;book category="web"&gt;</span>
<span class="gp">   .....: </span><span class="s2">    &lt;title lang="en"&gt;Learning XML&lt;/title&gt;</span>
<span class="gp">   .....: </span><span class="s2">    &lt;author&gt;Erik T. Ray&lt;/author&gt;</span>
<span class="gp">   .....: </span><span class="s2">    &lt;year&gt;2003&lt;/year&gt;</span>
<span class="gp">   .....: </span><span class="s2">    &lt;price&gt;39.95&lt;/price&gt;</span>
<span class="gp">   .....: </span><span class="s2">  &lt;/book&gt;</span>
<span class="gp">   .....: </span><span class="s2">&lt;/bookstore&gt;"""</span>
<span class="gp">   .....: </span>

<span class="gp">In [374]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_xml</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">xml</span><span class="p">))</span>

<span class="gp">In [375]: </span><span class="n">df</span>
<span class="gh">Out[375]: </span>
<span class="go">   category             title               author  year  price</span>
<span class="go">0   cooking  Everyday Italian  Giada De Laurentiis  2005  30.00</span>
<span class="go">1  children      Harry Potter         J K. Rowling  2005  29.99</span>
<span class="go">2       web      Learning XML          Erik T. Ray  2003  39.95</span>
</pre></div>
</div>
<p>不带任何选项读取 URL</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [376]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_xml</span><span class="p">(</span><span class="s2">"https://w3schools.org.cn/xml/books.xml"</span><span class="p">)</span>

<span class="gp">In [377]: </span><span class="n">df</span>
<span class="gh">Out[377]: </span>
<span class="go">   category              title                  author  year  price      cover</span>
<span class="go">0   cooking   Everyday Italian     Giada De Laurentiis  2005  30.00       None</span>
<span class="go">1  children       Harry Potter            J K. Rowling  2005  29.99       None</span>
<span class="go">2       web  XQuery Kick Start  Vaidyanathan Nagarajan  2003  49.99       None</span>
<span class="go">3       web       Learning XML             Erik T. Ray  2003  39.95  paperback</span>
</pre></div>
</div>
<p>读取“books.xml”文件内容并将其作为字符串传递给 <code class="docutils literal notranslate"><span class="pre">read_xml</span></code>。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [378]: </span><span class="n">file_path</span> <span class="o">=</span> <span class="s2">"books.xml"</span>

<span class="gp">In [379]: </span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="gp">   .....: </span>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">xml</span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [380]: </span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="gp">   .....: </span>    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_xml</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()))</span>
<span class="gp">   .....: </span>

<span class="gp">In [381]: </span><span class="n">df</span>
<span class="gh">Out[381]: </span>
<span class="go">   category             title               author  year  price</span>
<span class="go">0   cooking  Everyday Italian  Giada De Laurentiis  2005  30.00</span>
<span class="go">1  children      Harry Potter         J K. Rowling  2005  29.99</span>
<span class="go">2       web      Learning XML          Erik T. Ray  2003  39.95</span>
</pre></div>
</div>
<p>将“books.xml”的内容作为 <code class="docutils literal notranslate"><span class="pre">StringIO</span></code> 或 <code class="docutils literal notranslate"><span class="pre">BytesIO</span></code> 的实例读取，并将其传递给 <code class="docutils literal notranslate"><span class="pre">read_xml</span></code>。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [382]: </span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="gp">   .....: </span>    <span class="n">sio</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
<span class="gp">   .....: </span>

<span class="gp">In [383]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_xml</span><span class="p">(</span><span class="n">sio</span><span class="p">)</span>

<span class="gp">In [384]: </span><span class="n">df</span>
<span class="gh">Out[384]: </span>
<span class="go">   category             title               author  year  price</span>
<span class="go">0   cooking  Everyday Italian  Giada De Laurentiis  2005  30.00</span>
<span class="go">1  children      Harry Potter         J K. Rowling  2005  29.99</span>
<span class="go">2       web      Learning XML          Erik T. Ray  2003  39.95</span>
</pre></div>
</div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [385]: </span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">"rb"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="gp">   .....: </span>    <span class="n">bio</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
<span class="gp">   .....: </span>

<span class="gp">In [386]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_xml</span><span class="p">(</span><span class="n">bio</span><span class="p">)</span>

<span class="gp">In [387]: </span><span class="n">df</span>
<span class="gh">Out[387]: </span>
<span class="go">   category             title               author  year  price</span>
<span class="go">0   cooking  Everyday Italian  Giada De Laurentiis  2005  30.00</span>
<span class="go">1  children      Harry Potter         J K. Rowling  2005  29.99</span>
<span class="go">2       web      Learning XML          Erik T. Ray  2003  39.95</span>
</pre></div>
</div>
<p>甚至可以从 AWS S3 存储桶读取 XML，例如 NIH NCBI PMC 文章数据集，其中包含生物医学和生命科学期刊。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [388]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_xml</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="s2">"s3://pmc-oa-opendata/oa_comm/xml/all/PMC1236943.xml"</span><span class="p">,</span>
<span class="gp">   .....: </span>    <span class="n">xpath</span><span class="o">=</span><span class="s2">".//journal-meta"</span><span class="p">,</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [389]: </span><span class="n">df</span>
<span class="gh">Out[389]: </span>
<span class="go">              journal-id              journal-title       issn  publisher</span>
<span class="go">0  Cardiovasc Ultrasound  Cardiovascular Ultrasound  1476-7120        NaN</span>
</pre></div>
</div>
<p>通过 <a class="reference external" href="https://lxml.de">lxml</a> 作为默认 <code class="docutils literal notranslate"><span class="pre">parser</span></code>，您可以访问功能齐全的 XML 库，它扩展了 Python 的 ElementTree API。一个强大的工具是能够使用更具表现力的 XPath 有选择地或有条件地查询节点。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [390]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_xml</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">xpath</span><span class="o">=</span><span class="s2">"//book[year=2005]"</span><span class="p">)</span>

<span class="gp">In [391]: </span><span class="n">df</span>
<span class="gh">Out[391]: </span>
<span class="go">   category             title               author  year  price</span>
<span class="go">0   cooking  Everyday Italian  Giada De Laurentiis  2005  30.00</span>
<span class="go">1  children      Harry Potter         J K. Rowling  2005  29.99</span>
</pre></div>
</div>
<p>指定只解析元素或只解析属性。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [392]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_xml</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">elems_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="gp">In [393]: </span><span class="n">df</span>
<span class="gh">Out[393]: </span>
<span class="go">              title               author  year  price</span>
<span class="go">0  Everyday Italian  Giada De Laurentiis  2005  30.00</span>
<span class="go">1      Harry Potter         J K. Rowling  2005  29.99</span>
<span class="go">2      Learning XML          Erik T. Ray  2003  39.95</span>
</pre></div>
</div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [394]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_xml</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">attrs_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="gp">In [395]: </span><span class="n">df</span>
<span class="gh">Out[395]: </span>
<span class="go">   category</span>
<span class="go">0   cooking</span>
<span class="go">1  children</span>
<span class="go">2       web</span>
</pre></div>
</div>
<p>XML 文档可以有带前缀的命名空间和不带前缀的默认命名空间，两者都用特殊属性 <code class="docutils literal notranslate"><span class="pre">xmlns</span></code> 表示。为了在命名空间上下文中按节点解析，<code class="docutils literal notranslate"><span class="pre">xpath</span></code> 必须引用一个前缀。</p>
<p>例如，下面的 XML 包含一个带前缀 <code class="docutils literal notranslate"><span class="pre">doc</span></code> 和 URI 为 <code class="docutils literal notranslate"><span class="pre">https://example.com</span></code> 的命名空间。为了解析 <code class="docutils literal notranslate"><span class="pre">doc:row</span></code> 节点，必须使用 <code class="docutils literal notranslate"><span class="pre">namespaces</span></code>。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [396]: </span><span class="n">xml</span> <span class="o">=</span> <span class="s2">"""&lt;?xml version='1.0' encoding='utf-8'?&gt;</span>
<span class="gp">   .....: </span><span class="s2">&lt;doc:data xmlns:doc="https://example.com"&gt;</span>
<span class="gp">   .....: </span><span class="s2">  &lt;doc:row&gt;</span>
<span class="gp">   .....: </span><span class="s2">    &lt;doc:shape&gt;square&lt;/doc:shape&gt;</span>
<span class="gp">   .....: </span><span class="s2">    &lt;doc:degrees&gt;360&lt;/doc:degrees&gt;</span>
<span class="gp">   .....: </span><span class="s2">    &lt;doc:sides&gt;4.0&lt;/doc:sides&gt;</span>
<span class="gp">   .....: </span><span class="s2">  &lt;/doc:row&gt;</span>
<span class="gp">   .....: </span><span class="s2">  &lt;doc:row&gt;</span>
<span class="gp">   .....: </span><span class="s2">    &lt;doc:shape&gt;circle&lt;/doc:shape&gt;</span>
<span class="gp">   .....: </span><span class="s2">    &lt;doc:degrees&gt;360&lt;/doc:degrees&gt;</span>
<span class="gp">   .....: </span><span class="s2">    &lt;doc:sides/&gt;</span>
<span class="gp">   .....: </span><span class="s2">  &lt;/doc:row&gt;</span>
<span class="gp">   .....: </span><span class="s2">  &lt;doc:row&gt;</span>
<span class="gp">   .....: </span><span class="s2">    &lt;doc:shape&gt;triangle&lt;/doc:shape&gt;</span>
<span class="gp">   .....: </span><span class="s2">    &lt;doc:degrees&gt;180&lt;/doc:degrees&gt;</span>
<span class="gp">   .....: </span><span class="s2">    &lt;doc:sides&gt;3.0&lt;/doc:sides&gt;</span>
<span class="gp">   .....: </span><span class="s2">  &lt;/doc:row&gt;</span>
<span class="gp">   .....: </span><span class="s2">&lt;/doc:data&gt;"""</span>
<span class="gp">   .....: </span>

<span class="gp">In [397]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_xml</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">xml</span><span class="p">),</span>
<span class="gp">   .....: </span>                 <span class="n">xpath</span><span class="o">=</span><span class="s2">"//doc:row"</span><span class="p">,</span>
<span class="gp">   .....: </span>                 <span class="n">namespaces</span><span class="o">=</span><span class="p">{</span><span class="s2">"doc"</span><span class="p">:</span> <span class="s2">"https://example.com"</span><span class="p">})</span>
<span class="gp">   .....: </span>

<span class="gp">In [398]: </span><span class="n">df</span>
<span class="gh">Out[398]: </span>
<span class="go">      shape  degrees  sides</span>
<span class="go">0    square      360    4.0</span>
<span class="go">1    circle      360    NaN</span>
<span class="go">2  triangle      180    3.0</span>
</pre></div>
</div>
<p>同样，XML 文档可以有一个没有前缀的默认命名空间。如果未能为正确的 URI 分配临时前缀，将返回空节点并引发 <code class="docutils literal notranslate"><span class="pre">ValueError</span></code>。但是，将<em>任何</em>临时名称分配给正确的 URI 允许按节点进行解析。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [399]: </span><span class="n">xml</span> <span class="o">=</span> <span class="s2">"""&lt;?xml version='1.0' encoding='utf-8'?&gt;</span>
<span class="gp">   .....: </span><span class="s2">&lt;data xmlns="https://example.com"&gt;</span>
<span class="gp">   .....: </span><span class="s2"> &lt;row&gt;</span>
<span class="gp">   .....: </span><span class="s2">   &lt;shape&gt;square&lt;/shape&gt;</span>
<span class="gp">   .....: </span><span class="s2">   &lt;degrees&gt;360&lt;/degrees&gt;</span>
<span class="gp">   .....: </span><span class="s2">   &lt;sides&gt;4.0&lt;/sides&gt;</span>
<span class="gp">   .....: </span><span class="s2"> &lt;/row&gt;</span>
<span class="gp">   .....: </span><span class="s2"> &lt;row&gt;</span>
<span class="gp">   .....: </span><span class="s2">   &lt;shape&gt;circle&lt;/shape&gt;</span>
<span class="gp">   .....: </span><span class="s2">   &lt;degrees&gt;360&lt;/degrees&gt;</span>
<span class="gp">   .....: </span><span class="s2">   &lt;sides/&gt;</span>
<span class="gp">   .....: </span><span class="s2"> &lt;/row&gt;</span>
<span class="gp">   .....: </span><span class="s2"> &lt;row&gt;</span>
<span class="gp">   .....: </span><span class="s2">   &lt;shape&gt;triangle&lt;/shape&gt;</span>
<span class="gp">   .....: </span><span class="s2">   &lt;degrees&gt;180&lt;/degrees&gt;</span>
<span class="gp">   .....: </span><span class="s2">   &lt;sides&gt;3.0&lt;/sides&gt;</span>
<span class="gp">   .....: </span><span class="s2"> &lt;/row&gt;</span>
<span class="gp">   .....: </span><span class="s2">&lt;/data&gt;"""</span>
<span class="gp">   .....: </span>

<span class="gp">In [400]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_xml</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">xml</span><span class="p">),</span>
<span class="gp">   .....: </span>                 <span class="n">xpath</span><span class="o">=</span><span class="s2">"//pandas:row"</span><span class="p">,</span>
<span class="gp">   .....: </span>                 <span class="n">namespaces</span><span class="o">=</span><span class="p">{</span><span class="s2">"pandas"</span><span class="p">:</span> <span class="s2">"https://example.com"</span><span class="p">})</span>
<span class="gp">   .....: </span>

<span class="gp">In [401]: </span><span class="n">df</span>
<span class="gh">Out[401]: </span>
<span class="go">      shape  degrees  sides</span>
<span class="go">0    square      360    4.0</span>
<span class="go">1    circle      360    NaN</span>
<span class="go">2  triangle      180    3.0</span>
</pre></div>
</div>
<p>但是，如果 XPath 不引用节点名称（例如默认值 <code class="docutils literal notranslate"><span class="pre">/*</span></code>），则不需要 <code class="docutils literal notranslate"><span class="pre">namespaces</span></code>。</p>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p>由于 <code class="docutils literal notranslate"><span class="pre">xpath</span></code> 标识要解析的内容的父级，因此只解析直接的后代，包括子节点或当前属性。因此，<code class="docutils literal notranslate"><span class="pre">read_xml</span></code> 不会解析孙子或其他后代的文本，也不会解析任何后代的属性。要检索较低级别的内容，请将 xpath 调整到较低级别。例如：</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [402]: </span><span class="n">xml</span> <span class="o">=</span> <span class="s2">"""</span>
<span class="gp">   .....: </span><span class="s2">&lt;data&gt;</span>
<span class="gp">   .....: </span><span class="s2">  &lt;row&gt;</span>
<span class="gp">   .....: </span><span class="s2">    &lt;shape sides="4"&gt;square&lt;/shape&gt;</span>
<span class="gp">   .....: </span><span class="s2">    &lt;degrees&gt;360&lt;/degrees&gt;</span>
<span class="gp">   .....: </span><span class="s2">  &lt;/row&gt;</span>
<span class="gp">   .....: </span><span class="s2">  &lt;row&gt;</span>
<span class="gp">   .....: </span><span class="s2">    &lt;shape sides="0"&gt;circle&lt;/shape&gt;</span>
<span class="gp">   .....: </span><span class="s2">    &lt;degrees&gt;360&lt;/degrees&gt;</span>
<span class="gp">   .....: </span><span class="s2">  &lt;/row&gt;</span>
<span class="gp">   .....: </span><span class="s2">  &lt;row&gt;</span>
<span class="gp">   .....: </span><span class="s2">    &lt;shape sides="3"&gt;triangle&lt;/shape&gt;</span>
<span class="gp">   .....: </span><span class="s2">    &lt;degrees&gt;180&lt;/degrees&gt;</span>
<span class="gp">   .....: </span><span class="s2">  &lt;/row&gt;</span>
<span class="gp">   .....: </span><span class="s2">&lt;/data&gt;"""</span>
<span class="gp">   .....: </span>

<span class="gp">In [403]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_xml</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">xml</span><span class="p">),</span> <span class="n">xpath</span><span class="o">=</span><span class="s2">"./row"</span><span class="p">)</span>

<span class="gp">In [404]: </span><span class="n">df</span>
<span class="gh">Out[404]: </span>
<span class="go">      shape  degrees</span>
<span class="go">0    square      360</span>
<span class="go">1    circle      360</span>
<span class="go">2  triangle      180</span>
</pre></div>
</div>
<p>显示 <code class="docutils literal notranslate"><span class="pre">shape</span></code> 元素上的属性 <code class="docutils literal notranslate"><span class="pre">sides</span></code> 未按预期解析，因为此属性位于 <code class="docutils literal notranslate"><span class="pre">row</span></code> 元素的子级上，而不是 <code class="docutils literal notranslate"><span class="pre">row</span></code> 元素本身。换句话说，<code class="docutils literal notranslate"><span class="pre">sides</span></code> 属性是 <code class="docutils literal notranslate"><span class="pre">row</span></code> 元素的孙子级别后代。然而，<code class="docutils literal notranslate"><span class="pre">xpath</span></code> 目标是 <code class="docutils literal notranslate"><span class="pre">row</span></code> 元素，它只涵盖其子级和属性。</p>
</div>
<p>使用 <a class="reference external" href="https://lxml.de">lxml</a> 作为解析器，您可以使用 XSLT 脚本展平嵌套的 XML 文档，该脚本也可以是字符串/文件/URL 类型。作为背景，<a class="reference external" href="https://www.w3.org/TR/xslt/">XSLT</a> 是一种用特殊 XML 文件编写的专用语言，可以使用 XSLT 处理器将原始 XML 文档转换为其他 XML、HTML 甚至文本（CSV、JSON 等）。</p>
<p>例如，考虑芝加哥“L”铁路客流量的这种有些嵌套的结构，其中车站和客流量元素在各自的部分中封装数据。通过以下 XSLT，<code class="docutils literal notranslate"><span class="pre">lxml</span></code> 可以将原始嵌套文档转换为更扁平的输出（如下所示用于演示），以便更轻松地解析为 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [405]: </span><span class="n">xml</span> <span class="o">=</span> <span class="s2">"""&lt;?xml version='1.0' encoding='utf-8'?&gt;</span>
<span class="gp">   .....: </span><span class="s2"> &lt;response&gt;</span>
<span class="gp">   .....: </span><span class="s2">  &lt;row&gt;</span>
<span class="gp">   .....: </span><span class="s2">    &lt;station id="40850" name="Library"/&gt;</span>
<span class="gp">   .....: </span><span class="s2">    &lt;month&gt;2020-09-01T00:00:00&lt;/month&gt;</span>
<span class="gp">   .....: </span><span class="s2">    &lt;rides&gt;</span>
<span class="gp">   .....: </span><span class="s2">      &lt;avg_weekday_rides&gt;864.2&lt;/avg_weekday_rides&gt;</span>
<span class="gp">   .....: </span><span class="s2">      &lt;avg_saturday_rides&gt;534&lt;/avg_saturday_rides&gt;</span>
<span class="gp">   .....: </span><span class="s2">      &lt;avg_sunday_holiday_rides&gt;417.2&lt;/avg_sunday_holiday_rides&gt;</span>
<span class="gp">   .....: </span><span class="s2">    &lt;/rides&gt;</span>
<span class="gp">   .....: </span><span class="s2">  &lt;/row&gt;</span>
<span class="gp">   .....: </span><span class="s2">  &lt;row&gt;</span>
<span class="gp">   .....: </span><span class="s2">    &lt;station id="41700" name="Washington/Wabash"/&gt;</span>
<span class="gp">   .....: </span><span class="s2">    &lt;month&gt;2020-09-01T00:00:00&lt;/month&gt;</span>
<span class="gp">   .....: </span><span class="s2">    &lt;rides&gt;</span>
<span class="gp">   .....: </span><span class="s2">      &lt;avg_weekday_rides&gt;2707.4&lt;/avg_weekday_rides&gt;</span>
<span class="gp">   .....: </span><span class="s2">      &lt;avg_saturday_rides&gt;1909.8&lt;/avg_saturday_rides&gt;</span>
<span class="gp">   .....: </span><span class="s2">      &lt;avg_sunday_holiday_rides&gt;1438.6&lt;/avg_sunday_holiday_rides&gt;</span>
<span class="gp">   .....: </span><span class="s2">    &lt;/rides&gt;</span>
<span class="gp">   .....: </span><span class="s2">  &lt;/row&gt;</span>
<span class="gp">   .....: </span><span class="s2">  &lt;row&gt;</span>
<span class="gp">   .....: </span><span class="s2">    &lt;station id="40380" name="Clark/Lake"/&gt;</span>
<span class="gp">   .....: </span><span class="s2">    &lt;month&gt;2020-09-01T00:00:00&lt;/month&gt;</span>
<span class="gp">   .....: </span><span class="s2">    &lt;rides&gt;</span>
<span class="gp">   .....: </span><span class="s2">      &lt;avg_weekday_rides&gt;2949.6&lt;/avg_weekday_rides&gt;</span>
<span class="gp">   .....: </span><span class="s2">      &lt;avg_saturday_rides&gt;1657&lt;/avg_saturday_rides&gt;</span>
<span class="gp">   .....: </span><span class="s2">      &lt;avg_sunday_holiday_rides&gt;1453.8&lt;/avg_sunday_holiday_rides&gt;</span>
<span class="gp">   .....: </span><span class="s2">    &lt;/rides&gt;</span>
<span class="gp">   .....: </span><span class="s2">  &lt;/row&gt;</span>
<span class="gp">   .....: </span><span class="s2"> &lt;/response&gt;"""</span>
<span class="gp">   .....: </span>

<span class="gp">In [406]: </span><span class="n">xsl</span> <span class="o">=</span> <span class="s2">"""&lt;xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;</span>
<span class="gp">   .....: </span><span class="s2">   &lt;xsl:output method="xml" omit-xml-declaration="no" indent="yes"/&gt;</span>
<span class="gp">   .....: </span><span class="s2">   &lt;xsl:strip-space elements="*"/&gt;</span>
<span class="gp">   .....: </span><span class="s2">   &lt;xsl:template match="/response"&gt;</span>
<span class="gp">   .....: </span><span class="s2">      &lt;xsl:copy&gt;</span>
<span class="gp">   .....: </span><span class="s2">        &lt;xsl:apply-templates select="row"/&gt;</span>
<span class="gp">   .....: </span><span class="s2">      &lt;/xsl:copy&gt;</span>
<span class="gp">   .....: </span><span class="s2">   &lt;/xsl:template&gt;</span>
<span class="gp">   .....: </span><span class="s2">   &lt;xsl:template match="row"&gt;</span>
<span class="gp">   .....: </span><span class="s2">      &lt;xsl:copy&gt;</span>
<span class="gp">   .....: </span><span class="s2">        &lt;station_id&gt;&lt;xsl:value-of select="station/@id"/&gt;&lt;/station_id&gt;</span>
<span class="gp">   .....: </span><span class="s2">        &lt;station_name&gt;&lt;xsl:value-of select="station/@name"/&gt;&lt;/station_name&gt;</span>
<span class="gp">   .....: </span><span class="s2">        &lt;xsl:copy-of select="month|rides/*"/&gt;</span>
<span class="gp">   .....: </span><span class="s2">      &lt;/xsl:copy&gt;</span>
<span class="gp">   .....: </span><span class="s2">   &lt;/xsl:template&gt;</span>
<span class="gp">   .....: </span><span class="s2"> &lt;/xsl:stylesheet&gt;"""</span>
<span class="gp">   .....: </span>

<span class="gp">In [407]: </span><span class="n">output</span> <span class="o">=</span> <span class="s2">"""&lt;?xml version='1.0' encoding='utf-8'?&gt;</span>
<span class="gp">   .....: </span><span class="s2"> &lt;response&gt;</span>
<span class="gp">   .....: </span><span class="s2">   &lt;row&gt;</span>
<span class="gp">   .....: </span><span class="s2">      &lt;station_id&gt;40850&lt;/station_id&gt;</span>
<span class="gp">   .....: </span><span class="s2">      &lt;station_name&gt;Library&lt;/station_name&gt;</span>
<span class="gp">   .....: </span><span class="s2">      &lt;month&gt;2020-09-01T00:00:00&lt;/month&gt;</span>
<span class="gp">   .....: </span><span class="s2">      &lt;avg_weekday_rides&gt;864.2&lt;/avg_weekday_rides&gt;</span>
<span class="gp">   .....: </span><span class="s2">      &lt;avg_saturday_rides&gt;534&lt;/avg_saturday_rides&gt;</span>
<span class="gp">   .....: </span><span class="s2">      &lt;avg_sunday_holiday_rides&gt;417.2&lt;/avg_sunday_holiday_rides&gt;</span>
<span class="gp">   .....: </span><span class="s2">   &lt;/row&gt;</span>
<span class="gp">   .....: </span><span class="s2">   &lt;row&gt;</span>
<span class="gp">   .....: </span><span class="s2">      &lt;station_id&gt;41700&lt;/station_id&gt;</span>
<span class="gp">   .....: </span><span class="s2">      &lt;station_name&gt;Washington/Wabash&lt;/station_name&gt;</span>
<span class="gp">   .....: </span><span class="s2">      &lt;month&gt;2020-09-01T00:00:00&lt;/month&gt;</span>
<span class="gp">   .....: </span><span class="s2">      &lt;avg_weekday_rides&gt;2707.4&lt;/avg_weekday_rides&gt;</span>
<span class="gp">   .....: </span><span class="s2">      &lt;avg_saturday_rides&gt;1909.8&lt;/avg_saturday_rides&gt;</span>
<span class="gp">   .....: </span><span class="s2">      &lt;avg_sunday_holiday_rides&gt;1438.6&lt;/avg_sunday_holiday_rides&gt;</span>
<span class="gp">   .....: </span><span class="s2">   &lt;/row&gt;</span>
<span class="gp">   .....: </span><span class="s2">   &lt;row&gt;</span>
<span class="gp">   .....: </span><span class="s2">      &lt;station_id&gt;40380&lt;/station_id&gt;</span>
<span class="gp">   .....: </span><span class="s2">      &lt;station_name&gt;Clark/Lake&lt;/station_name&gt;</span>
<span class="gp">   .....: </span><span class="s2">      &lt;month&gt;2020-09-01T00:00:00&lt;/month&gt;</span>
<span class="gp">   .....: </span><span class="s2">      &lt;avg_weekday_rides&gt;2949.6&lt;/avg_weekday_rides&gt;</span>
<span class="gp">   .....: </span><span class="s2">      &lt;avg_saturday_rides&gt;1657&lt;/avg_saturday_rides&gt;</span>
<span class="gp">   .....: </span><span class="s2">      &lt;avg_sunday_holiday_rides&gt;1453.8&lt;/avg_sunday_holiday_rides&gt;</span>
<span class="gp">   .....: </span><span class="s2">   &lt;/row&gt;</span>
<span class="gp">   .....: </span><span class="s2"> &lt;/response&gt;"""</span>
<span class="gp">   .....: </span>

<span class="gp">In [408]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_xml</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">xml</span><span class="p">),</span> <span class="n">stylesheet</span><span class="o">=</span><span class="n">xsl</span><span class="p">)</span>

<span class="gp">In [409]: </span><span class="n">df</span>
<span class="gh">Out[409]: </span>
<span class="go">   station_id       station_name  ... avg_saturday_rides  avg_sunday_holiday_rides</span>
<span class="go">0       40850            Library  ...              534.0                     417.2</span>
<span class="go">1       41700  Washington/Wabash  ...             1909.8                    1438.6</span>
<span class="go">2       40380         Clark/Lake  ...             1657.0                    1453.8</span>

<span class="go">[3 rows x 6 columns]</span>
</pre></div>
</div>
<p>对于大小从数百兆字节到千兆字节的非常大的 XML 文件，<a class="reference internal" href="../reference/api/pandas.read_xml.html#pandas.read_xml" title="pandas.read_xml"><code class="xref py py-func docutils literal notranslate"><span class="pre">pandas.read_xml()</span></code></a> 支持使用 <a class="reference external" href="https://lxml.de/3.2/parsing.html#iterparse-and-iterwalk">lxml 的 iterparse</a> 和 <a class="reference external" href="https://docs.pythonlang.cn/3/library/xml.etree.elementtree.html#xml.etree.ElementTree.iterparse">etree 的 iterparse</a> 解析此类大型文件，这些都是内存效率高的方法，可以迭代 XML 树并提取特定元素和属性，而无需将整个树保留在内存中。</p>
<div class="versionadded">
<p><span class="versionmodified added">1.5.0 版本新增。</span></p>
</div>
<p>要使用此功能，您必须将物理 XML 文件路径传入 <code class="docutils literal notranslate"><span class="pre">read_xml</span></code> 并使用 <code class="docutils literal notranslate"><span class="pre">iterparse</span></code> 参数。文件不应被压缩或指向在线源，而应存储在本地磁盘上。此外，<code class="docutils literal notranslate"><span class="pre">iterparse</span></code> 应该是一个字典，其中键是文档中重复的节点（它们成为行），值是作为重复节点的任何元素或属性的后代（即子级、孙子级）的列表。由于此方法中不使用 XPath，因此后代不需要彼此共享相同的关系。下面显示了读取维基百科非常大（12 GB+）最新文章数据转储的示例。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_xml</span><span class="p">(</span>
<span class="go">...         "/path/to/downloaded/enwikisource-latest-pages-articles.xml",</span>
<span class="go">...         iterparse = {"page": ["title", "ns", "id"]}</span>
<span class="go">...     )</span>
<span class="go">...     df</span>
<span class="gh">Out[2]:</span>
<span class="go">                                                     title   ns        id</span>
<span class="go">0                                       Gettysburg Address    0     21450</span>
<span class="go">1                                                Main Page    0     42950</span>
<span class="go">2                            Declaration by United Nations    0      8435</span>
<span class="go">3             Constitution of the United States of America    0      8435</span>
<span class="go">4                     Declaration of Independence (Israel)    0     17858</span>
<span class="go">...                                                    ...  ...       ...</span>
<span class="go">3578760               Page:Black cat 1897 07 v2 n10.pdf/17  104    219649</span>
<span class="go">3578761               Page:Black cat 1897 07 v2 n10.pdf/43  104    219649</span>
<span class="go">3578762               Page:Black cat 1897 07 v2 n10.pdf/44  104    219649</span>
<span class="go">3578763      The History of Tom Jones, a Foundling/Book IX    0  12084291</span>
<span class="go">3578764  Page:Shakespeare of Stratford (1926) Yale.djvu/91  104     21450</span>

<span class="go">[3578765 rows x 3 columns]</span>
</pre></div>
</div>
</section>
<section id="writing-xml">
<span id="io-xml"></span><h3>写入 XML<a class="headerlink" href="io.html#writing-xml" title="Link to this heading">#</a></h3>
<div class="versionadded">
<p><span class="versionmodified added">1.3.0 版新增。</span></p>
</div>
<p><code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> 对象有一个实例方法 <code class="docutils literal notranslate"><span class="pre">to_xml</span></code>，它将 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> 的内容渲染为 XML 文档。</p>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p>此方法不支持 XML 的特殊属性，包括 DTD、CData、XSD 模式、处理指令、注释等。只支持根级别的命名空间。然而，<code class="docutils literal notranslate"><span class="pre">stylesheet</span></code> 允许在初始输出后进行设计更改。</p>
</div>
<p>我们来看几个例子。</p>
<p>不带选项写入 XML</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [410]: </span><span class="n">geom_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="p">{</span>
<span class="gp">   .....: </span>        <span class="s2">"shape"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"square"</span><span class="p">,</span> <span class="s2">"circle"</span><span class="p">,</span> <span class="s2">"triangle"</span><span class="p">],</span>
<span class="gp">   .....: </span>        <span class="s2">"degrees"</span><span class="p">:</span> <span class="p">[</span><span class="mi">360</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">180</span><span class="p">],</span>
<span class="gp">   .....: </span>        <span class="s2">"sides"</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
<span class="gp">   .....: </span>    <span class="p">}</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [411]: </span><span class="nb">print</span><span class="p">(</span><span class="n">geom_df</span><span class="o">.</span><span class="n">to_xml</span><span class="p">())</span>
<span class="go">&lt;?xml version='1.0' encoding='utf-8'?&gt;</span>
<span class="go">&lt;data&gt;</span>
<span class="go">  &lt;row&gt;</span>
<span class="go">    &lt;index&gt;0&lt;/index&gt;</span>
<span class="go">    &lt;shape&gt;square&lt;/shape&gt;</span>
<span class="go">    &lt;degrees&gt;360&lt;/degrees&gt;</span>
<span class="go">    &lt;sides&gt;4.0&lt;/sides&gt;</span>
<span class="go">  &lt;/row&gt;</span>
<span class="go">  &lt;row&gt;</span>
<span class="go">    &lt;index&gt;1&lt;/index&gt;</span>
<span class="go">    &lt;shape&gt;circle&lt;/shape&gt;</span>
<span class="go">    &lt;degrees&gt;360&lt;/degrees&gt;</span>
<span class="go">    &lt;sides/&gt;</span>
<span class="go">  &lt;/row&gt;</span>
<span class="go">  &lt;row&gt;</span>
<span class="go">    &lt;index&gt;2&lt;/index&gt;</span>
<span class="go">    &lt;shape&gt;triangle&lt;/shape&gt;</span>
<span class="go">    &lt;degrees&gt;180&lt;/degrees&gt;</span>
<span class="go">    &lt;sides&gt;3.0&lt;/sides&gt;</span>
<span class="go">  &lt;/row&gt;</span>
<span class="go">&lt;/data&gt;</span>
</pre></div>
</div>
<p>写入带有新根和行名称的 XML</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [412]: </span><span class="nb">print</span><span class="p">(</span><span class="n">geom_df</span><span class="o">.</span><span class="n">to_xml</span><span class="p">(</span><span class="n">root_name</span><span class="o">=</span><span class="s2">"geometry"</span><span class="p">,</span> <span class="n">row_name</span><span class="o">=</span><span class="s2">"objects"</span><span class="p">))</span>
<span class="go">&lt;?xml version='1.0' encoding='utf-8'?&gt;</span>
<span class="go">&lt;geometry&gt;</span>
<span class="go">  &lt;objects&gt;</span>
<span class="go">    &lt;index&gt;0&lt;/index&gt;</span>
<span class="go">    &lt;shape&gt;square&lt;/shape&gt;</span>
<span class="go">    &lt;degrees&gt;360&lt;/degrees&gt;</span>
<span class="go">    &lt;sides&gt;4.0&lt;/sides&gt;</span>
<span class="go">  &lt;/objects&gt;</span>
<span class="go">  &lt;objects&gt;</span>
<span class="go">    &lt;index&gt;1&lt;/index&gt;</span>
<span class="go">    &lt;shape&gt;circle&lt;/shape&gt;</span>
<span class="go">    &lt;degrees&gt;360&lt;/degrees&gt;</span>
<span class="go">    &lt;sides/&gt;</span>
<span class="go">  &lt;/objects&gt;</span>
<span class="go">  &lt;objects&gt;</span>
<span class="go">    &lt;index&gt;2&lt;/index&gt;</span>
<span class="go">    &lt;shape&gt;triangle&lt;/shape&gt;</span>
<span class="go">    &lt;degrees&gt;180&lt;/degrees&gt;</span>
<span class="go">    &lt;sides&gt;3.0&lt;/sides&gt;</span>
<span class="go">  &lt;/objects&gt;</span>
<span class="go">&lt;/geometry&gt;</span>
</pre></div>
</div>
<p>写入属性中心的 XML</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [413]: </span><span class="nb">print</span><span class="p">(</span><span class="n">geom_df</span><span class="o">.</span><span class="n">to_xml</span><span class="p">(</span><span class="n">attr_cols</span><span class="o">=</span><span class="n">geom_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()))</span>
<span class="go">&lt;?xml version='1.0' encoding='utf-8'?&gt;</span>
<span class="go">&lt;data&gt;</span>
<span class="go">  &lt;row index="0" shape="square" degrees="360" sides="4.0"/&gt;</span>
<span class="go">  &lt;row index="1" shape="circle" degrees="360"/&gt;</span>
<span class="go">  &lt;row index="2" shape="triangle" degrees="180" sides="3.0"/&gt;</span>
<span class="go">&lt;/data&gt;</span>
</pre></div>
</div>
<p>写入元素和属性的混合</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [414]: </span><span class="nb">print</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="n">geom_df</span><span class="o">.</span><span class="n">to_xml</span><span class="p">(</span>
<span class="gp">   .....: </span>        <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="gp">   .....: </span>        <span class="n">attr_cols</span><span class="o">=</span><span class="p">[</span><span class="s1">'shape'</span><span class="p">],</span>
<span class="gp">   .....: </span>        <span class="n">elem_cols</span><span class="o">=</span><span class="p">[</span><span class="s1">'degrees'</span><span class="p">,</span> <span class="s1">'sides'</span><span class="p">])</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>
<span class="go">&lt;?xml version='1.0' encoding='utf-8'?&gt;</span>
<span class="go">&lt;data&gt;</span>
<span class="go">  &lt;row shape="square"&gt;</span>
<span class="go">    &lt;degrees&gt;360&lt;/degrees&gt;</span>
<span class="go">    &lt;sides&gt;4.0&lt;/sides&gt;</span>
<span class="go">  &lt;/row&gt;</span>
<span class="go">  &lt;row shape="circle"&gt;</span>
<span class="go">    &lt;degrees&gt;360&lt;/degrees&gt;</span>
<span class="go">    &lt;sides/&gt;</span>
<span class="go">  &lt;/row&gt;</span>
<span class="go">  &lt;row shape="triangle"&gt;</span>
<span class="go">    &lt;degrees&gt;180&lt;/degrees&gt;</span>
<span class="go">    &lt;sides&gt;3.0&lt;/sides&gt;</span>
<span class="go">  &lt;/row&gt;</span>
<span class="go">&lt;/data&gt;</span>
</pre></div>
</div>
<p>任何具有分层列的 <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code> 都将被展平，XML 元素名称的级别以下划线分隔。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [415]: </span><span class="n">ext_geom_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="p">{</span>
<span class="gp">   .....: </span>        <span class="s2">"type"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"polygon"</span><span class="p">,</span> <span class="s2">"other"</span><span class="p">,</span> <span class="s2">"polygon"</span><span class="p">],</span>
<span class="gp">   .....: </span>        <span class="s2">"shape"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"square"</span><span class="p">,</span> <span class="s2">"circle"</span><span class="p">,</span> <span class="s2">"triangle"</span><span class="p">],</span>
<span class="gp">   .....: </span>        <span class="s2">"degrees"</span><span class="p">:</span> <span class="p">[</span><span class="mi">360</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">180</span><span class="p">],</span>
<span class="gp">   .....: </span>        <span class="s2">"sides"</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
<span class="gp">   .....: </span>    <span class="p">}</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [416]: </span><span class="n">pvt_df</span> <span class="o">=</span> <span class="n">ext_geom_df</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s1">'shape'</span><span class="p">,</span>
<span class="gp">   .....: </span>                                 <span class="n">columns</span><span class="o">=</span><span class="s1">'type'</span><span class="p">,</span>
<span class="gp">   .....: </span>                                 <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="s1">'degrees'</span><span class="p">,</span> <span class="s1">'sides'</span><span class="p">],</span>
<span class="gp">   .....: </span>                                 <span class="n">aggfunc</span><span class="o">=</span><span class="s1">'sum'</span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [417]: </span><span class="n">pvt_df</span>
<span class="gh">Out[417]: </span>
<span class="go">         degrees         sides        </span>
<span class="go">type       other polygon other polygon</span>
<span class="go">shape                                 </span>
<span class="go">circle     360.0     NaN   0.0     NaN</span>
<span class="go">square       NaN   360.0   NaN     4.0</span>
<span class="go">triangle     NaN   180.0   NaN     3.0</span>

<span class="gp">In [418]: </span><span class="nb">print</span><span class="p">(</span><span class="n">pvt_df</span><span class="o">.</span><span class="n">to_xml</span><span class="p">())</span>
<span class="go">&lt;?xml version='1.0' encoding='utf-8'?&gt;</span>
<span class="go">&lt;data&gt;</span>
<span class="go">  &lt;row&gt;</span>
<span class="go">    &lt;shape&gt;circle&lt;/shape&gt;</span>
<span class="go">    &lt;degrees_other&gt;360.0&lt;/degrees_other&gt;</span>
<span class="go">    &lt;degrees_polygon/&gt;</span>
<span class="go">    &lt;sides_other&gt;0.0&lt;/sides_other&gt;</span>
<span class="go">    &lt;sides_polygon/&gt;</span>
<span class="go">  &lt;/row&gt;</span>
<span class="go">  &lt;row&gt;</span>
<span class="go">    &lt;shape&gt;square&lt;/shape&gt;</span>
<span class="go">    &lt;degrees_other/&gt;</span>
<span class="go">    &lt;degrees_polygon&gt;360.0&lt;/degrees_polygon&gt;</span>
<span class="go">    &lt;sides_other/&gt;</span>
<span class="go">    &lt;sides_polygon&gt;4.0&lt;/sides_polygon&gt;</span>
<span class="go">  &lt;/row&gt;</span>
<span class="go">  &lt;row&gt;</span>
<span class="go">    &lt;shape&gt;triangle&lt;/shape&gt;</span>
<span class="go">    &lt;degrees_other/&gt;</span>
<span class="go">    &lt;degrees_polygon&gt;180.0&lt;/degrees_polygon&gt;</span>
<span class="go">    &lt;sides_other/&gt;</span>
<span class="go">    &lt;sides_polygon&gt;3.0&lt;/sides_polygon&gt;</span>
<span class="go">  &lt;/row&gt;</span>
<span class="go">&lt;/data&gt;</span>
</pre></div>
</div>
<p>写入带有默认命名空间的 XML</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [419]: </span><span class="nb">print</span><span class="p">(</span><span class="n">geom_df</span><span class="o">.</span><span class="n">to_xml</span><span class="p">(</span><span class="n">namespaces</span><span class="o">=</span><span class="p">{</span><span class="s2">""</span><span class="p">:</span> <span class="s2">"https://example.com"</span><span class="p">}))</span>
<span class="go">&lt;?xml version='1.0' encoding='utf-8'?&gt;</span>
<span class="go">&lt;data xmlns="https://example.com"&gt;</span>
<span class="go">  &lt;row&gt;</span>
<span class="go">    &lt;index&gt;0&lt;/index&gt;</span>
<span class="go">    &lt;shape&gt;square&lt;/shape&gt;</span>
<span class="go">    &lt;degrees&gt;360&lt;/degrees&gt;</span>
<span class="go">    &lt;sides&gt;4.0&lt;/sides&gt;</span>
<span class="go">  &lt;/row&gt;</span>
<span class="go">  &lt;row&gt;</span>
<span class="go">    &lt;index&gt;1&lt;/index&gt;</span>
<span class="go">    &lt;shape&gt;circle&lt;/shape&gt;</span>
<span class="go">    &lt;degrees&gt;360&lt;/degrees&gt;</span>
<span class="go">    &lt;sides/&gt;</span>
<span class="go">  &lt;/row&gt;</span>
<span class="go">  &lt;row&gt;</span>
<span class="go">    &lt;index&gt;2&lt;/index&gt;</span>
<span class="go">    &lt;shape&gt;triangle&lt;/shape&gt;</span>
<span class="go">    &lt;degrees&gt;180&lt;/degrees&gt;</span>
<span class="go">    &lt;sides&gt;3.0&lt;/sides&gt;</span>
<span class="go">  &lt;/row&gt;</span>
<span class="go">&lt;/data&gt;</span>
</pre></div>
</div>
<p>写入带有命名空间前缀的 XML</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [420]: </span><span class="nb">print</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="n">geom_df</span><span class="o">.</span><span class="n">to_xml</span><span class="p">(</span><span class="n">namespaces</span><span class="o">=</span><span class="p">{</span><span class="s2">"doc"</span><span class="p">:</span> <span class="s2">"https://example.com"</span><span class="p">},</span>
<span class="gp">   .....: </span>                   <span class="n">prefix</span><span class="o">=</span><span class="s2">"doc"</span><span class="p">)</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>
<span class="go">&lt;?xml version='1.0' encoding='utf-8'?&gt;</span>
<span class="go">&lt;doc:data xmlns:doc="https://example.com"&gt;</span>
<span class="go">  &lt;doc:row&gt;</span>
<span class="go">    &lt;doc:index&gt;0&lt;/doc:index&gt;</span>
<span class="go">    &lt;doc:shape&gt;square&lt;/doc:shape&gt;</span>
<span class="go">    &lt;doc:degrees&gt;360&lt;/doc:degrees&gt;</span>
<span class="go">    &lt;doc:sides&gt;4.0&lt;/doc:sides&gt;</span>
<span class="go">  &lt;/doc:row&gt;</span>
<span class="go">  &lt;doc:row&gt;</span>
<span class="go">    &lt;doc:index&gt;1&lt;/doc:index&gt;</span>
<span class="go">    &lt;doc:shape&gt;circle&lt;/doc:shape&gt;</span>
<span class="go">    &lt;doc:degrees&gt;360&lt;/doc:degrees&gt;</span>
<span class="go">    &lt;doc:sides/&gt;</span>
<span class="go">  &lt;/doc:row&gt;</span>
<span class="go">  &lt;doc:row&gt;</span>
<span class="go">    &lt;doc:index&gt;2&lt;/doc:index&gt;</span>
<span class="go">    &lt;doc:shape&gt;triangle&lt;/doc:shape&gt;</span>
<span class="go">    &lt;doc:degrees&gt;180&lt;/doc:degrees&gt;</span>
<span class="go">    &lt;doc:sides&gt;3.0&lt;/doc:sides&gt;</span>
<span class="go">  &lt;/doc:row&gt;</span>
<span class="go">&lt;/doc:data&gt;</span>
</pre></div>
</div>
<p>写入不带声明或美观打印的 XML</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [421]: </span><span class="nb">print</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="n">geom_df</span><span class="o">.</span><span class="n">to_xml</span><span class="p">(</span><span class="n">xml_declaration</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="gp">   .....: </span>                   <span class="n">pretty_print</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>
<span class="go">&lt;data&gt;&lt;row&gt;&lt;index&gt;0&lt;/index&gt;&lt;shape&gt;square&lt;/shape&gt;&lt;degrees&gt;360&lt;/degrees&gt;&lt;sides&gt;4.0&lt;/sides&gt;&lt;/row&gt;&lt;row&gt;&lt;index&gt;1&lt;/index&gt;&lt;shape&gt;circle&lt;/shape&gt;&lt;degrees&gt;360&lt;/degrees&gt;&lt;sides/&gt;&lt;/row&gt;&lt;row&gt;&lt;index&gt;2&lt;/index&gt;&lt;shape&gt;triangle&lt;/shape&gt;&lt;degrees&gt;180&lt;/degrees&gt;&lt;sides&gt;3.0&lt;/sides&gt;&lt;/row&gt;&lt;/data&gt;</span>
</pre></div>
</div>
<p>写入 XML 并使用样式表进行转换</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [422]: </span><span class="n">xsl</span> <span class="o">=</span> <span class="s2">"""&lt;xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;</span>
<span class="gp">   .....: </span><span class="s2">   &lt;xsl:output method="xml" omit-xml-declaration="no" indent="yes"/&gt;</span>
<span class="gp">   .....: </span><span class="s2">   &lt;xsl:strip-space elements="*"/&gt;</span>
<span class="gp">   .....: </span><span class="s2">   &lt;xsl:template match="/data"&gt;</span>
<span class="gp">   .....: </span><span class="s2">     &lt;geometry&gt;</span>
<span class="gp">   .....: </span><span class="s2">       &lt;xsl:apply-templates select="row"/&gt;</span>
<span class="gp">   .....: </span><span class="s2">     &lt;/geometry&gt;</span>
<span class="gp">   .....: </span><span class="s2">   &lt;/xsl:template&gt;</span>
<span class="gp">   .....: </span><span class="s2">   &lt;xsl:template match="row"&gt;</span>
<span class="gp">   .....: </span><span class="s2">     &lt;object index="</span><span class="si">{index}</span><span class="s2">"&gt;</span>
<span class="gp">   .....: </span><span class="s2">       &lt;xsl:if test="shape!='circle'"&gt;</span>
<span class="gp">   .....: </span><span class="s2">           &lt;xsl:attribute name="type"&gt;polygon&lt;/xsl:attribute&gt;</span>
<span class="gp">   .....: </span><span class="s2">       &lt;/xsl:if&gt;</span>
<span class="gp">   .....: </span><span class="s2">       &lt;xsl:copy-of select="shape"/&gt;</span>
<span class="gp">   .....: </span><span class="s2">       &lt;property&gt;</span>
<span class="gp">   .....: </span><span class="s2">           &lt;xsl:copy-of select="degrees|sides"/&gt;</span>
<span class="gp">   .....: </span><span class="s2">       &lt;/property&gt;</span>
<span class="gp">   .....: </span><span class="s2">     &lt;/object&gt;</span>
<span class="gp">   .....: </span><span class="s2">   &lt;/xsl:template&gt;</span>
<span class="gp">   .....: </span><span class="s2"> &lt;/xsl:stylesheet&gt;"""</span>
<span class="gp">   .....: </span>

<span class="gp">In [423]: </span><span class="nb">print</span><span class="p">(</span><span class="n">geom_df</span><span class="o">.</span><span class="n">to_xml</span><span class="p">(</span><span class="n">stylesheet</span><span class="o">=</span><span class="n">xsl</span><span class="p">))</span>
<span class="go">&lt;?xml version="1.0"?&gt;</span>
<span class="go">&lt;geometry&gt;</span>
<span class="go">  &lt;object index="0" type="polygon"&gt;</span>
<span class="go">    &lt;shape&gt;square&lt;/shape&gt;</span>
<span class="go">    &lt;property&gt;</span>
<span class="go">      &lt;degrees&gt;360&lt;/degrees&gt;</span>
<span class="go">      &lt;sides&gt;4.0&lt;/sides&gt;</span>
<span class="go">    &lt;/property&gt;</span>
<span class="go">  &lt;/object&gt;</span>
<span class="go">  &lt;object index="1"&gt;</span>
<span class="go">    &lt;shape&gt;circle&lt;/shape&gt;</span>
<span class="go">    &lt;property&gt;</span>
<span class="go">      &lt;degrees&gt;360&lt;/degrees&gt;</span>
<span class="go">      &lt;sides/&gt;</span>
<span class="go">    &lt;/property&gt;</span>
<span class="go">  &lt;/object&gt;</span>
<span class="go">  &lt;object index="2" type="polygon"&gt;</span>
<span class="go">    &lt;shape&gt;triangle&lt;/shape&gt;</span>
<span class="go">    &lt;property&gt;</span>
<span class="go">      &lt;degrees&gt;180&lt;/degrees&gt;</span>
<span class="go">      &lt;sides&gt;3.0&lt;/sides&gt;</span>
<span class="go">    &lt;/property&gt;</span>
<span class="go">  &lt;/object&gt;</span>
<span class="go">&lt;/geometry&gt;</span>
</pre></div>
</div>
</section>
<section id="xml-final-notes">
<h3>XML 最终注意事项<a class="headerlink" href="io.html#xml-final-notes" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>所有 XML 文档都遵循 <a class="reference external" href="https://www.w3.org/TR/xml/">W3C 规范</a>。无论是 <code class="docutils literal notranslate"><span class="pre">etree</span></code> 还是 <code class="docutils literal notranslate"><span class="pre">lxml</span></code> 解析器，都无法解析任何格式不正确或不遵循 XML 语法规则的标记文档。请注意，HTML 不是 XML 文档，除非它遵循 XHTML 规范。然而，其他流行的标记类型，包括 KML、XAML、RSS、MusicML、MathML 都是符合 <a class="reference external" href="https://en.wikipedia.org/wiki/List_of_types_of_XML_schemas">XML 模式</a>的。</p></li>
<li><p>基于上述原因，如果您的应用程序在 pandas 操作之前构建 XML，请使用适当的 DOM 库（如 <code class="docutils literal notranslate"><span class="pre">etree</span></code> 和 <code class="docutils literal notranslate"><span class="pre">lxml</span></code>）来构建必要的文档，而不是通过字符串连接或正则表达式调整。请始终记住 XML 是一个带有标记规则的<em>特殊</em>文本文件。</p></li>
<li><p>对于非常大的 XML 文件（数百 MB 到 GB 级），XPath 和 XSLT 可能会成为内存密集型操作。请确保有足够的可用 RAM 来读取和写入大型 XML 文件（大约是文本大小的 5 倍）。</p></li>
<li><p>因为 XSLT 是一种编程语言，请谨慎使用它，因为此类脚本可能在您的环境中构成安全风险，并且可能运行大量或无限的递归操作。在全面运行之前，务必在小片段上测试脚本。</p></li>
<li><p><a class="reference external" href="https://docs.pythonlang.cn/3/library/xml.etree.elementtree.html">etree</a> 解析器支持 <code class="docutils literal notranslate"><span class="pre">read_xml</span></code> 和 <code class="docutils literal notranslate"><span class="pre">to_xml</span></code> 的所有功能，除了复杂的 XPath 和任何 XSLT。尽管功能有限，<code class="docutils literal notranslate"><span class="pre">etree</span></code> 仍然是一个可靠且有能力的解析器和树构建器。对于大型文件，其性能可能会在一定程度上落后于 <code class="docutils literal notranslate"><span class="pre">lxml</span></code>，但在中小型文件上相对不明显。</p></li>
</ul>
</section>
</section>
<section id="excel-files">
<span id="io-excel"></span><h2>Excel 文件<a class="headerlink" href="io.html#excel-files" title="Link to this heading">#</a></h2>
<p><a class="reference internal" href="../reference/api/pandas.read_excel.html#pandas.read_excel" title="pandas.read_excel"><code class="xref py py-func docutils literal notranslate"><span class="pre">read_excel()</span></code></a> 方法可以使用 <code class="docutils literal notranslate"><span class="pre">openpyxl</span></code> Python 模块读取 Excel 2007+ (<code class="docutils literal notranslate"><span class="pre">.xlsx</span></code>) 文件。Excel 2003 (<code class="docutils literal notranslate"><span class="pre">.xls</span></code>) 文件可以使用 <code class="docutils literal notranslate"><span class="pre">xlrd</span></code> 读取。二进制 Excel (<code class="docutils literal notranslate"><span class="pre">.xlsb</span></code>) 文件可以使用 <code class="docutils literal notranslate"><span class="pre">pyxlsb</span></code> 读取。所有格式都可以使用 <a class="reference internal" href="io.html#io-calamine"><span class="std std-ref">calamine</span></a> 引擎读取。<a class="reference internal" href="../reference/api/pandas.DataFrame.to_excel.html#pandas.DataFrame.to_excel" title="pandas.DataFrame.to_excel"><code class="xref py py-meth docutils literal notranslate"><span class="pre">to_excel()</span></code></a> 实例方法用于将 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> 保存到 Excel。通常，语义与处理 <a class="reference internal" href="io.html#io-read-csv-table"><span class="std std-ref">csv</span></a> 数据相似。请参阅 <a class="reference internal" href="cookbook.html#cookbook-excel"><span class="std std-ref">cookbook</span></a> 以获取一些高级策略。</p>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p>当 <code class="docutils literal notranslate"><span class="pre">engine=None</span></code> 时，将使用以下逻辑来确定引擎：</p>
<ul class="simple">
<li><p>如果 <code class="docutils literal notranslate"><span class="pre">path_or_buffer</span></code> 是 OpenDocument 格式（.odf, .ods, .odt），则将使用 <a class="reference external" href="https://pypi.ac.cn/project/odfpy/">odf</a>。</p></li>
<li><p>否则，如果 <code class="docutils literal notranslate"><span class="pre">path_or_buffer</span></code> 是 xls 格式，将使用 <code class="docutils literal notranslate"><span class="pre">xlrd</span></code>。</p></li>
<li><p>否则，如果 <code class="docutils literal notranslate"><span class="pre">path_or_buffer</span></code> 是 xlsb 格式，将使用 <code class="docutils literal notranslate"><span class="pre">pyxlsb</span></code>。</p></li>
<li><p>否则，将使用 <code class="docutils literal notranslate"><span class="pre">openpyxl</span></code>。</p></li>
</ul>
</div>
<section id="reading-excel-files">
<span id="io-excel-reader"></span><h3>读取 Excel 文件<a class="headerlink" href="io.html#reading-excel-files" title="Link to this heading">#</a></h3>
<p>在最基本的用例中，<code class="docutils literal notranslate"><span class="pre">read_excel</span></code> 接受 Excel 文件的路径和指示要解析哪个工作表的 <code class="docutils literal notranslate"><span class="pre">sheet_name</span></code>。</p>
<p>当使用 <code class="docutils literal notranslate"><span class="pre">engine_kwargs</span></code> 参数时，pandas 会将这些参数传递给引擎。为此，了解 pandas 内部使用的是哪个函数非常重要。</p>
<ul class="simple">
<li><p>对于 openpyxl 引擎，pandas 使用 <code class="xref py py-func docutils literal notranslate"><span class="pre">openpyxl.load_workbook()</span></code> 来读取 (<code class="docutils literal notranslate"><span class="pre">.xlsx</span></code>) 和 (<code class="docutils literal notranslate"><span class="pre">.xlsm</span></code>) 文件。</p></li>
<li><p>对于 xlrd 引擎，pandas 使用 <code class="xref py py-func docutils literal notranslate"><span class="pre">xlrd.open_workbook()</span></code> 来读取 (<code class="docutils literal notranslate"><span class="pre">.xls</span></code>) 文件。</p></li>
<li><p>对于 pyxlsb 引擎，pandas 使用 <code class="xref py py-func docutils literal notranslate"><span class="pre">pyxlsb.open_workbook()</span></code> 来读取 (<code class="docutils literal notranslate"><span class="pre">.xlsb</span></code>) 文件。</p></li>
<li><p>对于 odf 引擎，pandas 使用 <code class="xref py py-func docutils literal notranslate"><span class="pre">odf.opendocument.load()</span></code> 来读取 (<code class="docutils literal notranslate"><span class="pre">.ods</span></code>) 文件。</p></li>
<li><p>对于 calamine 引擎，pandas 使用 <code class="xref py py-func docutils literal notranslate"><span class="pre">python_calamine.load_workbook()</span></code> 来读取 (<code class="docutils literal notranslate"><span class="pre">.xlsx</span></code>)、(<code class="docutils literal notranslate"><span class="pre">.xlsm</span></code>)、(<code class="docutils literal notranslate"><span class="pre">.xls</span></code>)、(<code class="docutils literal notranslate"><span class="pre">.xlsb</span></code>)、(<code class="docutils literal notranslate"><span class="pre">.ods</span></code>) 文件。</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Returns a DataFrame</span>
<span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s2">"path_to_file.xls"</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s2">"Sheet1"</span><span class="p">)</span>
</pre></div>
</div>
<section id="excelfile-class">
<span id="io-excel-excelfile-class"></span><h4><code class="docutils literal notranslate"><span class="pre">ExcelFile</span></code> 类<a class="headerlink" href="io.html#excelfile-class" title="指向此标题的链接">#</a></h4>
<p>为了方便处理同一个文件中的多个工作表，可以使用 <code class="docutils literal notranslate"><span class="pre">ExcelFile</span></code> 类来封装文件，并将其传递给 <code class="docutils literal notranslate"><span class="pre">read_excel</span></code>。由于文件只会被读取到内存一次，因此读取多个工作表时会带来性能优势。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">xlsx</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelFile</span><span class="p">(</span><span class="s2">"path_to_file.xls"</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">xlsx</span><span class="p">,</span> <span class="s2">"Sheet1"</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">ExcelFile</span></code> 类也可以用作上下文管理器。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelFile</span><span class="p">(</span><span class="s2">"path_to_file.xls"</span><span class="p">)</span> <span class="k">as</span> <span class="n">xls</span><span class="p">:</span>
    <span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">xls</span><span class="p">,</span> <span class="s2">"Sheet1"</span><span class="p">)</span>
    <span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">xls</span><span class="p">,</span> <span class="s2">"Sheet2"</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">sheet_names</span></code> 属性将生成文件中工作表名称的列表。</p>
<p><code class="docutils literal notranslate"><span class="pre">ExcelFile</span></code> 的主要用例是使用不同的参数解析多个工作表。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
<span class="c1"># For when Sheet1's format differs from Sheet2</span>
<span class="k">with</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelFile</span><span class="p">(</span><span class="s2">"path_to_file.xls"</span><span class="p">)</span> <span class="k">as</span> <span class="n">xls</span><span class="p">:</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">"Sheet1"</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">xls</span><span class="p">,</span> <span class="s2">"Sheet1"</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">na_values</span><span class="o">=</span><span class="p">[</span><span class="s2">"NA"</span><span class="p">])</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">"Sheet2"</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">xls</span><span class="p">,</span> <span class="s2">"Sheet2"</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>请注意，如果所有工作表都使用相同的解析参数，则可以将工作表名称列表直接传递给 <code class="docutils literal notranslate"><span class="pre">read_excel</span></code>，而不会造成性能损失。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># using the ExcelFile class</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">with</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelFile</span><span class="p">(</span><span class="s2">"path_to_file.xls"</span><span class="p">)</span> <span class="k">as</span> <span class="n">xls</span><span class="p">:</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">"Sheet1"</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">xls</span><span class="p">,</span> <span class="s2">"Sheet1"</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">na_values</span><span class="o">=</span><span class="p">[</span><span class="s2">"NA"</span><span class="p">])</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">"Sheet2"</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">xls</span><span class="p">,</span> <span class="s2">"Sheet2"</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">na_values</span><span class="o">=</span><span class="p">[</span><span class="s2">"NA"</span><span class="p">])</span>

<span class="c1"># equivalent using the read_excel function</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span>
    <span class="s2">"path_to_file.xls"</span><span class="p">,</span> <span class="p">[</span><span class="s2">"Sheet1"</span><span class="p">,</span> <span class="s2">"Sheet2"</span><span class="p">],</span> <span class="n">index_col</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">na_values</span><span class="o">=</span><span class="p">[</span><span class="s2">"NA"</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">ExcelFile</span></code> 也可以通过传入 <code class="docutils literal notranslate"><span class="pre">xlrd.book.Book</span></code> 对象作为参数来调用。这允许用户控制 Excel 文件的读取方式。例如，可以通过调用 <code class="docutils literal notranslate"><span class="pre">xlrd.open_workbook()</span></code> 并设置 <code class="docutils literal notranslate"><span class="pre">on_demand=True</span></code> 来按需加载工作表。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">xlrd</span>

<span class="n">xlrd_book</span> <span class="o">=</span> <span class="n">xlrd</span><span class="o">.</span><span class="n">open_workbook</span><span class="p">(</span><span class="s2">"path_to_file.xls"</span><span class="p">,</span> <span class="n">on_demand</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">with</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelFile</span><span class="p">(</span><span class="n">xlrd_book</span><span class="p">)</span> <span class="k">as</span> <span class="n">xls</span><span class="p">:</span>
    <span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">xls</span><span class="p">,</span> <span class="s2">"Sheet1"</span><span class="p">)</span>
    <span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">xls</span><span class="p">,</span> <span class="s2">"Sheet2"</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="specifying-sheets">
<span id="io-excel-specifying-sheets"></span><h4>指定工作表<a class="headerlink" href="io.html#specifying-sheets" title="指向此标题的链接">#</a></h4>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p>第二个参数是 <code class="docutils literal notranslate"><span class="pre">sheet_name</span></code>，不要与 <code class="docutils literal notranslate"><span class="pre">ExcelFile.sheet_names</span></code> 混淆。</p>
</div>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p>ExcelFile 的属性 <code class="docutils literal notranslate"><span class="pre">sheet_names</span></code> 提供对工作表列表的访问。</p>
</div>
<ul class="simple">
<li><p>参数 <code class="docutils literal notranslate"><span class="pre">sheet_name</span></code> 允许指定要读取的一个或多个工作表。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sheet_name</span></code> 的默认值为 0，表示读取第一个工作表。</p></li>
<li><p>传入一个字符串来指定工作簿中特定工作表的名称。</p></li>
<li><p>传入一个整数来指定工作表的索引。索引遵循 Python 约定，从 0 开始。</p></li>
<li><p>传入一个包含字符串或整数的列表，以返回指定工作表的字典。</p></li>
<li><p>传入 <code class="docutils literal notranslate"><span class="pre">None</span></code> 以返回所有可用工作表的字典。</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Returns a DataFrame</span>
<span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s2">"path_to_file.xls"</span><span class="p">,</span> <span class="s2">"Sheet1"</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">na_values</span><span class="o">=</span><span class="p">[</span><span class="s2">"NA"</span><span class="p">])</span>
</pre></div>
</div>
<p>使用工作表索引</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Returns a DataFrame</span>
<span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s2">"path_to_file.xls"</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">na_values</span><span class="o">=</span><span class="p">[</span><span class="s2">"NA"</span><span class="p">])</span>
</pre></div>
</div>
<p>使用所有默认值</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Returns a DataFrame</span>
<span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s2">"path_to_file.xls"</span><span class="p">)</span>
</pre></div>
</div>
<p>使用 None 获取所有工作表</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Returns a dictionary of DataFrames</span>
<span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s2">"path_to_file.xls"</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<p>使用列表获取多个工作表</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Returns the 1st and 4th sheet, as a dictionary of DataFrames.</span>
<span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s2">"path_to_file.xls"</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="p">[</span><span class="s2">"Sheet1"</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">read_excel</span></code> 可以读取多个工作表，通过将 <code class="docutils literal notranslate"><span class="pre">sheet_name</span></code> 设置为工作表名称列表、工作表位置列表或 <code class="docutils literal notranslate"><span class="pre">None</span></code> 来读取所有工作表。工作表可以分别通过整数（工作表索引）或字符串（工作表名称）来指定。</p>
</section>
<section id="reading-a-multiindex">
<span id="io-excel-reading-multiindex"></span><h4>读取 <code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code><a class="headerlink" href="io.html#reading-a-multiindex" title="指向此标题的链接">#</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">read_excel</span></code> 可以通过将列列表传递给 <code class="docutils literal notranslate"><span class="pre">index_col</span></code> 来读取 <code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code> 索引，并通过将行列表传递给 <code class="docutils literal notranslate"><span class="pre">header</span></code> 来读取 <code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code> 列。如果 <code class="docutils literal notranslate"><span class="pre">index</span></code> 或 <code class="docutils literal notranslate"><span class="pre">columns</span></code> 具有序列化的级别名称，则通过指定构成这些级别的行/列，这些名称也将被读取。</p>
<p>例如，读取没有名称的 <code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code> 索引：</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [424]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="p">{</span><span class="s2">"a"</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="s2">"b"</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">]},</span>
<span class="gp">   .....: </span>    <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_product</span><span class="p">([[</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">],</span> <span class="p">[</span><span class="s2">"c"</span><span class="p">,</span> <span class="s2">"d"</span><span class="p">]]),</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [425]: </span><span class="n">df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s2">"path_to_file.xlsx"</span><span class="p">)</span>

<span class="gp">In [426]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s2">"path_to_file.xlsx"</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

<span class="gp">In [427]: </span><span class="n">df</span>
<span class="gh">Out[427]: </span>
<span class="go">     a  b</span>
<span class="go">a c  1  5</span>
<span class="go">  d  2  6</span>
<span class="go">b c  3  7</span>
<span class="go">  d  4  8</span>
</pre></div>
</div>
<p>如果索引具有级别名称，它们也将使用相同的参数进行解析。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [428]: </span><span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">set_names</span><span class="p">([</span><span class="s2">"lvl1"</span><span class="p">,</span> <span class="s2">"lvl2"</span><span class="p">])</span>

<span class="gp">In [429]: </span><span class="n">df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s2">"path_to_file.xlsx"</span><span class="p">)</span>

<span class="gp">In [430]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s2">"path_to_file.xlsx"</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

<span class="gp">In [431]: </span><span class="n">df</span>
<span class="gh">Out[431]: </span>
<span class="go">           a  b</span>
<span class="go">lvl1 lvl2      </span>
<span class="go">a    c     1  5</span>
<span class="go">     d     2  6</span>
<span class="go">b    c     3  7</span>
<span class="go">     d     4  8</span>
</pre></div>
</div>
<p>如果源文件同时具有 <code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code> 索引和列，则应将分别指定它们的列表传递给 <code class="docutils literal notranslate"><span class="pre">index_col</span></code> 和 <code class="docutils literal notranslate"><span class="pre">header</span></code>。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [432]: </span><span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_product</span><span class="p">([[</span><span class="s2">"a"</span><span class="p">],</span> <span class="p">[</span><span class="s2">"b"</span><span class="p">,</span> <span class="s2">"d"</span><span class="p">]],</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s2">"c1"</span><span class="p">,</span> <span class="s2">"c2"</span><span class="p">])</span>

<span class="gp">In [433]: </span><span class="n">df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s2">"path_to_file.xlsx"</span><span class="p">)</span>

<span class="gp">In [434]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s2">"path_to_file.xlsx"</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">header</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

<span class="gp">In [435]: </span><span class="n">df</span>
<span class="gh">Out[435]: </span>
<span class="go">c1         a   </span>
<span class="go">c2         b  d</span>
<span class="go">lvl1 lvl2      </span>
<span class="go">a    c     1  5</span>
<span class="go">     d     2  6</span>
<span class="go">b    c     3  7</span>
<span class="go">     d     4  8</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">index_col</span></code> 中指定列的缺失值将被前向填充，以允许与 <code class="docutils literal notranslate"><span class="pre">to_excel</span></code> 在 <code class="docutils literal notranslate"><span class="pre">merged_cells=True</span></code> 时进行往返转换。为避免前向填充缺失值，请在读取数据后使用 <code class="docutils literal notranslate"><span class="pre">set_index</span></code> 而不是 <code class="docutils literal notranslate"><span class="pre">index_col</span></code>。</p>
</section>
<section id="parsing-specific-columns">
<h4>解析特定列<a class="headerlink" href="io.html#parsing-specific-columns" title="指向此标题的链接">#</a></h4>
<p>用户通常会在 Excel 中插入列进行临时计算，您可能不希望读取这些列。<code class="docutils literal notranslate"><span class="pre">read_excel</span></code> 接受一个 <code class="docutils literal notranslate"><span class="pre">usecols</span></code> 关键字，允许您指定要解析的列子集。</p>
<p>您可以将逗号分隔的 Excel 列和范围集指定为字符串。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s2">"path_to_file.xls"</span><span class="p">,</span> <span class="s2">"Sheet1"</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="s2">"A,C:E"</span><span class="p">)</span>
</pre></div>
</div>
<p>如果 <code class="docutils literal notranslate"><span class="pre">usecols</span></code> 是一个整数列表，则假定它是要解析的文件列索引。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s2">"path_to_file.xls"</span><span class="p">,</span> <span class="s2">"Sheet1"</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
<p>元素顺序将被忽略，因此 <code class="docutils literal notranslate"><span class="pre">usecols=[0,</span> <span class="pre">1]</span></code> 与 <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">0]</span></code> 相同。</p>
<p>如果 <code class="docutils literal notranslate"><span class="pre">usecols</span></code> 是一个字符串列表，则假定每个字符串对应于用户在 <code class="docutils literal notranslate"><span class="pre">names</span></code> 中提供或从文档标题行推断出的列名。这些字符串定义了将要解析哪些列。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s2">"path_to_file.xls"</span><span class="p">,</span> <span class="s2">"Sheet1"</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="s2">"foo"</span><span class="p">,</span> <span class="s2">"bar"</span><span class="p">])</span>
</pre></div>
</div>
<p>元素顺序将被忽略，因此 <code class="docutils literal notranslate"><span class="pre">usecols=['baz',</span> <span class="pre">'joe']</span></code> 与 <code class="docutils literal notranslate"><span class="pre">['joe',</span> <span class="pre">'baz']</span></code> 相同。</p>
<p>如果 <code class="docutils literal notranslate"><span class="pre">usecols</span></code> 是可调用对象，则该可调用函数将根据列名进行评估，返回可调用函数评估为 <code class="docutils literal notranslate"><span class="pre">True</span></code> 的列名。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s2">"path_to_file.xls"</span><span class="p">,</span> <span class="s2">"Sheet1"</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">isalpha</span><span class="p">())</span>
</pre></div>
</div>
</section>
<section id="parsing-dates">
<h4>解析日期<a class="headerlink" href="io.html#parsing-dates" title="指向此标题的链接">#</a></h4>
<p>读取 Excel 文件时，日期时间类值通常会自动转换为适当的 dtype。但是，如果您有一列字符串<em>看起来</em>像日期（但实际上在 Excel 中并未格式化为日期），您可以使用 <code class="docutils literal notranslate"><span class="pre">parse_dates</span></code> 关键字将这些字符串解析为日期时间。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s2">"path_to_file.xls"</span><span class="p">,</span> <span class="s2">"Sheet1"</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="s2">"date_strings"</span><span class="p">])</span>
</pre></div>
</div>
</section>
<section id="cell-converters">
<h4>单元格转换器<a class="headerlink" href="io.html#cell-converters" title="指向此标题的链接">#</a></h4>
<p>可以通过 <code class="docutils literal notranslate"><span class="pre">converters</span></code> 选项转换 Excel 单元格的内容。例如，将一列转换为布尔值：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s2">"path_to_file.xls"</span><span class="p">,</span> <span class="s2">"Sheet1"</span><span class="p">,</span> <span class="n">converters</span><span class="o">=</span><span class="p">{</span><span class="s2">"MyBools"</span><span class="p">:</span> <span class="nb">bool</span><span class="p">})</span>
</pre></div>
</div>
<p>此选项处理缺失值，并将转换器中的异常视为缺失数据。转换是逐单元格应用的，而不是对整个列应用，因此不保证数组的 dtype。例如，包含缺失值的整数列无法转换为整数 dtype 的数组，因为 NaN 严格来说是浮点数。您可以手动屏蔽缺失数据以恢复整数 dtype。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">cfun</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>


<span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s2">"path_to_file.xls"</span><span class="p">,</span> <span class="s2">"Sheet1"</span><span class="p">,</span> <span class="n">converters</span><span class="o">=</span><span class="p">{</span><span class="s2">"MyInts"</span><span class="p">:</span> <span class="n">cfun</span><span class="p">})</span>
</pre></div>
</div>
</section>
<section id="dtype-specifications">
<h4>Dtype 规范<a class="headerlink" href="io.html#dtype-specifications" title="指向此标题的链接">#</a></h4>
<p>作为转换器的替代方案，可以使用 <code class="docutils literal notranslate"><span class="pre">dtype</span></code> 关键字指定整个列的类型，该关键字接受一个将列名映射到类型的字典。要解释不进行类型推断的数据，请使用类型 <code class="docutils literal notranslate"><span class="pre">str</span></code> 或 <code class="docutils literal notranslate"><span class="pre">object</span></code>。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s2">"path_to_file.xls"</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="p">{</span><span class="s2">"MyInts"</span><span class="p">:</span> <span class="s2">"int64"</span><span class="p">,</span> <span class="s2">"MyText"</span><span class="p">:</span> <span class="nb">str</span><span class="p">})</span>
</pre></div>
</div>
</section>
</section>
<section id="writing-excel-files">
<span id="io-excel-writer"></span><h3>写入 Excel 文件<a class="headerlink" href="io.html#writing-excel-files" title="指向此标题的链接">#</a></h3>
<section id="writing-excel-files-to-disk">
<h4>将 Excel 文件写入磁盘<a class="headerlink" href="io.html#writing-excel-files-to-disk" title="指向此标题的链接">#</a></h4>
<p>要将 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> 对象写入 Excel 文件的工作表，可以使用 <code class="docutils literal notranslate"><span class="pre">to_excel</span></code> 实例方法。其参数与上面描述的 <code class="docutils literal notranslate"><span class="pre">to_csv</span></code> 大致相同，第一个参数是 Excel 文件名，可选的第二个参数是要写入 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> 的工作表名称。例如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s2">"path_to_file.xlsx"</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s2">"Sheet1"</span><span class="p">)</span>
</pre></div>
</div>
<p>扩展名为 <code class="docutils literal notranslate"><span class="pre">.xlsx</span></code> 的文件将使用 <code class="docutils literal notranslate"><span class="pre">xlsxwriter</span></code>（如果可用）或 <code class="docutils literal notranslate"><span class="pre">openpyxl</span></code> 写入。</p>
<p><code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> 将以模仿 REPL 输出的方式写入。<code class="docutils literal notranslate"><span class="pre">index_label</span></code> 将被放置在第二行而不是第一行。您可以通过将 <code class="docutils literal notranslate"><span class="pre">to_excel()</span></code> 中的 <code class="docutils literal notranslate"><span class="pre">merge_cells</span></code> 选项设置为 <code class="docutils literal notranslate"><span class="pre">False</span></code> 来将其放置在第一行。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s2">"path_to_file.xlsx"</span><span class="p">,</span> <span class="n">index_label</span><span class="o">=</span><span class="s2">"label"</span><span class="p">,</span> <span class="n">merge_cells</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>为了将独立的 <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code> 写入单个 Excel 文件中的不同工作表，可以传递一个 <code class="xref py py-class docutils literal notranslate"><span class="pre">ExcelWriter</span></code>。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelWriter</span><span class="p">(</span><span class="s2">"path_to_file.xlsx"</span><span class="p">)</span> <span class="k">as</span> <span class="n">writer</span><span class="p">:</span>
    <span class="n">df1</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s2">"Sheet1"</span><span class="p">)</span>
    <span class="n">df2</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s2">"Sheet2"</span><span class="p">)</span>
</pre></div>
</div>
<p id="io-excel-writing-buffer">当使用 <code class="docutils literal notranslate"><span class="pre">engine_kwargs</span></code> 参数时，pandas 会将这些参数传递给引擎。为此，了解 pandas 内部使用的是哪个函数非常重要。</p>
<ul class="simple">
<li><p>对于 openpyxl 引擎，pandas 使用 <code class="xref py py-func docutils literal notranslate"><span class="pre">openpyxl.Workbook()</span></code> 创建新工作表，并使用 <code class="xref py py-func docutils literal notranslate"><span class="pre">openpyxl.load_workbook()</span></code> 将数据追加到现有工作表。openpyxl 引擎写入 (<code class="docutils literal notranslate"><span class="pre">.xlsx</span></code>) 和 (<code class="docutils literal notranslate"><span class="pre">.xlsm</span></code>) 文件。</p></li>
<li><p>对于 xlsxwriter 引擎，pandas 使用 <code class="xref py py-func docutils literal notranslate"><span class="pre">xlsxwriter.Workbook()</span></code> 写入 (<code class="docutils literal notranslate"><span class="pre">.xlsx</span></code>) 文件。</p></li>
<li><p>对于 odf 引擎，pandas 使用 <code class="xref py py-func docutils literal notranslate"><span class="pre">odf.opendocument.OpenDocumentSpreadsheet()</span></code> 写入 (<code class="docutils literal notranslate"><span class="pre">.ods</span></code>) 文件。</p></li>
</ul>
</section>
<section id="writing-excel-files-to-memory">
<h4>将 Excel 文件写入内存<a class="headerlink" href="io.html#writing-excel-files-to-memory" title="指向此标题的链接">#</a></h4>
<p>pandas 支持使用 <code class="xref py py-class docutils literal notranslate"><span class="pre">ExcelWriter</span></code> 将 Excel 文件写入类似缓冲区的对象，例如 <code class="docutils literal notranslate"><span class="pre">StringIO</span></code> 或 <code class="docutils literal notranslate"><span class="pre">BytesIO</span></code>。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">io</span><span class="w"> </span><span class="kn">import</span> <span class="n">BytesIO</span>

<span class="n">bio</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>

<span class="c1"># By setting the 'engine' in the ExcelWriter constructor.</span>
<span class="n">writer</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelWriter</span><span class="p">(</span><span class="n">bio</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">"xlsxwriter"</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s2">"Sheet1"</span><span class="p">)</span>

<span class="c1"># Save the workbook</span>
<span class="n">writer</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

<span class="c1"># Seek to the beginning and read to copy the workbook to a variable in memory</span>
<span class="n">bio</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">workbook</span> <span class="o">=</span> <span class="n">bio</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p><code class="docutils literal notranslate"><span class="pre">engine</span></code> 是可选的，但建议设置。设置引擎决定了生成的 Excel 工作簿版本。设置 <code class="docutils literal notranslate"><span class="pre">engine='xlrd'</span></code> 将生成 Excel 2003 格式的工作簿 (xls)。使用 <code class="docutils literal notranslate"><span class="pre">'openpyxl'</span></code> 或 <code class="docutils literal notranslate"><span class="pre">'xlsxwriter'</span></code> 将生成 Excel 2007 格式的工作簿 (xlsx)。如果省略，则生成 Excel 2007 格式的工作簿。</p>
</div>
</section>
</section>
<section id="excel-writer-engines">
<span id="io-excel-writers"></span><h3>Excel 写入引擎<a class="headerlink" href="io.html#excel-writer-engines" title="指向此标题的链接">#</a></h3>
<p>pandas 通过两种方法选择 Excel 写入器：</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">engine</span></code> 关键字参数</p></li>
<li><p>文件名扩展名（通过配置选项中指定的默认值）</p></li>
</ol>
<p>默认情况下，pandas 对 <code class="docutils literal notranslate"><span class="pre">.xlsx</span></code> 文件使用 <a class="reference external" href="https://xlsxwriter.readthedocs.io">XlsxWriter</a>，对 <code class="docutils literal notranslate"><span class="pre">.xlsm</span></code> 文件使用 <a class="reference external" href="https://openpyxl.readthedocs.io/">openpyxl</a>。如果您安装了多个引擎，可以通过<a class="reference internal" href="options.html#options"><span class="std std-ref">设置配置选项</span></a> <code class="docutils literal notranslate"><span class="pre">io.excel.xlsx.writer</span></code> 和 <code class="docutils literal notranslate"><span class="pre">io.excel.xls.writer</span></code> 来设置默认引擎。如果 <a class="reference external" href="https://xlsxwriter.readthedocs.io">Xlsxwriter</a> 不可用，pandas 将对 <code class="docutils literal notranslate"><span class="pre">.xlsx</span></code> 文件回退到 <a class="reference external" href="https://openpyxl.readthedocs.io/">openpyxl</a>。</p>
<p>要指定要使用的写入器，可以将引擎关键字参数传递给 <code class="docutils literal notranslate"><span class="pre">to_excel</span></code> 和 <code class="docutils literal notranslate"><span class="pre">ExcelWriter</span></code>。内置引擎包括：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">openpyxl</span></code>：需要 2.4 或更高版本。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">xlsxwriter</span></code></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># By setting the 'engine' in the DataFrame 'to_excel()' methods.</span>
<span class="n">df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s2">"path_to_file.xlsx"</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s2">"Sheet1"</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">"xlsxwriter"</span><span class="p">)</span>

<span class="c1"># By setting the 'engine' in the ExcelWriter constructor.</span>
<span class="n">writer</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelWriter</span><span class="p">(</span><span class="s2">"path_to_file.xlsx"</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">"xlsxwriter"</span><span class="p">)</span>

<span class="c1"># Or via pandas configuration.</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="kn">import</span> <span class="n">options</span>  <span class="c1"># noqa: E402</span>

<span class="n">options</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">excel</span><span class="o">.</span><span class="n">xlsx</span><span class="o">.</span><span class="n">writer</span> <span class="o">=</span> <span class="s2">"xlsxwriter"</span>

<span class="n">df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s2">"path_to_file.xlsx"</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s2">"Sheet1"</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="style-and-formatting">
<span id="io-excel-style"></span><h3>样式和格式<a class="headerlink" href="io.html#style-and-formatting" title="指向此标题的链接">#</a></h3>
<p>通过使用 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> 的 <code class="docutils literal notranslate"><span class="pre">to_excel</span></code> 方法的以下参数，可以修改从 pandas 创建的 Excel 工作表的外观。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">float_format</span></code>：浮点数的格式字符串（默认 <code class="docutils literal notranslate"><span class="pre">None</span></code>）。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">freeze_panes</span></code>：一个包含两个整数的元组，表示要冻结的最底行和最右列。每个参数都基于 1，因此 (1, 1) 将冻结第一行和第一列（默认 <code class="docutils literal notranslate"><span class="pre">None</span></code>）。</p></li>
</ul>
<p>使用 <a class="reference external" href="https://xlsxwriter.readthedocs.io">Xlsxwriter</a> 引擎为使用 <code class="docutils literal notranslate"><span class="pre">to_excel</span></code> 方法创建的 Excel 工作表提供了许多格式控制选项。您可以在 <a class="reference external" href="https://xlsxwriter.readthedocs.io">Xlsxwriter</a> 文档中找到出色的示例，网址为：<a class="reference external" href="https://xlsxwriter.readthedocs.io/working_with_pandas.html">https://xlsxwriter.readthedocs.io/working_with_pandas.html</a></p>
</section>
</section>
<section id="opendocument-spreadsheets">
<span id="io-ods"></span><h2>OpenDocument 电子表格<a class="headerlink" href="io.html#opendocument-spreadsheets" title="指向此标题的链接">#</a></h2>
<p><a class="reference internal" href="io.html#excel-files">Excel 文件</a>的 I/O 方法也支持使用 <a class="reference external" href="https://pypi.ac.cn/project/odfpy/">odfpy</a> 模块读取和写入 OpenDocument 电子表格。读取和写入 OpenDocument 电子表格的语义和功能与使用 <code class="docutils literal notranslate"><span class="pre">engine='odf'</span></code> 处理 <a class="reference internal" href="io.html#excel-files">Excel 文件</a>时所能实现的功能相匹配。可选依赖项“odfpy”需要安装。</p>
<p><a class="reference internal" href="../reference/api/pandas.read_excel.html#pandas.read_excel" title="pandas.read_excel"><code class="xref py py-func docutils literal notranslate"><span class="pre">read_excel()</span></code></a> 方法可以读取 OpenDocument 电子表格。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Returns a DataFrame</span>
<span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s2">"path_to_file.ods"</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">"odf"</span><span class="p">)</span>
</pre></div>
</div>
<p>同样，<code class="xref py py-func docutils literal notranslate"><span class="pre">to_excel()</span></code> 方法可以写入 OpenDocument 电子表格。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Writes DataFrame to a .ods file</span>
<span class="n">df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s2">"path_to_file.ods"</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">"odf"</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="binary-excel-xlsb-files">
<span id="io-xlsb"></span><h2>二进制 Excel (.xlsb) 文件<a class="headerlink" href="io.html#binary-excel-xlsb-files" title="指向此标题的链接">#</a></h2>
<p><a class="reference internal" href="../reference/api/pandas.read_excel.html#pandas.read_excel" title="pandas.read_excel"><code class="xref py py-func docutils literal notranslate"><span class="pre">read_excel()</span></code></a> 方法还可以使用 <code class="docutils literal notranslate"><span class="pre">pyxlsb</span></code> 模块读取二进制 Excel 文件。读取二进制 Excel 文件的语义和功能大多与使用 <code class="docutils literal notranslate"><span class="pre">engine='pyxlsb'</span></code> 读取 <a class="reference internal" href="io.html#excel-files">Excel 文件</a>的功能相匹配。<code class="docutils literal notranslate"><span class="pre">pyxlsb</span></code> 不识别文件中的日期时间类型，而是返回浮点数（如果需要识别日期时间类型，可以使用 <a class="reference internal" href="io.html#io-calamine"><span class="std std-ref">calamine</span></a>）。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Returns a DataFrame</span>
<span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s2">"path_to_file.xlsb"</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">"pyxlsb"</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p>目前 pandas 仅支持<em>读取</em>二进制 Excel 文件。写入功能尚未实现。</p>
</div>
</section>
<section id="calamine-excel-and-ods-files">
<span id="io-calamine"></span><h2>Calamine（Excel 和 ODS 文件）<a class="headerlink" href="io.html#calamine-excel-and-ods-files" title="指向此标题的链接">#</a></h2>
<p><a class="reference internal" href="../reference/api/pandas.read_excel.html#pandas.read_excel" title="pandas.read_excel"><code class="xref py py-func docutils literal notranslate"><span class="pre">read_excel()</span></code></a> 方法可以使用 <code class="docutils literal notranslate"><span class="pre">python-calamine</span></code> 模块读取 Excel 文件（<code class="docutils literal notranslate"><span class="pre">.xlsx</span></code>、<code class="docutils literal notranslate"><span class="pre">.xlsm</span></code>、<code class="docutils literal notranslate"><span class="pre">.xls</span></code>、<code class="docutils literal notranslate"><span class="pre">.xlsb</span></code>）和 OpenDocument 电子表格（<code class="docutils literal notranslate"><span class="pre">.ods</span></code>）。该模块是 Rust 库 <a class="reference external" href="https://crates.io/crates/calamine">calamine</a> 的绑定，在大多数情况下比其他引擎更快。可选依赖项“python-calamine”需要安装。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Returns a DataFrame</span>
<span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s2">"path_to_file.xlsb"</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">"calamine"</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="clipboard">
<span id="io-clipboard"></span><h2>剪贴板<a class="headerlink" href="io.html#clipboard" title="指向此标题的链接">#</a></h2>
<p>获取数据的一种便捷方法是使用 <code class="xref py py-meth docutils literal notranslate"><span class="pre">read_clipboard()</span></code> 方法，它会获取剪贴板缓冲区的内容并将其传递给 <code class="docutils literal notranslate"><span class="pre">read_csv</span></code> 方法。例如，您可以将以下文本复制到剪贴板（在许多操作系统上按 CTRL-C）：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">  A B C</span>
<span class="go">x 1 4 p</span>
<span class="go">y 2 5 q</span>
<span class="go">z 3 6 r</span>
</pre></div>
</div>
<p>然后通过调用以下方法将数据直接导入到 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">clipdf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_clipboard</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">clipdf</span>
<span class="go">  A B C</span>
<span class="go">x 1 4 p</span>
<span class="go">y 2 5 q</span>
<span class="go">z 3 6 r</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">to_clipboard</span></code> 方法可用于将 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> 的内容写入剪贴板。之后，您可以将剪贴板内容粘贴到其他应用程序中（在许多操作系统上按 CTRL-V）。这里我们演示了将 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> 写入剪贴板并将其读回。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<span class="gp">... </span>    <span class="p">{</span><span class="s2">"A"</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="s2">"B"</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="s2">"C"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"p"</span><span class="p">,</span> <span class="s2">"q"</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">]},</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">"x"</span><span class="p">,</span> <span class="s2">"y"</span><span class="p">,</span> <span class="s2">"z"</span><span class="p">]</span>
<span class="gp">... </span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span>
<span class="go">  A B C</span>
<span class="go">x 1 4 p</span>
<span class="go">y 2 5 q</span>
<span class="go">z 3 6 r</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="o">.</span><span class="n">to_clipboard</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pd</span><span class="o">.</span><span class="n">read_clipboard</span><span class="p">()</span>
<span class="go">  A B C</span>
<span class="go">x 1 4 p</span>
<span class="go">y 2 5 q</span>
<span class="go">z 3 6 r</span>
</pre></div>
</div>
<p>我们可以看到我们得到了与之前写入剪贴板相同的内容。</p>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p>在 Linux 上，您可能需要安装 xclip 或 xsel（以及 PyQt5、PyQt4 或 qtpy）才能使用这些方法。</p>
</div>
</section>
<section id="pickling">
<span id="io-pickle"></span><h2>Pickle 序列化<a class="headerlink" href="io.html#pickling" title="指向此标题的链接">#</a></h2>
<p>所有 pandas 对象都配备了 <code class="docutils literal notranslate"><span class="pre">to_pickle</span></code> 方法，这些方法使用 Python 的 <code class="docutils literal notranslate"><span class="pre">cPickle</span></code> 模块以 pickle 格式将数据结构保存到磁盘。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [436]: </span><span class="n">df</span>
<span class="gh">Out[436]: </span>
<span class="go">c1         a   </span>
<span class="go">c2         b  d</span>
<span class="go">lvl1 lvl2      </span>
<span class="go">a    c     1  5</span>
<span class="go">     d     2  6</span>
<span class="go">b    c     3  7</span>
<span class="go">     d     4  8</span>

<span class="gp">In [437]: </span><span class="n">df</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="s2">"foo.pkl"</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">pandas</span></code> 命名空间中的 <code class="docutils literal notranslate"><span class="pre">read_pickle</span></code> 函数可用于从文件中加载任何经过 pickle 序列化的 pandas 对象（或任何其他经过 pickle 序列化的对象）。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [438]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="s2">"foo.pkl"</span><span class="p">)</span>
<span class="gh">Out[438]: </span>
<span class="go">c1         a   </span>
<span class="go">c2         b  d</span>
<span class="go">lvl1 lvl2      </span>
<span class="go">a    c     1  5</span>
<span class="go">     d     2  6</span>
<span class="go">b    c     3  7</span>
<span class="go">     d     4  8</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>从不受信任的来源加载经过 pickle 序列化的数据可能不安全。</p>
<p>详情请参见：<a class="reference external" href="https://docs.pythonlang.cn/3/library/pickle.html">https://docs.pythonlang.cn/3/library/pickle.html</a></p>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p><a class="reference internal" href="../reference/api/pandas.read_pickle.html#pandas.read_pickle" title="pandas.read_pickle"><code class="xref py py-func docutils literal notranslate"><span class="pre">read_pickle()</span></code></a> 仅保证向后兼容到几个次要版本。</p>
</div>
<section id="compressed-pickle-files">
<span id="io-pickle-compression"></span><h3>压缩的 Pickle 文件<a class="headerlink" href="io.html#compressed-pickle-files" title="指向此标题的链接">#</a></h3>
<p><a class="reference internal" href="../reference/api/pandas.read_pickle.html#pandas.read_pickle" title="pandas.read_pickle"><code class="xref py py-func docutils literal notranslate"><span class="pre">read_pickle()</span></code></a>、<a class="reference internal" href="../reference/api/pandas.DataFrame.to_pickle.html#pandas.DataFrame.to_pickle" title="pandas.DataFrame.to_pickle"><code class="xref py py-meth docutils literal notranslate"><span class="pre">DataFrame.to_pickle()</span></code></a> 和 <a class="reference internal" href="../reference/api/pandas.Series.to_pickle.html#pandas.Series.to_pickle" title="pandas.Series.to_pickle"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Series.to_pickle()</span></code></a> 可以读写压缩的 pickle 文件。支持 <code class="docutils literal notranslate"><span class="pre">gzip</span></code>、<code class="docutils literal notranslate"><span class="pre">bz2</span></code>、<code class="docutils literal notranslate"><span class="pre">xz</span></code>、<code class="docutils literal notranslate"><span class="pre">zstd</span></code> 压缩类型进行读写。<code class="docutils literal notranslate"><span class="pre">zip</span></code> 文件格式仅支持读取，并且必须只包含一个要读取的数据文件。</p>
<p>压缩类型可以是显式参数，也可以从文件扩展名推断。如果为“infer”，则如果文件名分别以 <code class="docutils literal notranslate"><span class="pre">'.gz'</span></code>、<code class="docutils literal notranslate"><span class="pre">'.bz2'</span></code>、<code class="docutils literal notranslate"><span class="pre">'.zip'</span></code>、<code class="docutils literal notranslate"><span class="pre">'.xz'</span></code> 或 <code class="docutils literal notranslate"><span class="pre">'.zst'</span></code> 结尾，则使用 <code class="docutils literal notranslate"><span class="pre">gzip</span></code>、<code class="docutils literal notranslate"><span class="pre">bz2</span></code>、<code class="docutils literal notranslate"><span class="pre">zip</span></code>、<code class="docutils literal notranslate"><span class="pre">xz</span></code> 或 <code class="docutils literal notranslate"><span class="pre">zstd</span></code>。</p>
<p>压缩参数也可以是 <code class="docutils literal notranslate"><span class="pre">dict</span></code> 类型，以便向压缩协议传递选项。它必须有一个 <code class="docutils literal notranslate"><span class="pre">'method'</span></code> 键，其值设置为压缩协议的名称，该名称必须是 {<code class="docutils literal notranslate"><span class="pre">'zip'</span></code>, <code class="docutils literal notranslate"><span class="pre">'gzip'</span></code>, <code class="docutils literal notranslate"><span class="pre">'bz2'</span></code>, <code class="docutils literal notranslate"><span class="pre">'xz'</span></code>, <code class="docutils literal notranslate"><span class="pre">'zstd'</span></code>} 中的一个。所有其他键值对都传递给底层的压缩库。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [439]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="p">{</span>
<span class="gp">   .....: </span>        <span class="s2">"A"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1000</span><span class="p">),</span>
<span class="gp">   .....: </span>        <span class="s2">"B"</span><span class="p">:</span> <span class="s2">"foo"</span><span class="p">,</span>
<span class="gp">   .....: </span>        <span class="s2">"C"</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">"20130101"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"s"</span><span class="p">),</span>
<span class="gp">   .....: </span>    <span class="p">}</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [440]: </span><span class="n">df</span>
<span class="gh">Out[440]: </span>
<span class="go">            A    B                   C</span>
<span class="go">0   -0.317441  foo 2013-01-01 00:00:00</span>
<span class="go">1   -1.236269  foo 2013-01-01 00:00:01</span>
<span class="go">2    0.896171  foo 2013-01-01 00:00:02</span>
<span class="go">3   -0.487602  foo 2013-01-01 00:00:03</span>
<span class="go">4   -0.082240  foo 2013-01-01 00:00:04</span>
<span class="go">..        ...  ...                 ...</span>
<span class="go">995 -0.171092  foo 2013-01-01 00:16:35</span>
<span class="go">996  1.786173  foo 2013-01-01 00:16:36</span>
<span class="go">997 -0.575189  foo 2013-01-01 00:16:37</span>
<span class="go">998  0.820750  foo 2013-01-01 00:16:38</span>
<span class="go">999 -1.256530  foo 2013-01-01 00:16:39</span>

<span class="go">[1000 rows x 3 columns]</span>
</pre></div>
</div>
<p>使用显式压缩类型</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [441]: </span><span class="n">df</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="s2">"data.pkl.compress"</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="s2">"gzip"</span><span class="p">)</span>

<span class="gp">In [442]: </span><span class="n">rt</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="s2">"data.pkl.compress"</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="s2">"gzip"</span><span class="p">)</span>

<span class="gp">In [443]: </span><span class="n">rt</span>
<span class="gh">Out[443]: </span>
<span class="go">            A    B                   C</span>
<span class="go">0   -0.317441  foo 2013-01-01 00:00:00</span>
<span class="go">1   -1.236269  foo 2013-01-01 00:00:01</span>
<span class="go">2    0.896171  foo 2013-01-01 00:00:02</span>
<span class="go">3   -0.487602  foo 2013-01-01 00:00:03</span>
<span class="go">4   -0.082240  foo 2013-01-01 00:00:04</span>
<span class="go">..        ...  ...                 ...</span>
<span class="go">995 -0.171092  foo 2013-01-01 00:16:35</span>
<span class="go">996  1.786173  foo 2013-01-01 00:16:36</span>
<span class="go">997 -0.575189  foo 2013-01-01 00:16:37</span>
<span class="go">998  0.820750  foo 2013-01-01 00:16:38</span>
<span class="go">999 -1.256530  foo 2013-01-01 00:16:39</span>

<span class="go">[1000 rows x 3 columns]</span>
</pre></div>
</div>
<p>从扩展名推断压缩类型</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [444]: </span><span class="n">df</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="s2">"data.pkl.xz"</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="s2">"infer"</span><span class="p">)</span>

<span class="gp">In [445]: </span><span class="n">rt</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="s2">"data.pkl.xz"</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="s2">"infer"</span><span class="p">)</span>

<span class="gp">In [446]: </span><span class="n">rt</span>
<span class="gh">Out[446]: </span>
<span class="go">            A    B                   C</span>
<span class="go">0   -0.317441  foo 2013-01-01 00:00:00</span>
<span class="go">1   -1.236269  foo 2013-01-01 00:00:01</span>
<span class="go">2    0.896171  foo 2013-01-01 00:00:02</span>
<span class="go">3   -0.487602  foo 2013-01-01 00:00:03</span>
<span class="go">4   -0.082240  foo 2013-01-01 00:00:04</span>
<span class="go">..        ...  ...                 ...</span>
<span class="go">995 -0.171092  foo 2013-01-01 00:16:35</span>
<span class="go">996  1.786173  foo 2013-01-01 00:16:36</span>
<span class="go">997 -0.575189  foo 2013-01-01 00:16:37</span>
<span class="go">998  0.820750  foo 2013-01-01 00:16:38</span>
<span class="go">999 -1.256530  foo 2013-01-01 00:16:39</span>

<span class="go">[1000 rows x 3 columns]</span>
</pre></div>
</div>
<p>默认是“推断”</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [447]: </span><span class="n">df</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="s2">"data.pkl.gz"</span><span class="p">)</span>

<span class="gp">In [448]: </span><span class="n">rt</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="s2">"data.pkl.gz"</span><span class="p">)</span>

<span class="gp">In [449]: </span><span class="n">rt</span>
<span class="gh">Out[449]: </span>
<span class="go">            A    B                   C</span>
<span class="go">0   -0.317441  foo 2013-01-01 00:00:00</span>
<span class="go">1   -1.236269  foo 2013-01-01 00:00:01</span>
<span class="go">2    0.896171  foo 2013-01-01 00:00:02</span>
<span class="go">3   -0.487602  foo 2013-01-01 00:00:03</span>
<span class="go">4   -0.082240  foo 2013-01-01 00:00:04</span>
<span class="go">..        ...  ...                 ...</span>
<span class="go">995 -0.171092  foo 2013-01-01 00:16:35</span>
<span class="go">996  1.786173  foo 2013-01-01 00:16:36</span>
<span class="go">997 -0.575189  foo 2013-01-01 00:16:37</span>
<span class="go">998  0.820750  foo 2013-01-01 00:16:38</span>
<span class="go">999 -1.256530  foo 2013-01-01 00:16:39</span>

<span class="go">[1000 rows x 3 columns]</span>

<span class="gp">In [450]: </span><span class="n">df</span><span class="p">[</span><span class="s2">"A"</span><span class="p">]</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="s2">"s1.pkl.bz2"</span><span class="p">)</span>

<span class="gp">In [451]: </span><span class="n">rt</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="s2">"s1.pkl.bz2"</span><span class="p">)</span>

<span class="gp">In [452]: </span><span class="n">rt</span>
<span class="gh">Out[452]: </span>
<span class="go">0     -0.317441</span>
<span class="go">1     -1.236269</span>
<span class="go">2      0.896171</span>
<span class="go">3     -0.487602</span>
<span class="go">4     -0.082240</span>
<span class="go">         ...   </span>
<span class="go">995   -0.171092</span>
<span class="go">996    1.786173</span>
<span class="go">997   -0.575189</span>
<span class="go">998    0.820750</span>
<span class="go">999   -1.256530</span>
<span class="go">Name: A, Length: 1000, dtype: float64</span>
</pre></div>
</div>
<p>向压缩协议传递选项以加快压缩速度</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [453]: </span><span class="n">df</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="s2">"data.pkl.gz"</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="p">{</span><span class="s2">"method"</span><span class="p">:</span> <span class="s2">"gzip"</span><span class="p">,</span> <span class="s2">"compresslevel"</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
</pre></div>
</div>
</section>
</section>
<section id="msgpack">
<span id="io-msgpack"></span><h2>msgpack<a class="headerlink" href="io.html#msgpack" title="指向此标题的链接">#</a></h2>
<p>pandas 对 <code class="docutils literal notranslate"><span class="pre">msgpack</span></code> 的支持已在 1.0.0 版本中移除。建议改用 <a class="reference internal" href="io.html#io-pickle"><span class="std std-ref">pickle</span></a>。</p>
<p>或者，您也可以使用 Arrow IPC 序列化格式进行 pandas 对象的在线传输。有关 pyarrow 的文档，请参阅<a class="reference external" href="https://arrow.apache.ac.cn/docs/python/ipc.html">此处</a>。</p>
</section>
<section id="hdf5-pytables">
<span id="io-hdf5"></span><h2>HDF5 (PyTables)<a class="headerlink" href="io.html#hdf5-pytables" title="指向此标题的链接">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">HDFStore</span></code> 是一个类似字典的对象，它使用出色的 <a class="reference external" href="https://www.pytables.org/">PyTables</a> 库，以高性能的 HDF5 格式读写 pandas 数据。有关一些高级策略，请参见<a class="reference internal" href="cookbook.html#cookbook-hdf"><span class="std std-ref">cookbook</span></a>。</p>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>pandas 使用 PyTables 读写 HDF5 文件，这允许使用 pickle 序列化对象 dtype 数据。从不受信任的来源加载经过 pickle 序列化的数据可能不安全。</p>
<p>详情请参见：<a class="reference external" href="https://docs.pythonlang.cn/3/library/pickle.html">https://docs.pythonlang.cn/3/library/pickle.html</a>。</p>
</div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [454]: </span><span class="n">store</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">HDFStore</span><span class="p">(</span><span class="s2">"store.h5"</span><span class="p">)</span>

<span class="gp">In [455]: </span><span class="nb">print</span><span class="p">(</span><span class="n">store</span><span class="p">)</span>
<span class="go">&lt;class 'pandas.io.pytables.HDFStore'&gt;</span>
<span class="go">File path: store.h5</span>
</pre></div>
</div>
<p>对象可以像向字典添加键值对一样写入文件。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [456]: </span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">"1/1/2000"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<span class="gp">In [457]: </span><span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">,</span> <span class="s2">"c"</span><span class="p">,</span> <span class="s2">"d"</span><span class="p">,</span> <span class="s2">"e"</span><span class="p">])</span>

<span class="gp">In [458]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"A"</span><span class="p">,</span> <span class="s2">"B"</span><span class="p">,</span> <span class="s2">"C"</span><span class="p">])</span>

<span class="go"># store.put('s', s) is an equivalent method</span>
<span class="gp">In [459]: </span><span class="n">store</span><span class="p">[</span><span class="s2">"s"</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span>

<span class="gp">In [460]: </span><span class="n">store</span><span class="p">[</span><span class="s2">"df"</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span>

<span class="gp">In [461]: </span><span class="n">store</span>
<span class="gh">Out[461]: </span>
<span class="go">&lt;class 'pandas.io.pytables.HDFStore'&gt;</span>
<span class="go">File path: store.h5</span>
</pre></div>
</div>
<p>在当前或以后的 Python 会话中，您可以检索存储的对象。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="go"># store.get('df') is an equivalent method</span>
<span class="gp">In [462]: </span><span class="n">store</span><span class="p">[</span><span class="s2">"df"</span><span class="p">]</span>
<span class="gh">Out[462]: </span>
<span class="go">                   A         B         C</span>
<span class="go">2000-01-01  0.858644 -0.851236  1.058006</span>
<span class="go">2000-01-02 -0.080372 -1.268121  1.561967</span>
<span class="go">2000-01-03  0.816983  1.965656 -1.169408</span>
<span class="go">2000-01-04  0.712795 -0.062433  0.736755</span>
<span class="go">2000-01-05 -0.298721 -1.988045  1.475308</span>
<span class="go">2000-01-06  1.103675  1.382242 -0.650762</span>
<span class="go">2000-01-07 -0.729161 -0.142928 -1.063038</span>
<span class="go">2000-01-08 -1.005977  0.465222 -0.094517</span>

<span class="go"># dotted (attribute) access provides get as well</span>
<span class="gp">In [463]: </span><span class="n">store</span><span class="o">.</span><span class="n">df</span>
<span class="gh">Out[463]: </span>
<span class="go">                   A         B         C</span>
<span class="go">2000-01-01  0.858644 -0.851236  1.058006</span>
<span class="go">2000-01-02 -0.080372 -1.268121  1.561967</span>
<span class="go">2000-01-03  0.816983  1.965656 -1.169408</span>
<span class="go">2000-01-04  0.712795 -0.062433  0.736755</span>
<span class="go">2000-01-05 -0.298721 -1.988045  1.475308</span>
<span class="go">2000-01-06  1.103675  1.382242 -0.650762</span>
<span class="go">2000-01-07 -0.729161 -0.142928 -1.063038</span>
<span class="go">2000-01-08 -1.005977  0.465222 -0.094517</span>
</pre></div>
</div>
<p>删除由键指定的对象</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="go"># store.remove('df') is an equivalent method</span>
<span class="gp">In [464]: </span><span class="k">del</span> <span class="n">store</span><span class="p">[</span><span class="s2">"df"</span><span class="p">]</span>

<span class="gp">In [465]: </span><span class="n">store</span>
<span class="gh">Out[465]: </span>
<span class="go">&lt;class 'pandas.io.pytables.HDFStore'&gt;</span>
<span class="go">File path: store.h5</span>
</pre></div>
</div>
<p>关闭存储并使用上下文管理器</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [466]: </span><span class="n">store</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="gp">In [467]: </span><span class="n">store</span>
<span class="gh">Out[467]: </span>
<span class="go">&lt;class 'pandas.io.pytables.HDFStore'&gt;</span>
<span class="go">File path: store.h5</span>

<span class="gp">In [468]: </span><span class="n">store</span><span class="o">.</span><span class="n">is_open</span>
<span class="gh">Out[468]: </span><span class="go">False</span>

<span class="go"># Working with, and automatically closing the store using a context manager</span>
<span class="gp">In [469]: </span><span class="k">with</span> <span class="n">pd</span><span class="o">.</span><span class="n">HDFStore</span><span class="p">(</span><span class="s2">"store.h5"</span><span class="p">)</span> <span class="k">as</span> <span class="n">store</span><span class="p">:</span>
<span class="gp">   .....: </span>    <span class="n">store</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="gp">   .....: </span>
</pre></div>
</div>
<section id="read-write-api">
<h3>读写 API<a class="headerlink" href="io.html#read-write-api" title="指向此标题的链接">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">HDFStore</span></code> 支持顶层 API，使用 <code class="docutils literal notranslate"><span class="pre">read_hdf</span></code> 进行读取，使用 <code class="docutils literal notranslate"><span class="pre">to_hdf</span></code> 进行写入，类似于 <code class="docutils literal notranslate"><span class="pre">read_csv</span></code> 和 <code class="docutils literal notranslate"><span class="pre">to_csv</span></code> 的工作方式。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [470]: </span><span class="n">df_tl</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">"A"</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)),</span> <span class="s2">"B"</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">))})</span>

<span class="gp">In [471]: </span><span class="n">df_tl</span><span class="o">.</span><span class="n">to_hdf</span><span class="p">(</span><span class="s2">"store_tl.h5"</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s2">"table"</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="gp">In [472]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_hdf</span><span class="p">(</span><span class="s2">"store_tl.h5"</span><span class="p">,</span> <span class="s2">"table"</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="p">[</span><span class="s2">"index&gt;2"</span><span class="p">])</span>
<span class="gh">Out[472]: </span>
<span class="go">   A  B</span>
<span class="go">3  3  3</span>
<span class="go">4  4  4</span>
</pre></div>
</div>
<p>HDFStore 默认不会丢弃所有缺失的行。通过设置 <code class="docutils literal notranslate"><span class="pre">dropna=True</span></code> 可以更改此行为。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [473]: </span><span class="n">df_with_missing</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="p">{</span>
<span class="gp">   .....: </span>        <span class="s2">"col1"</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
<span class="gp">   .....: </span>        <span class="s2">"col2"</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span>
<span class="gp">   .....: </span>    <span class="p">}</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [474]: </span><span class="n">df_with_missing</span>
<span class="gh">Out[474]: </span>
<span class="go">   col1  col2</span>
<span class="go">0   0.0   1.0</span>
<span class="go">1   NaN   NaN</span>
<span class="go">2   2.0   NaN</span>

<span class="gp">In [475]: </span><span class="n">df_with_missing</span><span class="o">.</span><span class="n">to_hdf</span><span class="p">(</span><span class="s2">"file.h5"</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s2">"df_with_missing"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">"table"</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"w"</span><span class="p">)</span>

<span class="gp">In [476]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_hdf</span><span class="p">(</span><span class="s2">"file.h5"</span><span class="p">,</span> <span class="s2">"df_with_missing"</span><span class="p">)</span>
<span class="gh">Out[476]: </span>
<span class="go">   col1  col2</span>
<span class="go">0   0.0   1.0</span>
<span class="go">1   NaN   NaN</span>
<span class="go">2   2.0   NaN</span>

<span class="gp">In [477]: </span><span class="n">df_with_missing</span><span class="o">.</span><span class="n">to_hdf</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="s2">"file.h5"</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s2">"df_with_missing"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">"table"</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"w"</span><span class="p">,</span> <span class="n">dropna</span><span class="o">=</span><span class="kc">True</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [478]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_hdf</span><span class="p">(</span><span class="s2">"file.h5"</span><span class="p">,</span> <span class="s2">"df_with_missing"</span><span class="p">)</span>
<span class="gh">Out[478]: </span>
<span class="go">   col1  col2</span>
<span class="go">0   0.0   1.0</span>
<span class="go">2   2.0   NaN</span>
</pre></div>
</div>
</section>
<section id="fixed-format">
<span id="io-hdf5-fixed"></span><h3>固定格式<a class="headerlink" href="io.html#fixed-format" title="指向此标题的链接">#</a></h3>
<p>上面的示例展示了使用 <code class="docutils literal notranslate"><span class="pre">put</span></code> 进行存储，它以固定数组格式（称为 <code class="docutils literal notranslate"><span class="pre">fixed</span></code> 格式）将 HDF5 写入 <code class="docutils literal notranslate"><span class="pre">PyTables</span></code>。这些类型的存储一旦写入就<strong>不可追加</strong>（尽管您可以直接删除它们并重新写入）。它们也<strong>不可查询</strong>；必须完整检索它们。它们也不支持具有非唯一列名的数据帧。<code class="docutils literal notranslate"><span class="pre">fixed</span></code> 格式的存储提供了非常快的写入速度和比 <code class="docutils literal notranslate"><span class="pre">table</span></code> 存储稍快的读取速度。使用 <code class="docutils literal notranslate"><span class="pre">put</span></code> 或 <code class="docutils literal notranslate"><span class="pre">to_hdf</span></code> 时，或者通过 <code class="docutils literal notranslate"><span class="pre">format='fixed'</span></code> 或 <code class="docutils literal notranslate"><span class="pre">format='f'</span></code> 时，默认指定此格式。</p>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>如果您尝试使用 <code class="docutils literal notranslate"><span class="pre">where</span></code> 进行检索，<code class="docutils literal notranslate"><span class="pre">fixed</span></code> 格式将引发 <code class="docutils literal notranslate"><span class="pre">TypeError</span></code>。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [479]: </span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">to_hdf</span><span class="p">(</span><span class="s2">"test_fixed.h5"</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s2">"df"</span><span class="p">)</span>

<span class="gp">In [480]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_hdf</span><span class="p">(</span><span class="s2">"test_fixed.h5"</span><span class="p">,</span> <span class="s2">"df"</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="s2">"index&gt;5"</span><span class="p">)</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">TypeError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">480</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_hdf</span><span class="p">(</span><span class="s2">"test_fixed.h5"</span><span class="p">,</span> <span class="s2">"df"</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="s2">"index&gt;5"</span><span class="p">)</span>

<span class="nn">File ~/work/pandas/pandas/pandas/io/pytables.py:457,</span> in <span class="ni">read_hdf</span><span class="nt">(path_or_buf, key, mode, errors, where, start, stop, columns, iterator, chunksize, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">452</span>                 <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">453</span>                     <span class="s2">"key must be provided when HDF5 "</span>
<span class="g g-Whitespace">    </span><span class="mi">454</span>                     <span class="s2">"file contains multiple datasets."</span>
<span class="g g-Whitespace">    </span><span class="mi">455</span>                 <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">456</span>         <span class="n">key</span> <span class="o">=</span> <span class="n">candidate_only_group</span><span class="o">.</span><span class="n">_v_pathname</span>
<span class="ne">--&gt; </span><span class="mi">457</span>     <span class="k">return</span> <span class="n">store</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">458</span>         <span class="n">key</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">459</span>         <span class="n">where</span><span class="o">=</span><span class="n">where</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">460</span>         <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">461</span>         <span class="n">stop</span><span class="o">=</span><span class="n">stop</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">462</span>         <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">463</span>         <span class="n">iterator</span><span class="o">=</span><span class="n">iterator</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">464</span>         <span class="n">chunksize</span><span class="o">=</span><span class="n">chunksize</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">465</span>         <span class="n">auto_close</span><span class="o">=</span><span class="n">auto_close</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">466</span>     <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">467</span> <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">,</span> <span class="ne">LookupError</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">468</span>     <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">path_or_buf</span><span class="p">,</span> <span class="n">HDFStore</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">469</span>         <span class="c1"># if there is an error, close the store if we opened it.</span>

<span class="nn">File ~/work/pandas/pandas/pandas/io/pytables.py:911,</span> in <span class="ni">HDFStore.select</span><span class="nt">(self, key, where, start, stop, columns, iterator, chunksize, auto_close)</span>
<span class="g g-Whitespace">    </span><span class="mi">897</span> <span class="c1"># create the iterator</span>
<span class="g g-Whitespace">    </span><span class="mi">898</span> <span class="n">it</span> <span class="o">=</span> <span class="n">TableIterator</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">899</span>     <span class="bp">self</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">900</span>     <span class="n">s</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">908</span>     <span class="n">auto_close</span><span class="o">=</span><span class="n">auto_close</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">909</span> <span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">911</span> <span class="k">return</span> <span class="n">it</span><span class="o">.</span><span class="n">get_result</span><span class="p">()</span>

<span class="nn">File ~/work/pandas/pandas/pandas/io/pytables.py:2034,</span> in <span class="ni">TableIterator.get_result</span><span class="nt">(self, coordinates)</span>
<span class="g g-Whitespace">   </span><span class="mi">2031</span>     <span class="n">where</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">where</span>
<span class="g g-Whitespace">   </span><span class="mi">2033</span> <span class="c1"># directly return the result</span>
<span class="ne">-&gt; </span><span class="mi">2034</span> <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">,</span> <span class="n">where</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2035</span> <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="g g-Whitespace">   </span><span class="mi">2036</span> <span class="k">return</span> <span class="n">results</span>

<span class="nn">File ~/work/pandas/pandas/pandas/io/pytables.py:895,</span> in <span class="ni">HDFStore.select.&lt;locals&gt;.func</span><span class="nt">(_start, _stop, _where)</span>
<span class="g g-Whitespace">    </span><span class="mi">894</span> <span class="k">def</span><span class="w"> </span><span class="nf">func</span><span class="p">(</span><span class="n">_start</span><span class="p">,</span> <span class="n">_stop</span><span class="p">,</span> <span class="n">_where</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">895</span>     <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">_start</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="n">_stop</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">_where</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>

<span class="nn">File ~/work/pandas/pandas/pandas/io/pytables.py:3295,</span> in <span class="ni">BlockManagerFixed.read</span><span class="nt">(self, where, columns, start, stop)</span>
<span class="g g-Whitespace">   </span><span class="mi">3287</span> <span class="k">def</span><span class="w"> </span><span class="nf">read</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">3288</span>     <span class="bp">self</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">3289</span>     <span class="n">where</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">3293</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">3294</span>     <span class="c1"># start, stop applied to rows, so 0th axis only</span>
<span class="ne">-&gt; </span><span class="mi">3295</span>     <span class="bp">self</span><span class="o">.</span><span class="n">validate_read</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="n">where</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">3296</span>     <span class="n">select_axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj_type</span><span class="p">()</span><span class="o">.</span><span class="n">_get_block_manager_axis</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">3298</span>     <span class="n">axes</span> <span class="o">=</span> <span class="p">[]</span>

<span class="nn">File ~/work/pandas/pandas/pandas/io/pytables.py:2927,</span> in <span class="ni">GenericFixed.validate_read</span><span class="nt">(self, columns, where)</span>
<span class="g g-Whitespace">   </span><span class="mi">2922</span>     <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">2923</span>         <span class="s2">"cannot pass a column specification when reading "</span>
<span class="g g-Whitespace">   </span><span class="mi">2924</span>         <span class="s2">"a Fixed format store. this store must be selected in its entirety"</span>
<span class="g g-Whitespace">   </span><span class="mi">2925</span>     <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2926</span> <span class="k">if</span> <span class="n">where</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">2927</span>     <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">2928</span>         <span class="s2">"cannot pass a where specification when reading "</span>
<span class="g g-Whitespace">   </span><span class="mi">2929</span>         <span class="s2">"from a Fixed format store. this store must be selected in its entirety"</span>
<span class="g g-Whitespace">   </span><span class="mi">2930</span>     <span class="p">)</span>

<span class="ne">TypeError</span>: cannot pass a where specification when reading from a Fixed format store. this store must be selected in its entirety
</pre></div>
</div>
</div>
</section>
<section id="table-format">
<span id="io-hdf5-table"></span><h3>表格式<a class="headerlink" href="io.html#table-format" title="指向此标题的链接">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">HDFStore</span></code> 支持另一种磁盘上的 <code class="docutils literal notranslate"><span class="pre">PyTables</span></code> 格式，即 <code class="docutils literal notranslate"><span class="pre">table</span></code> 格式。从概念上讲，<code class="docutils literal notranslate"><span class="pre">table</span></code> 的形状与 DataFrame 非常相似，具有行和列。<code class="docutils literal notranslate"><span class="pre">table</span></code> 可以在相同或不同的会话中进行追加。此外，还支持删除和查询操作。此格式通过 <code class="docutils literal notranslate"><span class="pre">append</span></code>、<code class="docutils literal notranslate"><span class="pre">put</span></code> 或 <code class="docutils literal notranslate"><span class="pre">to_hdf</span></code> 的 <code class="docutils literal notranslate"><span class="pre">format='table'</span></code> 或 <code class="docutils literal notranslate"><span class="pre">format='t'</span></code> 来指定。</p>
<p>此格式也可以设置为选项，例如 <code class="docutils literal notranslate"><span class="pre">pd.set_option('io.hdf.default_format','table')</span></code>，以使 <code class="docutils literal notranslate"><span class="pre">put/append/to_hdf</span></code> 默认以 <code class="docutils literal notranslate"><span class="pre">table</span></code> 格式存储。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [481]: </span><span class="n">store</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">HDFStore</span><span class="p">(</span><span class="s2">"store.h5"</span><span class="p">)</span>

<span class="gp">In [482]: </span><span class="n">df1</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>

<span class="gp">In [483]: </span><span class="n">df2</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span>

<span class="go"># append data (creates a table automatically)</span>
<span class="gp">In [484]: </span><span class="n">store</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"df"</span><span class="p">,</span> <span class="n">df1</span><span class="p">)</span>

<span class="gp">In [485]: </span><span class="n">store</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"df"</span><span class="p">,</span> <span class="n">df2</span><span class="p">)</span>

<span class="gp">In [486]: </span><span class="n">store</span>
<span class="gh">Out[486]: </span>
<span class="go">&lt;class 'pandas.io.pytables.HDFStore'&gt;</span>
<span class="go">File path: store.h5</span>

<span class="go"># select the entire object</span>
<span class="gp">In [487]: </span><span class="n">store</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">"df"</span><span class="p">)</span>
<span class="gh">Out[487]: </span>
<span class="go">                   A         B         C</span>
<span class="go">2000-01-01  0.858644 -0.851236  1.058006</span>
<span class="go">2000-01-02 -0.080372 -1.268121  1.561967</span>
<span class="go">2000-01-03  0.816983  1.965656 -1.169408</span>
<span class="go">2000-01-04  0.712795 -0.062433  0.736755</span>
<span class="go">2000-01-05 -0.298721 -1.988045  1.475308</span>
<span class="go">2000-01-06  1.103675  1.382242 -0.650762</span>
<span class="go">2000-01-07 -0.729161 -0.142928 -1.063038</span>
<span class="go">2000-01-08 -1.005977  0.465222 -0.094517</span>

<span class="go"># the type of stored data</span>
<span class="gp">In [488]: </span><span class="n">store</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">_v_attrs</span><span class="o">.</span><span class="n">pandas_type</span>
<span class="gh">Out[488]: </span><span class="go">'frame_table'</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p>您还可以通过在 <code class="docutils literal notranslate"><span class="pre">put</span></code> 操作中传入 <code class="docutils literal notranslate"><span class="pre">format='table'</span></code> 或 <code class="docutils literal notranslate"><span class="pre">format='t'</span></code> 来创建 <code class="docutils literal notranslate"><span class="pre">table</span></code>。</p>
</div>
</section>
<section id="hierarchical-keys">
<span id="io-hdf5-keys"></span><h3>分层键<a class="headerlink" href="io.html#hierarchical-keys" title="指向此标题的链接">#</a></h3>
<p>存储的键可以指定为字符串。它们可以是分层路径名格式（例如 <code class="docutils literal notranslate"><span class="pre">foo/bar/bah</span></code>），这将生成一个子存储（或 PyTables 中的 <code class="docutils literal notranslate"><span class="pre">Groups</span></code>）的层次结构。键可以不带开头的“/”指定，并且<strong>总是</strong>绝对的（例如，“foo”指“/foo”）。删除操作可以删除子存储及其<strong>以下</strong>的所有内容，因此请<em>小心</em>。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [489]: </span><span class="n">store</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s2">"foo/bar/bah"</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>

<span class="gp">In [490]: </span><span class="n">store</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"food/orange"</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>

<span class="gp">In [491]: </span><span class="n">store</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"food/apple"</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>

<span class="gp">In [492]: </span><span class="n">store</span>
<span class="gh">Out[492]: </span>
<span class="go">&lt;class 'pandas.io.pytables.HDFStore'&gt;</span>
<span class="go">File path: store.h5</span>

<span class="go"># a list of keys are returned</span>
<span class="gp">In [493]: </span><span class="n">store</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="gh">Out[493]: </span><span class="go">['/df', '/food/apple', '/food/orange', '/foo/bar/bah']</span>

<span class="go"># remove all nodes under this level</span>
<span class="gp">In [494]: </span><span class="n">store</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">"food"</span><span class="p">)</span>

<span class="gp">In [495]: </span><span class="n">store</span>
<span class="gh">Out[495]: </span>
<span class="go">&lt;class 'pandas.io.pytables.HDFStore'&gt;</span>
<span class="go">File path: store.h5</span>
</pre></div>
</div>
<p>您可以使用 <code class="docutils literal notranslate"><span class="pre">walk</span></code> 方法遍历组层次结构，该方法将为每个组键及其内容的相对键生成一个元组。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [496]: </span><span class="k">for</span> <span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">subgroups</span><span class="p">,</span> <span class="n">subkeys</span><span class="p">)</span> <span class="ow">in</span> <span class="n">store</span><span class="o">.</span><span class="n">walk</span><span class="p">():</span>
<span class="gp">   .....: </span>    <span class="k">for</span> <span class="n">subgroup</span> <span class="ow">in</span> <span class="n">subgroups</span><span class="p">:</span>
<span class="gp">   .....: </span>        <span class="nb">print</span><span class="p">(</span><span class="s2">"GROUP: </span><span class="si">{}</span><span class="s2">/</span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">subgroup</span><span class="p">))</span>
<span class="gp">   .....: </span>    <span class="k">for</span> <span class="n">subkey</span> <span class="ow">in</span> <span class="n">subkeys</span><span class="p">:</span>
<span class="gp">   .....: </span>        <span class="n">key</span> <span class="o">=</span> <span class="s2">"/"</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">path</span><span class="p">,</span> <span class="n">subkey</span><span class="p">])</span>
<span class="gp">   .....: </span>        <span class="nb">print</span><span class="p">(</span><span class="s2">"KEY: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
<span class="gp">   .....: </span>        <span class="nb">print</span><span class="p">(</span><span class="n">store</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
<span class="gp">   .....: </span>
<span class="go">GROUP: /foo</span>
<span class="go">KEY: /df</span>
<span class="go">                   A         B         C</span>
<span class="go">2000-01-01  0.858644 -0.851236  1.058006</span>
<span class="go">2000-01-02 -0.080372 -1.268121  1.561967</span>
<span class="go">2000-01-03  0.816983  1.965656 -1.169408</span>
<span class="go">2000-01-04  0.712795 -0.062433  0.736755</span>
<span class="go">2000-01-05 -0.298721 -1.988045  1.475308</span>
<span class="go">2000-01-06  1.103675  1.382242 -0.650762</span>
<span class="go">2000-01-07 -0.729161 -0.142928 -1.063038</span>
<span class="go">2000-01-08 -1.005977  0.465222 -0.094517</span>
<span class="go">GROUP: /foo/bar</span>
<span class="go">KEY: /foo/bar/bah</span>
<span class="go">                   A         B         C</span>
<span class="go">2000-01-01  0.858644 -0.851236  1.058006</span>
<span class="go">2000-01-02 -0.080372 -1.268121  1.561967</span>
<span class="go">2000-01-03  0.816983  1.965656 -1.169408</span>
<span class="go">2000-01-04  0.712795 -0.062433  0.736755</span>
<span class="go">2000-01-05 -0.298721 -1.988045  1.475308</span>
<span class="go">2000-01-06  1.103675  1.382242 -0.650762</span>
<span class="go">2000-01-07 -0.729161 -0.142928 -1.063038</span>
<span class="go">2000-01-08 -1.005977  0.465222 -0.094517</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>分层键无法像上面描述的根节点下存储的项那样以点（属性）访问方式检索。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [497]: </span><span class="n">store</span><span class="o">.</span><span class="n">foo</span><span class="o">.</span><span class="n">bar</span><span class="o">.</span><span class="n">bah</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">TypeError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">497</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">store</span><span class="o">.</span><span class="n">foo</span><span class="o">.</span><span class="n">bar</span><span class="o">.</span><span class="n">bah</span>

<span class="nn">File ~/work/pandas/pandas/pandas/io/pytables.py:618,</span> in <span class="ni">HDFStore.__getattr__</span><span class="nt">(self, name)</span>
<span class="g g-Whitespace">    </span><span class="mi">616</span><span class="w"> </span><span class="sd">"""allow attribute access to get stores"""</span>
<span class="g g-Whitespace">    </span><span class="mi">617</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">618</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">619</span> <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="n">ClosedFileError</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">620</span>     <span class="k">pass</span>

<span class="nn">File ~/work/pandas/pandas/pandas/io/pytables.py:818,</span> in <span class="ni">HDFStore.get</span><span class="nt">(self, key)</span>
<span class="g g-Whitespace">    </span><span class="mi">816</span> <span class="k">if</span> <span class="n">group</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">817</span>     <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">"No object named </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> in the file"</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">818</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_group</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>

<span class="nn">File ~/work/pandas/pandas/pandas/io/pytables.py:1883,</span> in <span class="ni">HDFStore._read_group</span><span class="nt">(self, group)</span>
<span class="g g-Whitespace">   </span><span class="mi">1882</span> <span class="k">def</span><span class="w"> </span><span class="nf">_read_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">:</span> <span class="n">Node</span><span class="p">):</span>
<span class="ne">-&gt; </span><span class="mi">1883</span>     <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_storer</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1884</span>     <span class="n">s</span><span class="o">.</span><span class="n">infer_axes</span><span class="p">()</span>
<span class="g g-Whitespace">   </span><span class="mi">1885</span>     <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="nn">File ~/work/pandas/pandas/pandas/io/pytables.py:1757,</span> in <span class="ni">HDFStore._create_storer</span><span class="nt">(self, group, format, value, encoding, errors)</span>
<span class="g g-Whitespace">   </span><span class="mi">1755</span>         <span class="n">tt</span> <span class="o">=</span> <span class="s2">"generic_table"</span>
<span class="g g-Whitespace">   </span><span class="mi">1756</span>     <span class="k">else</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">1757</span>         <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1758</span>             <span class="s2">"cannot create a storer if the object is not existing "</span>
<span class="g g-Whitespace">   </span><span class="mi">1759</span>             <span class="s2">"nor a value are passed"</span>
<span class="g g-Whitespace">   </span><span class="mi">1760</span>         <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1761</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1762</span>     <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Series</span><span class="p">):</span>

<span class="ne">TypeError</span>: cannot create a storer if the object is not existing nor a value are passed
</pre></div>
</div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="go"># you can directly access the actual PyTables node but using the root node</span>
<span class="gp">In [498]: </span><span class="n">store</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">foo</span><span class="o">.</span><span class="n">bar</span><span class="o">.</span><span class="n">bah</span>
<span class="gh">Out[498]: </span>
<span class="go">/foo/bar/bah (Group) ''</span>
<span class="go">  children := ['axis0' (Array), 'axis1' (Array), 'block0_items' (Array), 'block0_values' (Array)]</span>
</pre></div>
</div>
<p>相反，请使用显式的基于字符串的键。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [499]: </span><span class="n">store</span><span class="p">[</span><span class="s2">"foo/bar/bah"</span><span class="p">]</span>
<span class="gh">Out[499]: </span>
<span class="go">                   A         B         C</span>
<span class="go">2000-01-01  0.858644 -0.851236  1.058006</span>
<span class="go">2000-01-02 -0.080372 -1.268121  1.561967</span>
<span class="go">2000-01-03  0.816983  1.965656 -1.169408</span>
<span class="go">2000-01-04  0.712795 -0.062433  0.736755</span>
<span class="go">2000-01-05 -0.298721 -1.988045  1.475308</span>
<span class="go">2000-01-06  1.103675  1.382242 -0.650762</span>
<span class="go">2000-01-07 -0.729161 -0.142928 -1.063038</span>
<span class="go">2000-01-08 -1.005977  0.465222 -0.094517</span>
</pre></div>
</div>
</div>
</section>
<section id="storing-types">
<span id="io-hdf5-types"></span><h3>存储类型<a class="headerlink" href="io.html#storing-types" title="指向此标题的链接">#</a></h3>
<section id="storing-mixed-types-in-a-table">
<h4>在表中存储混合类型<a class="headerlink" href="io.html#storing-mixed-types-in-a-table" title="指向此标题的链接">#</a></h4>
<p>支持存储混合 dtype 数据。字符串以固定宽度存储，使用追加列的最大大小。后续尝试追加更长的字符串将引发 <code class="docutils literal notranslate"><span class="pre">ValueError</span></code>。</p>
<p>将 <code class="docutils literal notranslate"><span class="pre">min_itemsize={`values`:</span> <span class="pre">size}</span></code> 作为参数传递给 append 将为字符串列设置一个更大的最小值。目前支持存储 <code class="docutils literal notranslate"><span class="pre">floats,</span> <span class="pre">strings,</span> <span class="pre">ints,</span> <span class="pre">bools,</span> <span class="pre">datetime64</span></code>。对于字符串列，将 <code class="docutils literal notranslate"><span class="pre">nan_rep</span> <span class="pre">=</span> <span class="pre">'nan'</span></code> 传递给 append 将更改磁盘上的默认 NaN 表示形式（它会转换为/从 <code class="docutils literal notranslate"><span class="pre">np.nan</span></code>），此默认值为 <code class="docutils literal notranslate"><span class="pre">nan</span></code>。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [500]: </span><span class="n">df_mixed</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="p">{</span>
<span class="gp">   .....: </span>        <span class="s2">"A"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span>
<span class="gp">   .....: </span>        <span class="s2">"B"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span>
<span class="gp">   .....: </span>        <span class="s2">"C"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">"float32"</span><span class="p">),</span>
<span class="gp">   .....: </span>        <span class="s2">"string"</span><span class="p">:</span> <span class="s2">"string"</span><span class="p">,</span>
<span class="gp">   .....: </span>        <span class="s2">"int"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="gp">   .....: </span>        <span class="s2">"bool"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<span class="gp">   .....: </span>        <span class="s2">"datetime64"</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">"20010102"</span><span class="p">),</span>
<span class="gp">   .....: </span>    <span class="p">},</span>
<span class="gp">   .....: </span>    <span class="n">index</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">)),</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [501]: </span><span class="n">df_mixed</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_mixed</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="s2">"A"</span><span class="p">,</span> <span class="s2">"B"</span><span class="p">,</span> <span class="s2">"string"</span><span class="p">,</span> <span class="s2">"datetime64"</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

<span class="gp">In [502]: </span><span class="n">store</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"df_mixed"</span><span class="p">,</span> <span class="n">df_mixed</span><span class="p">,</span> <span class="n">min_itemsize</span><span class="o">=</span><span class="p">{</span><span class="s2">"values"</span><span class="p">:</span> <span class="mi">50</span><span class="p">})</span>

<span class="gp">In [503]: </span><span class="n">df_mixed1</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">"df_mixed"</span><span class="p">)</span>

<span class="gp">In [504]: </span><span class="n">df_mixed1</span>
<span class="gh">Out[504]: </span>
<span class="go">          A         B         C  ... int  bool                    datetime64</span>
<span class="go">0  0.013747 -1.166078 -1.292080  ...   1  True 1970-01-01 00:00:00.978393600</span>
<span class="go">1 -0.712009  0.247572  1.526911  ...   1  True 1970-01-01 00:00:00.978393600</span>
<span class="go">2 -0.645096  1.687406  0.288504  ...   1  True 1970-01-01 00:00:00.978393600</span>
<span class="go">3       NaN       NaN  0.097771  ...   1  True                           NaT</span>
<span class="go">4       NaN       NaN  1.536408  ...   1  True                           NaT</span>
<span class="go">5 -0.023202  0.043702  0.926790  ...   1  True 1970-01-01 00:00:00.978393600</span>
<span class="go">6  2.359782  0.088224 -0.676448  ...   1  True 1970-01-01 00:00:00.978393600</span>
<span class="go">7 -0.143428 -0.813360 -0.179724  ...   1  True 1970-01-01 00:00:00.978393600</span>

<span class="go">[8 rows x 7 columns]</span>

<span class="gp">In [505]: </span><span class="n">df_mixed1</span><span class="o">.</span><span class="n">dtypes</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="gh">Out[505]: </span>
<span class="go">float64           2</span>
<span class="go">float32           1</span>
<span class="go">object            1</span>
<span class="go">int64             1</span>
<span class="go">bool              1</span>
<span class="go">datetime64[ns]    1</span>
<span class="go">Name: count, dtype: int64</span>

<span class="go"># we have provided a minimum string column size</span>
<span class="gp">In [506]: </span><span class="n">store</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">df_mixed</span><span class="o">.</span><span class="n">table</span>
<span class="gh">Out[506]: </span>
<span class="go">/df_mixed/table (Table(8,)) ''</span>
<span class="go">  description := {</span>
<span class="go">  "index": Int64Col(shape=(), dflt=0, pos=0),</span>
<span class="go">  "values_block_0": Float64Col(shape=(2,), dflt=0.0, pos=1),</span>
<span class="go">  "values_block_1": Float32Col(shape=(1,), dflt=0.0, pos=2),</span>
<span class="go">  "values_block_2": StringCol(itemsize=50, shape=(1,), dflt=b'', pos=3),</span>
<span class="go">  "values_block_3": Int64Col(shape=(1,), dflt=0, pos=4),</span>
<span class="go">  "values_block_4": BoolCol(shape=(1,), dflt=False, pos=5),</span>
<span class="go">  "values_block_5": Int64Col(shape=(1,), dflt=0, pos=6)}</span>
<span class="go">  byteorder := 'little'</span>
<span class="go">  chunkshape := (689,)</span>
<span class="go">  autoindex := True</span>
<span class="go">  colindexes := {</span>
<span class="go">    "index": Index(6, mediumshuffle, zlib(1)).is_csi=False}</span>
</pre></div>
</div>
</section>
<section id="storing-multiindex-dataframes">
<h4>存储 MultiIndex DataFrames<a class="headerlink" href="io.html#storing-multiindex-dataframes" title="指向此标题的链接">#</a></h4>
<p>将 MultiIndex <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code> 存储为表与从同构索引 <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code> 存储/选择非常相似。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [507]: </span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="p">(</span>
<span class="gp">   .....: </span>   <span class="n">levels</span><span class="o">=</span><span class="p">[[</span><span class="s2">"foo"</span><span class="p">,</span> <span class="s2">"bar"</span><span class="p">,</span> <span class="s2">"baz"</span><span class="p">,</span> <span class="s2">"qux"</span><span class="p">],</span> <span class="p">[</span><span class="s2">"one"</span><span class="p">,</span> <span class="s2">"two"</span><span class="p">,</span> <span class="s2">"three"</span><span class="p">]],</span>
<span class="gp">   .....: </span>   <span class="n">codes</span><span class="o">=</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]],</span>
<span class="gp">   .....: </span>   <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s2">"foo"</span><span class="p">,</span> <span class="s2">"bar"</span><span class="p">],</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [508]: </span><span class="n">df_mi</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"A"</span><span class="p">,</span> <span class="s2">"B"</span><span class="p">,</span> <span class="s2">"C"</span><span class="p">])</span>

<span class="gp">In [509]: </span><span class="n">df_mi</span>
<span class="gh">Out[509]: </span>
<span class="go">                  A         B         C</span>
<span class="go">foo bar                                </span>
<span class="go">foo one   -1.303456 -0.642994 -0.649456</span>
<span class="go">    two    1.012694  0.414147  1.950460</span>
<span class="go">    three  1.094544 -0.802899 -0.583343</span>
<span class="go">bar one    0.410395  0.618321  0.560398</span>
<span class="go">    two    1.434027 -0.033270  0.343197</span>
<span class="go">baz two   -1.646063 -0.695847 -0.429156</span>
<span class="go">    three -0.244688 -1.428229 -0.138691</span>
<span class="go">qux one    1.866184 -1.446617  0.036660</span>
<span class="go">    two   -1.660522  0.929553 -1.298649</span>
<span class="go">    three  3.565769  0.682402  1.041927</span>

<span class="gp">In [510]: </span><span class="n">store</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"df_mi"</span><span class="p">,</span> <span class="n">df_mi</span><span class="p">)</span>

<span class="gp">In [511]: </span><span class="n">store</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">"df_mi"</span><span class="p">)</span>
<span class="gh">Out[511]: </span>
<span class="go">                  A         B         C</span>
<span class="go">foo bar                                </span>
<span class="go">foo one   -1.303456 -0.642994 -0.649456</span>
<span class="go">    two    1.012694  0.414147  1.950460</span>
<span class="go">    three  1.094544 -0.802899 -0.583343</span>
<span class="go">bar one    0.410395  0.618321  0.560398</span>
<span class="go">    two    1.434027 -0.033270  0.343197</span>
<span class="go">baz two   -1.646063 -0.695847 -0.429156</span>
<span class="go">    three -0.244688 -1.428229 -0.138691</span>
<span class="go">qux one    1.866184 -1.446617  0.036660</span>
<span class="go">    two   -1.660522  0.929553 -1.298649</span>
<span class="go">    three  3.565769  0.682402  1.041927</span>

<span class="go"># the levels are automatically included as data columns</span>
<span class="gp">In [512]: </span><span class="n">store</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">"df_mi"</span><span class="p">,</span> <span class="s2">"foo=bar"</span><span class="p">)</span>
<span class="gh">Out[512]: </span>
<span class="go">                A         B         C</span>
<span class="go">foo bar                              </span>
<span class="go">bar one  0.410395  0.618321  0.560398</span>
<span class="go">    two  1.434027 -0.033270  0.343197</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p>关键字 <code class="docutils literal notranslate"><span class="pre">index</span></code> 是保留的，不能用作级别名称。</p>
</div>
</section>
</section>
<section id="querying">
<span id="io-hdf5-query"></span><h3>查询<a class="headerlink" href="io.html#querying" title="指向此标题的链接">#</a></h3>
<section id="querying-a-table">
<h4>查询表<a class="headerlink" href="io.html#querying-a-table" title="指向此标题的链接">#</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">select</span></code> 和 <code class="docutils literal notranslate"><span class="pre">delete</span></code> 操作有一个可选的条件，可以指定来选择/删除数据的子集。这允许您拥有一个非常大的磁盘表，并仅检索部分数据。</p>
<p>查询在底层使用 <code class="docutils literal notranslate"><span class="pre">Term</span></code> 类，以布尔表达式的形式指定。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">index</span></code> 和 <code class="docutils literal notranslate"><span class="pre">columns</span></code> 是 <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code> 支持的索引器。</p></li>
<li><p>如果指定了 <code class="docutils literal notranslate"><span class="pre">data_columns</span></code>，它们可以用作额外的索引器。</p></li>
<li><p>MultiIndex 中的级别名称，如果未提供，则默认为 <code class="docutils literal notranslate"><span class="pre">level_0</span></code>, <code class="docutils literal notranslate"><span class="pre">level_1</span></code> 等。</p></li>
</ul>
<p>有效的比较运算符是：</p>
<p><code class="docutils literal notranslate"><span class="pre">=,</span> <span class="pre">==,</span> <span class="pre">!=,</span> <span class="pre">&gt;,</span> <span class="pre">&gt;=,</span> <span class="pre">&lt;,</span> <span class="pre">&lt;=</span></code></p>
<p>有效的布尔表达式通过以下方式组合：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">|</span></code>：或</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&amp;</span></code>：和</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">(</span></code> 和 <code class="docutils literal notranslate"><span class="pre">)</span></code>：用于分组</p></li>
</ul>
<p>这些规则与 pandas 中布尔表达式用于索引的方式类似。</p>
<div class="admonition note">
<p class="admonition-title">注意</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">=</span></code> 将自动扩展为比较运算符 <code class="docutils literal notranslate"><span class="pre">==</span></code>。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">~</span></code> 是非运算符，但只能在非常有限的情况下使用。</p></li>
<li><p>如果传入表达式列表/元组，它们将通过 <code class="docutils literal notranslate"><span class="pre">&amp;</span></code> 组合。</p></li>
</ul>
</div>
<p>以下是有效的表达式：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">'index</span> <span class="pre">&gt;=</span> <span class="pre">date'</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">"columns</span> <span class="pre">=</span> <span class="pre">['A',</span> <span class="pre">'D']"</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">"columns</span> <span class="pre">in</span> <span class="pre">['A',</span> <span class="pre">'D']"</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'columns</span> <span class="pre">=</span> <span class="pre">A'</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'columns</span> <span class="pre">==</span> <span class="pre">A'</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">"~(columns</span> <span class="pre">=</span> <span class="pre">['A',</span> <span class="pre">'B'])"</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'index</span> <span class="pre">&gt;</span> <span class="pre">df.index[3]</span> <span class="pre">&amp;</span> <span class="pre">string</span> <span class="pre">=</span> <span class="pre">"bar"'</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'(index</span> <span class="pre">&gt;</span> <span class="pre">df.index[3]</span> <span class="pre">&amp;</span> <span class="pre">index</span> <span class="pre">&lt;=</span> <span class="pre">df.index[6])</span> <span class="pre">|</span> <span class="pre">string</span> <span class="pre">=</span> <span class="pre">"bar"'</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">"ts</span> <span class="pre">&gt;=</span> <span class="pre">Timestamp('2012-02-01')"</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">"major_axis&gt;=20130101"</span></code></p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">indexers</span></code> 位于子表达式的左侧。</p>
<p><code class="docutils literal notranslate"><span class="pre">columns</span></code>, <code class="docutils literal notranslate"><span class="pre">major_axis</span></code>, <code class="docutils literal notranslate"><span class="pre">ts</span></code></p>
<p>子表达式的右侧（在比较运算符之后）可以是：</p>
<ul class="simple">
<li><p>将被评估的函数，例如 <code class="docutils literal notranslate"><span class="pre">Timestamp('2012-02-01')</span></code>。</p></li>
<li><p>字符串，例如 <code class="docutils literal notranslate"><span class="pre">"bar"</span></code>。</p></li>
<li><p>日期类值，例如 <code class="docutils literal notranslate"><span class="pre">20130101</span></code> 或 <code class="docutils literal notranslate"><span class="pre">"20130101"</span></code>。</p></li>
<li><p>列表，例如 <code class="docutils literal notranslate"><span class="pre">"['A',</span> <span class="pre">'B']"</span></code>。</p></li>
<li><p>在局部命名空间中定义的变量，例如 <code class="docutils literal notranslate"><span class="pre">date</span></code>。</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p>不建议通过将字符串插入查询表达式来将其传递给查询。只需将感兴趣的字符串赋值给变量，并在表达式中使用该变量。例如，这样做：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">string</span> <span class="o">=</span> <span class="s2">"HolyMoly'"</span>
<span class="n">store</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">"df"</span><span class="p">,</span> <span class="s2">"index == string"</span><span class="p">)</span>
</pre></div>
</div>
<p>而不是这样做：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">string</span> <span class="o">=</span> <span class="s2">"HolyMoly'"</span>
<span class="n">store</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">'df'</span><span class="p">,</span> <span class="sa">f</span><span class="s1">'index == </span><span class="si">{</span><span class="n">string</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
</pre></div>
</div>
<p>后者<strong>不会</strong>工作，并会引发 <code class="docutils literal notranslate"><span class="pre">SyntaxError</span></code>。请注意，<code class="docutils literal notranslate"><span class="pre">string</span></code> 变量中有一个单引号，后面跟着一个双引号。</p>
<p>如果您<em>必须</em>插值，请使用 <code class="docutils literal notranslate"><span class="pre">'%r'</span></code> 格式说明符。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">store</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">"df"</span><span class="p">,</span> <span class="s2">"index == </span><span class="si">%r</span><span class="s2">"</span> <span class="o">%</span> <span class="n">string</span><span class="p">)</span>
</pre></div>
</div>
<p>这将引用 <code class="docutils literal notranslate"><span class="pre">string</span></code>。</p>
</div>
<p>这里有一些例子：</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [513]: </span><span class="n">dfq</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
<span class="gp">   .....: </span>    <span class="n">columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="s2">"ABCD"</span><span class="p">),</span>
<span class="gp">   .....: </span>    <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">"20130101"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [514]: </span><span class="n">store</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"dfq"</span><span class="p">,</span> <span class="n">dfq</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">"table"</span><span class="p">,</span> <span class="n">data_columns</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>使用布尔表达式，并进行内联函数评估。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [515]: </span><span class="n">store</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">"dfq"</span><span class="p">,</span> <span class="s2">"index&gt;pd.Timestamp('20130104') &amp; columns=['A', 'B']"</span><span class="p">)</span>
<span class="gh">Out[515]: </span>
<span class="go">                   A         B</span>
<span class="go">2013-01-05 -0.830545 -0.457071</span>
<span class="go">2013-01-06  0.431186  1.049421</span>
<span class="go">2013-01-07  0.617509 -0.811230</span>
<span class="go">2013-01-08  0.947422 -0.671233</span>
<span class="go">2013-01-09 -0.183798 -1.211230</span>
<span class="go">2013-01-10  0.361428  0.887304</span>
</pre></div>
</div>
<p>使用内联列引用。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [516]: </span><span class="n">store</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">"dfq"</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="s2">"A&gt;0 or C&gt;0"</span><span class="p">)</span>
<span class="gh">Out[516]: </span>
<span class="go">                   A         B         C         D</span>
<span class="go">2013-01-02  0.658179  0.362814 -0.917897  0.010165</span>
<span class="go">2013-01-03  0.905122  1.848731 -1.184241  0.932053</span>
<span class="go">2013-01-05 -0.830545 -0.457071  1.565581  1.148032</span>
<span class="go">2013-01-06  0.431186  1.049421  0.383309  0.595013</span>
<span class="go">2013-01-07  0.617509 -0.811230 -2.088563 -1.393500</span>
<span class="go">2013-01-08  0.947422 -0.671233 -0.847097 -1.187785</span>
<span class="go">2013-01-10  0.361428  0.887304  0.266457 -0.399641</span>
</pre></div>
</div>
<p>可以提供 <code class="docutils literal notranslate"><span class="pre">columns</span></code> 关键字来选择要返回的列列表，这等同于传递 <code class="docutils literal notranslate"><span class="pre">'columns=list_of_columns_to_filter'</span></code>。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [517]: </span><span class="n">store</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">"df"</span><span class="p">,</span> <span class="s2">"columns=['A', 'B']"</span><span class="p">)</span>
<span class="gh">Out[517]: </span>
<span class="go">                   A         B</span>
<span class="go">2000-01-01  0.858644 -0.851236</span>
<span class="go">2000-01-02 -0.080372 -1.268121</span>
<span class="go">2000-01-03  0.816983  1.965656</span>
<span class="go">2000-01-04  0.712795 -0.062433</span>
<span class="go">2000-01-05 -0.298721 -1.988045</span>
<span class="go">2000-01-06  1.103675  1.382242</span>
<span class="go">2000-01-07 -0.729161 -0.142928</span>
<span class="go">2000-01-08 -1.005977  0.465222</span>
</pre></div>
</div>
<p>可以指定 <code class="docutils literal notranslate"><span class="pre">start</span></code> 和 <code class="docutils literal notranslate"><span class="pre">stop</span></code> 参数来限制总搜索空间。这些参数是基于表中总行数。</p>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p>如果查询表达式具有未知变量引用，<code class="docutils literal notranslate"><span class="pre">select</span></code> 将引发 <code class="docutils literal notranslate"><span class="pre">ValueError</span></code>。这通常意味着您尝试在<strong>不是</strong>数据列的列上进行选择。</p>
<p>如果查询表达式无效，<code class="docutils literal notranslate"><span class="pre">select</span></code> 将引发 <code class="docutils literal notranslate"><span class="pre">SyntaxError</span></code>。</p>
</div>
</section>
<section id="query-timedelta64-ns">
<span id="io-hdf5-timedelta"></span><h4>查询 timedelta64[ns]<a class="headerlink" href="io.html#query-timedelta64-ns" title="指向此标题的链接">#</a></h4>
<p>您可以使用 <code class="docutils literal notranslate"><span class="pre">timedelta64[ns]</span></code> 类型进行存储和查询。术语可以按以下格式指定：<code class="docutils literal notranslate"><span class="pre">&lt;float&gt;(&lt;unit&gt;)</span></code>，其中 float 可以带符号（和分数），unit 可以是 <code class="docutils literal notranslate"><span class="pre">D,s,ms,us,ns</span></code> 用于时间差。这里有一个例子：</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [518]: </span><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">timedelta</span>

<span class="gp">In [519]: </span><span class="n">dftd</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="p">{</span>
<span class="gp">   .....: </span>        <span class="s2">"A"</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">"20130101"</span><span class="p">),</span>
<span class="gp">   .....: </span>        <span class="s2">"B"</span><span class="p">:</span> <span class="p">[</span>
<span class="gp">   .....: </span>            <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">"20130101"</span><span class="p">)</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">seconds</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="gp">   .....: </span>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="gp">   .....: </span>        <span class="p">],</span>
<span class="gp">   .....: </span>    <span class="p">}</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [520]: </span><span class="n">dftd</span><span class="p">[</span><span class="s2">"C"</span><span class="p">]</span> <span class="o">=</span> <span class="n">dftd</span><span class="p">[</span><span class="s2">"A"</span><span class="p">]</span> <span class="o">-</span> <span class="n">dftd</span><span class="p">[</span><span class="s2">"B"</span><span class="p">]</span>

<span class="gp">In [521]: </span><span class="n">dftd</span>
<span class="gh">Out[521]: </span>
<span class="go">           A                   B                  C</span>
<span class="go">0 2013-01-01 2013-01-01 00:00:10  -1 days +23:59:50</span>
<span class="go">1 2013-01-01 2013-01-02 00:00:10  -2 days +23:59:50</span>
<span class="go">2 2013-01-01 2013-01-03 00:00:10  -3 days +23:59:50</span>
<span class="go">3 2013-01-01 2013-01-04 00:00:10  -4 days +23:59:50</span>
<span class="go">4 2013-01-01 2013-01-05 00:00:10  -5 days +23:59:50</span>
<span class="go">5 2013-01-01 2013-01-06 00:00:10  -6 days +23:59:50</span>
<span class="go">6 2013-01-01 2013-01-07 00:00:10  -7 days +23:59:50</span>
<span class="go">7 2013-01-01 2013-01-08 00:00:10  -8 days +23:59:50</span>
<span class="go">8 2013-01-01 2013-01-09 00:00:10  -9 days +23:59:50</span>
<span class="go">9 2013-01-01 2013-01-10 00:00:10 -10 days +23:59:50</span>

<span class="gp">In [522]: </span><span class="n">store</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"dftd"</span><span class="p">,</span> <span class="n">dftd</span><span class="p">,</span> <span class="n">data_columns</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="gp">In [523]: </span><span class="n">store</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">"dftd"</span><span class="p">,</span> <span class="s2">"C&lt;'-3.5D'"</span><span class="p">)</span>
<span class="gh">Out[523]: </span>
<span class="go">                              A                   B                  C</span>
<span class="go">4 1970-01-01 00:00:01.356998400 2013-01-05 00:00:10  -5 days +23:59:50</span>
<span class="go">5 1970-01-01 00:00:01.356998400 2013-01-06 00:00:10  -6 days +23:59:50</span>
<span class="go">6 1970-01-01 00:00:01.356998400 2013-01-07 00:00:10  -7 days +23:59:50</span>
<span class="go">7 1970-01-01 00:00:01.356998400 2013-01-08 00:00:10  -8 days +23:59:50</span>
<span class="go">8 1970-01-01 00:00:01.356998400 2013-01-09 00:00:10  -9 days +23:59:50</span>
<span class="go">9 1970-01-01 00:00:01.356998400 2013-01-10 00:00:10 -10 days +23:59:50</span>
</pre></div>
</div>
</section>
<section id="query-multiindex">
<span id="io-query-multi"></span><h4>查询 MultiIndex<a class="headerlink" href="io.html#query-multiindex" title="指向此标题的链接">#</a></h4>
<p>通过使用级别的名称，可以从 <code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code> 中进行选择。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [524]: </span><span class="n">df_mi</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span>
<span class="gh">Out[524]: </span><span class="go">FrozenList(['foo', 'bar'])</span>

<span class="gp">In [525]: </span><span class="n">store</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">"df_mi"</span><span class="p">,</span> <span class="s2">"foo=baz and bar=two"</span><span class="p">)</span>
<span class="gh">Out[525]: </span>
<span class="go">                A         B         C</span>
<span class="go">foo bar                              </span>
<span class="go">baz two -1.646063 -0.695847 -0.429156</span>
</pre></div>
</div>
<p>如果 <code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code> 级别名称为 <code class="docutils literal notranslate"><span class="pre">None</span></code>，则这些级别会自动通过 <code class="docutils literal notranslate"><span class="pre">level_n</span></code> 关键字提供，其中 <code class="docutils literal notranslate"><span class="pre">n</span></code> 是您要从中选择的 <code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code> 的级别。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [526]: </span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="n">levels</span><span class="o">=</span><span class="p">[[</span><span class="s2">"foo"</span><span class="p">,</span> <span class="s2">"bar"</span><span class="p">,</span> <span class="s2">"baz"</span><span class="p">,</span> <span class="s2">"qux"</span><span class="p">],</span> <span class="p">[</span><span class="s2">"one"</span><span class="p">,</span> <span class="s2">"two"</span><span class="p">,</span> <span class="s2">"three"</span><span class="p">]],</span>
<span class="gp">   .....: </span>    <span class="n">codes</span><span class="o">=</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]],</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [527]: </span><span class="n">df_mi_2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"A"</span><span class="p">,</span> <span class="s2">"B"</span><span class="p">,</span> <span class="s2">"C"</span><span class="p">])</span>

<span class="gp">In [528]: </span><span class="n">df_mi_2</span>
<span class="gh">Out[528]: </span>
<span class="go">                  A         B         C</span>
<span class="go">foo one   -0.219582  1.186860 -1.437189</span>
<span class="go">    two    0.053768  1.872644 -1.469813</span>
<span class="go">    three -0.564201  0.876341  0.407749</span>
<span class="go">bar one   -0.232583  0.179812  0.922152</span>
<span class="go">    two   -1.820952 -0.641360  2.133239</span>
<span class="go">baz two   -0.941248 -0.136307 -1.271305</span>
<span class="go">    three -0.099774 -0.061438 -0.845172</span>
<span class="go">qux one    0.465793  0.756995 -0.541690</span>
<span class="go">    two   -0.802241  0.877657 -2.553831</span>
<span class="go">    three  0.094899 -2.319519  0.293601</span>

<span class="gp">In [529]: </span><span class="n">store</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"df_mi_2"</span><span class="p">,</span> <span class="n">df_mi_2</span><span class="p">)</span>

<span class="go"># the levels are automatically included as data columns with keyword level_n</span>
<span class="gp">In [530]: </span><span class="n">store</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">"df_mi_2"</span><span class="p">,</span> <span class="s2">"level_0=foo and level_1=two"</span><span class="p">)</span>
<span class="gh">Out[530]: </span>
<span class="go">                A         B         C</span>
<span class="go">foo two  0.053768  1.872644 -1.469813</span>
</pre></div>
</div>
</section>
<section id="indexing">
<h4>索引<a class="headerlink" href="io.html#indexing" title="指向此标题的链接">#</a></h4>
<p>在数据已存在于表中（在 <code class="docutils literal notranslate"><span class="pre">append/put</span></code> 操作之后）后，您可以使用 <code class="docutils literal notranslate"><span class="pre">create_table_index</span></code> 为表创建/修改索引。<strong>强烈建议</strong>创建表索引。当您使用以索引维度作为 <code class="docutils literal notranslate"><span class="pre">where</span></code> 的 <code class="docutils literal notranslate"><span class="pre">select</span></code> 时，这将大大加快您的查询速度。</p>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p>索引会自动在可索引列和您指定的任何数据列上创建。可以通过在 <code class="docutils literal notranslate"><span class="pre">append</span></code> 中传递 <code class="docutils literal notranslate"><span class="pre">index=False</span></code> 来关闭此行为。</p>
</div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="go"># we have automagically already created an index (in the first section)</span>
<span class="gp">In [531]: </span><span class="n">i</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">cols</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">index</span>

<span class="gp">In [532]: </span><span class="n">i</span><span class="o">.</span><span class="n">optlevel</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">kind</span>
<span class="gh">Out[532]: </span><span class="go">(6, 'medium')</span>

<span class="go"># change an index by passing new parameters</span>
<span class="gp">In [533]: </span><span class="n">store</span><span class="o">.</span><span class="n">create_table_index</span><span class="p">(</span><span class="s2">"df"</span><span class="p">,</span> <span class="n">optlevel</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">"full"</span><span class="p">)</span>

<span class="gp">In [534]: </span><span class="n">i</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">cols</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">index</span>

<span class="gp">In [535]: </span><span class="n">i</span><span class="o">.</span><span class="n">optlevel</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">kind</span>
<span class="gh">Out[535]: </span><span class="go">(9, 'full')</span>
</pre></div>
</div>
<p>通常，当向存储追加大量数据时，关闭每次追加的索引创建，然后在最后重新创建索引会很有用。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [536]: </span><span class="n">df_1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="s2">"AB"</span><span class="p">))</span>

<span class="gp">In [537]: </span><span class="n">df_2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="s2">"AB"</span><span class="p">))</span>

<span class="gp">In [538]: </span><span class="n">st</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">HDFStore</span><span class="p">(</span><span class="s2">"appends.h5"</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"w"</span><span class="p">)</span>

<span class="gp">In [539]: </span><span class="n">st</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"df"</span><span class="p">,</span> <span class="n">df_1</span><span class="p">,</span> <span class="n">data_columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"B"</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="gp">In [540]: </span><span class="n">st</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"df"</span><span class="p">,</span> <span class="n">df_2</span><span class="p">,</span> <span class="n">data_columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"B"</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="gp">In [541]: </span><span class="n">st</span><span class="o">.</span><span class="n">get_storer</span><span class="p">(</span><span class="s2">"df"</span><span class="p">)</span><span class="o">.</span><span class="n">table</span>
<span class="gh">Out[541]: </span>
<span class="go">/df/table (Table(20,)) ''</span>
<span class="go">  description := {</span>
<span class="go">  "index": Int64Col(shape=(), dflt=0, pos=0),</span>
<span class="go">  "values_block_0": Float64Col(shape=(1,), dflt=0.0, pos=1),</span>
<span class="go">  "B": Float64Col(shape=(), dflt=0.0, pos=2)}</span>
<span class="go">  byteorder := 'little'</span>
<span class="go">  chunkshape := (2730,)</span>
</pre></div>
</div>
<p>追加完成后再创建索引。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [542]: </span><span class="n">st</span><span class="o">.</span><span class="n">create_table_index</span><span class="p">(</span><span class="s2">"df"</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"B"</span><span class="p">],</span> <span class="n">optlevel</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">"full"</span><span class="p">)</span>

<span class="gp">In [543]: </span><span class="n">st</span><span class="o">.</span><span class="n">get_storer</span><span class="p">(</span><span class="s2">"df"</span><span class="p">)</span><span class="o">.</span><span class="n">table</span>
<span class="gh">Out[543]: </span>
<span class="go">/df/table (Table(20,)) ''</span>
<span class="go">  description := {</span>
<span class="go">  "index": Int64Col(shape=(), dflt=0, pos=0),</span>
<span class="go">  "values_block_0": Float64Col(shape=(1,), dflt=0.0, pos=1),</span>
<span class="go">  "B": Float64Col(shape=(), dflt=0.0, pos=2)}</span>
<span class="go">  byteorder := 'little'</span>
<span class="go">  chunkshape := (2730,)</span>
<span class="go">  autoindex := True</span>
<span class="go">  colindexes := {</span>
<span class="go">    "B": Index(9, fullshuffle, zlib(1)).is_csi=True}</span>

<span class="gp">In [544]: </span><span class="n">st</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>有关如何在现有存储上创建完全排序索引 (CSI) 的信息，请参见<a class="reference external" href="https://stackoverflow.com/questions/17893370/ptrepack-sortby-needs-full-index">此处</a>。</p>
</section>
<section id="query-via-data-columns">
<span id="io-hdf5-query-data-columns"></span><h4>通过数据列查询<a class="headerlink" href="io.html#query-via-data-columns" title="指向此标题的链接">#</a></h4>
<p>您可以指定（并索引）某些您希望能够执行查询的列（除了始终可以查询的 <code class="docutils literal notranslate"><span class="pre">indexable</span></code> 列）。例如，假设您想在磁盘上执行此常见操作，并只返回与此查询匹配的帧。您可以指定 <code class="docutils literal notranslate"><span class="pre">data_columns</span> <span class="pre">=</span> <span class="pre">True</span></code> 以强制所有列成为 <code class="docutils literal notranslate"><span class="pre">data_columns</span></code>。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [545]: </span><span class="n">df_dc</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="gp">In [546]: </span><span class="n">df_dc</span><span class="p">[</span><span class="s2">"string"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"foo"</span>

<span class="gp">In [547]: </span><span class="n">df_dc</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_dc</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">],</span> <span class="s2">"string"</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

<span class="gp">In [548]: </span><span class="n">df_dc</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_dc</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">7</span><span class="p">:</span><span class="mi">9</span><span class="p">],</span> <span class="s2">"string"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"bar"</span>

<span class="gp">In [549]: </span><span class="n">df_dc</span><span class="p">[</span><span class="s2">"string2"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"cool"</span>

<span class="gp">In [550]: </span><span class="n">df_dc</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_dc</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="s2">"B"</span><span class="p">,</span> <span class="s2">"C"</span><span class="p">]]</span> <span class="o">=</span> <span class="mf">1.0</span>

<span class="gp">In [551]: </span><span class="n">df_dc</span>
<span class="gh">Out[551]: </span>
<span class="go">                   A         B         C string string2</span>
<span class="go">2000-01-01  0.858644 -0.851236  1.058006    foo    cool</span>
<span class="go">2000-01-02 -0.080372  1.000000  1.000000    foo    cool</span>
<span class="go">2000-01-03  0.816983  1.000000  1.000000    foo    cool</span>
<span class="go">2000-01-04  0.712795 -0.062433  0.736755    foo    cool</span>
<span class="go">2000-01-05 -0.298721 -1.988045  1.475308    NaN    cool</span>
<span class="go">2000-01-06  1.103675  1.382242 -0.650762    NaN    cool</span>
<span class="go">2000-01-07 -0.729161 -0.142928 -1.063038    foo    cool</span>
<span class="go">2000-01-08 -1.005977  0.465222 -0.094517    bar    cool</span>

<span class="go"># on-disk operations</span>
<span class="gp">In [552]: </span><span class="n">store</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"df_dc"</span><span class="p">,</span> <span class="n">df_dc</span><span class="p">,</span> <span class="n">data_columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"B"</span><span class="p">,</span> <span class="s2">"C"</span><span class="p">,</span> <span class="s2">"string"</span><span class="p">,</span> <span class="s2">"string2"</span><span class="p">])</span>

<span class="gp">In [553]: </span><span class="n">store</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">"df_dc"</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="s2">"B &gt; 0"</span><span class="p">)</span>
<span class="gh">Out[553]: </span>
<span class="go">                   A         B         C string string2</span>
<span class="go">2000-01-02 -0.080372  1.000000  1.000000    foo    cool</span>
<span class="go">2000-01-03  0.816983  1.000000  1.000000    foo    cool</span>
<span class="go">2000-01-06  1.103675  1.382242 -0.650762    NaN    cool</span>
<span class="go">2000-01-08 -1.005977  0.465222 -0.094517    bar    cool</span>

<span class="go"># getting creative</span>
<span class="gp">In [554]: </span><span class="n">store</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">"df_dc"</span><span class="p">,</span> <span class="s2">"B &gt; 0 &amp; C &gt; 0 &amp; string == foo"</span><span class="p">)</span>
<span class="gh">Out[554]: </span>
<span class="go">                   A    B    C string string2</span>
<span class="go">2000-01-02 -0.080372  1.0  1.0    foo    cool</span>
<span class="go">2000-01-03  0.816983  1.0  1.0    foo    cool</span>

<span class="go"># this is in-memory version of this type of selection</span>
<span class="gp">In [555]: </span><span class="n">df_dc</span><span class="p">[(</span><span class="n">df_dc</span><span class="o">.</span><span class="n">B</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_dc</span><span class="o">.</span><span class="n">C</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_dc</span><span class="o">.</span><span class="n">string</span> <span class="o">==</span> <span class="s2">"foo"</span><span class="p">)]</span>
<span class="gh">Out[555]: </span>
<span class="go">                   A    B    C string string2</span>
<span class="go">2000-01-02 -0.080372  1.0  1.0    foo    cool</span>
<span class="go">2000-01-03  0.816983  1.0  1.0    foo    cool</span>

<span class="go"># we have automagically created this index and the B/C/string/string2</span>
<span class="go"># columns are stored separately as ``PyTables`` columns</span>
<span class="gp">In [556]: </span><span class="n">store</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">df_dc</span><span class="o">.</span><span class="n">table</span>
<span class="gh">Out[556]: </span>
<span class="go">/df_dc/table (Table(8,)) ''</span>
<span class="go">  description := {</span>
<span class="go">  "index": Int64Col(shape=(), dflt=0, pos=0),</span>
<span class="go">  "values_block_0": Float64Col(shape=(1,), dflt=0.0, pos=1),</span>
<span class="go">  "B": Float64Col(shape=(), dflt=0.0, pos=2),</span>
<span class="go">  "C": Float64Col(shape=(), dflt=0.0, pos=3),</span>
<span class="go">  "string": StringCol(itemsize=3, shape=(), dflt=b'', pos=4),</span>
<span class="go">  "string2": StringCol(itemsize=4, shape=(), dflt=b'', pos=5)}</span>
<span class="go">  byteorder := 'little'</span>
<span class="go">  chunkshape := (1680,)</span>
<span class="go">  autoindex := True</span>
<span class="go">  colindexes := {</span>
<span class="go">    "index": Index(6, mediumshuffle, zlib(1)).is_csi=False,</span>
<span class="go">    "B": Index(6, mediumshuffle, zlib(1)).is_csi=False,</span>
<span class="go">    "C": Index(6, mediumshuffle, zlib(1)).is_csi=False,</span>
<span class="go">    "string": Index(6, mediumshuffle, zlib(1)).is_csi=False,</span>
<span class="go">    "string2": Index(6, mediumshuffle, zlib(1)).is_csi=False}</span>
</pre></div>
</div>
<p>将大量列设为 <code class="docutils literal notranslate"><span class="pre">data</span> <span class="pre">columns</span></code> 会导致一定的性能下降，因此由用户决定是否指定这些列。此外，在第一次 append/put 操作之后，您不能更改数据列（或可索引列）（当然，您可以简单地读取数据并创建一个新表！）。</p>
</section>
<section id="iterator">
<h4>迭代器<a class="headerlink" href="io.html#iterator" title="指向此标题的链接">#</a></h4>
<p>您可以将 <code class="docutils literal notranslate"><span class="pre">iterator=True</span></code> 或 <code class="docutils literal notranslate"><span class="pre">chunksize=number_in_a_chunk</span></code> 传递给 <code class="docutils literal notranslate"><span class="pre">select</span></code> 和 <code class="docutils literal notranslate"><span class="pre">select_as_multiple</span></code>，以返回结果的迭代器。默认情况下，每次返回 50,000 行。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [557]: </span><span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">store</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">"df"</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
<span class="gp">   .....: </span>    <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="gp">   .....: </span>
<span class="go">                   A         B         C</span>
<span class="go">2000-01-01  0.858644 -0.851236  1.058006</span>
<span class="go">2000-01-02 -0.080372 -1.268121  1.561967</span>
<span class="go">2000-01-03  0.816983  1.965656 -1.169408</span>
<span class="go">                   A         B         C</span>
<span class="go">2000-01-04  0.712795 -0.062433  0.736755</span>
<span class="go">2000-01-05 -0.298721 -1.988045  1.475308</span>
<span class="go">2000-01-06  1.103675  1.382242 -0.650762</span>
<span class="go">                   A         B         C</span>
<span class="go">2000-01-07 -0.729161 -0.142928 -1.063038</span>
<span class="go">2000-01-08 -1.005977  0.465222 -0.094517</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p>您还可以将迭代器与 <code class="docutils literal notranslate"><span class="pre">read_hdf</span></code> 一起使用，它将在迭代完成后自动打开并关闭存储。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_hdf</span><span class="p">(</span><span class="s2">"store.h5"</span><span class="p">,</span> <span class="s2">"df"</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>请注意，chunksize 关键字适用于<strong>源</strong>行。因此，如果您正在执行查询，则 chunksize 将细分表中的总行数并应用查询，返回一个可能大小不等的块的迭代器。</p>
<p>这里有一个用于生成查询并使用它创建等大小返回块的方法。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [558]: </span><span class="n">dfeq</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">"number"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">)})</span>

<span class="gp">In [559]: </span><span class="n">dfeq</span>
<span class="gh">Out[559]: </span>
<span class="go">   number</span>
<span class="go">0       1</span>
<span class="go">1       2</span>
<span class="go">2       3</span>
<span class="go">3       4</span>
<span class="go">4       5</span>
<span class="go">5       6</span>
<span class="go">6       7</span>
<span class="go">7       8</span>
<span class="go">8       9</span>
<span class="go">9      10</span>

<span class="gp">In [560]: </span><span class="n">store</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"dfeq"</span><span class="p">,</span> <span class="n">dfeq</span><span class="p">,</span> <span class="n">data_columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"number"</span><span class="p">])</span>

<span class="gp">In [561]: </span><span class="k">def</span><span class="w"> </span><span class="nf">chunks</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
<span class="gp">   .....: </span>    <span class="k">return</span> <span class="p">[</span><span class="n">l</span><span class="p">[</span><span class="n">i</span><span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="n">n</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">),</span> <span class="n">n</span><span class="p">)]</span>
<span class="gp">   .....: </span>

<span class="gp">In [562]: </span><span class="n">evens</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>

<span class="gp">In [563]: </span><span class="n">coordinates</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="n">select_as_coordinates</span><span class="p">(</span><span class="s2">"dfeq"</span><span class="p">,</span> <span class="s2">"number=evens"</span><span class="p">)</span>

<span class="gp">In [564]: </span><span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">(</span><span class="n">coordinates</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
<span class="gp">   .....: </span>    <span class="nb">print</span><span class="p">(</span><span class="n">store</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">"dfeq"</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">c</span><span class="p">))</span>
<span class="gp">   .....: </span>
<span class="go">   number</span>
<span class="go">1       2</span>
<span class="go">3       4</span>
<span class="go">   number</span>
<span class="go">5       6</span>
<span class="go">7       8</span>
<span class="go">   number</span>
<span class="go">9      10</span>
</pre></div>
</div>
</section>
<section id="advanced-queries">
<h4>高级查询<a class="headerlink" href="io.html#advanced-queries" title="指向此标题的链接">#</a></h4>
<section id="select-a-single-column">
<h5>选择单列<a class="headerlink" href="io.html#select-a-single-column" title="指向此标题的链接">#</a></h5>
<p>要检索单个可索引列或数据列，请使用 <code class="docutils literal notranslate"><span class="pre">select_column</span></code> 方法。例如，这将使您能够非常快速地获取索引。这些方法返回一个结果的 <code class="docutils literal notranslate"><span class="pre">Series</span></code>，按行号索引。它们目前不接受 <code class="docutils literal notranslate"><span class="pre">where</span></code> 选择器。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [565]: </span><span class="n">store</span><span class="o">.</span><span class="n">select_column</span><span class="p">(</span><span class="s2">"df_dc"</span><span class="p">,</span> <span class="s2">"index"</span><span class="p">)</span>
<span class="gh">Out[565]: </span>
<span class="go">0   2000-01-01</span>
<span class="go">1   2000-01-02</span>
<span class="go">2   2000-01-03</span>
<span class="go">3   2000-01-04</span>
<span class="go">4   2000-01-05</span>
<span class="go">5   2000-01-06</span>
<span class="go">6   2000-01-07</span>
<span class="go">7   2000-01-08</span>
<span class="go">Name: index, dtype: datetime64[ns]</span>

<span class="gp">In [566]: </span><span class="n">store</span><span class="o">.</span><span class="n">select_column</span><span class="p">(</span><span class="s2">"df_dc"</span><span class="p">,</span> <span class="s2">"string"</span><span class="p">)</span>
<span class="gh">Out[566]: </span>
<span class="go">0    foo</span>
<span class="go">1    foo</span>
<span class="go">2    foo</span>
<span class="go">3    foo</span>
<span class="go">4    NaN</span>
<span class="go">5    NaN</span>
<span class="go">6    foo</span>
<span class="go">7    bar</span>
<span class="go">Name: string, dtype: object</span>
</pre></div>
</div>
</section>
<section id="selecting-coordinates">
<span id="io-hdf5-selecting-coordinates"></span><h5>选择坐标<a class="headerlink" href="io.html#selecting-coordinates" title="指向此标题的链接">#</a></h5>
<p>有时您可能需要获取查询的坐标（即索引位置）。这将返回一个结果位置的 <code class="docutils literal notranslate"><span class="pre">Index</span></code>。这些坐标也可以传递给后续的 <code class="docutils literal notranslate"><span class="pre">where</span></code> 操作。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [567]: </span><span class="n">df_coord</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">"20000101"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [568]: </span><span class="n">store</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"df_coord"</span><span class="p">,</span> <span class="n">df_coord</span><span class="p">)</span>

<span class="gp">In [569]: </span><span class="n">c</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="n">select_as_coordinates</span><span class="p">(</span><span class="s2">"df_coord"</span><span class="p">,</span> <span class="s2">"index &gt; 20020101"</span><span class="p">)</span>

<span class="gp">In [570]: </span><span class="n">c</span>
<span class="gh">Out[570]: </span>
<span class="go">Index([732, 733, 734, 735, 736, 737, 738, 739, 740, 741,</span>
<span class="go">       ...</span>
<span class="go">       990, 991, 992, 993, 994, 995, 996, 997, 998, 999],</span>
<span class="go">      dtype='int64', length=268)</span>

<span class="gp">In [571]: </span><span class="n">store</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">"df_coord"</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>
<span class="gh">Out[571]: </span>
<span class="go">                   0         1</span>
<span class="go">2002-01-02  0.007717  1.168386</span>
<span class="go">2002-01-03  0.759328 -0.638934</span>
<span class="go">2002-01-04 -1.154018 -0.324071</span>
<span class="go">2002-01-05 -0.804551 -1.280593</span>
<span class="go">2002-01-06 -0.047208  1.260503</span>
<span class="go">...              ...       ...</span>
<span class="go">2002-09-22 -1.139583  0.344316</span>
<span class="go">2002-09-23 -0.760643 -1.306704</span>
<span class="go">2002-09-24  0.059018  1.775482</span>
<span class="go">2002-09-25  1.242255 -0.055457</span>
<span class="go">2002-09-26  0.410317  2.194489</span>

<span class="go">[268 rows x 2 columns]</span>
</pre></div>
</div>
</section>
<section id="selecting-using-a-where-mask">
<span id="io-hdf5-where-mask"></span><h5>使用 where 掩码进行选择<a class="headerlink" href="io.html#selecting-using-a-where-mask" title="指向此标题的链接">#</a></h5>
<p>有时您的查询可能涉及创建要选择的行列表。通常，此 <code class="docutils literal notranslate"><span class="pre">mask</span></code> 将是索引操作的结果 <code class="docutils literal notranslate"><span class="pre">index</span></code>。此示例选择日期时间索引中月份为 5 的行。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [572]: </span><span class="n">df_mask</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">"20000101"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [573]: </span><span class="n">store</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"df_mask"</span><span class="p">,</span> <span class="n">df_mask</span><span class="p">)</span>

<span class="gp">In [574]: </span><span class="n">c</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="n">select_column</span><span class="p">(</span><span class="s2">"df_mask"</span><span class="p">,</span> <span class="s2">"index"</span><span class="p">)</span>

<span class="gp">In [575]: </span><span class="n">where</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">month</span> <span class="o">==</span> <span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>

<span class="gp">In [576]: </span><span class="n">store</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">"df_mask"</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">where</span><span class="p">)</span>
<span class="gh">Out[576]: </span>
<span class="go">                   0         1</span>
<span class="go">2000-05-01  1.479511  0.516433</span>
<span class="go">2000-05-02 -0.334984 -1.493537</span>
<span class="go">2000-05-03  0.900321  0.049695</span>
<span class="go">2000-05-04  0.614266 -1.077151</span>
<span class="go">2000-05-05  0.233881  0.493246</span>
<span class="go">...              ...       ...</span>
<span class="go">2002-05-27  0.294122  0.457407</span>
<span class="go">2002-05-28 -1.102535  1.215650</span>
<span class="go">2002-05-29 -0.432911  0.753606</span>
<span class="go">2002-05-30 -1.105212  2.311877</span>
<span class="go">2002-05-31  2.567296  2.610691</span>

<span class="go">[93 rows x 2 columns]</span>
</pre></div>
</div>
</section>
<section id="storer-object">
<h5>Storer 对象<a class="headerlink" href="io.html#storer-object" title="指向此标题的链接">#</a></h5>
<p>如果您想检查存储的对象，可以通过 <code class="docutils literal notranslate"><span class="pre">get_storer</span></code> 检索。您可以通过编程方式使用它，例如获取对象中的行数。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [577]: </span><span class="n">store</span><span class="o">.</span><span class="n">get_storer</span><span class="p">(</span><span class="s2">"df_dc"</span><span class="p">)</span><span class="o">.</span><span class="n">nrows</span>
<span class="gh">Out[577]: </span><span class="go">8</span>
</pre></div>
</div>
</section>
</section>
<section id="multiple-table-queries">
<h4>多表查询<a class="headerlink" href="io.html#multiple-table-queries" title="指向此标题的链接">#</a></h4>
<p>方法 <code class="docutils literal notranslate"><span class="pre">append_to_multiple</span></code> 和 <code class="docutils literal notranslate"><span class="pre">select_as_multiple</span></code> 可以同时对多个表执行追加/选择操作。其思想是拥有一个表（称为选择器表），您在该表中索引大多数/所有列，并执行您的查询。其他表是数据表，其索引与选择器表的索引匹配。然后，您可以在选择器表上执行非常快速的查询，同时获得大量数据。此方法类似于拥有一个非常宽的表，但能够实现更高效的查询。</p>
<p><code class="docutils literal notranslate"><span class="pre">append_to_multiple</span></code> 方法根据 <code class="docutils literal notranslate"><span class="pre">d</span></code>（一个将表名映射到您希望在该表中包含的“列”列表的字典）将给定的单个 DataFrame 拆分为多个表。如果使用 <code class="docutils literal notranslate"><span class="pre">None</span></code> 代替列表，则该表将包含给定 DataFrame 中剩余的未指定列。参数 <code class="docutils literal notranslate"><span class="pre">selector</span></code> 定义哪个表是选择器表（您可以从中进行查询）。参数 <code class="docutils literal notranslate"><span class="pre">dropna</span></code> 将从输入 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> 中删除行，以确保表同步。这意味着，如果要写入的表中的某一行完全是 <code class="docutils literal notranslate"><span class="pre">np.nan</span></code>，则该行将从所有表中删除。</p>
<p>如果 <code class="docutils literal notranslate"><span class="pre">dropna</span></code> 为 False，<strong>用户有责任同步表</strong>。请记住，完全为 <code class="docutils literal notranslate"><span class="pre">np.Nan</span></code> 的行不会写入 HDFStore，因此如果您选择调用 <code class="docutils literal notranslate"><span class="pre">dropna=False</span></code>，某些表可能比其他表拥有更多行，因此 <code class="docutils literal notranslate"><span class="pre">select_as_multiple</span></code> 可能无法工作或可能返回意外结果。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [578]: </span><span class="n">df_mt</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
<span class="gp">   .....: </span>    <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">"1/1/2000"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">8</span><span class="p">),</span>
<span class="gp">   .....: </span>    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"A"</span><span class="p">,</span> <span class="s2">"B"</span><span class="p">,</span> <span class="s2">"C"</span><span class="p">,</span> <span class="s2">"D"</span><span class="p">,</span> <span class="s2">"E"</span><span class="p">,</span> <span class="s2">"F"</span><span class="p">],</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [579]: </span><span class="n">df_mt</span><span class="p">[</span><span class="s2">"foo"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"bar"</span>

<span class="gp">In [580]: </span><span class="n">df_mt</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_mt</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="s2">"A"</span><span class="p">,</span> <span class="s2">"B"</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

<span class="go"># you can also create the tables individually</span>
<span class="gp">In [581]: </span><span class="n">store</span><span class="o">.</span><span class="n">append_to_multiple</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="p">{</span><span class="s2">"df1_mt"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"A"</span><span class="p">,</span> <span class="s2">"B"</span><span class="p">],</span> <span class="s2">"df2_mt"</span><span class="p">:</span> <span class="kc">None</span><span class="p">},</span> <span class="n">df_mt</span><span class="p">,</span> <span class="n">selector</span><span class="o">=</span><span class="s2">"df1_mt"</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [582]: </span><span class="n">store</span>
<span class="gh">Out[582]: </span>
<span class="go">&lt;class 'pandas.io.pytables.HDFStore'&gt;</span>
<span class="go">File path: store.h5</span>

<span class="go"># individual tables were created</span>
<span class="gp">In [583]: </span><span class="n">store</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">"df1_mt"</span><span class="p">)</span>
<span class="gh">Out[583]: </span>
<span class="go">                   A         B</span>
<span class="go">2000-01-01  0.162291 -0.430489</span>
<span class="go">2000-01-02       NaN       NaN</span>
<span class="go">2000-01-03  0.429207 -1.099274</span>
<span class="go">2000-01-04  1.869081 -1.466039</span>
<span class="go">2000-01-05  0.092130 -1.726280</span>
<span class="go">2000-01-06  0.266901 -0.036854</span>
<span class="go">2000-01-07 -0.517871 -0.990317</span>
<span class="go">2000-01-08 -0.231342  0.557402</span>

<span class="gp">In [584]: </span><span class="n">store</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">"df2_mt"</span><span class="p">)</span>
<span class="gh">Out[584]: </span>
<span class="go">                   C         D         E         F  foo</span>
<span class="go">2000-01-01 -2.502042  0.668149  0.460708  1.834518  bar</span>
<span class="go">2000-01-02  0.130441 -0.608465  0.439872  0.506364  bar</span>
<span class="go">2000-01-03 -1.069546  1.236277  0.116634 -1.772519  bar</span>
<span class="go">2000-01-04  0.137462  0.313939  0.748471 -0.943009  bar</span>
<span class="go">2000-01-05  0.836517  2.049798  0.562167  0.189952  bar</span>
<span class="go">2000-01-06  1.112750 -0.151596  1.503311  0.939470  bar</span>
<span class="go">2000-01-07 -0.294348  0.335844 -0.794159  1.495614  bar</span>
<span class="go">2000-01-08  0.860312 -0.538674 -0.541986 -1.759606  bar</span>

<span class="go"># as a multiple</span>
<span class="gp">In [585]: </span><span class="n">store</span><span class="o">.</span><span class="n">select_as_multiple</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="p">[</span><span class="s2">"df1_mt"</span><span class="p">,</span> <span class="s2">"df2_mt"</span><span class="p">],</span>
<span class="gp">   .....: </span>    <span class="n">where</span><span class="o">=</span><span class="p">[</span><span class="s2">"A&gt;0"</span><span class="p">,</span> <span class="s2">"B&gt;0"</span><span class="p">],</span>
<span class="gp">   .....: </span>    <span class="n">selector</span><span class="o">=</span><span class="s2">"df1_mt"</span><span class="p">,</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>
<span class="gh">Out[585]: </span>
<span class="go">Empty DataFrame</span>
<span class="go">Columns: [A, B, C, D, E, F, foo]</span>
<span class="go">Index: []</span>
</pre></div>
</div>
</section>
</section>
<section id="delete-from-a-table">
<h3>从表中删除<a class="headerlink" href="io.html#delete-from-a-table" title="指向此标题的链接">#</a></h3>
<p>您可以通过指定 <code class="docutils literal notranslate"><span class="pre">where</span></code> 从表中选择性删除。在删除行时，重要的是要了解 <code class="docutils literal notranslate"><span class="pre">PyTables</span></code> 通过擦除行，然后<strong>移动</strong>后续数据来删除行。因此，删除操作可能非常昂贵，具体取决于您数据的方向。为了获得最佳性能，将要删除的维度作为 <code class="docutils literal notranslate"><span class="pre">indexables</span></code> 的第一个维度是值得的。</p>
<p>数据（在磁盘上）是根据 <code class="docutils literal notranslate"><span class="pre">indexables</span></code> 进行排序的。这是一个简单的用例。您存储面板类型数据，日期在 <code class="docutils literal notranslate"><span class="pre">major_axis</span></code> 中，ID 在 <code class="docutils literal notranslate"><span class="pre">minor_axis</span></code> 中。数据会像这样交错：</p>
<ul class="simple">
<li><dl class="simple">
<dt>date_1</dt><dd><ul>
<li><p>id_1</p></li>
<li><p>id_2</p></li>
<li><p>.</p></li>
<li><p>id_n</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>date_2</dt><dd><ul>
<li><p>id_1</p></li>
<li><p>.</p></li>
<li><p>id_n</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>应该清楚的是，对 <code class="docutils literal notranslate"><span class="pre">major_axis</span></code> 的删除操作将相当快，因为一个块被移除后，后续数据被移动。另一方面，对 <code class="docutils literal notranslate"><span class="pre">minor_axis</span></code> 的删除操作将非常昂贵。在这种情况下，使用 <code class="docutils literal notranslate"><span class="pre">where</span></code> 选择除缺失数据之外的所有数据来重写表几乎肯定会更快。</p>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>请注意，HDF5 <strong>不会自动回收</strong> h5 文件中的空间。因此，重复删除（或移除节点）并再次添加，<strong>往往会增加文件大小</strong>。</p>
<p>要<em>重新打包和清理</em>文件，请使用 <a class="reference internal" href="io.html#io-hdf5-ptrepack"><span class="std std-ref">ptrepack</span></a>。</p>
</div>
</section>
<section id="notes-caveats">
<span id="io-hdf5-notes"></span><h3>注意事项与警告<a class="headerlink" href="io.html#notes-caveats" title="指向此标题的链接">#</a></h3>
<section id="compression">
<h4>压缩<a class="headerlink" href="io.html#compression" title="指向此标题的链接">#</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">PyTables</span></code> 允许对存储的数据进行压缩。这适用于所有类型的存储，而不仅仅是表。使用两个参数来控制压缩：<code class="docutils literal notranslate"><span class="pre">complevel</span></code> 和 <code class="docutils literal notranslate"><span class="pre">complib</span></code>。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">complevel</span></code> 指定是否以及如何进行数据压缩。<code class="docutils literal notranslate"><span class="pre">complevel=0</span></code> 和 <code class="docutils literal notranslate"><span class="pre">complevel=None</span></code> 禁用压缩，<code class="docutils literal notranslate"><span class="pre">0&lt;complevel&lt;10</span></code> 启用压缩。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">complib</span></code> 指定要使用的压缩库。如果未指定，则使用默认库 <code class="docutils literal notranslate"><span class="pre">zlib</span></code>。压缩库通常会优化压缩率或速度，结果将取决于数据类型。选择哪种压缩类型取决于您的具体需求和数据。支持的压缩库列表：</p>
<ul>
<li><p><a class="reference external" href="https://zlib.net/">zlib</a>：默认压缩库。在压缩方面是经典之作，能实现良好的压缩率，但速度稍慢。</p></li>
<li><p><a class="reference external" href="https://www.oberhumer.com/opensource/lzo/">lzo</a>：快速压缩和解压缩。</p></li>
<li><p><a class="reference external" href="https://sourceware.org/bzip2/">bzip2</a>：良好的压缩率。</p></li>
<li><p><a class="reference external" href="https://www.blosc.org/">blosc</a>：快速压缩和解压缩。</p>
<p>支持其他 blosc 压缩器：</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.blosc.org/">blosc:blosclz</a>：这是 <code class="docutils literal notranslate"><span class="pre">blosc</span></code> 的默认压缩器。</p></li>
<li><p><a class="reference external" href="https://fastcompression.blogspot.com/p/lz4.html">blosc:lz4</a>：一种紧凑、非常流行且快速的压缩器。</p></li>
<li><p><a class="reference external" href="https://fastcompression.blogspot.com/p/lz4.html">blosc:lz4hc</a>：LZ4 的调整版本，以牺牲速度为代价，产生更好的压缩比。</p></li>
<li><p><a class="reference external" href="https://ggdocs.cn/snappy/">blosc:snappy</a>：一种在许多地方使用的流行压缩器。</p></li>
<li><p><a class="reference external" href="https://zlib.net/">blosc:zlib</a>：经典压缩器；比前面几种稍慢，但能实现更好的压缩比。</p></li>
<li><p><a class="reference external" href="https://fbdocs.cn/zstd/">blosc:zstd</a>：一种极其均衡的编解码器；它在上述所有编解码器中提供了最佳压缩比，并且速度相当快。</p></li>
</ul>
</li>
</ul>
<p>如果 <code class="docutils literal notranslate"><span class="pre">complib</span></code> 定义为列出的库之外的任何内容，则会引发 <code class="docutils literal notranslate"><span class="pre">ValueError</span></code> 异常。</p>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p>如果您的平台上缺少使用 <code class="docutils literal notranslate"><span class="pre">complib</span></code> 选项指定的库，压缩将默认使用 <code class="docutils literal notranslate"><span class="pre">zlib</span></code>，无需进一步操作。</p>
</div>
<p>启用文件中所有对象的压缩功能。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">store_compressed</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">HDFStore</span><span class="p">(</span>
    <span class="s2">"store_compressed.h5"</span><span class="p">,</span> <span class="n">complevel</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">complib</span><span class="o">=</span><span class="s2">"blosc:blosclz"</span>
<span class="p">)</span>
</pre></div>
</div>
<p>或者在未启用压缩的存储中进行即时压缩（这仅适用于表）。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">store</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"df"</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">complib</span><span class="o">=</span><span class="s2">"zlib"</span><span class="p">,</span> <span class="n">complevel</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="ptrepack">
<span id="io-hdf5-ptrepack"></span><h4>ptrepack<a class="headerlink" href="io.html#ptrepack" title="指向此标题的链接">#</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">PyTables</span></code> 提供了更好的写入性能，当表在写入后进行压缩时，而不是从一开始就开启压缩。您可以使用附带的 <code class="docutils literal notranslate"><span class="pre">PyTables</span></code> 工具 <code class="docutils literal notranslate"><span class="pre">ptrepack</span></code>。此外，<code class="docutils literal notranslate"><span class="pre">ptrepack</span></code> 可以在事后更改压缩级别。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ptrepack --chunkshape=auto --propindexes --complevel=9 --complib=blosc in.h5 out.h5</span>
</pre></div>
</div>
<p>此外，<code class="docutils literal notranslate"><span class="pre">ptrepack</span> <span class="pre">in.h5</span> <span class="pre">out.h5</span></code> 将<em>重新打包</em>文件，以便您可以重复利用之前删除的空间。或者，也可以直接删除文件并重新写入，或使用 <code class="docutils literal notranslate"><span class="pre">copy</span></code> 方法。</p>
</section>
<section id="caveats">
<span id="io-hdf5-caveats"></span><h4>注意事项<a class="headerlink" href="io.html#caveats" title="指向此标题的链接">#</a></h4>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p><code class="docutils literal notranslate"><span class="pre">HDFStore</span></code> <strong>对于写入不是线程安全的</strong>。底层的 <code class="docutils literal notranslate"><span class="pre">PyTables</span></code> 仅支持并发读取（通过线程或进程）。如果您需要<em>同时</em>进行读取和写入，则需要在一个进程的单个线程中序列化这些操作。否则，您的数据将损坏。有关更多信息，请参见 (<a class="extlink-issue reference external" href="https://github.com/pandas-dev/pandas/issues/2397">GH 2397</a>)。</p>
</div>
<ul class="simple">
<li><p>如果您使用锁来管理多个进程之间的写入访问，您可能需要在释放写入锁之前使用 <a class="reference external" href="https://docs.pythonlang.cn/3/library/os.html#os.fsync" title="(in Python v3.13)"><code class="xref py py-func docutils literal notranslate"><span class="pre">fsync()</span></code></a>。为方便起见，您可以使用 <code class="docutils literal notranslate"><span class="pre">store.flush(fsync=True)</span></code> 来为您完成此操作。</p></li>
<li><p>一旦创建了 <code class="docutils literal notranslate"><span class="pre">table</span></code>，列（DataFrame）就固定了；只能追加完全相同的列。</p></li>
<li><p>请注意，时区（例如 <code class="docutils literal notranslate"><span class="pre">pytz.timezone('US/Eastern')</span></code>）在不同时区版本之间不一定相等。因此，如果使用某个时区库版本将数据本地化到 HDFStore 中的特定时区，并且该数据使用另一个版本更新，则数据将被转换为 UTC，因为这些时区被认为不相等。要么使用相同版本的时区库，要么使用 <code class="docutils literal notranslate"><span class="pre">tz_convert</span></code> 和更新的时区定义。</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>如果列名不能用作属性选择器，<code class="docutils literal notranslate"><span class="pre">PyTables</span></code> 将显示 <code class="docutils literal notranslate"><span class="pre">NaturalNameWarning</span></code>。<em>自然</em>标识符只包含字母、数字和下划线，并且不能以数字开头。其他标识符不能在 <code class="docutils literal notranslate"><span class="pre">where</span></code> 子句中使用，通常是个坏主意。</p>
</div>
</section>
</section>
<section id="datatypes">
<span id="io-hdf5-data-types"></span><h3>数据类型<a class="headerlink" href="io.html#datatypes" title="指向此标题的链接">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">HDFStore</span></code> 会将对象 dtype 映射到 <code class="docutils literal notranslate"><span class="pre">PyTables</span></code> 的底层 dtype。这意味着以下类型已知可行：</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>类型</p></th>
<th class="head"><p>表示缺失值</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>浮点型：<code class="docutils literal notranslate"><span class="pre">float64,</span> <span class="pre">float32,</span> <span class="pre">float16</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">np.nan</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>整型：<code class="docutils literal notranslate"><span class="pre">int64,</span> <span class="pre">int32,</span> <span class="pre">int8,</span> <span class="pre">uint64,uint32,</span> <span class="pre">uint8</span></code></p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>boolean</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">datetime64[ns]</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">NaT</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">timedelta64[ns]</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">NaT</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>分类型：见下文</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>对象型：<code class="docutils literal notranslate"><span class="pre">strings</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">np.nan</span></code></p></td>
</tr>
</tbody>
</table>
<p>不支持 <code class="docutils literal notranslate"><span class="pre">unicode</span></code> 列，并且<strong>将失败</strong>。</p>
<section id="categorical-data">
<span id="io-hdf5-categorical"></span><h4>分类数据<a class="headerlink" href="io.html#categorical-data" title="指向此标题的链接">#</a></h4>
<p>您可以将包含 <code class="docutils literal notranslate"><span class="pre">category</span></code> dtype 的数据写入 <code class="docutils literal notranslate"><span class="pre">HDFStore</span></code>。查询的工作方式与对象数组相同。然而，<code class="docutils literal notranslate"><span class="pre">category</span></code> dtype 的数据以更高效的方式存储。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [586]: </span><span class="n">dfcat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="p">{</span><span class="s2">"A"</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="s2">"aabbcdba"</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">"category"</span><span class="p">),</span> <span class="s2">"B"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">8</span><span class="p">)}</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [587]: </span><span class="n">dfcat</span>
<span class="gh">Out[587]: </span>
<span class="go">   A         B</span>
<span class="go">0  a -1.520478</span>
<span class="go">1  a -1.069391</span>
<span class="go">2  b -0.551981</span>
<span class="go">3  b  0.452407</span>
<span class="go">4  c  0.409257</span>
<span class="go">5  d  0.301911</span>
<span class="go">6  b -0.640843</span>
<span class="go">7  a -2.253022</span>

<span class="gp">In [588]: </span><span class="n">dfcat</span><span class="o">.</span><span class="n">dtypes</span>
<span class="gh">Out[588]: </span>
<span class="go">A    category</span>
<span class="go">B     float64</span>
<span class="go">dtype: object</span>

<span class="gp">In [589]: </span><span class="n">cstore</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">HDFStore</span><span class="p">(</span><span class="s2">"cats.h5"</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"w"</span><span class="p">)</span>

<span class="gp">In [590]: </span><span class="n">cstore</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"dfcat"</span><span class="p">,</span> <span class="n">dfcat</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">"table"</span><span class="p">,</span> <span class="n">data_columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"A"</span><span class="p">])</span>

<span class="gp">In [591]: </span><span class="n">result</span> <span class="o">=</span> <span class="n">cstore</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">"dfcat"</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="s2">"A in ['b', 'c']"</span><span class="p">)</span>

<span class="gp">In [592]: </span><span class="n">result</span>
<span class="gh">Out[592]: </span>
<span class="go">   A         B</span>
<span class="go">2  b -0.551981</span>
<span class="go">3  b  0.452407</span>
<span class="go">4  c  0.409257</span>
<span class="go">6  b -0.640843</span>

<span class="gp">In [593]: </span><span class="n">result</span><span class="o">.</span><span class="n">dtypes</span>
<span class="gh">Out[593]: </span>
<span class="go">A    category</span>
<span class="go">B     float64</span>
<span class="go">dtype: object</span>
</pre></div>
</div>
</section>
<section id="string-columns">
<h4>字符串列<a class="headerlink" href="io.html#string-columns" title="指向此标题的链接">#</a></h4>
<p><strong>min_itemsize</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">HDFStore</span></code> 的底层实现对字符串列使用固定的列宽（itemsize）。字符串列的 itemsize 是根据<strong>首次追加</strong>到 <code class="docutils literal notranslate"><span class="pre">HDFStore</span></code> 的数据（针对该列）的最大长度计算的。后续追加时，如果引入的字符串长度<strong>大于</strong>该列所能容纳的长度，将引发异常（否则可能会对这些列进行静默截断，导致信息丢失）。将来我们可能会放宽此限制，并允许用户指定的截断发生。</p>
<p>在首次创建表时传递 <code class="docutils literal notranslate"><span class="pre">min_itemsize</span></code>，以预先指定特定字符串列的最小长度。<code class="docutils literal notranslate"><span class="pre">min_itemsize</span></code> 可以是整数，也可以是将列名映射到整数的字典。您可以将 <code class="docutils literal notranslate"><span class="pre">values</span></code> 作为键传入，以使所有<em>可索引列</em>或<em>数据列</em>都具有此 min_itemsize。</p>
<p>传入 <code class="docutils literal notranslate"><span class="pre">min_itemsize</span></code> 字典将导致所有传入的列自动创建为<em>数据列</em>。</p>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p>如果您未传递任何 <code class="docutils literal notranslate"><span class="pre">data_columns</span></code>，则 <code class="docutils literal notranslate"><span class="pre">min_itemsize</span></code> 将是任何传入字符串长度的最大值。</p>
</div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [594]: </span><span class="n">dfs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">"A"</span><span class="p">:</span> <span class="s2">"foo"</span><span class="p">,</span> <span class="s2">"B"</span><span class="p">:</span> <span class="s2">"bar"</span><span class="p">},</span> <span class="n">index</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)))</span>

<span class="gp">In [595]: </span><span class="n">dfs</span>
<span class="gh">Out[595]: </span>
<span class="go">     A    B</span>
<span class="go">0  foo  bar</span>
<span class="go">1  foo  bar</span>
<span class="go">2  foo  bar</span>
<span class="go">3  foo  bar</span>
<span class="go">4  foo  bar</span>

<span class="go"># A and B have a size of 30</span>
<span class="gp">In [596]: </span><span class="n">store</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"dfs"</span><span class="p">,</span> <span class="n">dfs</span><span class="p">,</span> <span class="n">min_itemsize</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>

<span class="gp">In [597]: </span><span class="n">store</span><span class="o">.</span><span class="n">get_storer</span><span class="p">(</span><span class="s2">"dfs"</span><span class="p">)</span><span class="o">.</span><span class="n">table</span>
<span class="gh">Out[597]: </span>
<span class="go">/dfs/table (Table(5,)) ''</span>
<span class="go">  description := {</span>
<span class="go">  "index": Int64Col(shape=(), dflt=0, pos=0),</span>
<span class="go">  "values_block_0": StringCol(itemsize=30, shape=(2,), dflt=b'', pos=1)}</span>
<span class="go">  byteorder := 'little'</span>
<span class="go">  chunkshape := (963,)</span>
<span class="go">  autoindex := True</span>
<span class="go">  colindexes := {</span>
<span class="go">    "index": Index(6, mediumshuffle, zlib(1)).is_csi=False}</span>

<span class="go"># A is created as a data_column with a size of 30</span>
<span class="go"># B is size is calculated</span>
<span class="gp">In [598]: </span><span class="n">store</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"dfs2"</span><span class="p">,</span> <span class="n">dfs</span><span class="p">,</span> <span class="n">min_itemsize</span><span class="o">=</span><span class="p">{</span><span class="s2">"A"</span><span class="p">:</span> <span class="mi">30</span><span class="p">})</span>

<span class="gp">In [599]: </span><span class="n">store</span><span class="o">.</span><span class="n">get_storer</span><span class="p">(</span><span class="s2">"dfs2"</span><span class="p">)</span><span class="o">.</span><span class="n">table</span>
<span class="gh">Out[599]: </span>
<span class="go">/dfs2/table (Table(5,)) ''</span>
<span class="go">  description := {</span>
<span class="go">  "index": Int64Col(shape=(), dflt=0, pos=0),</span>
<span class="go">  "values_block_0": StringCol(itemsize=3, shape=(1,), dflt=b'', pos=1),</span>
<span class="go">  "A": StringCol(itemsize=30, shape=(), dflt=b'', pos=2)}</span>
<span class="go">  byteorder := 'little'</span>
<span class="go">  chunkshape := (1598,)</span>
<span class="go">  autoindex := True</span>
<span class="go">  colindexes := {</span>
<span class="go">    "index": Index(6, mediumshuffle, zlib(1)).is_csi=False,</span>
<span class="go">    "A": Index(6, mediumshuffle, zlib(1)).is_csi=False}</span>
</pre></div>
</div>
<p><strong>nan_rep</strong></p>
<p>字符串列将使用 <code class="docutils literal notranslate"><span class="pre">nan_rep</span></code> 字符串表示来序列化 <code class="docutils literal notranslate"><span class="pre">np.nan</span></code>（一个缺失值）。这默认为字符串值 <code class="docutils literal notranslate"><span class="pre">nan</span></code>。您可能会无意中将一个实际的 <code class="docutils literal notranslate"><span class="pre">nan</span></code> 值转换为缺失值。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [600]: </span><span class="n">dfss</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">"A"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"foo"</span><span class="p">,</span> <span class="s2">"bar"</span><span class="p">,</span> <span class="s2">"nan"</span><span class="p">]})</span>

<span class="gp">In [601]: </span><span class="n">dfss</span>
<span class="gh">Out[601]: </span>
<span class="go">     A</span>
<span class="go">0  foo</span>
<span class="go">1  bar</span>
<span class="go">2  nan</span>

<span class="gp">In [602]: </span><span class="n">store</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"dfss"</span><span class="p">,</span> <span class="n">dfss</span><span class="p">)</span>

<span class="gp">In [603]: </span><span class="n">store</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">"dfss"</span><span class="p">)</span>
<span class="gh">Out[603]: </span>
<span class="go">     A</span>
<span class="go">0  foo</span>
<span class="go">1  bar</span>
<span class="go">2  NaN</span>

<span class="go"># here you need to specify a different nan rep</span>
<span class="gp">In [604]: </span><span class="n">store</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"dfss2"</span><span class="p">,</span> <span class="n">dfss</span><span class="p">,</span> <span class="n">nan_rep</span><span class="o">=</span><span class="s2">"_nan_"</span><span class="p">)</span>

<span class="gp">In [605]: </span><span class="n">store</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">"dfss2"</span><span class="p">)</span>
<span class="gh">Out[605]: </span>
<span class="go">     A</span>
<span class="go">0  foo</span>
<span class="go">1  bar</span>
<span class="go">2  nan</span>
</pre></div>
</div>
</section>
</section>
<section id="performance">
<h3>性能<a class="headerlink" href="io.html#performance" title="指向此标题的链接">#</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">tables</span></code> 格式与 <code class="docutils literal notranslate"><span class="pre">fixed</span></code> 存储相比，写入性能会受到影响。其优势在于能够追加/删除和查询（可能是非常大量的数据）。与常规存储相比，写入时间通常更长。查询时间可以相当快，尤其是在索引轴上。</p></li>
<li><p>您可以将 <code class="docutils literal notranslate"><span class="pre">chunksize=&lt;int&gt;</span></code> 传递给 <code class="docutils literal notranslate"><span class="pre">append</span></code>，以指定写入块大小（默认为 50000）。这将显著降低写入时的内存使用量。</p></li>
<li><p>您可以将 <code class="docutils literal notranslate"><span class="pre">expectedrows=&lt;int&gt;</span></code> 传递给首次 <code class="docutils literal notranslate"><span class="pre">append</span></code>，以设置 <code class="docutils literal notranslate"><span class="pre">PyTables</span></code> 预期的总行数。这将优化读写性能。</p></li>
<li><p>重复行可以写入表，但在选择时会被过滤掉（选择最后出现的项；因此表在主轴和次轴对上是唯一的）。</p></li>
<li><p>如果您尝试存储将被 PyTables 进行 pickle 序列化的类型（而不是作为固有类型存储），将引发 <code class="docutils literal notranslate"><span class="pre">PerformanceWarning</span></code>。有关更多信息和一些解决方案，请参见<a class="reference external" href="https://stackoverflow.com/questions/14355151/how-to-make-pandas-hdfstore-put-operation-faster/14370190#14370190">此处</a>。</p></li>
</ul>
</section>
</section>
<section id="feather">
<span id="io-feather"></span><h2>Feather<a class="headerlink" href="io.html#feather" title="指向此标题的链接">#</a></h2>
<p>Feather 为数据帧提供了二进制列式序列化。它旨在提高数据帧读写效率，并简化跨数据分析语言的数据共享。</p>
<p>Feather 旨在忠实地序列化和反序列化 DataFrames，支持所有 pandas dtypes，包括分类和带时区的 datetime 等扩展 dtypes。</p>
<p>一些注意事项</p>
<ul class="simple">
<li><p>此格式将不会为 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> 写入 <code class="docutils literal notranslate"><span class="pre">Index</span></code> 或 <code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code>，如果提供了非默认的索引，则会引发错误。您可以调用 <code class="docutils literal notranslate"><span class="pre">.reset_index()</span></code> 来存储索引，或调用 <code class="docutils literal notranslate"><span class="pre">.reset_index(drop=True)</span></code> 来忽略它。</p></li>
<li><p>不支持重复的列名和非字符串列名。</p></li>
<li><p>不支持对象 dtype 列中的实际 Python 对象。尝试序列化时，这些将引发一条有用的错误消息。</p></li>
</ul>
<p>请参阅<a class="reference external" href="https://github.com/wesm/feather">完整文档</a>。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [606]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="p">{</span>
<span class="gp">   .....: </span>        <span class="s2">"a"</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="s2">"abc"</span><span class="p">),</span>
<span class="gp">   .....: </span>        <span class="s2">"b"</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)),</span>
<span class="gp">   .....: </span>        <span class="s2">"c"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">"u1"</span><span class="p">),</span>
<span class="gp">   .....: </span>        <span class="s2">"d"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">"float64"</span><span class="p">),</span>
<span class="gp">   .....: </span>        <span class="s2">"e"</span><span class="p">:</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">],</span>
<span class="gp">   .....: </span>        <span class="s2">"f"</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="s2">"abc"</span><span class="p">)),</span>
<span class="gp">   .....: </span>        <span class="s2">"g"</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">"20130101"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
<span class="gp">   .....: </span>        <span class="s2">"h"</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">"20130101"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s2">"US/Eastern"</span><span class="p">),</span>
<span class="gp">   .....: </span>        <span class="s2">"i"</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">"20130101"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"ns"</span><span class="p">),</span>
<span class="gp">   .....: </span>    <span class="p">}</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [607]: </span><span class="n">df</span>
<span class="gh">Out[607]: </span>
<span class="go">   a  b  c  ...          g                         h                             i</span>
<span class="go">0  a  1  3  ... 2013-01-01 2013-01-01 00:00:00-05:00 2013-01-01 00:00:00.000000000</span>
<span class="go">1  b  2  4  ... 2013-01-02 2013-01-02 00:00:00-05:00 2013-01-01 00:00:00.000000001</span>
<span class="go">2  c  3  5  ... 2013-01-03 2013-01-03 00:00:00-05:00 2013-01-01 00:00:00.000000002</span>

<span class="go">[3 rows x 9 columns]</span>

<span class="gp">In [608]: </span><span class="n">df</span><span class="o">.</span><span class="n">dtypes</span>
<span class="gh">Out[608]: </span>
<span class="go">a                        object</span>
<span class="go">b                         int64</span>
<span class="go">c                         uint8</span>
<span class="go">d                       float64</span>
<span class="go">e                          bool</span>
<span class="go">f                      category</span>
<span class="go">g                datetime64[ns]</span>
<span class="go">h    datetime64[ns, US/Eastern]</span>
<span class="go">i                datetime64[ns]</span>
<span class="go">dtype: object</span>
</pre></div>
</div>
<p>写入 feather 文件。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [609]: </span><span class="n">df</span><span class="o">.</span><span class="n">to_feather</span><span class="p">(</span><span class="s2">"example.feather"</span><span class="p">)</span>
</pre></div>
</div>
<p>从 feather 文件读取。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [610]: </span><span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_feather</span><span class="p">(</span><span class="s2">"example.feather"</span><span class="p">)</span>

<span class="gp">In [611]: </span><span class="n">result</span>
<span class="gh">Out[611]: </span>
<span class="go">   a  b  c  ...          g                         h                             i</span>
<span class="go">0  a  1  3  ... 2013-01-01 2013-01-01 00:00:00-05:00 2013-01-01 00:00:00.000000000</span>
<span class="go">1  b  2  4  ... 2013-01-02 2013-01-02 00:00:00-05:00 2013-01-01 00:00:00.000000001</span>
<span class="go">2  c  3  5  ... 2013-01-03 2013-01-03 00:00:00-05:00 2013-01-01 00:00:00.000000002</span>

<span class="go">[3 rows x 9 columns]</span>

<span class="go"># we preserve dtypes</span>
<span class="gp">In [612]: </span><span class="n">result</span><span class="o">.</span><span class="n">dtypes</span>
<span class="gh">Out[612]: </span>
<span class="go">a                        object</span>
<span class="go">b                         int64</span>
<span class="go">c                         uint8</span>
<span class="go">d                       float64</span>
<span class="go">e                          bool</span>
<span class="go">f                      category</span>
<span class="go">g                datetime64[ns]</span>
<span class="go">h    datetime64[ns, US/Eastern]</span>
<span class="go">i                datetime64[ns]</span>
<span class="go">dtype: object</span>
</pre></div>
</div>
</section>
<section id="parquet">
<span id="io-parquet"></span><h2>Parquet<a class="headerlink" href="io.html#parquet" title="Link to this heading">#</a></h2>
<p><a class="reference external" href="https://parquet.apache.org/">Apache Parquet</a> 为数据框提供了一种分区二进制列式序列化。它旨在高效地读写数据框，并方便跨数据分析语言共享数据。Parquet 可以使用各种压缩技术来尽可能缩小文件大小，同时仍保持良好的读取性能。</p>
<p>Parquet 旨在忠实地序列化和反序列化 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>，支持所有 pandas 数据类型，包括带时区的 datetime 等扩展数据类型。</p>
<p>几点注意事项。</p>
<ul class="simple">
<li><p>不支持重复的列名和非字符串列名。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pyarrow</span></code> 引擎始终将索引写入输出，但 <code class="docutils literal notranslate"><span class="pre">fastparquet</span></code> 仅写入非默认索引。这个额外的列可能会给不期望它的非 pandas 消费者带来问题。无论底层引擎如何，您都可以使用 <code class="docutils literal notranslate"><span class="pre">index</span></code> 参数强制包含或省略索引。</p></li>
<li><p>如果指定了索引级别名称，则必须是字符串。</p></li>
<li><p>在 <code class="docutils literal notranslate"><span class="pre">pyarrow</span></code> 引擎中，非字符串类型的分类数据类型可以序列化为 parquet，但反序列化时将作为其原始数据类型。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pyarrow</span></code> 引擎保留了字符串类型分类数据类型的 <code class="docutils literal notranslate"><span class="pre">ordered</span></code> 标志。<code class="docutils literal notranslate"><span class="pre">fastparquet</span></code> 不保留 <code class="docutils literal notranslate"><span class="pre">ordered</span></code> 标志。</p></li>
<li><p>不支持的类型包括 <code class="docutils literal notranslate"><span class="pre">Interval</span></code> 和实际的 Python 对象类型。尝试序列化时，这些将引发一条有用的错误消息。<code class="docutils literal notranslate"><span class="pre">Period</span></code> 类型在 pyarrow &gt;= 0.16.0 时受支持。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pyarrow</span></code> 引擎保留了可空整数和字符串数据类型等扩展数据类型（要求 pyarrow &gt;= 0.16.0，并要求扩展类型实现所需的协议，请参阅<a class="reference internal" href="../development/extending.html#extending-extension-arrow"><span class="std std-ref">扩展类型文档</span></a>）。</p></li>
</ul>
<p>您可以指定一个 <code class="docutils literal notranslate"><span class="pre">engine</span></code> 来指导序列化。它可以是 <code class="docutils literal notranslate"><span class="pre">pyarrow</span></code>、<code class="docutils literal notranslate"><span class="pre">fastparquet</span></code> 或 <code class="docutils literal notranslate"><span class="pre">auto</span></code> 之一。如果未指定引擎，则会检查 <code class="docutils literal notranslate"><span class="pre">pd.options.io.parquet.engine</span></code> 选项；如果此选项也为 <code class="docutils literal notranslate"><span class="pre">auto</span></code>，则尝试 <code class="docutils literal notranslate"><span class="pre">pyarrow</span></code>，然后回退到 <code class="docutils literal notranslate"><span class="pre">fastparquet</span></code>。</p>
<p>请参阅 <a class="reference external" href="https://arrow.apache.ac.cn/docs/python/">pyarrow</a> 和 <a class="reference external" href="https://fastparquet.readthedocs.io/en/latest/">fastparquet</a> 的文档。</p>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p>这些引擎非常相似，应该能够读写几乎相同的 parquet 格式文件。<code class="docutils literal notranslate"><span class="pre">pyarrow&gt;=8.0.0</span></code> 支持 timedelta 数据，<code class="docutils literal notranslate"><span class="pre">fastparquet&gt;=0.1.4</span></code> 支持时区感知 datetime。这些库的区别在于底层依赖项不同（<code class="docutils literal notranslate"><span class="pre">fastparquet</span></code> 使用 <code class="docutils literal notranslate"><span class="pre">numba</span></code>，而 <code class="docutils literal notranslate"><span class="pre">pyarrow</span></code> 使用 C 库）。</p>
</div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [613]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="p">{</span>
<span class="gp">   .....: </span>        <span class="s2">"a"</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="s2">"abc"</span><span class="p">),</span>
<span class="gp">   .....: </span>        <span class="s2">"b"</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)),</span>
<span class="gp">   .....: </span>        <span class="s2">"c"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">"u1"</span><span class="p">),</span>
<span class="gp">   .....: </span>        <span class="s2">"d"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">"float64"</span><span class="p">),</span>
<span class="gp">   .....: </span>        <span class="s2">"e"</span><span class="p">:</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">],</span>
<span class="gp">   .....: </span>        <span class="s2">"f"</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">"20130101"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
<span class="gp">   .....: </span>        <span class="s2">"g"</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">"20130101"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s2">"US/Eastern"</span><span class="p">),</span>
<span class="gp">   .....: </span>        <span class="s2">"h"</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="s2">"abc"</span><span class="p">)),</span>
<span class="gp">   .....: </span>        <span class="s2">"i"</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="s2">"abc"</span><span class="p">),</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
<span class="gp">   .....: </span>    <span class="p">}</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [614]: </span><span class="n">df</span>
<span class="gh">Out[614]: </span>
<span class="go">   a  b  c    d      e          f                         g  h  i</span>
<span class="go">0  a  1  3  4.0   True 2013-01-01 2013-01-01 00:00:00-05:00  a  a</span>
<span class="go">1  b  2  4  5.0  False 2013-01-02 2013-01-02 00:00:00-05:00  b  b</span>
<span class="go">2  c  3  5  6.0   True 2013-01-03 2013-01-03 00:00:00-05:00  c  c</span>

<span class="gp">In [615]: </span><span class="n">df</span><span class="o">.</span><span class="n">dtypes</span>
<span class="gh">Out[615]: </span>
<span class="go">a                        object</span>
<span class="go">b                         int64</span>
<span class="go">c                         uint8</span>
<span class="go">d                       float64</span>
<span class="go">e                          bool</span>
<span class="go">f                datetime64[ns]</span>
<span class="go">g    datetime64[ns, US/Eastern]</span>
<span class="go">h                      category</span>
<span class="go">i                      category</span>
<span class="go">dtype: object</span>
</pre></div>
</div>
<p>写入 parquet 文件。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [616]: </span><span class="n">df</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="s2">"example_pa.parquet"</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">"pyarrow"</span><span class="p">)</span>

<span class="gp">In [617]: </span><span class="n">df</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="s2">"example_fp.parquet"</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">"fastparquet"</span><span class="p">)</span>
</pre></div>
</div>
<p>从 parquet 文件读取。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [618]: </span><span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s2">"example_fp.parquet"</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">"fastparquet"</span><span class="p">)</span>

<span class="gp">In [619]: </span><span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s2">"example_pa.parquet"</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">"pyarrow"</span><span class="p">)</span>

<span class="gp">In [620]: </span><span class="n">result</span><span class="o">.</span><span class="n">dtypes</span>
<span class="gh">Out[620]: </span>
<span class="go">a                        object</span>
<span class="go">b                         int64</span>
<span class="go">c                         uint8</span>
<span class="go">d                       float64</span>
<span class="go">e                          bool</span>
<span class="go">f                datetime64[ns]</span>
<span class="go">g    datetime64[ns, US/Eastern]</span>
<span class="go">h                      category</span>
<span class="go">i                      category</span>
<span class="go">dtype: object</span>
</pre></div>
</div>
<p>通过设置 <code class="docutils literal notranslate"><span class="pre">dtype_backend</span></code> 参数，您可以控制生成的 DataFrame 的默认 dtypes。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [621]: </span><span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s2">"example_pa.parquet"</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">"pyarrow"</span><span class="p">,</span> <span class="n">dtype_backend</span><span class="o">=</span><span class="s2">"pyarrow"</span><span class="p">)</span>

<span class="gp">In [622]: </span><span class="n">result</span><span class="o">.</span><span class="n">dtypes</span>
<span class="gh">Out[622]: </span>
<span class="go">a                                      string[pyarrow]</span>
<span class="go">b                                       int64[pyarrow]</span>
<span class="go">c                                       uint8[pyarrow]</span>
<span class="go">d                                      double[pyarrow]</span>
<span class="go">e                                        bool[pyarrow]</span>
<span class="go">f                               timestamp[ns][pyarrow]</span>
<span class="go">g                timestamp[ns, tz=US/Eastern][pyarrow]</span>
<span class="go">h    dictionary&lt;values=string, indices=int8, ordere...</span>
<span class="go">i    dictionary&lt;values=string, indices=int8, ordere...</span>
<span class="go">dtype: object</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p>请注意，<code class="docutils literal notranslate"><span class="pre">fastparquet</span></code> 不支持此功能。</p>
</div>
<p>仅读取 parquet 文件的某些列。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [623]: </span><span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="s2">"example_fp.parquet"</span><span class="p">,</span>
<span class="gp">   .....: </span>    <span class="n">engine</span><span class="o">=</span><span class="s2">"fastparquet"</span><span class="p">,</span>
<span class="gp">   .....: </span>    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">],</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [624]: </span><span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="s2">"example_pa.parquet"</span><span class="p">,</span>
<span class="gp">   .....: </span>    <span class="n">engine</span><span class="o">=</span><span class="s2">"pyarrow"</span><span class="p">,</span>
<span class="gp">   .....: </span>    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">],</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [625]: </span><span class="n">result</span><span class="o">.</span><span class="n">dtypes</span>
<span class="gh">Out[625]: </span>
<span class="go">a    object</span>
<span class="go">b     int64</span>
<span class="go">dtype: object</span>
</pre></div>
</div>
<section id="handling-indexes">
<h3>处理索引<a class="headerlink" href="io.html#handling-indexes" title="Link to this heading">#</a></h3>
<p>将 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> 序列化为 parquet 可能将隐式索引作为输出文件中的一个或多个列包含在内。因此，以下代码</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [626]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">"a"</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="s2">"b"</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]})</span>

<span class="gp">In [627]: </span><span class="n">df</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="s2">"test.parquet"</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">"pyarrow"</span><span class="p">)</span>
</pre></div>
</div>
<p>如果您使用 <code class="docutils literal notranslate"><span class="pre">pyarrow</span></code> 进行序列化，则会创建具有<em>三</em>列的 parquet 文件：<code class="docutils literal notranslate"><span class="pre">a</span></code>、<code class="docutils literal notranslate"><span class="pre">b</span></code> 和 <code class="docutils literal notranslate"><span class="pre">__index_level_0__</span></code>。如果您使用 <code class="docutils literal notranslate"><span class="pre">fastparquet</span></code>，索引<a class="reference external" href="https://fastparquet.readthedocs.io/en/latest/api.html#fastparquet.write">可能会或可能不会</a>写入文件。</p>
<p>这个意外的额外列导致一些数据库（如 Amazon Redshift）拒绝该文件，因为目标表中不存在该列。</p>
<p>如果您想在写入时省略数据框的索引，请将 <code class="docutils literal notranslate"><span class="pre">index=False</span></code> 传递给 <a class="reference internal" href="../reference/api/pandas.DataFrame.to_parquet.html#pandas.DataFrame.to_parquet" title="pandas.DataFrame.to_parquet"><code class="xref py py-func docutils literal notranslate"><span class="pre">to_parquet()</span></code></a></p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [628]: </span><span class="n">df</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="s2">"test.parquet"</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>这将创建一个仅包含 <code class="docutils literal notranslate"><span class="pre">a</span></code> 和 <code class="docutils literal notranslate"><span class="pre">b</span></code> 两列的 parquet 文件。如果您的 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> 具有自定义索引，则在将此文件加载到 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> 时将无法取回该索引。</p>
<p>传递 <code class="docutils literal notranslate"><span class="pre">index=True</span></code> 将<em>始终</em>写入索引，即使这不是底层引擎的默认行为。</p>
</section>
<section id="partitioning-parquet-files">
<h3>分区 Parquet 文件<a class="headerlink" href="io.html#partitioning-parquet-files" title="Link to this heading">#</a></h3>
<p>Parquet 支持根据一个或多个列的值对数据进行分区。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [629]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">"a"</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s2">"b"</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]})</span>

<span class="gp">In [630]: </span><span class="n">df</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">"test"</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">"pyarrow"</span><span class="p">,</span> <span class="n">partition_cols</span><span class="o">=</span><span class="p">[</span><span class="s2">"a"</span><span class="p">],</span> <span class="n">compression</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">path</span></code> 指定将数据保存到的父目录。<code class="docutils literal notranslate"><span class="pre">partition_cols</span></code> 是数据集将按其分区的列名。列按给定顺序进行分区。分区拆分由分区列中的唯一值确定。上面的示例创建了一个分区数据集，它可能看起来像</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>test
├── a=0
│   ├── 0bac803e32dc42ae83fddfd029cbdebc.parquet
│   └──  ...
└── a=1
    ├── e6ab24a4f45147b49b54a662f0c412a3.parquet
    └── ...
</pre></div>
</div>
</section>
</section>
<section id="orc">
<span id="io-orc"></span><h2>ORC<a class="headerlink" href="io.html#orc" title="Link to this heading">#</a></h2>
<p>与<a class="reference internal" href="io.html#io-parquet"><span class="std std-ref">parquet</span></a>格式类似，<a class="reference external" href="https://orc.apache.org/">ORC 格式</a>是一种二进制列式序列化数据框的格式。它旨在高效地读取数据框。pandas 提供了 ORC 格式的读取器和写入器，即 <a class="reference internal" href="../reference/api/pandas.read_orc.html#pandas.read_orc" title="pandas.read_orc"><code class="xref py py-func docutils literal notranslate"><span class="pre">read_orc()</span></code></a> 和 <a class="reference internal" href="../reference/api/pandas.DataFrame.to_orc.html#pandas.DataFrame.to_orc" title="pandas.DataFrame.to_orc"><code class="xref py py-func docutils literal notranslate"><span class="pre">to_orc()</span></code></a>。这需要 <a class="reference external" href="https://arrow.apache.ac.cn/docs/python/">pyarrow</a> 库。</p>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<ul class="simple">
<li><p>由于 pyarrow 出现的一些问题，<em>强烈建议</em>使用 conda 安装 pyarrow。</p></li>
<li><p><a class="reference internal" href="../reference/api/pandas.DataFrame.to_orc.html#pandas.DataFrame.to_orc" title="pandas.DataFrame.to_orc"><code class="xref py py-func docutils literal notranslate"><span class="pre">to_orc()</span></code></a> 需要 pyarrow&gt;=7.0.0。</p></li>
<li><p><a class="reference internal" href="../reference/api/pandas.read_orc.html#pandas.read_orc" title="pandas.read_orc"><code class="xref py py-func docutils literal notranslate"><span class="pre">read_orc()</span></code></a> 和 <a class="reference internal" href="../reference/api/pandas.DataFrame.to_orc.html#pandas.DataFrame.to_orc" title="pandas.DataFrame.to_orc"><code class="xref py py-func docutils literal notranslate"><span class="pre">to_orc()</span></code></a> 暂不支持 Windows，您可以在<a class="reference internal" href="../getting_started/install.html#install-warn-orc"><span class="std std-ref">安装可选依赖项</span></a>中找到有效的环境。</p></li>
<li><p>对于支持的 dtypes，请参阅 <a class="reference external" href="https://arrow.apache.ac.cn/docs/cpp/orc.html#data-types">Arrow 中支持的 ORC 功能</a>。</p></li>
<li><p>目前，当数据框转换为 ORC 文件时，datetime 列中的时区不予保留。</p></li>
</ul>
</div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [631]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="p">{</span>
<span class="gp">   .....: </span>        <span class="s2">"a"</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="s2">"abc"</span><span class="p">),</span>
<span class="gp">   .....: </span>        <span class="s2">"b"</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)),</span>
<span class="gp">   .....: </span>        <span class="s2">"c"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">"float64"</span><span class="p">),</span>
<span class="gp">   .....: </span>        <span class="s2">"d"</span><span class="p">:</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">],</span>
<span class="gp">   .....: </span>        <span class="s2">"e"</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">"20130101"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
<span class="gp">   .....: </span>    <span class="p">}</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [632]: </span><span class="n">df</span>
<span class="gh">Out[632]: </span>
<span class="go">   a  b    c      d          e</span>
<span class="go">0  a  1  4.0   True 2013-01-01</span>
<span class="go">1  b  2  5.0  False 2013-01-02</span>
<span class="go">2  c  3  6.0   True 2013-01-03</span>

<span class="gp">In [633]: </span><span class="n">df</span><span class="o">.</span><span class="n">dtypes</span>
<span class="gh">Out[633]: </span>
<span class="go">a            object</span>
<span class="go">b             int64</span>
<span class="go">c           float64</span>
<span class="go">d              bool</span>
<span class="go">e    datetime64[ns]</span>
<span class="go">dtype: object</span>
</pre></div>
</div>
<p>写入 ORC 文件。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [634]: </span><span class="n">df</span><span class="o">.</span><span class="n">to_orc</span><span class="p">(</span><span class="s2">"example_pa.orc"</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">"pyarrow"</span><span class="p">)</span>
</pre></div>
</div>
<p>从 ORC 文件读取。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [635]: </span><span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_orc</span><span class="p">(</span><span class="s2">"example_pa.orc"</span><span class="p">)</span>

<span class="gp">In [636]: </span><span class="n">result</span><span class="o">.</span><span class="n">dtypes</span>
<span class="gh">Out[636]: </span>
<span class="go">a            object</span>
<span class="go">b             int64</span>
<span class="go">c           float64</span>
<span class="go">d              bool</span>
<span class="go">e    datetime64[ns]</span>
<span class="go">dtype: object</span>
</pre></div>
</div>
<p>仅读取 ORC 文件的某些列。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [637]: </span><span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_orc</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="s2">"example_pa.orc"</span><span class="p">,</span>
<span class="gp">   .....: </span>    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">],</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [638]: </span><span class="n">result</span><span class="o">.</span><span class="n">dtypes</span>
<span class="gh">Out[638]: </span>
<span class="go">a    object</span>
<span class="go">b     int64</span>
<span class="go">dtype: object</span>
</pre></div>
</div>
</section>
<section id="sql-queries">
<span id="io-sql"></span><h2>SQL 查询<a class="headerlink" href="io.html#sql-queries" title="Link to this heading">#</a></h2>
<p><code class="xref py py-mod docutils literal notranslate"><span class="pre">pandas.io.sql</span></code> 模块提供了一系列查询包装器，以方便数据检索并减少对特定数据库 API 的依赖。</p>
<p>在可用时，用户可能首先选择使用 <a class="reference external" href="https://arrow.apache.ac.cn/adbc/current/index.html">Apache Arrow ADBC</a> 驱动程序。这些驱动程序应提供最佳性能、空值处理和类型检测。</p>
<blockquote>
<div><div class="versionadded">
<p><span class="versionmodified added">版本 2.2.0 中新增：</span>增加了对 ADBC 驱动程序的原生支持</p>
</div>
</div></blockquote>
<p>有关 ADBC 驱动程序及其开发状态的完整列表，请参阅 <a class="reference external" href="https://arrow.apache.ac.cn/adbc/current/driver/status.html">ADBC 驱动程序实现状态</a>文档。</p>
<p>如果 ADBC 驱动程序不可用或可能缺少功能，用户应选择安装 SQLAlchemy 及其数据库驱动程序库。此类驱动程序的示例包括 PostgreSQL 的 <a class="reference external" href="https://www.psycopg.org/">psycopg2</a> 或 MySQL 的 <a class="reference external" href="https://github.com/PyMySQL/PyMySQL">pymysql</a>。对于 <a class="reference external" href="https://docs.pythonlang.cn/3/library/sqlite3.html">SQLite</a>，这默认包含在 Python 的标准库中。您可以在 <a class="reference external" href="https://docs.sqlalchemy.org.cn/en/latest/dialects/index.html">SQLAlchemy 文档</a>中找到每个 SQL 方言支持的驱动程序概述。</p>
<p>如果未安装 SQLAlchemy，您可以使用 <a class="reference external" href="https://docs.pythonlang.cn/3/library/sqlite3.html#sqlite3.Connection" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlite3.Connection</span></code></a> 代替 SQLAlchemy 引擎、连接或 URI 字符串。</p>
<p>另请参阅一些 <a class="reference internal" href="cookbook.html#cookbook-sql"><span class="std std-ref">cookbook 示例</span></a>，了解一些高级策略。</p>
<p>关键函数是</p>
<table class="autosummary longtable table autosummary">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="../reference/api/pandas.read_sql_table.html#pandas.read_sql_table" title="pandas.read_sql_table"><code class="xref py py-obj docutils literal notranslate"><span class="pre">read_sql_table</span></code></a>(table_name,&nbsp;con[,&nbsp;schema,&nbsp;...])</p></td>
<td><p>将 SQL 数据库表读取到 DataFrame 中。</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../reference/api/pandas.read_sql_query.html#pandas.read_sql_query" title="pandas.read_sql_query"><code class="xref py py-obj docutils literal notranslate"><span class="pre">read_sql_query</span></code></a>(sql,&nbsp;con[,&nbsp;index_col,&nbsp;...])</p></td>
<td><p>将 SQL 查询读取到 DataFrame 中。</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../reference/api/pandas.read_sql.html#pandas.read_sql" title="pandas.read_sql"><code class="xref py py-obj docutils literal notranslate"><span class="pre">read_sql</span></code></a>(sql,&nbsp;con[,&nbsp;index_col,&nbsp;...])</p></td>
<td><p>将 SQL 查询或数据库表读取到 DataFrame 中。</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../reference/api/pandas.DataFrame.to_sql.html#pandas.DataFrame.to_sql" title="pandas.DataFrame.to_sql"><code class="xref py py-obj docutils literal notranslate"><span class="pre">DataFrame.to_sql</span></code></a>(name,&nbsp;con,&nbsp;*[,&nbsp;schema,&nbsp;...])</p></td>
<td><p>将存储在 DataFrame 中的记录写入 SQL 数据库。</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p>函数 <a class="reference internal" href="../reference/api/pandas.read_sql.html#pandas.read_sql" title="pandas.read_sql"><code class="xref py py-func docutils literal notranslate"><span class="pre">read_sql()</span></code></a> 是 <a class="reference internal" href="../reference/api/pandas.read_sql_table.html#pandas.read_sql_table" title="pandas.read_sql_table"><code class="xref py py-func docutils literal notranslate"><span class="pre">read_sql_table()</span></code></a> 和 <a class="reference internal" href="../reference/api/pandas.read_sql_query.html#pandas.read_sql_query" title="pandas.read_sql_query"><code class="xref py py-func docutils literal notranslate"><span class="pre">read_sql_query()</span></code></a> 的便捷包装器（以及为了向后兼容），它将根据提供的输入（数据库表名或 SQL 查询）委托给特定函数。如果表名包含特殊字符，则无需加引号。</p>
</div>
<p>在以下示例中，我们使用 <a class="reference external" href="https://www.sqlite.org/index.html">SQlite</a> SQL 数据库引擎。您可以使用将数据存储在“内存”中的临时 SQLite 数据库。</p>
<p>要使用 ADBC 驱动程序连接，您需要使用包管理器安装 <code class="docutils literal notranslate"><span class="pre">adbc_driver_sqlite</span></code>。安装后，您可以使用 ADBC 驱动程序提供的 DBAPI 接口连接到数据库。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">adbc_driver_sqlite.dbapi</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sqlite_dbapi</span>

<span class="c1"># Create the connection</span>
<span class="k">with</span> <span class="n">sqlite_dbapi</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">"sqlite:///:memory:"</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
     <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_table</span><span class="p">(</span><span class="s2">"data"</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
</pre></div>
</div>
<p>要使用 SQLAlchemy 连接，您可以使用 <code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code> 函数从数据库 URI 创建引擎对象。对于您要连接的每个数据库，您只需创建一次引擎。有关 <code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code> 和 URI 格式的更多信息，请参阅下面的示例和 SQLAlchemy <a class="reference external" href="https://docs.sqlalchemy.org.cn/en/latest/core/engines.html">文档</a></p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [639]: </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_engine</span>

<span class="go"># Create your engine.</span>
<span class="gp">In [640]: </span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">"sqlite:///:memory:"</span><span class="p">)</span>
</pre></div>
</div>
<p>如果您想管理自己的连接，可以传递其中一个。下面的示例使用 Python 上下文管理器打开与数据库的连接，该管理器在块完成后自动关闭连接。有关如何处理数据库连接的解释，请参阅 <a class="reference external" href="https://docs.sqlalchemy.org.cn/en/latest/core/connections.html#basic-usage">SQLAlchemy 文档</a>。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">,</span> <span class="n">conn</span><span class="o">.</span><span class="n">begin</span><span class="p">():</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_table</span><span class="p">(</span><span class="s2">"data"</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>当您打开数据库连接时，您也有责任关闭它。未关闭连接的副作用可能包括锁定数据库或其他破坏性行为。</p>
</div>
<section id="writing-dataframes">
<h3>写入 DataFrames<a class="headerlink" href="io.html#writing-dataframes" title="Link to this heading">#</a></h3>
<p>假设以下数据位于 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> <code class="docutils literal notranslate"><span class="pre">data</span></code> 中，我们可以使用 <a class="reference internal" href="../reference/api/pandas.DataFrame.to_sql.html#pandas.DataFrame.to_sql" title="pandas.DataFrame.to_sql"><code class="xref py py-func docutils literal notranslate"><span class="pre">to_sql()</span></code></a> 将其插入到数据库中。</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>id</p></th>
<th class="head"><p>日期</p></th>
<th class="head"><p>列_1</p></th>
<th class="head"><p>列_2</p></th>
<th class="head"><p>列_3</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>26</p></td>
<td><p>2012-10-18</p></td>
<td><p>X</p></td>
<td><p>25.7</p></td>
<td><p>真</p></td>
</tr>
<tr class="row-odd"><td><p>42</p></td>
<td><p>2012-10-19</p></td>
<td><p>Y</p></td>
<td><p>-12.4</p></td>
<td><p>假</p></td>
</tr>
<tr class="row-even"><td><p>63</p></td>
<td><p>2012-10-20</p></td>
<td><p>Z</p></td>
<td><p>5.73</p></td>
<td><p>真</p></td>
</tr>
</tbody>
</table>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [641]: </span><span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>

<span class="gp">In [642]: </span><span class="n">c</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"id"</span><span class="p">,</span> <span class="s2">"Date"</span><span class="p">,</span> <span class="s2">"Col_1"</span><span class="p">,</span> <span class="s2">"Col_2"</span><span class="p">,</span> <span class="s2">"Col_3"</span><span class="p">]</span>

<span class="gp">In [643]: </span><span class="n">d</span> <span class="o">=</span> <span class="p">[</span>
<span class="gp">   .....: </span>    <span class="p">(</span><span class="mi">26</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">18</span><span class="p">),</span> <span class="s2">"X"</span><span class="p">,</span> <span class="mf">27.5</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
<span class="gp">   .....: </span>    <span class="p">(</span><span class="mi">42</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">19</span><span class="p">),</span> <span class="s2">"Y"</span><span class="p">,</span> <span class="o">-</span><span class="mf">12.5</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
<span class="gp">   .....: </span>    <span class="p">(</span><span class="mi">63</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span> <span class="s2">"Z"</span><span class="p">,</span> <span class="mf">5.73</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
<span class="gp">   .....: </span><span class="p">]</span>
<span class="gp">   .....: </span>

<span class="gp">In [644]: </span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>

<span class="gp">In [645]: </span><span class="n">data</span>
<span class="gh">Out[645]: </span>
<span class="go">   id       Date Col_1  Col_2  Col_3</span>
<span class="go">0  26 2010-10-18     X  27.50   True</span>
<span class="go">1  42 2010-10-19     Y -12.50  False</span>
<span class="go">2  63 2010-10-20     Z   5.73   True</span>

<span class="gp">In [646]: </span><span class="n">data</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="s2">"data"</span><span class="p">,</span> <span class="n">con</span><span class="o">=</span><span class="n">engine</span><span class="p">)</span>
<span class="gh">Out[646]: </span><span class="go">3</span>
</pre></div>
</div>
<p>对于某些数据库，写入大型 DataFrame 可能会由于超出数据包大小限制而导致错误。这可以通过在调用 <code class="docutils literal notranslate"><span class="pre">to_sql</span></code> 时设置 <code class="docutils literal notranslate"><span class="pre">chunksize</span></code> 参数来避免。例如，以下代码将 <code class="docutils literal notranslate"><span class="pre">data</span></code> 以每次 1000 行的批量写入数据库</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [647]: </span><span class="n">data</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="s2">"data_chunked"</span><span class="p">,</span> <span class="n">con</span><span class="o">=</span><span class="n">engine</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="gh">Out[647]: </span><span class="go">3</span>
</pre></div>
</div>
<section id="sql-data-types">
<h4>SQL 数据类型<a class="headerlink" href="io.html#sql-data-types" title="Link to this heading">#</a></h4>
<p>确保 SQL 数据库之间数据类型管理的一致性具有挑战性。并非每个 SQL 数据库都提供相同的类型，即使提供了，给定类型的实现方式也可能有所不同，从而对类型保留方式产生微妙的影响。</p>
<p>为了最大程度地保留数据库类型，建议用户在可用时使用 ADBC 驱动程序。Arrow 类型系统提供了比历史 pandas/NumPy 类型系统更广泛的类型，这些类型与数据库类型更匹配。为了说明这一点，请注意不同数据库和 pandas 后端中可用类型的（非穷尽）列表</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>numpy/pandas</p></th>
<th class="head"><p>arrow</p></th>
<th class="head"><p>postgres</p></th>
<th class="head"><p>sqlite</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>int16/Int16</p></td>
<td><p>int16</p></td>
<td><p>SMALLINT</p></td>
<td><p>INTEGER</p></td>
</tr>
<tr class="row-odd"><td><p>int32/Int32</p></td>
<td><p>int32</p></td>
<td><p>INTEGER</p></td>
<td><p>INTEGER</p></td>
</tr>
<tr class="row-even"><td><p>int64/Int64</p></td>
<td><p>int64</p></td>
<td><p>BIGINT</p></td>
<td><p>INTEGER</p></td>
</tr>
<tr class="row-odd"><td><p>float32</p></td>
<td><p>float32</p></td>
<td><p>REAL</p></td>
<td><p>REAL</p></td>
</tr>
<tr class="row-even"><td><p>float64</p></td>
<td><p>float64</p></td>
<td><p>DOUBLE PRECISION</p></td>
<td><p>REAL</p></td>
</tr>
<tr class="row-odd"><td><p>object</p></td>
<td><p>string</p></td>
<td><p>TEXT</p></td>
<td><p>TEXT</p></td>
</tr>
<tr class="row-even"><td><p>bool</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">bool_</span></code></p></td>
<td><p>BOOLEAN</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>datetime64[ns]</p></td>
<td><p>timestamp(us)</p></td>
<td><p>TIMESTAMP</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>datetime64[ns,tz]</p></td>
<td><p>timestamp(us,tz)</p></td>
<td><p>TIMESTAMPTZ</p></td>
<td></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>date32</p></td>
<td><p>DATE</p></td>
<td></td>
</tr>
<tr class="row-even"><td></td>
<td><p>month_day_nano_interval</p></td>
<td><p>INTERVAL</p></td>
<td></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>二进制</p></td>
<td><p>BINARY</p></td>
<td><p>BLOB</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>decimal128</p></td>
<td><p>DECIMAL <a class="footnote-reference brackets" href="io.html#f1" id="id5" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a></p></td>
<td></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>list</p></td>
<td><p>ARRAY <a class="footnote-reference brackets" href="io.html#f1" id="id6" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a></p></td>
<td></td>
</tr>
<tr class="row-even"><td></td>
<td><p>struct</p></td>
<td><dl class="simple">
<dt>COMPOSITE TYPE</dt><dd><p><a class="footnote-reference brackets" href="io.html#f1" id="id7" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a></p>
</dd>
</dl>
</td>
<td></td>
</tr>
</tbody>
</table>
<p class="rubric">脚注</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="f1" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></span>
<span class="backrefs">(<a role="doc-backlink" href="io.html#id5">1</a>,<a role="doc-backlink" href="io.html#id6">2</a>,<a role="doc-backlink" href="io.html#id7">3</a>)</span>
<p>撰写本文时尚未实现，但理论上可行</p>
</aside>
</aside>
<p>如果您有兴趣在 DataFrame 的整个生命周期中尽可能保留数据库类型，建议用户利用 <a class="reference internal" href="../reference/api/pandas.read_sql.html#pandas.read_sql" title="pandas.read_sql"><code class="xref py py-func docutils literal notranslate"><span class="pre">read_sql()</span></code></a> 的 <code class="docutils literal notranslate"><span class="pre">dtype_backend="pyarrow"</span></code> 参数</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="c1"># for roundtripping</span>
<span class="k">with</span> <span class="n">pg_dbapi</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="s2">"pandas_table"</span><span class="p">,</span> <span class="n">conn</span><span class="p">,</span> <span class="n">dtype_backend</span><span class="o">=</span><span class="s2">"pyarrow"</span><span class="p">)</span>
</pre></div>
</div>
<p>这将阻止您的数据转换为传统的 pandas/NumPy 类型系统，该系统通常会以无法往返的方式转换 SQL 类型。</p>
<p>如果 ADBC 驱动程序不可用，<a class="reference internal" href="../reference/api/pandas.DataFrame.to_sql.html#pandas.DataFrame.to_sql" title="pandas.DataFrame.to_sql"><code class="xref py py-func docutils literal notranslate"><span class="pre">to_sql()</span></code></a> 将尝试根据数据的数据类型将您的数据映射到适当的 SQL 数据类型。当您有 <code class="docutils literal notranslate"><span class="pre">object</span></code> 数据类型的列时，pandas 将尝试推断数据类型。</p>
<p>您始终可以通过使用 <code class="docutils literal notranslate"><span class="pre">dtype</span></code> 参数指定任何列所需的 SQL 类型来覆盖默认类型。此参数需要一个将列名映射到 SQLAlchemy 类型（或用于 sqlite3 回退模式的字符串）的字典。例如，指定对字符串列使用 sqlalchemy <code class="docutils literal notranslate"><span class="pre">String</span></code> 类型而不是默认的 <code class="docutils literal notranslate"><span class="pre">Text</span></code> 类型</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [648]: </span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">String</span>

<span class="gp">In [649]: </span><span class="n">data</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="s2">"data_dtype"</span><span class="p">,</span> <span class="n">con</span><span class="o">=</span><span class="n">engine</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="p">{</span><span class="s2">"Col_1"</span><span class="p">:</span> <span class="n">String</span><span class="p">})</span>
<span class="gh">Out[649]: </span><span class="go">3</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p>由于 timedelta 在不同数据库方言中的支持有限，类型为 <code class="docutils literal notranslate"><span class="pre">timedelta64</span></code> 的列将作为纳秒级的整数值写入数据库，并会引发警告。唯一的例外是使用 ADBC PostgreSQL 驱动程序时，在这种情况下，timedelta 将作为 <code class="docutils literal notranslate"><span class="pre">INTERVAL</span></code> 写入数据库。</p>
</div>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p><code class="docutils literal notranslate"><span class="pre">category</span></code> 数据类型的列将被转换为密集表示，就像您使用 <code class="docutils literal notranslate"><span class="pre">np.asarray(categorical)</span></code> 获得的那样（例如，对于字符串类别，这将生成一个字符串数组）。因此，将数据库表读回时<strong>不会</strong>生成分类数据。</p>
</div>
</section>
</section>
<section id="datetime-data-types">
<span id="io-sql-datetime-data"></span><h3>日期时间数据类型<a class="headerlink" href="io.html#datetime-data-types" title="Link to this heading">#</a></h3>
<p>使用 ADBC 或 SQLAlchemy，<a class="reference internal" href="../reference/api/pandas.DataFrame.to_sql.html#pandas.DataFrame.to_sql" title="pandas.DataFrame.to_sql"><code class="xref py py-func docutils literal notranslate"><span class="pre">to_sql()</span></code></a> 能够写入不带时区或带时区的日期时间数据。但是，最终存储在数据库中的数据取决于所用数据库系统对日期时间数据支持的数据类型。</p>
<p>下表列出了某些常见数据库支持的日期时间数据类型。其他数据库方言可能具有不同的日期时间数据类型。</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>数据库</p></th>
<th class="head"><p>SQL 日期时间类型</p></th>
<th class="head"><p>时区支持</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>SQLite</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TEXT</span></code></p></td>
<td><p>否</p></td>
</tr>
<tr class="row-odd"><td><p>MySQL</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TIMESTAMP</span></code> 或 <code class="docutils literal notranslate"><span class="pre">DATETIME</span></code></p></td>
<td><p>否</p></td>
</tr>
<tr class="row-even"><td><p>PostgreSQL</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TIMESTAMP</span></code> 或 <code class="docutils literal notranslate"><span class="pre">TIMESTAMP</span> <span class="pre">WITH</span> <span class="pre">TIME</span> <span class="pre">ZONE</span></code></p></td>
<td><p>是</p></td>
</tr>
</tbody>
</table>
<p>当将带时区的数据写入不支持时区的数据库时，数据将作为相对于时区的本地时间的不带时区的时间戳写入。</p>
<p><a class="reference internal" href="../reference/api/pandas.read_sql_table.html#pandas.read_sql_table" title="pandas.read_sql_table"><code class="xref py py-func docutils literal notranslate"><span class="pre">read_sql_table()</span></code></a> 也能够读取带时区或不带时区的日期时间数据。当读取 <code class="docutils literal notranslate"><span class="pre">TIMESTAMP</span> <span class="pre">WITH</span> <span class="pre">TIME</span> <span class="pre">ZONE</span></code> 类型时，pandas 会将数据转换为 UTC。</p>
<section id="insertion-method">
<span id="io-sql-method"></span><h4>插入方法<a class="headerlink" href="io.html#insertion-method" title="Link to this heading">#</a></h4>
<p>参数 <code class="docutils literal notranslate"><span class="pre">method</span></code> 控制使用的 SQL 插入子句。可能的值是</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">None</span></code>: 使用标准 SQL <code class="docutils literal notranslate"><span class="pre">INSERT</span></code> 子句（每行一个）。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'multi'</span></code>: 在单个 <code class="docutils literal notranslate"><span class="pre">INSERT</span></code> 子句中传递多个值。它使用一种<em>特殊</em>的 SQL 语法，并非所有后端都支持。这通常为 <em>Presto</em> 和 <em>Redshift</em> 等分析型数据库提供更好的性能，但如果表包含许多列，则对传统 SQL 后端的性能较差。有关更多信息，请查看 SQLAlchemy <a class="reference external" href="https://docs.sqlalchemy.org.cn/en/latest/core/dml.html#sqlalchemy.sql.expression.Insert.values.params.*args">文档</a>。</p></li>
<li><p>可调用对象，其签名<code class="docutils literal notranslate"><span class="pre">(pd_table,</span> <span class="pre">conn,</span> <span class="pre">keys,</span> <span class="pre">data_iter)</span></code>：这可用于实现基于特定后端方言功能的性能更好的插入方法。</p></li>
</ul>
<p>使用 PostgreSQL <a class="reference external" href="https://postgresql.ac.cn/docs/current/sql-copy.html">COPY 子句</a>的可调用对象示例</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Alternative to_sql() *method* for DBs that support COPY FROM</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">csv</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">io</span><span class="w"> </span><span class="kn">import</span> <span class="n">StringIO</span>

<span class="k">def</span><span class="w"> </span><span class="nf">psql_insert_copy</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">conn</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="n">data_iter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Execute SQL statement inserting data</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    table : pandas.io.sql.SQLTable</span>
<span class="sd">    conn : sqlalchemy.engine.Engine or sqlalchemy.engine.Connection</span>
<span class="sd">    keys : list of str</span>
<span class="sd">        Column names</span>
<span class="sd">    data_iter : Iterable that iterates the values to be inserted</span>
<span class="sd">    """</span>
    <span class="c1"># gets a DBAPI connection that can provide a cursor</span>
    <span class="n">dbapi_conn</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">connection</span>
    <span class="k">with</span> <span class="n">dbapi_conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
        <span class="n">s_buf</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
        <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">s_buf</span><span class="p">)</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">writerows</span><span class="p">(</span><span class="n">data_iter</span><span class="p">)</span>
        <span class="n">s_buf</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">columns</span> <span class="o">=</span> <span class="s1">', '</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">'"</span><span class="si">{}</span><span class="s1">"'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">table</span><span class="o">.</span><span class="n">schema</span><span class="p">:</span>
            <span class="n">table_name</span> <span class="o">=</span> <span class="s1">'</span><span class="si">{}</span><span class="s1">.</span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">schema</span><span class="p">,</span> <span class="n">table</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">table_name</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">name</span>

        <span class="n">sql</span> <span class="o">=</span> <span class="s1">'COPY </span><span class="si">{}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1">) FROM STDIN WITH CSV'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">table_name</span><span class="p">,</span> <span class="n">columns</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">copy_expert</span><span class="p">(</span><span class="n">sql</span><span class="o">=</span><span class="n">sql</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">s_buf</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="reading-tables">
<h3>读取表<a class="headerlink" href="io.html#reading-tables" title="Link to this heading">#</a></h3>
<p><a class="reference internal" href="../reference/api/pandas.read_sql_table.html#pandas.read_sql_table" title="pandas.read_sql_table"><code class="xref py py-func docutils literal notranslate"><span class="pre">read_sql_table()</span></code></a> 将读取给定表名的数据库表，并可选择读取列的子集。</p>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p>为了使用 <a class="reference internal" href="../reference/api/pandas.read_sql_table.html#pandas.read_sql_table" title="pandas.read_sql_table"><code class="xref py py-func docutils literal notranslate"><span class="pre">read_sql_table()</span></code></a>，您<strong>必须</strong>安装 ADBC 驱动程序或 SQLAlchemy 可选依赖项。</p>
</div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [650]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_sql_table</span><span class="p">(</span><span class="s2">"data"</span><span class="p">,</span> <span class="n">engine</span><span class="p">)</span>
<span class="gh">Out[650]: </span>
<span class="go">   index  id       Date Col_1  Col_2  Col_3</span>
<span class="go">0      0  26 2010-10-18     X  27.50   True</span>
<span class="go">1      1  42 2010-10-19     Y -12.50  False</span>
<span class="go">2      2  63 2010-10-20     Z   5.73   True</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p>ADBC 驱动程序将数据库类型直接映射回 arrow 类型。对于其他驱动程序，请注意 pandas 从查询输出推断列数据类型，而不是通过查找物理数据库架构中的数据类型来推断。例如，假设 <code class="docutils literal notranslate"><span class="pre">userid</span></code> 是表中的一个整数列。那么，直观上，<code class="docutils literal notranslate"><span class="pre">select</span> <span class="pre">userid</span> <span class="pre">...</span></code> 将返回整数值的系列，而 <code class="docutils literal notranslate"><span class="pre">select</span> <span class="pre">cast(userid</span> <span class="pre">as</span> <span class="pre">text)</span> <span class="pre">...</span></code> 将返回对象值的（字符串）系列。因此，如果查询输出为空，则所有结果列都将作为对象值返回（因为它们最通用）。如果您预见到您的查询有时会生成空结果，您可能需要在之后显式类型转换以确保数据类型完整性。</p>
</div>
<p>您还可以将列名指定为 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> 索引，并指定要读取的列的子集。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [651]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_sql_table</span><span class="p">(</span><span class="s2">"data"</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="s2">"id"</span><span class="p">)</span>
<span class="gh">Out[651]: </span>
<span class="go">    index       Date Col_1  Col_2  Col_3</span>
<span class="go">id                                      </span>
<span class="go">26      0 2010-10-18     X  27.50   True</span>
<span class="go">42      1 2010-10-19     Y -12.50  False</span>
<span class="go">63      2 2010-10-20     Z   5.73   True</span>

<span class="gp">In [652]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_sql_table</span><span class="p">(</span><span class="s2">"data"</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"Col_1"</span><span class="p">,</span> <span class="s2">"Col_2"</span><span class="p">])</span>
<span class="gh">Out[652]: </span>
<span class="go">  Col_1  Col_2</span>
<span class="go">0     X  27.50</span>
<span class="go">1     Y -12.50</span>
<span class="go">2     Z   5.73</span>
</pre></div>
</div>
<p>您可以明确强制将列解析为日期</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [653]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_sql_table</span><span class="p">(</span><span class="s2">"data"</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="s2">"Date"</span><span class="p">])</span>
<span class="gh">Out[653]: </span>
<span class="go">   index  id       Date Col_1  Col_2  Col_3</span>
<span class="go">0      0  26 2010-10-18     X  27.50   True</span>
<span class="go">1      1  42 2010-10-19     Y -12.50  False</span>
<span class="go">2      2  63 2010-10-20     Z   5.73   True</span>
</pre></div>
</div>
<p>如果需要，您可以明确指定格式字符串，或指定一个参数字典以传递给 <a class="reference internal" href="../reference/api/pandas.to_datetime.html#pandas.to_datetime" title="pandas.to_datetime"><code class="xref py py-func docutils literal notranslate"><span class="pre">pandas.to_datetime()</span></code></a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">read_sql_table</span><span class="p">(</span><span class="s2">"data"</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">{</span><span class="s2">"Date"</span><span class="p">:</span> <span class="s2">"%Y-%m-</span><span class="si">%d</span><span class="s2">"</span><span class="p">})</span>
<span class="n">pd</span><span class="o">.</span><span class="n">read_sql_table</span><span class="p">(</span>
    <span class="s2">"data"</span><span class="p">,</span>
    <span class="n">engine</span><span class="p">,</span>
    <span class="n">parse_dates</span><span class="o">=</span><span class="p">{</span><span class="s2">"Date"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"format"</span><span class="p">:</span> <span class="s2">"%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S"</span><span class="p">}},</span>
<span class="p">)</span>
</pre></div>
</div>
<p>您可以使用 <code class="xref py py-func docutils literal notranslate"><span class="pre">has_table()</span></code> 检查表是否存在</p>
</section>
<section id="schema-support">
<h3>模式支持<a class="headerlink" href="io.html#schema-support" title="Link to this heading">#</a></h3>
<p>通过 <a class="reference internal" href="../reference/api/pandas.read_sql_table.html#pandas.read_sql_table" title="pandas.read_sql_table"><code class="xref py py-func docutils literal notranslate"><span class="pre">read_sql_table()</span></code></a> 和 <a class="reference internal" href="../reference/api/pandas.DataFrame.to_sql.html#pandas.DataFrame.to_sql" title="pandas.DataFrame.to_sql"><code class="xref py py-func docutils literal notranslate"><span class="pre">to_sql()</span></code></a> 函数中的 <code class="docutils literal notranslate"><span class="pre">schema</span></code> 关键字支持从不同模式读取和写入。但请注意，这取决于数据库类型（sqlite 没有模式）。例如</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"table"</span><span class="p">,</span> <span class="n">con</span><span class="o">=</span><span class="n">engine</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="s2">"other_schema"</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">read_sql_table</span><span class="p">(</span><span class="s2">"table"</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="s2">"other_schema"</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id8">
<h3>查询<a class="headerlink" href="io.html#id8" title="Link to this heading">#</a></h3>
<p>您可以在 <a class="reference internal" href="../reference/api/pandas.read_sql_query.html#pandas.read_sql_query" title="pandas.read_sql_query"><code class="xref py py-func docutils literal notranslate"><span class="pre">read_sql_query()</span></code></a> 函数中使用原始 SQL 进行查询。在这种情况下，您必须使用适用于您数据库的 SQL 变体。使用 SQLAlchemy 时，您还可以传递 SQLAlchemy 表达式语言构造，这些构造与数据库无关。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [654]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s2">"SELECT * FROM data"</span><span class="p">,</span> <span class="n">engine</span><span class="p">)</span>
<span class="gh">Out[654]: </span>
<span class="go">   index  id                        Date Col_1  Col_2  Col_3</span>
<span class="go">0      0  26  2010-10-18 00:00:00.000000     X  27.50      1</span>
<span class="go">1      1  42  2010-10-19 00:00:00.000000     Y -12.50      0</span>
<span class="go">2      2  63  2010-10-20 00:00:00.000000     Z   5.73      1</span>
</pre></div>
</div>
<p>当然，您可以指定一个更“复杂”的查询。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [655]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s2">"SELECT id, Col_1, Col_2 FROM data WHERE id = 42;"</span><span class="p">,</span> <span class="n">engine</span><span class="p">)</span>
<span class="gh">Out[655]: </span>
<span class="go">   id Col_1  Col_2</span>
<span class="go">0  42     Y  -12.5</span>
</pre></div>
</div>
<p><a class="reference internal" href="../reference/api/pandas.read_sql_query.html#pandas.read_sql_query" title="pandas.read_sql_query"><code class="xref py py-func docutils literal notranslate"><span class="pre">read_sql_query()</span></code></a> 函数支持 <code class="docutils literal notranslate"><span class="pre">chunksize</span></code> 参数。指定此参数将返回一个查询结果块的迭代器。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [656]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="s2">"abc"</span><span class="p">))</span>

<span class="gp">In [657]: </span><span class="n">df</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"data_chunks"</span><span class="p">,</span> <span class="n">con</span><span class="o">=</span><span class="n">engine</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gh">Out[657]: </span><span class="go">20</span>
</pre></div>
</div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [658]: </span><span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s2">"SELECT * FROM data_chunks"</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<span class="gp">   .....: </span>    <span class="nb">print</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
<span class="gp">   .....: </span>
<span class="go">          a         b         c</span>
<span class="go">0 -0.395347 -0.822726 -0.363777</span>
<span class="go">1  1.676124 -0.908102 -1.391346</span>
<span class="go">2 -1.094269  0.278380  1.205899</span>
<span class="go">3  1.503443  0.932171 -0.709459</span>
<span class="go">4 -0.645944 -1.351389  0.132023</span>
<span class="go">          a         b         c</span>
<span class="go">0  0.210427  0.192202  0.661949</span>
<span class="go">1  1.690629 -1.046044  0.618697</span>
<span class="go">2 -0.013863  1.314289  1.951611</span>
<span class="go">3 -1.485026  0.304662  1.194757</span>
<span class="go">4 -0.446717  0.528496 -0.657575</span>
<span class="go">          a         b         c</span>
<span class="go">0 -0.876654  0.336252  0.172668</span>
<span class="go">1  0.337684 -0.411202 -0.828394</span>
<span class="go">2 -0.244413  1.094948  0.087183</span>
<span class="go">3  1.125934 -1.480095  1.205944</span>
<span class="go">4 -0.451849  0.452214 -2.208192</span>
<span class="go">          a         b         c</span>
<span class="go">0 -2.061019  0.044184 -0.017118</span>
<span class="go">1  1.248959 -0.675595 -1.908296</span>
<span class="go">2 -0.125934  1.491974  0.648726</span>
<span class="go">3  0.391214  0.438609  1.634248</span>
<span class="go">4  1.208707 -1.535740  1.620399</span>
</pre></div>
</div>
</section>
<section id="engine-connection-examples">
<h3>引擎连接示例<a class="headerlink" href="io.html#engine-connection-examples" title="Link to this heading">#</a></h3>
<p>要使用 SQLAlchemy 连接，您可以使用 <code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code> 函数从数据库 URI 创建引擎对象。您只需为您要连接的每个数据库创建一次引擎。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_engine</span>

<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">"postgresql://scott:tiger@localhost:5432/mydatabase"</span><span class="p">)</span>

<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">"mysql+mysqldb://scott:tiger@localhost/foo"</span><span class="p">)</span>

<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">"oracle://scott:<a href="https://pandas.ac.cn/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="">[email&nbsp;protected]</a>:1521/sidname"</span><span class="p">)</span>

<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">"mssql+pyodbc://mydsn"</span><span class="p">)</span>

<span class="c1"># sqlite://&lt;nohostname&gt;/&lt;path&gt;</span>
<span class="c1"># where &lt;path&gt; is relative:</span>
<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">"sqlite:///foo.db"</span><span class="p">)</span>

<span class="c1"># or absolute, starting with a slash:</span>
<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">"sqlite:////absolute/path/to/foo.db"</span><span class="p">)</span>
</pre></div>
</div>
<p>有关更多信息，请参阅 SQLAlchemy <a class="reference external" href="https://docs.sqlalchemy.org.cn/en/latest/core/engines.html">文档</a>中的示例。</p>
</section>
<section id="advanced-sqlalchemy-queries">
<h3>高级 SQLAlchemy 查询<a class="headerlink" href="io.html#advanced-sqlalchemy-queries" title="Link to this heading">#</a></h3>
<p>您可以使用 SQLAlchemy 构造来描述您的查询。</p>
<p>使用 <code class="xref py py-func docutils literal notranslate"><span class="pre">sqlalchemy.text()</span></code> 以与后端无关的方式指定查询参数</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [659]: </span><span class="kn">import</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sa</span>

<span class="gp">In [660]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="n">sa</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s2">"SELECT * FROM data where Col_1=:col1"</span><span class="p">),</span> <span class="n">engine</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">"col1"</span><span class="p">:</span> <span class="s2">"X"</span><span class="p">}</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>
<span class="gh">Out[660]: </span>
<span class="go">   index  id                        Date Col_1  Col_2  Col_3</span>
<span class="go">0      0  26  2010-10-18 00:00:00.000000     X   27.5      1</span>
</pre></div>
</div>
<p>如果您有数据库的 SQLAlchemy 描述，则可以使用 SQLAlchemy 表达式表达 where 条件</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [661]: </span><span class="n">metadata</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="n">MetaData</span><span class="p">()</span>

<span class="gp">In [662]: </span><span class="n">data_table</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="n">Table</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="s2">"data"</span><span class="p">,</span>
<span class="gp">   .....: </span>    <span class="n">metadata</span><span class="p">,</span>
<span class="gp">   .....: </span>    <span class="n">sa</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="s2">"index"</span><span class="p">,</span> <span class="n">sa</span><span class="o">.</span><span class="n">Integer</span><span class="p">),</span>
<span class="gp">   .....: </span>    <span class="n">sa</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="s2">"Date"</span><span class="p">,</span> <span class="n">sa</span><span class="o">.</span><span class="n">DateTime</span><span class="p">),</span>
<span class="gp">   .....: </span>    <span class="n">sa</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="s2">"Col_1"</span><span class="p">,</span> <span class="n">sa</span><span class="o">.</span><span class="n">String</span><span class="p">),</span>
<span class="gp">   .....: </span>    <span class="n">sa</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="s2">"Col_2"</span><span class="p">,</span> <span class="n">sa</span><span class="o">.</span><span class="n">Float</span><span class="p">),</span>
<span class="gp">   .....: </span>    <span class="n">sa</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="s2">"Col_3"</span><span class="p">,</span> <span class="n">sa</span><span class="o">.</span><span class="n">Boolean</span><span class="p">),</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [663]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="n">sa</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">data_table</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">data_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">Col_3</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">),</span> <span class="n">engine</span><span class="p">)</span>
<span class="gh">Out[663]: </span>
<span class="go">Empty DataFrame</span>
<span class="go">Columns: [index, Date, Col_1, Col_2, Col_3]</span>
<span class="go">Index: []</span>
</pre></div>
</div>
<p>您可以使用 <code class="xref py py-func docutils literal notranslate"><span class="pre">sqlalchemy.bindparam()</span></code> 将 SQLAlchemy 表达式与传递给 <a class="reference internal" href="../reference/api/pandas.read_sql.html#pandas.read_sql" title="pandas.read_sql"><code class="xref py py-func docutils literal notranslate"><span class="pre">read_sql()</span></code></a> 的参数结合使用</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [664]: </span><span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">dt</span>

<span class="gp">In [665]: </span><span class="n">expr</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">data_table</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">data_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">Date</span> <span class="o">&gt;</span> <span class="n">sa</span><span class="o">.</span><span class="n">bindparam</span><span class="p">(</span><span class="s2">"date"</span><span class="p">))</span>

<span class="gp">In [666]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">"date"</span><span class="p">:</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">18</span><span class="p">)})</span>
<span class="gh">Out[666]: </span>
<span class="go">   index       Date Col_1  Col_2  Col_3</span>
<span class="go">0      1 2010-10-19     Y -12.50  False</span>
<span class="go">1      2 2010-10-20     Z   5.73   True</span>
</pre></div>
</div>
</section>
<section id="sqlite-fallback">
<h3>Sqlite 回退<a class="headerlink" href="io.html#sqlite-fallback" title="Link to this heading">#</a></h3>
<p>支持不使用 SQLAlchemy 的 sqlite。此模式需要遵循 <a class="reference external" href="https://pythonlang.cn/dev/peps/pep-0249/">Python DB-API</a> 的 Python 数据库适配器。</p>
<p>您可以这样创建连接</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sqlite3</span>

<span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">":memory:"</span><span class="p">)</span>
</pre></div>
</div>
<p>然后发出以下查询</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="s2">"data"</span><span class="p">,</span> <span class="n">con</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s2">"SELECT * FROM data"</span><span class="p">,</span> <span class="n">con</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="google-bigquery">
<span id="io-bigquery"></span><h2>Google BigQuery<a class="headerlink" href="io.html#google-bigquery" title="Link to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">pandas-gbq</span></code> 包提供了从 Google BigQuery 读取/写入的功能。</p>
<p>pandas 与此外部包集成。如果安装了 <code class="docutils literal notranslate"><span class="pre">pandas-gbq</span></code>，您可以使用 pandas 方法 <code class="docutils literal notranslate"><span class="pre">pd.read_gbq</span></code> 和 <code class="docutils literal notranslate"><span class="pre">DataFrame.to_gbq</span></code>，它们将调用 <code class="docutils literal notranslate"><span class="pre">pandas-gbq</span></code> 中的相应函数。</p>
<p>完整文档可在<a class="reference external" href="https://pandas-gbq.readthedocs.io/en/latest/">此处</a>找到。</p>
</section>
<section id="stata-format">
<span id="io-stata"></span><h2>Stata 格式<a class="headerlink" href="io.html#stata-format" title="Link to this heading">#</a></h2>
<section id="writing-to-stata-format">
<span id="io-stata-writer"></span><h3>写入 Stata 格式<a class="headerlink" href="io.html#writing-to-stata-format" title="Link to this heading">#</a></h3>
<p>方法 <code class="xref py py-func docutils literal notranslate"><span class="pre">DataFrame.to_stata()</span></code> 会将 DataFrame 写入 .dta 文件。此文件的格式版本始终为 115 (Stata 12)。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [667]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="s2">"AB"</span><span class="p">))</span>

<span class="gp">In [668]: </span><span class="n">df</span><span class="o">.</span><span class="n">to_stata</span><span class="p">(</span><span class="s2">"stata.dta"</span><span class="p">)</span>
</pre></div>
</div>
<p><em>Stata</em> 数据文件支持的数据类型有限；只有长度为 244 个或更少字符的字符串、<code class="docutils literal notranslate"><span class="pre">int8</span></code>、<code class="docutils literal notranslate"><span class="pre">int16</span></code>、<code class="docutils literal notranslate"><span class="pre">int32</span></code>、<code class="docutils literal notranslate"><span class="pre">float32</span></code> 和 <code class="docutils literal notranslate"><span class="pre">float64</span></code> 可以存储在 <code class="docutils literal notranslate"><span class="pre">.dta</span></code> 文件中。此外，<em>Stata</em> 保留某些值来表示缺失数据。导出超出 Stata 允许范围的非缺失值，对于特定数据类型，会将变量重新转换为下一个更大的大小。例如，<code class="docutils literal notranslate"><span class="pre">int8</span></code> 值在 Stata 中限制在 -127 到 100 之间，因此值超过 100 的变量将触发转换为 <code class="docutils literal notranslate"><span class="pre">int16</span></code>。<code class="docutils literal notranslate"><span class="pre">nan</span></code> 浮点数据类型中的值存储为基本缺失数据类型（<em>Stata</em> 中的 <code class="docutils literal notranslate"><span class="pre">.</span></code>）。</p>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p>无法导出整数数据类型的缺失数据值。</p>
</div>
<p>Stata 写入器可以优雅地处理其他数据类型，包括 <code class="docutils literal notranslate"><span class="pre">int64</span></code>、<code class="docutils literal notranslate"><span class="pre">bool</span></code>、<code class="docutils literal notranslate"><span class="pre">uint8</span></code>、<code class="docutils literal notranslate"><span class="pre">uint16</span></code>、<code class="docutils literal notranslate"><span class="pre">uint32</span></code>，通过强制转换为能够表示数据的最小支持类型。例如，类型为 <code class="docutils literal notranslate"><span class="pre">uint8</span></code> 的数据如果所有值都小于 100（Stata 中非缺失 <code class="docutils literal notranslate"><span class="pre">int8</span></code> 数据的上限），则将强制转换为 <code class="docutils literal notranslate"><span class="pre">int8</span></code>，或者，如果值超出此范围，则变量将强制转换为 <code class="docutils literal notranslate"><span class="pre">int16</span></code>。</p>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>如果 <code class="docutils literal notranslate"><span class="pre">int64</span></code> 值大于 2**53，则从 <code class="docutils literal notranslate"><span class="pre">int64</span></code> 转换为 <code class="docutils literal notranslate"><span class="pre">float64</span></code> 可能会导致精度损失。</p>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">StataWriter</span></code> 和 <code class="xref py py-func docutils literal notranslate"><span class="pre">DataFrame.to_stata()</span></code> 仅支持包含最多 244 个字符的固定宽度字符串，这是版本 115 dta 文件格式施加的限制。尝试写入字符串长度超过 244 个字符的 <em>Stata</em> dta 文件会引发 <code class="docutils literal notranslate"><span class="pre">ValueError</span></code>。</p>
</div>
</section>
<section id="reading-from-stata-format">
<span id="io-stata-reader"></span><h3>从 Stata 格式读取<a class="headerlink" href="io.html#reading-from-stata-format" title="Link to this heading">#</a></h3>
<p>顶级函数 <code class="docutils literal notranslate"><span class="pre">read_stata</span></code> 将读取 dta 文件并返回 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> 或 <code class="xref py py-class docutils literal notranslate"><span class="pre">pandas.api.typing.StataReader</span></code>，后者可用于增量读取文件。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [669]: </span><span class="n">pd</span><span class="o">.</span><span class="n">read_stata</span><span class="p">(</span><span class="s2">"stata.dta"</span><span class="p">)</span>
<span class="gh">Out[669]: </span>
<span class="go">   index         A         B</span>
<span class="go">0      0 -0.165614  0.490482</span>
<span class="go">1      1 -0.637829  0.067091</span>
<span class="go">2      2 -0.242577  1.348038</span>
<span class="go">3      3  0.647699 -0.644937</span>
<span class="go">4      4  0.625771  0.918376</span>
<span class="go">5      5  0.401781 -1.488919</span>
<span class="go">6      6 -0.981845 -0.046882</span>
<span class="go">7      7 -0.306796  0.877025</span>
<span class="go">8      8 -0.336606  0.624747</span>
<span class="go">9      9 -1.582600  0.806340</span>
</pre></div>
</div>
<p>指定 <code class="docutils literal notranslate"><span class="pre">chunksize</span></code> 将生成一个 <code class="xref py py-class docutils literal notranslate"><span class="pre">pandas.api.typing.StataReader</span></code> 实例，该实例可用于每次从文件中读取 <code class="docutils literal notranslate"><span class="pre">chunksize</span></code> 行。<code class="docutils literal notranslate"><span class="pre">StataReader</span></code> 对象可用作迭代器。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [670]: </span><span class="k">with</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_stata</span><span class="p">(</span><span class="s2">"stata.dta"</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> <span class="k">as</span> <span class="n">reader</span><span class="p">:</span>
<span class="gp">   .....: </span>    <span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">:</span>
<span class="gp">   .....: </span>        <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="gp">   .....: </span>
<span class="go">(3, 3)</span>
<span class="go">(3, 3)</span>
<span class="go">(3, 3)</span>
<span class="go">(1, 3)</span>
</pre></div>
</div>
<p>要进行更精细的控制，请使用 <code class="docutils literal notranslate"><span class="pre">iterator=True</span></code>，并在每次调用 <code class="xref py py-func docutils literal notranslate"><span class="pre">read()</span></code> 时指定 <code class="docutils literal notranslate"><span class="pre">chunksize</span></code>。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [671]: </span><span class="k">with</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_stata</span><span class="p">(</span><span class="s2">"stata.dta"</span><span class="p">,</span> <span class="n">iterator</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">reader</span><span class="p">:</span>
<span class="gp">   .....: </span>    <span class="n">chunk1</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="gp">   .....: </span>    <span class="n">chunk2</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="gp">   .....: </span>
</pre></div>
</div>
<p>目前，<code class="docutils literal notranslate"><span class="pre">index</span></code> 作为一列被检索。</p>
<p>参数 <code class="docutils literal notranslate"><span class="pre">convert_categoricals</span></code> 指示是否应读取值标签并将其用于创建 <code class="docutils literal notranslate"><span class="pre">Categorical</span></code> 变量。值标签也可以通过函数 <code class="docutils literal notranslate"><span class="pre">value_labels</span></code> 检索，这需要在使用前调用 <code class="xref py py-func docutils literal notranslate"><span class="pre">read()</span></code>。</p>
<p>参数 <code class="docutils literal notranslate"><span class="pre">convert_missing</span></code> 指示是否应保留 Stata 中的缺失值表示。如果为 <code class="docutils literal notranslate"><span class="pre">False</span></code>（默认值），则缺失值表示为 <code class="docutils literal notranslate"><span class="pre">np.nan</span></code>。如果为 <code class="docutils literal notranslate"><span class="pre">True</span></code>，则缺失值表示为 <code class="docutils literal notranslate"><span class="pre">StataMissingValue</span></code> 对象，并且包含缺失值的列将具有 <code class="docutils literal notranslate"><span class="pre">object</span></code> 数据类型。</p>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p><a class="reference internal" href="../reference/api/pandas.read_stata.html#pandas.read_stata" title="pandas.read_stata"><code class="xref py py-func docutils literal notranslate"><span class="pre">read_stata()</span></code></a> 和 <code class="xref py py-class docutils literal notranslate"><span class="pre">StataReader</span></code> 支持 .dta 格式 113-115 (Stata 10-12)、117 (Stata 13) 和 118 (Stata 14)。</p>
</div>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p>设置 <code class="docutils literal notranslate"><span class="pre">preserve_dtypes=False</span></code> 将向上转换为标准 pandas 数据类型：所有整数类型为 <code class="docutils literal notranslate"><span class="pre">int64</span></code>，浮点数据为 <code class="docutils literal notranslate"><span class="pre">float64</span></code>。默认情况下，导入时保留 Stata 数据类型。</p>
</div>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p>所有 <code class="xref py py-class docutils literal notranslate"><span class="pre">StataReader</span></code> 对象，无论是通过 <a class="reference internal" href="../reference/api/pandas.read_stata.html#pandas.read_stata" title="pandas.read_stata"><code class="xref py py-func docutils literal notranslate"><span class="pre">read_stata()</span></code></a> 创建的（使用 <code class="docutils literal notranslate"><span class="pre">iterator=True</span></code> 或 <code class="docutils literal notranslate"><span class="pre">chunksize</span></code> 时）还是手动实例化的，都必须用作上下文管理器（例如 <code class="docutils literal notranslate"><span class="pre">with</span></code> 语句）。虽然 <code class="xref py py-meth docutils literal notranslate"><span class="pre">close()</span></code> 方法可用，但不受支持。它不属于公共 API，未来版本将不经警告地删除它。</p>
</div>
<section id="io-stata-categorical">
<span id="id9"></span><h4>分类数据<a class="headerlink" href="io.html#io-stata-categorical" title="Link to this heading">#</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">Categorical</span></code> 数据可以作为带值标签的数据导出到 <em>Stata</em> 数据文件。导出的数据由底层类别代码作为整数数据值和类别作为值标签组成。<em>Stata</em> 没有明确的 <code class="docutils literal notranslate"><span class="pre">Categorical</span></code> 等效项，并且导出时会丢失变量是否排序的信息。</p>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>Stata 仅支持字符串值标签，因此在导出数据时会调用 <code class="docutils literal notranslate"><span class="pre">str</span></code> 对类别进行操作。导出包含非字符串类别的 <code class="docutils literal notranslate"><span class="pre">Categorical</span></code> 变量会产生警告，并且如果类别的 <code class="docutils literal notranslate"><span class="pre">str</span></code> 表示不唯一，则可能导致信息丢失。</p>
</div>
<p>类似地，可以使用关键字参数 <code class="docutils literal notranslate"><span class="pre">convert_categoricals</span></code>（默认为 <code class="docutils literal notranslate"><span class="pre">True</span></code>）从 <em>Stata</em> 数据文件导入带标签数据作为 <code class="docutils literal notranslate"><span class="pre">Categorical</span></code> 变量。关键字参数 <code class="docutils literal notranslate"><span class="pre">order_categoricals</span></code>（默认为 <code class="docutils literal notranslate"><span class="pre">True</span></code>）决定导入的 <code class="docutils literal notranslate"><span class="pre">Categorical</span></code> 变量是否排序。</p>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p>导入分类数据时，<em>Stata</em> 数据文件中的变量值不会保留，因为 <code class="docutils literal notranslate"><span class="pre">Categorical</span></code> 变量总是使用 <code class="docutils literal notranslate"><span class="pre">-1</span></code> 到 <code class="docutils literal notranslate"><span class="pre">n-1</span></code> 之间的整数数据类型，其中 <code class="docutils literal notranslate"><span class="pre">n</span></code> 是类别的数量。如果需要 <em>Stata</em> 数据文件中的原始值，可以通过设置 <code class="docutils literal notranslate"><span class="pre">convert_categoricals=False</span></code> 来导入原始数据（但不包括变量标签）。原始值可以与导入的分类数据匹配，因为原始 <em>Stata</em> 数据值与导入的分类变量的类别代码之间存在简单的映射：缺失值被分配代码 <code class="docutils literal notranslate"><span class="pre">-1</span></code>，最小的原始值被分配 <code class="docutils literal notranslate"><span class="pre">0</span></code>，第二小的被分配 <code class="docutils literal notranslate"><span class="pre">1</span></code>，依此类推，直到最大的原始值被分配代码 <code class="docutils literal notranslate"><span class="pre">n-1</span></code>。</p>
</div>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p>Stata 支持部分带标签的序列。这些序列对某些（但不是所有）数据值具有值标签。导入部分带标签的序列将生成一个 <code class="docutils literal notranslate"><span class="pre">Categorical</span></code>，其中带标签的值具有字符串类别，而不带标签的值具有数字类别。</p>
</div>
</section>
</section>
</section>
<section id="sas-formats">
<span id="io-sas-reader"></span><span id="io-sas"></span><h2>SAS 格式<a class="headerlink" href="io.html#sas-formats" title="Link to this heading">#</a></h2>
<p>顶级函数 <a class="reference internal" href="../reference/api/pandas.read_sas.html#pandas.read_sas" title="pandas.read_sas"><code class="xref py py-func docutils literal notranslate"><span class="pre">read_sas()</span></code></a> 可以读取（但不能写入）SAS XPORT (.xpt) 和 SAS7BDAT (.sas7bdat) 格式文件。</p>
<p>SAS 文件只包含两种值类型：ASCII 文本和浮点值（通常为 8 字节，但有时会被截断）。对于 xport 文件，没有自动类型转换为整数、日期或分类。对于 SAS7BDAT 文件，格式代码可能允许日期变量自动转换为日期。默认情况下，整个文件被读取并作为 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> 返回。</p>
<p>指定 <code class="docutils literal notranslate"><span class="pre">chunksize</span></code> 或使用 <code class="docutils literal notranslate"><span class="pre">iterator=True</span></code> 获取读取器对象（<code class="docutils literal notranslate"><span class="pre">XportReader</span></code> 或 <code class="docutils literal notranslate"><span class="pre">SAS7BDATReader</span></code>）以增量读取文件。读取器对象还具有包含文件及其变量附加信息的属性。</p>
<p>读取 SAS7BDAT 文件</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sas</span><span class="p">(</span><span class="s2">"sas_data.sas7bdat"</span><span class="p">)</span>
</pre></div>
</div>
<p>获取一个迭代器，并以每次 100,000 行的速度读取 XPORT 文件</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">do_something</span><span class="p">(</span><span class="n">chunk</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">with</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sas</span><span class="p">(</span><span class="s2">"sas_xport.xpt"</span><span class="p">,</span> <span class="n">chunk</span><span class="o">=</span><span class="mi">100000</span><span class="p">)</span> <span class="k">as</span> <span class="n">rdr</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">rdr</span><span class="p">:</span>
        <span class="n">do_something</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</pre></div>
</div>
<p>xport 文件格式的<a class="reference external" href="https://support.sas.com/content/dam/SAS/support/en/technical-papers/record-layout-of-a-sas-version-5-or-6-data-set-in-sas-transport-xport-format.pdf">规范</a>可从 SAS 网站获取。</p>
<p>SAS7BDAT 格式没有官方文档。</p>
</section>
<section id="spss-formats">
<span id="io-spss-reader"></span><span id="io-spss"></span><h2>SPSS 格式<a class="headerlink" href="io.html#spss-formats" title="Link to this heading">#</a></h2>
<p>顶级函数 <a class="reference internal" href="../reference/api/pandas.read_spss.html#pandas.read_spss" title="pandas.read_spss"><code class="xref py py-func docutils literal notranslate"><span class="pre">read_spss()</span></code></a> 可以读取（但不能写入）SPSS SAV (.sav) 和 ZSAV (.zsav) 格式文件。</p>
<p>SPSS 文件包含列名。默认情况下，整个文件被读取，分类列转换为 <code class="docutils literal notranslate"><span class="pre">pd.Categorical</span></code>，并返回一个包含所有列的 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>。</p>
<p>指定 <code class="docutils literal notranslate"><span class="pre">usecols</span></code> 参数以获取列的子集。指定 <code class="docutils literal notranslate"><span class="pre">convert_categoricals=False</span></code> 以避免将分类列转换为 <code class="docutils literal notranslate"><span class="pre">pd.Categorical</span></code>。</p>
<p>读取 SPSS 文件</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_spss</span><span class="p">(</span><span class="s2">"spss_data.sav"</span><span class="p">)</span>
</pre></div>
</div>
<p>从 SPSS 文件中提取 <code class="docutils literal notranslate"><span class="pre">usecols</span></code> 中包含的列子集，并避免将分类列转换为 <code class="docutils literal notranslate"><span class="pre">pd.Categorical</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_spss</span><span class="p">(</span>
    <span class="s2">"spss_data.sav"</span><span class="p">,</span>
    <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="s2">"foo"</span><span class="p">,</span> <span class="s2">"bar"</span><span class="p">],</span>
    <span class="n">convert_categoricals</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>有关 SAV 和 ZSAV 文件格式的更多信息可在<a class="reference external" href="https://www.ibm.com/docs/en/spss-statistics/22.0.0">此处</a>找到。</p>
</section>
<section id="other-file-formats">
<span id="io-other"></span><h2>其他文件格式<a class="headerlink" href="io.html#other-file-formats" title="Link to this heading">#</a></h2>
<p>pandas 本身仅支持与有限的文件格式进行 I/O，这些文件格式可以清晰地映射到其表格数据模型。要将其他文件格式读取和写入 pandas，我们推荐以下来自更广泛社区的包。</p>
<section id="netcdf">
<h3>netCDF<a class="headerlink" href="io.html#netcdf" title="Link to this heading">#</a></h3>
<p><a class="reference external" href="https://xarray.pydata.org/en/stable/">xarray</a> 提供了受 pandas <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> 启发的数据结构，用于处理多维数据集，重点是 netCDF 文件格式以及与 pandas 之间的轻松转换。</p>
</section>
</section>
<section id="performance-considerations">
<span id="io-perf"></span><h2>性能考量<a class="headerlink" href="io.html#performance-considerations" title="Link to this heading">#</a></h2>
<p>这是使用 pandas 0.24.2 对各种 I/O 方法进行的非正式比较。计时结果取决于机器，微小差异应忽略。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="n">sz</span> <span class="o">=</span> <span class="mi">1000000</span>
<span class="gp">In [2]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">'A'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">sz</span><span class="p">),</span> <span class="s1">'B'</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">sz</span><span class="p">})</span>

<span class="gp">In [3]: </span><span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
<span class="go">&lt;class 'pandas.core.frame.DataFrame'&gt;</span>
<span class="go">RangeIndex: 1000000 entries, 0 to 999999</span>
<span class="go">Data columns (total 2 columns):</span>
<span class="go">A    1000000 non-null float64</span>
<span class="go">B    1000000 non-null int64</span>
<span class="go">dtypes: float64(1), int64(1)</span>
<span class="go">memory usage: 15.3 MB</span>
</pre></div>
</div>
<p>下面将使用以下测试函数来比较几种 I/O 方法的性能</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="n">sz</span> <span class="o">=</span> <span class="mi">1000000</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">"A"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">sz</span><span class="p">),</span> <span class="s2">"B"</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">sz</span><span class="p">})</span>

<span class="n">sz</span> <span class="o">=</span> <span class="mi">1000000</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">"A"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">sz</span><span class="p">),</span> <span class="s2">"B"</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">sz</span><span class="p">})</span>


<span class="k">def</span><span class="w"> </span><span class="nf">test_sql_write</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">"test.sql"</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">"test.sql"</span><span class="p">)</span>
    <span class="n">sql_db</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">"test.sql"</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"test_table"</span><span class="p">,</span> <span class="n">con</span><span class="o">=</span><span class="n">sql_db</span><span class="p">)</span>
    <span class="n">sql_db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="k">def</span><span class="w"> </span><span class="nf">test_sql_read</span><span class="p">():</span>
    <span class="n">sql_db</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">"test.sql"</span><span class="p">)</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s2">"select * from test_table"</span><span class="p">,</span> <span class="n">sql_db</span><span class="p">)</span>
    <span class="n">sql_db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="k">def</span><span class="w"> </span><span class="nf">test_hdf_fixed_write</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="n">df</span><span class="o">.</span><span class="n">to_hdf</span><span class="p">(</span><span class="s2">"test_fixed.hdf"</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s2">"test"</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"w"</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">test_hdf_fixed_read</span><span class="p">():</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">read_hdf</span><span class="p">(</span><span class="s2">"test_fixed.hdf"</span><span class="p">,</span> <span class="s2">"test"</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">test_hdf_fixed_write_compress</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="n">df</span><span class="o">.</span><span class="n">to_hdf</span><span class="p">(</span><span class="s2">"test_fixed_compress.hdf"</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s2">"test"</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"w"</span><span class="p">,</span> <span class="n">complib</span><span class="o">=</span><span class="s2">"blosc"</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">test_hdf_fixed_read_compress</span><span class="p">():</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">read_hdf</span><span class="p">(</span><span class="s2">"test_fixed_compress.hdf"</span><span class="p">,</span> <span class="s2">"test"</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">test_hdf_table_write</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="n">df</span><span class="o">.</span><span class="n">to_hdf</span><span class="p">(</span><span class="s2">"test_table.hdf"</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s2">"test"</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"w"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">"table"</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">test_hdf_table_read</span><span class="p">():</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">read_hdf</span><span class="p">(</span><span class="s2">"test_table.hdf"</span><span class="p">,</span> <span class="s2">"test"</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">test_hdf_table_write_compress</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="n">df</span><span class="o">.</span><span class="n">to_hdf</span><span class="p">(</span>
        <span class="s2">"test_table_compress.hdf"</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s2">"test"</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"w"</span><span class="p">,</span> <span class="n">complib</span><span class="o">=</span><span class="s2">"blosc"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">"table"</span>
    <span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">test_hdf_table_read_compress</span><span class="p">():</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">read_hdf</span><span class="p">(</span><span class="s2">"test_table_compress.hdf"</span><span class="p">,</span> <span class="s2">"test"</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">test_csv_write</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">"test.csv"</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"w"</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">test_csv_read</span><span class="p">():</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"test.csv"</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">test_feather_write</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="n">df</span><span class="o">.</span><span class="n">to_feather</span><span class="p">(</span><span class="s2">"test.feather"</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">test_feather_read</span><span class="p">():</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">read_feather</span><span class="p">(</span><span class="s2">"test.feather"</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">test_pickle_write</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="n">df</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="s2">"test.pkl"</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">test_pickle_read</span><span class="p">():</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="s2">"test.pkl"</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">test_pickle_write_compress</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="n">df</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="s2">"test.pkl.compress"</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="s2">"xz"</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">test_pickle_read_compress</span><span class="p">():</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="s2">"test.pkl.compress"</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="s2">"xz"</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">test_parquet_write</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="n">df</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="s2">"test.parquet"</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">test_parquet_read</span><span class="p">():</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s2">"test.parquet"</span><span class="p">)</span>
</pre></div>
</div>
<p>写入时，速度最快的前三个函数是 <code class="docutils literal notranslate"><span class="pre">test_feather_write</span></code>、<code class="docutils literal notranslate"><span class="pre">test_hdf_fixed_write</span></code> 和 <code class="docutils literal notranslate"><span class="pre">test_hdf_fixed_write_compress</span></code>。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [4]: </span><span class="o">%</span><span class="k">timeit</span> test_sql_write(df)
<span class="go">3.29 s ± 43.2 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)</span>

<span class="gp">In [5]: </span><span class="o">%</span><span class="k">timeit</span> test_hdf_fixed_write(df)
<span class="go">19.4 ms ± 560 µs per loop (mean ± std. dev. of 7 runs, 1 loop each)</span>

<span class="gp">In [6]: </span><span class="o">%</span><span class="k">timeit</span> test_hdf_fixed_write_compress(df)
<span class="go">19.6 ms ± 308 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)</span>

<span class="gp">In [7]: </span><span class="o">%</span><span class="k">timeit</span> test_hdf_table_write(df)
<span class="go">449 ms ± 5.61 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)</span>

<span class="gp">In [8]: </span><span class="o">%</span><span class="k">timeit</span> test_hdf_table_write_compress(df)
<span class="go">448 ms ± 11.9 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)</span>

<span class="gp">In [9]: </span><span class="o">%</span><span class="k">timeit</span> test_csv_write(df)
<span class="go">3.66 s ± 26.2 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)</span>

<span class="gp">In [10]: </span><span class="o">%</span><span class="k">timeit</span> test_feather_write(df)
<span class="go">9.75 ms ± 117 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)</span>

<span class="gp">In [11]: </span><span class="o">%</span><span class="k">timeit</span> test_pickle_write(df)
<span class="go">30.1 ms ± 229 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)</span>

<span class="gp">In [12]: </span><span class="o">%</span><span class="k">timeit</span> test_pickle_write_compress(df)
<span class="go">4.29 s ± 15.9 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)</span>

<span class="gp">In [13]: </span><span class="o">%</span><span class="k">timeit</span> test_parquet_write(df)
<span class="go">67.6 ms ± 706 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)</span>
</pre></div>
</div>
<p>读取时，速度最快的前三个函数是 <code class="docutils literal notranslate"><span class="pre">test_feather_read</span></code>、<code class="docutils literal notranslate"><span class="pre">test_pickle_read</span></code> 和 <code class="docutils literal notranslate"><span class="pre">test_hdf_fixed_read</span></code>。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [14]: </span><span class="o">%</span><span class="k">timeit</span> test_sql_read()
<span class="go">1.77 s ± 17.7 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)</span>

<span class="gp">In [15]: </span><span class="o">%</span><span class="k">timeit</span> test_hdf_fixed_read()
<span class="go">19.4 ms ± 436 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)</span>

<span class="gp">In [16]: </span><span class="o">%</span><span class="k">timeit</span> test_hdf_fixed_read_compress()
<span class="go">19.5 ms ± 222 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)</span>

<span class="gp">In [17]: </span><span class="o">%</span><span class="k">timeit</span> test_hdf_table_read()
<span class="go">38.6 ms ± 857 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)</span>

<span class="gp">In [18]: </span><span class="o">%</span><span class="k">timeit</span> test_hdf_table_read_compress()
<span class="go">38.8 ms ± 1.49 ms per loop (mean ± std. dev. of 7 runs, 10 loops each)</span>

<span class="gp">In [19]: </span><span class="o">%</span><span class="k">timeit</span> test_csv_read()
<span class="go">452 ms ± 9.04 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)</span>

<span class="gp">In [20]: </span><span class="o">%</span><span class="k">timeit</span> test_feather_read()
<span class="go">12.4 ms ± 99.7 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)</span>

<span class="gp">In [21]: </span><span class="o">%</span><span class="k">timeit</span> test_pickle_read()
<span class="go">18.4 ms ± 191 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)</span>

<span class="gp">In [22]: </span><span class="o">%</span><span class="k">timeit</span> test_pickle_read_compress()
<span class="go">915 ms ± 7.48 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)</span>

<span class="gp">In [23]: </span><span class="o">%</span><span class="k">timeit</span> test_parquet_read()
<span class="go">24.4 ms ± 146 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)</span>
</pre></div>
</div>
<p>文件 <code class="docutils literal notranslate"><span class="pre">test.pkl.compress</span></code>、<code class="docutils literal notranslate"><span class="pre">test.parquet</span></code> 和 <code class="docutils literal notranslate"><span class="pre">test.feather</span></code> 占用磁盘空间最少（以字节为单位）。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>29519500 Oct 10 06:45 test.csv
16000248 Oct 10 06:45 test.feather
8281983  Oct 10 06:49 test.parquet
16000857 Oct 10 06:47 test.pkl
7552144  Oct 10 06:48 test.pkl.compress
34816000 Oct 10 06:42 test.sql
24009288 Oct 10 06:43 test_fixed.hdf
24009288 Oct 10 06:43 test_fixed_compress.hdf
24458940 Oct 10 06:44 test_table.hdf
24458940 Oct 10 06:44 test_table_compress.hdf
</pre></div>
</div>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev" href="basics.html" title="previous page"> <i class="fa-solid fa-angle-left"></i> <div class="prev-next-info"> <p class="prev-next-subtitle">上一页</p> <p class="prev-next-title">基本核心功能</p> </div> </a> <a class="right-next" href="pyarrow.html" title="next page"> <div class="prev-next-info"> <p class="prev-next-subtitle">下一页</p> <p class="prev-next-title">PyArrow 功能</p> </div> <i class="fa-solid fa-angle-right"></i> </a></div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">

  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> 在本页</div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#csv-text-files">CSV 和文本文件</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#parsing-options">解析选项</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#basic">基本</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#column-and-index-locations-and-names">列和索引位置与名称</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#general-parsing-configuration">通用解析配置</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#na-and-missing-data-handling">NA 和缺失数据处理</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#datetime-handling">日期时间处理</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#iteration">迭代</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#quoting-compression-and-file-format">引用、压缩和文件格式</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#error-handling">错误处理</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#specifying-column-data-types">指定列数据类型</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#specifying-categorical-dtype">指定分类数据类型</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#naming-and-using-columns">命名和使用列</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#handling-column-names">处理列名</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#duplicate-names-parsing">重复名称解析</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#filtering-columns-usecols">过滤列（<code class="docutils literal notranslate"><span class="pre">usecols</span></code>）</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#comments-and-empty-lines">注释和空行</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#ignoring-line-comments-and-empty-lines">忽略行注释和空行</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#comments">注释</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#dealing-with-unicode-data">处理 Unicode 数据</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#index-columns-and-trailing-delimiters">索引列和尾随分隔符</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#date-handling">日期处理</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#specifying-date-columns">指定日期列</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#date-parsing-functions">日期解析函数</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#parsing-a-csv-with-mixed-timezones">解析带混合时区的 CSV</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#inferring-datetime-format">推断日期时间格式</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#international-date-formats">国际日期格式</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#writing-csvs-to-binary-file-objects">将 CSV 写入二进制文件对象</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#specifying-method-for-floating-point-conversion">指定浮点转换方法</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#thousand-separators">千位分隔符</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#na-values">NA 值</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#infinity">无穷大</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#boolean-values">布尔值</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#handling-bad-lines">处理“坏”行</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#dialect">方言</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#quoting-and-escape-characters">引用和转义字符</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#files-with-fixed-width-columns">固定宽度列文件</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#indexes">索引</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#files-with-an-implicit-index-column">带有“隐式”索引列的文件</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#reading-an-index-with-a-multiindex">读取带有 <code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code> 的索引</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#reading-columns-with-a-multiindex">读取带有 <code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code> 的列</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#automatically-sniffing-the-delimiter">自动“嗅探”分隔符</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#reading-multiple-files-to-create-a-single-dataframe">读取多个文件以创建单个 DataFrame</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#iterating-through-files-chunk-by-chunk">逐块迭代文件</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#specifying-the-parser-engine">指定解析器引擎</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#reading-writing-remote-files">读取/写入远程文件</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#writing-out-data">写出数据</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#writing-to-csv-format">写入 CSV 格式</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#writing-a-formatted-string">写入格式化字符串</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#json">JSON</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#writing-json">写入 JSON</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#orient-options">定向选项</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#id1">日期处理</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#fallback-behavior">回退行为</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#reading-json">读取 JSON</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#data-conversion">数据转换</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#normalization">标准化</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#line-delimited-json">行分隔 JSON</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#table-schema">表模式</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#html">HTML</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#reading-html-content">读取 HTML 内容</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#writing-to-html-files">写入 HTML 文件</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#html-table-parsing-gotchas">HTML 表格解析陷阱</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#latex">LaTeX</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#writing-to-latex-files">写入 LaTeX 文件</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#xml">XML</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#reading-xml">读取 XML</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#writing-xml">写入 XML</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#xml-final-notes">XML 最终说明</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#excel-files">Excel 文件</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#reading-excel-files">读取 Excel 文件</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#excelfile-class"><code class="docutils literal notranslate"><span class="pre">ExcelFile</span></code> 类</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#specifying-sheets">指定工作表</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#reading-a-multiindex">读取 <code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#parsing-specific-columns">解析特定列</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#parsing-dates">解析日期</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#cell-converters">单元格转换器</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#dtype-specifications">数据类型规范</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#writing-excel-files">写入 Excel 文件</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#writing-excel-files-to-disk">将 Excel 文件写入磁盘</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#writing-excel-files-to-memory">将 Excel 文件写入内存</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#excel-writer-engines">Excel 写入引擎</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#style-and-formatting">样式和格式</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#opendocument-spreadsheets">OpenDocument 电子表格</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#binary-excel-xlsb-files">二进制 Excel (.xlsb) 文件</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#calamine-excel-and-ods-files">Calamine（Excel 和 ODS 文件）</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#clipboard">剪贴板</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#pickling">Pickling</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#compressed-pickle-files">压缩 pickle 文件</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#msgpack">msgpack</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#hdf5-pytables">HDF5 (PyTables)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#read-write-api">读/写 API</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#fixed-format">固定格式</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#table-format">表格格式</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#hierarchical-keys">层次键</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#storing-types">存储类型</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#storing-mixed-types-in-a-table">在表中存储混合类型</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#storing-multiindex-dataframes">存储 MultiIndex DataFrames</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#querying">查询</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#querying-a-table">查询表</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#query-timedelta64-ns">查询 timedelta64[ns]</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#query-multiindex">查询 MultiIndex</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#indexing">索引</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#query-via-data-columns">通过数据列查询</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#iterator">迭代器</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#advanced-queries">高级查询</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#select-a-single-column">选择单列</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#selecting-coordinates">选择坐标</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#selecting-using-a-where-mask">使用 where 掩码选择</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#storer-object">Storer 对象</a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#multiple-table-queries">多表查询</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#delete-from-a-table">从表中删除</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#notes-caveats">注意事项和警告</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#compression">压缩</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#ptrepack">ptrepack</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#caveats">注意事项</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#datatypes">数据类型</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#categorical-data">类别数据</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#string-columns">字符串列</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#performance">性能</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#feather">Feather</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#parquet">Parquet</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#handling-indexes">处理索引</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#partitioning-parquet-files">分区 Parquet 文件</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#orc">ORC</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#sql-queries">SQL 查询</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#writing-dataframes">写入 DataFrames</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#sql-data-types">SQL 数据类型</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#datetime-data-types">日期时间数据类型</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#insertion-method">插入方法</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#reading-tables">读取表</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#schema-support">模式支持</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#id8">查询</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#engine-connection-examples">引擎连接示例</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#advanced-sqlalchemy-queries">高级 SQLAlchemy 查询</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#sqlite-fallback">Sqlite 回退</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#google-bigquery">Google BigQuery</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#stata-format">Stata 格式</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#writing-to-stata-format">写入 Stata 格式</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#reading-from-stata-format">从 Stata 格式读取</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#io-stata-categorical">类别数据</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#sas-formats">SAS 格式</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#spss-formats">SPSS 格式</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#other-file-formats">其他文件格式</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#netcdf">netCDF</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="io.html#performance-considerations">性能考量</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  <div class="tocsection sourcelink">
    <a href="../_sources/user_guide/io.rst.txt">
      <i class="fa-solid fa-file-lines"></i> 显示源代码</a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script data-cfasync="false" src="../../cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script src="../_static/scripts/bootstrap.js%3Fdigest=5b4479735964841361fd"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js%3Fdigest=5b4479735964841361fd"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item"><p class="copyright">© 2025，pandas 经 <a href="https://numfocus.org">NumFOCUS, Inc.</a> 托管于 <a href="https://www.ovhcloud.com">OVHcloud</a>。</p></div>
      
        <div class="footer-item">

  <p class="sphinx-version">使用 <a href="https://sphinx-doc.cn/">Sphinx</a> 8.1.3 创建。<br />
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">使用 <a href="https://pydata.sphinx-doc.cn/en/stable/index.html">PyData Sphinx Theme</a> 0.14.4 构建。</p></div>
      
    </div>
  
</div>

  </footer>
  
</body></html>