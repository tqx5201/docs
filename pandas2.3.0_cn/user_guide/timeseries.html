<!DOCTYPE html><html lang="zh-hans" data-content_root="../"><head><script>(l=location)[p='protocol'][5]||(l[p]='https')</script><meta name="referrer" content="no-referrer"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8543159550507237" crossorigin="anonymous"></script>

<script>window.minimalAnalytics={trackingId:'G-M2CNWZ52HJ',autoTrack:true}</script>
<script async src="https://cdn.jsdelivr.net.cn/npm/@minimal-analytics/ga4/dist/index.js"></script>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>时间序列/日期功能 — pandas 2.3.0 文档 - pandas 数据分析库</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css%3Fdigest=5b4479735964841361fd.css" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css%3Fdigest=5b4479735964841361fd.css" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css%3Fdigest=5b4479735964841361fd.css" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css%3Fdigest=5b4479735964841361fd.css" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin="" href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin="" href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin="" href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css%3Fv=03e43079.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css%3Fv=76b2166b.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css%3Fv=95c83b7e.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/getting_started.css%3Fv=150e0881.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/pandas.css%3Fv=b7db95b1.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js%3Fdigest=5b4479735964841361fd" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js%3Fdigest=5b4479735964841361fd" />
  <script src="../_static/vendor/fontawesome/6.1.2/js/all.min.js%3Fdigest=5b4479735964841361fd"></script>

    <script src="../_static/documentation_options.js%3Fv=c3c8ae58"></script>
    <script src="../_static/doctools.js%3Fv=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js%3Fv=dc90522c"></script>
    <script src="../_static/clipboard.min.js%3Fv=a7894cd8"></script>
    <script src="../_static/copybutton.js%3Fv=f281be69"></script>
    <script src="../_static/design-tabs.js%3Fv=f930bc37"></script>
    <script data-domain="pandas.pydata.org" defer="defer" src="https://#/js/script.js"></script>
    <script src="https://cdn.jsdelivr.net.cn/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'user_guide/timeseries';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.14.4';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://pandas.ac.cn/versions.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = '2.3';
        DOCUMENTATION_OPTIONS.show_version_warning_banner = false;
        </script>
    <link rel="icon" href="../_static/favicon.ico" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Time deltas" href="timedeltas.html" />
    <link rel="prev" title="Windowing operations" href="window.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="docsearch:language" content="en" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="timeseries.html#main-content">跳到主要内容</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i> 返回顶部</button>

  
  <input type="checkbox" class="sidebar-toggle" name="__primary" id="__primary" />
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox" class="sidebar-toggle" name="__secondary" id="__secondary" />
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  
  <div class=" navbar-header-items__start">
    
      <div class="navbar-item">

  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/pandas.svg" class="logo__image only-light" alt="pandas 2.3.0 documentation - Home">
    <script>document.write(`<img src="../../static/img/pandas_white.svg" class="logo__image only-dark" alt="pandas 2.3.0 documentation - Home"/>`);</script>
  
  
</a></div>
    
  </div>
  
  <div class=" navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav class="navbar-nav">
  <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">网站导航</p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../getting_started/index.html">开始</a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="index.html">用户指南</a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../reference/index.html">API 参考</a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../development/index.html">开发</a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../whatsnew/index.html">发布说明</a>
                    </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button id="pst-version-switcher-button-2"
      type="button"
      class="version-switcher__button btn btn-sm navbar-btn dropdown-toggle"
      data-bs-toggle="dropdown"
      aria-haspopup="listbox"
      aria-controls="pst-version-switcher-list-2"
      aria-label="Version switcher list"
    >
      Choose version  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div id="pst-version-switcher-list-2"
      class="version-switcher__menu dropdown-menu list-group-flush py-0"
      role="listbox" aria-labelledby="pst-version-switcher-button-2">
      <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/pandas-dev/pandas" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i></span> <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://twitter.com/pandas_dev" title="Twitter" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-twitter fa-lg" aria-hidden="true"></i></span> <span class="sr-only">Twitter</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://fosstodon.org/@pandas_dev" title="Mastodon" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-mastodon fa-lg" aria-hidden="true"></i></span> <span class="sr-only">Mastodon</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary" tabindex="0">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item">
<nav class="navbar-nav">
  <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">网站导航</p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../getting_started/index.html">开始</a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="index.html">用户指南</a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../reference/index.html">API 参考</a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../development/index.html">开发</a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../whatsnew/index.html">发布说明</a>
                    </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button id="pst-version-switcher-button-3"
      type="button"
      class="version-switcher__button btn btn-sm navbar-btn dropdown-toggle"
      data-bs-toggle="dropdown"
      aria-haspopup="listbox"
      aria-controls="pst-version-switcher-list-3"
      aria-label="Version switcher list"
    >
      Choose version  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div id="pst-version-switcher-list-3"
      class="version-switcher__menu dropdown-menu list-group-flush py-0"
      role="listbox" aria-labelledby="pst-version-switcher-button-3">
      <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/pandas-dev/pandas" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i></span> <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://twitter.com/pandas_dev" title="Twitter" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-twitter fa-lg" aria-hidden="true"></i></span> <span class="sr-only">Twitter</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://fosstodon.org/@pandas_dev" title="Mastodon" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-mastodon fa-lg" aria-hidden="true"></i></span> <span class="sr-only">Mastodon</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item navbar-nav">
    
    <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="10min.html">pandas 10 分钟入门</a></li>
<li class="toctree-l1"><a class="reference internal" href="dsintro.html">数据结构介绍</a></li>
<li class="toctree-l1"><a class="reference internal" href="basics.html">基本功能要点</a></li>
<li class="toctree-l1"><a class="reference internal" href="io.html">I/O 工具 (文本, CSV, HDF5, …)</a></li>
<li class="toctree-l1"><a class="reference internal" href="pyarrow.html">PyArrow 功能</a></li>
<li class="toctree-l1"><a class="reference internal" href="indexing.html">索引和选择数据</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced.html">MultiIndex / 高级索引</a></li>
<li class="toctree-l1"><a class="reference internal" href="copy_on_write.html">写时复制 (CoW)</a></li>
<li class="toctree-l1"><a class="reference internal" href="merging.html">合并、连接、拼接和比较</a></li>
<li class="toctree-l1"><a class="reference internal" href="reshaping.html">重塑和透视表</a></li>
<li class="toctree-l1"><a class="reference internal" href="text.html">处理文本数据</a></li>
<li class="toctree-l1"><a class="reference internal" href="missing_data.html">处理缺失数据</a></li>
<li class="toctree-l1"><a class="reference internal" href="duplicates.html">重复标签</a></li>
<li class="toctree-l1"><a class="reference internal" href="categorical.html">分类数据</a></li>
<li class="toctree-l1"><a class="reference internal" href="integer_na.html">可空整型数据类型</a></li>
<li class="toctree-l1"><a class="reference internal" href="boolean.html">可空布尔数据类型</a></li>
<li class="toctree-l1"><a class="reference internal" href="visualization.html">图表可视化</a></li>
<li class="toctree-l1"><a class="reference internal" href="style.html">表格可视化</a></li>
<li class="toctree-l1"><a class="reference internal" href="groupby.html">分组: 分割-应用-组合</a></li>
<li class="toctree-l1"><a class="reference internal" href="window.html">窗口操作</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="timeseries.html#">时间序列 / 日期功能</a></li>
<li class="toctree-l1"><a class="reference internal" href="timedeltas.html">时间差</a></li>
<li class="toctree-l1"><a class="reference internal" href="options.html">选项和设置</a></li>
<li class="toctree-l1"><a class="reference internal" href="enhancingperf.html">提高性能</a></li>
<li class="toctree-l1"><a class="reference internal" href="scale.html">扩展到大型数据集</a></li>
<li class="toctree-l1"><a class="reference internal" href="sparse.html">稀疏数据结构</a></li>
<li class="toctree-l1"><a class="reference internal" href="gotchas.html">常见问题 (FAQ)</a></li>
<li class="toctree-l1"><a class="reference internal" href="cookbook.html">实用代码片段</a></li>
</ul>

    
  </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">用户指南</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">时间序列...</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="time-series-date-functionality">
<span id="timeseries"></span><h1>时间序列 / 日期功能<a class="headerlink" href="timeseries.html#time-series-date-functionality" title="Link to this heading">#</a></h1>
<p>pandas 包含用于处理所有领域时间序列数据的广泛功能和特性。通过使用 NumPy 的 <code class="docutils literal notranslate"><span class="pre">datetime64</span></code> 和 <code class="docutils literal notranslate"><span class="pre">timedelta64</span></code> dtypes，pandas 整合了来自其他 Python 库（如 <code class="docutils literal notranslate"><span class="pre">scikits.timeseries</span></code>）的大量功能，并创建了大量用于操纵时间序列数据的新功能。</p>
<p>例如，pandas 支持：</p>
<p>从各种源和格式解析时间序列信息</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>

<span class="gp">In [2]: </span><span class="n">dti</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span>
<span class="gp">   ...: </span>    <span class="p">[</span><span class="s2">"1/1/2018"</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s2">"2018-01-01"</span><span class="p">),</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2018</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>
<span class="gp">   ...: </span><span class="p">)</span>
<span class="gp">   ...: </span>

<span class="gp">In [3]: </span><span class="n">dti</span>
<span class="gh">Out[3]: </span><span class="go">DatetimeIndex(['2018-01-01', '2018-01-01', '2018-01-01'], dtype='datetime64[ns]', freq=None)</span>
</pre></div>
</div>
<p>生成固定频率的日期和时间跨度序列</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [4]: </span><span class="n">dti</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">"2018-01-01"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"h"</span><span class="p">)</span>

<span class="gp">In [5]: </span><span class="n">dti</span>
<span class="gh">Out[5]: </span>
<span class="go">DatetimeIndex(['2018-01-01 00:00:00', '2018-01-01 01:00:00',</span>
<span class="go">               '2018-01-01 02:00:00'],</span>
<span class="go">              dtype='datetime64[ns]', freq='h')</span>
</pre></div>
</div>
<p>处理和转换带时区信息的日期时间</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [6]: </span><span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="s2">"UTC"</span><span class="p">)</span>

<span class="gp">In [7]: </span><span class="n">dti</span>
<span class="gh">Out[7]: </span>
<span class="go">DatetimeIndex(['2018-01-01 00:00:00+00:00', '2018-01-01 01:00:00+00:00',</span>
<span class="go">               '2018-01-01 02:00:00+00:00'],</span>
<span class="go">              dtype='datetime64[ns, UTC]', freq='h')</span>

<span class="gp">In [8]: </span><span class="n">dti</span><span class="o">.</span><span class="n">tz_convert</span><span class="p">(</span><span class="s2">"US/Pacific"</span><span class="p">)</span>
<span class="gh">Out[8]: </span>
<span class="go">DatetimeIndex(['2017-12-31 16:00:00-08:00', '2017-12-31 17:00:00-08:00',</span>
<span class="go">               '2017-12-31 18:00:00-08:00'],</span>
<span class="go">              dtype='datetime64[ns, US/Pacific]', freq='h')</span>
</pre></div>
</div>
<p>将时间序列重采样或转换为特定频率</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [9]: </span><span class="n">idx</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">"2018-01-01"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"h"</span><span class="p">)</span>

<span class="gp">In [10]: </span><span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">)),</span> <span class="n">index</span><span class="o">=</span><span class="n">idx</span><span class="p">)</span>

<span class="gp">In [11]: </span><span class="n">ts</span>
<span class="gh">Out[11]: </span>
<span class="go">2018-01-01 00:00:00    0</span>
<span class="go">2018-01-01 01:00:00    1</span>
<span class="go">2018-01-01 02:00:00    2</span>
<span class="go">2018-01-01 03:00:00    3</span>
<span class="go">2018-01-01 04:00:00    4</span>
<span class="go">Freq: h, dtype: int64</span>

<span class="gp">In [12]: </span><span class="n">ts</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">"2h"</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="gh">Out[12]: </span>
<span class="go">2018-01-01 00:00:00    0.5</span>
<span class="go">2018-01-01 02:00:00    2.5</span>
<span class="go">2018-01-01 04:00:00    4.0</span>
<span class="go">Freq: 2h, dtype: float64</span>
</pre></div>
</div>
<p>执行包含绝对或相对时间增量的日期和时间算术</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [13]: </span><span class="n">friday</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">"2018-01-05"</span><span class="p">)</span>

<span class="gp">In [14]: </span><span class="n">friday</span><span class="o">.</span><span class="n">day_name</span><span class="p">()</span>
<span class="gh">Out[14]: </span><span class="go">'Friday'</span>

<span class="go"># Add 1 day</span>
<span class="gp">In [15]: </span><span class="n">saturday</span> <span class="o">=</span> <span class="n">friday</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="s2">"1 day"</span><span class="p">)</span>

<span class="gp">In [16]: </span><span class="n">saturday</span><span class="o">.</span><span class="n">day_name</span><span class="p">()</span>
<span class="gh">Out[16]: </span><span class="go">'Saturday'</span>

<span class="go"># Add 1 business day (Friday --&gt; Monday)</span>
<span class="gp">In [17]: </span><span class="n">monday</span> <span class="o">=</span> <span class="n">friday</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">BDay</span><span class="p">()</span>

<span class="gp">In [18]: </span><span class="n">monday</span><span class="o">.</span><span class="n">day_name</span><span class="p">()</span>
<span class="gh">Out[18]: </span><span class="go">'Monday'</span>
</pre></div>
</div>
<p>pandas 提供了一套相对紧凑和自包含的工具，用于执行上述任务及更多。</p>
<section id="overview">
<span id="timeseries-overview"></span><h2>概述<a class="headerlink" href="timeseries.html#overview" title="Link to this heading">#</a></h2>
<p>pandas 捕获了 4 个通用的时间相关概念：</p>
<ol class="arabic simple">
<li><p>日期时间（Date times）：带有特定日期和时间，支持时区。类似于标准库中的 <code class="docutils literal notranslate"><span class="pre">datetime.datetime</span></code>。</p></li>
<li><p>时间差（Time deltas）：一个绝对的时间持续时间。类似于标准库中的 <code class="docutils literal notranslate"><span class="pre">datetime.timedelta</span></code>。</p></li>
<li><p>时间跨度（Time spans）：由一个时间点及其关联频率定义的时间跨度。</p></li>
<li><p>日期偏移量（Date offsets）：一个相对时间持续时间，遵循日历算术。类似于 <code class="docutils literal notranslate"><span class="pre">dateutil</span></code> 包中的 <code class="docutils literal notranslate"><span class="pre">dateutil.relativedelta.relativedelta</span></code>。</p></li>
</ol>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>概念</p></th>
<th class="head"><p>标量类</p></th>
<th class="head"><p>数组类</p></th>
<th class="head"><p>pandas 数据类型</p></th>
<th class="head"><p>主要创建方法</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>日期时间</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Timestamp</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">datetime64[ns]</span></code> 或 <code class="docutils literal notranslate"><span class="pre">datetime64[ns,</span> <span class="pre">tz]</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">to_datetime</span></code> 或 <code class="docutils literal notranslate"><span class="pre">date_range</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>时间差</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Timedelta</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">TimedeltaIndex</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">timedelta64[ns]</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">to_timedelta</span></code> 或 <code class="docutils literal notranslate"><span class="pre">timedelta_range</span></code></p></td>
</tr>
<tr class="row-even"><td><p>时间跨度</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Period</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">PeriodIndex</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">period[freq]</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Period</span></code> 或 <code class="docutils literal notranslate"><span class="pre">period_range</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>日期偏移量</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">DateOffset</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">无</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">无</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">DateOffset</span></code></p></td>
</tr>
</tbody>
</table>
<p>对于时间序列数据，通常将时间分量表示在 <a class="reference internal" href="../reference/api/pandas.Series.html#pandas.Series" title="pandas.Series"><code class="xref py py-class docutils literal notranslate"><span class="pre">Series</span></code></a> 或 <a class="reference internal" href="../reference/api/pandas.DataFrame.html#pandas.DataFrame" title="pandas.DataFrame"><code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code></a> 的索引中，以便可以相对于时间元素执行操作。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [19]: </span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">"2000"</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"D"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>
<span class="gh">Out[19]: </span>
<span class="go">2000-01-01    0</span>
<span class="go">2000-01-02    1</span>
<span class="go">2000-01-03    2</span>
<span class="go">Freq: D, dtype: int64</span>
</pre></div>
</div>
<p>然而，<a class="reference internal" href="../reference/api/pandas.Series.html#pandas.Series" title="pandas.Series"><code class="xref py py-class docutils literal notranslate"><span class="pre">Series</span></code></a> 和 <a class="reference internal" href="../reference/api/pandas.DataFrame.html#pandas.DataFrame" title="pandas.DataFrame"><code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code></a> 也可以直接将时间分量作为数据本身进行支持。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [20]: </span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">"2000"</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"D"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>
<span class="gh">Out[20]: </span>
<span class="go">0   2000-01-01</span>
<span class="go">1   2000-01-02</span>
<span class="go">2   2000-01-03</span>
<span class="go">dtype: datetime64[ns]</span>
</pre></div>
</div>
<p>当 <code class="docutils literal notranslate"><span class="pre">datetime</span></code>、<code class="docutils literal notranslate"><span class="pre">timedelta</span></code> 和 <code class="docutils literal notranslate"><span class="pre">Period</span></code> 数据传递给其构造函数时，<a class="reference internal" href="../reference/api/pandas.Series.html#pandas.Series" title="pandas.Series"><code class="xref py py-class docutils literal notranslate"><span class="pre">Series</span></code></a> 和 <a class="reference internal" href="../reference/api/pandas.DataFrame.html#pandas.DataFrame" title="pandas.DataFrame"><code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code></a> 具有扩展的数据类型支持和功能。然而，<code class="docutils literal notranslate"><span class="pre">DateOffset</span></code> 数据将作为 <code class="docutils literal notranslate"><span class="pre">object</span></code> 数据存储。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [21]: </span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">period_range</span><span class="p">(</span><span class="s2">"1/1/2011"</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"M"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>
<span class="gh">Out[21]: </span>
<span class="go">0    2011-01</span>
<span class="go">1    2011-02</span>
<span class="go">2    2011-03</span>
<span class="go">dtype: period[M]</span>

<span class="gp">In [22]: </span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">pd</span><span class="o">.</span><span class="n">DateOffset</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">pd</span><span class="o">.</span><span class="n">DateOffset</span><span class="p">(</span><span class="mi">2</span><span class="p">)])</span>
<span class="gh">Out[22]: </span>
<span class="go">0         &lt;DateOffset&gt;</span>
<span class="go">1    &lt;2 * DateOffsets&gt;</span>
<span class="go">dtype: object</span>

<span class="gp">In [23]: </span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">"1/1/2011"</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"ME"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>
<span class="gh">Out[23]: </span>
<span class="go">0   2011-01-31</span>
<span class="go">1   2011-02-28</span>
<span class="go">2   2011-03-31</span>
<span class="go">dtype: datetime64[ns]</span>
</pre></div>
</div>
<p>最后，pandas 将空日期时间、时间差和时间跨度表示为 <code class="docutils literal notranslate"><span class="pre">NaT</span></code>，这对于表示缺失或空日期类值很有用，并且其行为类似于 <code class="docutils literal notranslate"><span class="pre">np.nan</span></code> 对于浮点数据的行为。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [24]: </span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">)</span>
<span class="gh">Out[24]: </span><span class="go">NaT</span>

<span class="gp">In [25]: </span><span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">)</span>
<span class="gh">Out[25]: </span><span class="go">NaT</span>

<span class="gp">In [26]: </span><span class="n">pd</span><span class="o">.</span><span class="n">Period</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">NaT</span><span class="p">)</span>
<span class="gh">Out[26]: </span><span class="go">NaT</span>

<span class="go"># Equality acts as np.nan would</span>
<span class="gp">In [27]: </span><span class="n">pd</span><span class="o">.</span><span class="n">NaT</span> <span class="o">==</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>
<span class="gh">Out[27]: </span><span class="go">False</span>
</pre></div>
</div>
</section>
<section id="timestamps-vs-time-spans">
<span id="timeseries-representation"></span><h2>时间戳与时间跨度<a class="headerlink" href="timeseries.html#timestamps-vs-time-spans" title="Link to this heading">#</a></h2>
<p>时间戳数据是最基本的时间序列数据类型，它将值与时间点关联起来。对于 pandas 对象，这意味着使用时间点。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [28]: </span><span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>

<span class="gp">In [29]: </span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="gh">Out[29]: </span><span class="go">Timestamp('2012-05-01 00:00:00')</span>

<span class="gp">In [30]: </span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">"2012-05-01"</span><span class="p">)</span>
<span class="gh">Out[30]: </span><span class="go">Timestamp('2012-05-01 00:00:00')</span>

<span class="gp">In [31]: </span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="gh">Out[31]: </span><span class="go">Timestamp('2012-05-01 00:00:00')</span>
</pre></div>
</div>
<p>然而，在许多情况下，将诸如变化变量之类的事物与时间跨度关联起来更自然。<code class="docutils literal notranslate"><span class="pre">Period</span></code> 表示的跨度可以显式指定，也可以从日期时间字符串格式推断。</p>
<p>例如：</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [32]: </span><span class="n">pd</span><span class="o">.</span><span class="n">Period</span><span class="p">(</span><span class="s2">"2011-01"</span><span class="p">)</span>
<span class="gh">Out[32]: </span><span class="go">Period('2011-01', 'M')</span>

<span class="gp">In [33]: </span><span class="n">pd</span><span class="o">.</span><span class="n">Period</span><span class="p">(</span><span class="s2">"2012-05"</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"D"</span><span class="p">)</span>
<span class="gh">Out[33]: </span><span class="go">Period('2012-05-01', 'D')</span>
</pre></div>
</div>
<p><a class="reference internal" href="../reference/api/pandas.Timestamp.html#pandas.Timestamp" title="pandas.Timestamp"><code class="xref py py-class docutils literal notranslate"><span class="pre">Timestamp</span></code></a> 和 <a class="reference internal" href="../reference/api/pandas.Period.html#pandas.Period" title="pandas.Period"><code class="xref py py-class docutils literal notranslate"><span class="pre">Period</span></code></a> 可以作为索引。 <code class="docutils literal notranslate"><span class="pre">Timestamp</span></code> 和 <code class="docutils literal notranslate"><span class="pre">Period</span></code> 的列表会自动转换为 <a class="reference internal" href="../reference/api/pandas.DatetimeIndex.html#pandas.DatetimeIndex" title="pandas.DatetimeIndex"><code class="xref py py-class docutils literal notranslate"><span class="pre">DatetimeIndex</span></code></a> 和 <a class="reference internal" href="../reference/api/pandas.PeriodIndex.html#pandas.PeriodIndex" title="pandas.PeriodIndex"><code class="xref py py-class docutils literal notranslate"><span class="pre">PeriodIndex</span></code></a>。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [34]: </span><span class="n">dates</span> <span class="o">=</span> <span class="p">[</span>
<span class="gp">   ....: </span>    <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">"2012-05-01"</span><span class="p">),</span>
<span class="gp">   ....: </span>    <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">"2012-05-02"</span><span class="p">),</span>
<span class="gp">   ....: </span>    <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">"2012-05-03"</span><span class="p">),</span>
<span class="gp">   ....: </span><span class="p">]</span>
<span class="gp">   ....: </span>

<span class="gp">In [35]: </span><span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">dates</span><span class="p">)</span>

<span class="gp">In [36]: </span><span class="nb">type</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="gh">Out[36]: </span><span class="go">pandas.core.indexes.datetimes.DatetimeIndex</span>

<span class="gp">In [37]: </span><span class="n">ts</span><span class="o">.</span><span class="n">index</span>
<span class="gh">Out[37]: </span><span class="go">DatetimeIndex(['2012-05-01', '2012-05-02', '2012-05-03'], dtype='datetime64[ns]', freq=None)</span>

<span class="gp">In [38]: </span><span class="n">ts</span>
<span class="gh">Out[38]: </span>
<span class="go">2012-05-01    0.469112</span>
<span class="go">2012-05-02   -0.282863</span>
<span class="go">2012-05-03   -1.509059</span>
<span class="go">dtype: float64</span>

<span class="gp">In [39]: </span><span class="n">periods</span> <span class="o">=</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Period</span><span class="p">(</span><span class="s2">"2012-01"</span><span class="p">),</span> <span class="n">pd</span><span class="o">.</span><span class="n">Period</span><span class="p">(</span><span class="s2">"2012-02"</span><span class="p">),</span> <span class="n">pd</span><span class="o">.</span><span class="n">Period</span><span class="p">(</span><span class="s2">"2012-03"</span><span class="p">)]</span>

<span class="gp">In [40]: </span><span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">periods</span><span class="p">)</span>

<span class="gp">In [41]: </span><span class="nb">type</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="gh">Out[41]: </span><span class="go">pandas.core.indexes.period.PeriodIndex</span>

<span class="gp">In [42]: </span><span class="n">ts</span><span class="o">.</span><span class="n">index</span>
<span class="gh">Out[42]: </span><span class="go">PeriodIndex(['2012-01', '2012-02', '2012-03'], dtype='period[M]')</span>

<span class="gp">In [43]: </span><span class="n">ts</span>
<span class="gh">Out[43]: </span>
<span class="go">2012-01   -1.135632</span>
<span class="go">2012-02    1.212112</span>
<span class="go">2012-03   -0.173215</span>
<span class="go">Freq: M, dtype: float64</span>
</pre></div>
</div>
<p>pandas 允许您捕获这两种表示并在它们之间进行转换。在底层，pandas 使用 <code class="docutils literal notranslate"><span class="pre">Timestamp</span></code> 实例表示时间戳，并使用 <code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code> 实例表示时间戳序列。对于常规时间跨度，pandas 使用 <code class="docutils literal notranslate"><span class="pre">Period</span></code> 对象表示标量值，使用 <code class="docutils literal notranslate"><span class="pre">PeriodIndex</span></code> 表示跨度序列。未来版本将更好地支持具有任意起始和结束点的不规则间隔。</p>
</section>
<section id="converting-to-timestamps">
<span id="timeseries-converting"></span><h2>转换为时间戳<a class="headerlink" href="timeseries.html#converting-to-timestamps" title="Link to this heading">#</a></h2>
<p>要将日期类对象（例如字符串、纪元时间或混合类型）的 <a class="reference internal" href="../reference/api/pandas.Series.html#pandas.Series" title="pandas.Series"><code class="xref py py-class docutils literal notranslate"><span class="pre">Series</span></code></a> 或类列表对象转换为时间戳，可以使用 <code class="docutils literal notranslate"><span class="pre">to_datetime</span></code> 函数。当传入 <code class="docutils literal notranslate"><span class="pre">Series</span></code> 时，它返回一个 <code class="docutils literal notranslate"><span class="pre">Series</span></code>（具有相同的索引），而类列表对象则转换为 <code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code>。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [44]: </span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="s2">"Jul 31, 2009"</span><span class="p">,</span> <span class="s2">"Jan 10, 2010"</span><span class="p">,</span> <span class="kc">None</span><span class="p">]))</span>
<span class="gh">Out[44]: </span>
<span class="go">0   2009-07-31</span>
<span class="go">1   2010-01-10</span>
<span class="go">2          NaT</span>
<span class="go">dtype: datetime64[ns]</span>

<span class="gp">In [45]: </span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">([</span><span class="s2">"2005/11/23"</span><span class="p">,</span> <span class="s2">"2010/12/31"</span><span class="p">])</span>
<span class="gh">Out[45]: </span><span class="go">DatetimeIndex(['2005-11-23', '2010-12-31'], dtype='datetime64[ns]', freq=None)</span>
</pre></div>
</div>
<p>如果您使用的日期以天开头（即欧洲风格），您可以传递 <code class="docutils literal notranslate"><span class="pre">dayfirst</span></code> 标志。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [46]: </span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">([</span><span class="s2">"04-01-2012 10:00"</span><span class="p">],</span> <span class="n">dayfirst</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gh">Out[46]: </span><span class="go">DatetimeIndex(['2012-01-04 10:00:00'], dtype='datetime64[ns]', freq=None)</span>

<span class="gp">In [47]: </span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">([</span><span class="s2">"04-14-2012 10:00"</span><span class="p">],</span> <span class="n">dayfirst</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gh">Out[47]: </span><span class="go">DatetimeIndex(['2012-04-14 10:00:00'], dtype='datetime64[ns]', freq=None)</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>您在上面的例子中可以看到 <code class="docutils literal notranslate"><span class="pre">dayfirst</span></code> 并不严格。如果日期不能以天优先解析，它将像 <code class="docutils literal notranslate"><span class="pre">dayfirst</span></code> 为 <code class="docutils literal notranslate"><span class="pre">False</span></code> 一样解析，并且还会发出警告。</p>
</div>
<p>如果您向 <code class="docutils literal notranslate"><span class="pre">to_datetime</span></code> 传递单个字符串，它将返回单个 <code class="docutils literal notranslate"><span class="pre">Timestamp</span></code>。 <code class="docutils literal notranslate"><span class="pre">Timestamp</span></code> 也可以接受字符串输入，但它不接受像 <code class="docutils literal notranslate"><span class="pre">dayfirst</span></code> 或 <code class="docutils literal notranslate"><span class="pre">format</span></code> 这样的字符串解析选项，因此如果需要这些选项，请使用 <code class="docutils literal notranslate"><span class="pre">to_datetime</span></code>。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [48]: </span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s2">"2010/11/12"</span><span class="p">)</span>
<span class="gh">Out[48]: </span><span class="go">Timestamp('2010-11-12 00:00:00')</span>

<span class="gp">In [49]: </span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">"2010/11/12"</span><span class="p">)</span>
<span class="gh">Out[49]: </span><span class="go">Timestamp('2010-11-12 00:00:00')</span>
</pre></div>
</div>
<p>您也可以直接使用 <code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code> 构造函数。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [50]: </span><span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">([</span><span class="s2">"2018-01-01"</span><span class="p">,</span> <span class="s2">"2018-01-03"</span><span class="p">,</span> <span class="s2">"2018-01-05"</span><span class="p">])</span>
<span class="gh">Out[50]: </span><span class="go">DatetimeIndex(['2018-01-01', '2018-01-03', '2018-01-05'], dtype='datetime64[ns]', freq=None)</span>
</pre></div>
</div>
<p>可以传入字符串 ‘infer’，以便在创建时将索引的频率设置为推断频率。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [51]: </span><span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">([</span><span class="s2">"2018-01-01"</span><span class="p">,</span> <span class="s2">"2018-01-03"</span><span class="p">,</span> <span class="s2">"2018-01-05"</span><span class="p">],</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"infer"</span><span class="p">)</span>
<span class="gh">Out[51]: </span><span class="go">DatetimeIndex(['2018-01-01', '2018-01-03', '2018-01-05'], dtype='datetime64[ns]', freq='2D')</span>
</pre></div>
</div>
<section id="providing-a-format-argument">
<span id="timeseries-converting-format"></span><h3>提供 <code class="docutils literal notranslate"><span class="pre">format</span></code> 参数<a class="headerlink" href="timeseries.html#providing-a-format-argument" title="Link to this heading">#</a></h3>
<p>除了必需的日期时间字符串外，还可以传入 <code class="docutils literal notranslate"><span class="pre">format</span></code> 参数以确保特定的解析。这也可以显著加快转换速度。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [52]: </span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s2">"2010/11/12"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">"%Y/%m/</span><span class="si">%d</span><span class="s2">"</span><span class="p">)</span>
<span class="gh">Out[52]: </span><span class="go">Timestamp('2010-11-12 00:00:00')</span>

<span class="gp">In [53]: </span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s2">"12-11-2010 00:00"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">"</span><span class="si">%d</span><span class="s2">-%m-%Y %H:%M"</span><span class="p">)</span>
<span class="gh">Out[53]: </span><span class="go">Timestamp('2010-11-12 00:00:00')</span>
</pre></div>
</div>
<p>有关指定 <code class="docutils literal notranslate"><span class="pre">format</span></code> 选项时可用的更多选择，请参阅 Python <a class="reference external" href="https://docs.pythonlang.cn/3/library/datetime.html#strftime-and-strptime-behavior">datetime 文档</a>。</p>
</section>
<section id="assembling-datetime-from-multiple-dataframe-columns">
<h3>从多个 DataFrame 列组装日期时间<a class="headerlink" href="timeseries.html#assembling-datetime-from-multiple-dataframe-columns" title="Link to this heading">#</a></h3>
<p>您还可以传入一个整数或字符串列的 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>，将其组装成一个 <code class="docutils literal notranslate"><span class="pre">Timestamps</span></code> 的 <code class="docutils literal notranslate"><span class="pre">Series</span></code>。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [54]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<span class="gp">   ....: </span>    <span class="p">{</span><span class="s2">"year"</span><span class="p">:</span> <span class="p">[</span><span class="mi">2015</span><span class="p">,</span> <span class="mi">2016</span><span class="p">],</span> <span class="s2">"month"</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="s2">"day"</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="s2">"hour"</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]}</span>
<span class="gp">   ....: </span><span class="p">)</span>
<span class="gp">   ....: </span>

<span class="gp">In [55]: </span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="gh">Out[55]: </span>
<span class="go">0   2015-02-04 02:00:00</span>
<span class="go">1   2016-03-05 03:00:00</span>
<span class="go">dtype: datetime64[ns]</span>
</pre></div>
</div>
<p>您可以只传递需要组装的列。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [56]: </span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s2">"year"</span><span class="p">,</span> <span class="s2">"month"</span><span class="p">,</span> <span class="s2">"day"</span><span class="p">]])</span>
<span class="gh">Out[56]: </span>
<span class="go">0   2015-02-04</span>
<span class="go">1   2016-03-05</span>
<span class="go">dtype: datetime64[ns]</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">pd.to_datetime</span></code> 在列名中查找日期时间组件的标准名称，包括：</p>
<ul class="simple">
<li><p>必需项：<code class="docutils literal notranslate"><span class="pre">year</span></code>, <code class="docutils literal notranslate"><span class="pre">month</span></code>, <code class="docutils literal notranslate"><span class="pre">day</span></code></p></li>
<li><p>可选项：<code class="docutils literal notranslate"><span class="pre">hour</span></code>, <code class="docutils literal notranslate"><span class="pre">minute</span></code>, <code class="docutils literal notranslate"><span class="pre">second</span></code>, <code class="docutils literal notranslate"><span class="pre">millisecond</span></code>, <code class="docutils literal notranslate"><span class="pre">microsecond</span></code>, <code class="docutils literal notranslate"><span class="pre">nanosecond</span></code></p></li>
</ul>
</section>
<section id="invalid-data">
<h3>无效数据<a class="headerlink" href="timeseries.html#invalid-data" title="Link to this heading">#</a></h3>
<p>默认行为 <code class="docutils literal notranslate"><span class="pre">errors='raise'</span></code> 是在无法解析时引发错误。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [57]: </span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">([</span><span class="s1">'2009/07/31'</span><span class="p">,</span> <span class="s1">'asd'</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">'raise'</span><span class="p">)</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ValueError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">57</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">([</span><span class="s1">'2009/07/31'</span><span class="p">,</span> <span class="s1">'asd'</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">'raise'</span><span class="p">)</span>

<span class="nn">File ~/work/pandas/pandas/pandas/core/tools/datetimes.py:1104,</span> in <span class="ni">to_datetime</span><span class="nt">(arg, errors, dayfirst, yearfirst, utc, format, exact, unit, infer_datetime_format, origin, cache)</span>
<span class="g g-Whitespace">   </span><span class="mi">1102</span>         <span class="n">result</span> <span class="o">=</span> <span class="n">_convert_and_box_cache</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">cache_array</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1103</span>     <span class="k">else</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">1104</span>         <span class="n">result</span> <span class="o">=</span> <span class="n">convert_listlike</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="nb">format</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1105</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1106</span>     <span class="n">result</span> <span class="o">=</span> <span class="n">convert_listlike</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">arg</span><span class="p">]),</span> <span class="nb">format</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="nn">File ~/work/pandas/pandas/pandas/core/tools/datetimes.py:435,</span> in <span class="ni">_convert_listlike_datetimes</span><span class="nt">(arg, format, name, utc, unit, errors, dayfirst, yearfirst, exact)</span>
<span class="g g-Whitespace">    </span><span class="mi">433</span> <span class="c1"># `format` could be inferred, or user didn't ask for mixed-format parsing.</span>
<span class="g g-Whitespace">    </span><span class="mi">434</span> <span class="k">if</span> <span class="nb">format</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">format</span> <span class="o">!=</span> <span class="s2">"mixed"</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">435</span>     <span class="k">return</span> <span class="n">_array_strptime_with_fallback</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">utc</span><span class="p">,</span> <span class="nb">format</span><span class="p">,</span> <span class="n">exact</span><span class="p">,</span> <span class="n">errors</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">437</span> <span class="n">result</span><span class="p">,</span> <span class="n">tz_parsed</span> <span class="o">=</span> <span class="n">objects_to_datetime64</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">438</span>     <span class="n">arg</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">439</span>     <span class="n">dayfirst</span><span class="o">=</span><span class="n">dayfirst</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">443</span>     <span class="n">allow_object</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">444</span> <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">446</span> <span class="k">if</span> <span class="n">tz_parsed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">447</span>     <span class="c1"># We can take a shortcut since the datetime64 numpy array</span>
<span class="g g-Whitespace">    </span><span class="mi">448</span>     <span class="c1"># is in UTC</span>

<span class="nn">File ~/work/pandas/pandas/pandas/core/tools/datetimes.py:469,</span> in <span class="ni">_array_strptime_with_fallback</span><span class="nt">(arg, name, utc, fmt, exact, errors)</span>
<span class="g g-Whitespace">    </span><span class="mi">458</span> <span class="k">def</span><span class="w"> </span><span class="nf">_array_strptime_with_fallback</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">459</span>     <span class="n">arg</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">460</span>     <span class="n">name</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">464</span>     <span class="n">errors</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">465</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Index</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">466</span><span class="w">     </span><span class="sd">"""</span>
<span class="g g-Whitespace">    </span><span class="mi">467</span><span class="sd">     Call array_strptime, with fallback behavior depending on 'errors'.</span>
<span class="g g-Whitespace">    </span><span class="mi">468</span><span class="sd">     """</span>
<span class="ne">--&gt; </span><span class="mi">469</span>     <span class="n">result</span><span class="p">,</span> <span class="n">tz_out</span> <span class="o">=</span> <span class="n">array_strptime</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">exact</span><span class="o">=</span><span class="n">exact</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">,</span> <span class="n">utc</span><span class="o">=</span><span class="n">utc</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">470</span>     <span class="k">if</span> <span class="n">tz_out</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">471</span>         <span class="n">unit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime_data</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">dtype</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="nn">File ~/work/pandas/pandas/pandas/_libs/tslibs/strptime.pyx:501,</span> in <span class="ni">pandas._libs.tslibs.strptime.array_strptime</span><span class="nt">()</span>

<span class="nn">File ~/work/pandas/pandas/pandas/_libs/tslibs/strptime.pyx:451,</span> in <span class="ni">pandas._libs.tslibs.strptime.array_strptime</span><span class="nt">()</span>

<span class="nn">File ~/work/pandas/pandas/pandas/_libs/tslibs/strptime.pyx:583,</span> in <span class="ni">pandas._libs.tslibs.strptime._parse_with_format</span><span class="nt">()</span>

<span class="ne">ValueError</span>: time data "asd" doesn't match format "%Y/%m/%d", at position 1. You might want to try:
    <span class="o">-</span> <span class="n">passing</span> <span class="err">`</span><span class="nb">format</span><span class="err">`</span> <span class="k">if</span> <span class="n">your</span> <span class="n">strings</span> <span class="n">have</span> <span class="n">a</span> <span class="n">consistent</span> <span class="nb">format</span><span class="p">;</span>
    <span class="o">-</span> <span class="n">passing</span> <span class="err">`</span><span class="nb">format</span><span class="o">=</span><span class="s1">'ISO8601'</span><span class="err">`</span> <span class="k">if</span> <span class="n">your</span> <span class="n">strings</span> <span class="n">are</span> <span class="nb">all</span> <span class="n">ISO8601</span> <span class="n">but</span> <span class="ow">not</span> <span class="n">necessarily</span> <span class="ow">in</span> <span class="n">exactly</span> <span class="n">the</span> <span class="n">same</span> <span class="nb">format</span><span class="p">;</span>
    <span class="o">-</span> <span class="n">passing</span> <span class="err">`</span><span class="nb">format</span><span class="o">=</span><span class="s1">'mixed'</span><span class="err">`</span><span class="p">,</span> <span class="ow">and</span> <span class="n">the</span> <span class="nb">format</span> <span class="n">will</span> <span class="n">be</span> <span class="n">inferred</span> <span class="k">for</span> <span class="n">each</span> <span class="n">element</span> <span class="n">individually</span><span class="o">.</span> <span class="n">You</span> <span class="n">might</span> <span class="n">want</span> <span class="n">to</span> <span class="n">use</span> <span class="err">`</span><span class="n">dayfirst</span><span class="err">`</span> <span class="n">alongside</span> <span class="n">this</span><span class="o">.</span>
</pre></div>
</div>
<p>传入 <code class="docutils literal notranslate"><span class="pre">errors='coerce'</span></code> 将无法解析的数据转换为 <code class="docutils literal notranslate"><span class="pre">NaT</span></code> (不是时间) 。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [58]: </span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">([</span><span class="s2">"2009/07/31"</span><span class="p">,</span> <span class="s2">"asd"</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s2">"coerce"</span><span class="p">)</span>
<span class="gh">Out[58]: </span><span class="go">DatetimeIndex(['2009-07-31', 'NaT'], dtype='datetime64[ns]', freq=None)</span>
</pre></div>
</div>
</section>
<section id="epoch-timestamps">
<span id="timeseries-converting-epoch"></span><h3>纪元时间戳<a class="headerlink" href="timeseries.html#epoch-timestamps" title="Link to this heading">#</a></h3>
<p>pandas 支持将整数或浮点纪元时间转换为 <code class="docutils literal notranslate"><span class="pre">Timestamp</span></code> 和 <code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code>。默认单位是纳秒，因为 <code class="docutils literal notranslate"><span class="pre">Timestamp</span></code> 对象在内部就是以纳秒存储的。然而，纪元时间通常以另一种 <code class="docutils literal notranslate"><span class="pre">unit</span></code> 存储，可以指定该单位。这些值是从 <code class="docutils literal notranslate"><span class="pre">origin</span></code> 参数指定的起点计算得出的。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [59]: </span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span>
<span class="gp">   ....: </span>    <span class="p">[</span><span class="mi">1349720105</span><span class="p">,</span> <span class="mi">1349806505</span><span class="p">,</span> <span class="mi">1349892905</span><span class="p">,</span> <span class="mi">1349979305</span><span class="p">,</span> <span class="mi">1350065705</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="s2">"s"</span>
<span class="gp">   ....: </span><span class="p">)</span>
<span class="gp">   ....: </span>
<span class="gh">Out[59]: </span>
<span class="go">DatetimeIndex(['2012-10-08 18:15:05', '2012-10-09 18:15:05',</span>
<span class="go">               '2012-10-10 18:15:05', '2012-10-11 18:15:05',</span>
<span class="go">               '2012-10-12 18:15:05'],</span>
<span class="go">              dtype='datetime64[ns]', freq=None)</span>

<span class="gp">In [60]: </span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span>
<span class="gp">   ....: </span>    <span class="p">[</span><span class="mi">1349720105100</span><span class="p">,</span> <span class="mi">1349720105200</span><span class="p">,</span> <span class="mi">1349720105300</span><span class="p">,</span> <span class="mi">1349720105400</span><span class="p">,</span> <span class="mi">1349720105500</span><span class="p">],</span>
<span class="gp">   ....: </span>    <span class="n">unit</span><span class="o">=</span><span class="s2">"ms"</span><span class="p">,</span>
<span class="gp">   ....: </span><span class="p">)</span>
<span class="gp">   ....: </span>
<span class="gh">Out[60]: </span>
<span class="go">DatetimeIndex(['2012-10-08 18:15:05.100000', '2012-10-08 18:15:05.200000',</span>
<span class="go">               '2012-10-08 18:15:05.300000', '2012-10-08 18:15:05.400000',</span>
<span class="go">               '2012-10-08 18:15:05.500000'],</span>
<span class="go">              dtype='datetime64[ns]', freq=None)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p><code class="docutils literal notranslate"><span class="pre">unit</span></code> 参数不使用与 <a class="reference internal" href="timeseries.html#timeseries-converting-format"><span class="std std-ref">上面</span></a> 讨论的 <code class="docutils literal notranslate"><span class="pre">format</span></code> 参数相同的字符串。可用的单位列在 <a class="reference internal" href="../reference/api/pandas.to_datetime.html#pandas.to_datetime" title="pandas.to_datetime"><code class="xref py py-func docutils literal notranslate"><span class="pre">pandas.to_datetime()</span></code></a> 的文档中。</p>
</div>
<p>使用指定 <code class="docutils literal notranslate"><span class="pre">tz</span></code> 参数的纪元时间戳来构造 <a class="reference internal" href="../reference/api/pandas.Timestamp.html#pandas.Timestamp" title="pandas.Timestamp"><code class="xref py py-class docutils literal notranslate"><span class="pre">Timestamp</span></code></a> 或 <a class="reference internal" href="../reference/api/pandas.DatetimeIndex.html#pandas.DatetimeIndex" title="pandas.DatetimeIndex"><code class="xref py py-class docutils literal notranslate"><span class="pre">DatetimeIndex</span></code></a> 将引发 ValueError。如果您的纪元时间是在另一个时区的本地时间，您可以将纪元时间读取为不带时区的时间戳，然后将其本地化到适当的时区。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [61]: </span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="mi">1262347200000000000</span><span class="p">)</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="s2">"US/Pacific"</span><span class="p">)</span>
<span class="gh">Out[61]: </span><span class="go">Timestamp('2010-01-01 12:00:00-0800', tz='US/Pacific')</span>

<span class="gp">In [62]: </span><span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">([</span><span class="mi">1262347200000000000</span><span class="p">])</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="s2">"US/Pacific"</span><span class="p">)</span>
<span class="gh">Out[62]: </span><span class="go">DatetimeIndex(['2010-01-01 12:00:00-08:00'], dtype='datetime64[ns, US/Pacific]', freq=None)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p>纪元时间将四舍五入到最近的纳秒。</p>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>浮点纪元时间的转换可能导致不准确和意外的结果。<a class="reference external" href="https://docs.pythonlang.cn/3/tutorial/floatingpoint.html#tut-fp-issues" title="(in Python v3.13)"><span class="xref std std-ref">Python 浮点数</span></a>在十进制中约有 15 位精度。从浮点数转换为高精度 <code class="docutils literal notranslate"><span class="pre">Timestamp</span></code> 时的四舍五入是不可避免的。实现精确精度的唯一方法是使用固定宽度类型（例如 int64）。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [63]: </span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">([</span><span class="mf">1490195805.433</span><span class="p">,</span> <span class="mf">1490195805.433502912</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="s2">"s"</span><span class="p">)</span>
<span class="gh">Out[63]: </span><span class="go">DatetimeIndex(['2017-03-22 15:16:45.433000088', '2017-03-22 15:16:45.433502913'], dtype='datetime64[ns]', freq=None)</span>

<span class="gp">In [64]: </span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="mi">1490195805433502912</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">"ns"</span><span class="p">)</span>
<span class="gh">Out[64]: </span><span class="go">Timestamp('2017-03-22 15:16:45.433502912')</span>
</pre></div>
</div>
</div>
<div class="admonition seealso">
<p class="admonition-title">另请参阅</p>
<p><a class="reference internal" href="timeseries.html#timeseries-origin"><span class="std std-ref">使用 origin 参数</span></a></p>
</div>
</section>
<section id="from-timestamps-to-epoch">
<span id="timeseries-converting-epoch-inverse"></span><h3>从时间戳到纪元时间<a class="headerlink" href="timeseries.html#from-timestamps-to-epoch" title="Link to this heading">#</a></h3>
<p>要反转上面的操作，即将 <code class="docutils literal notranslate"><span class="pre">Timestamp</span></code> 转换为“Unix”纪元时间：</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [65]: </span><span class="n">stamps</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">"2012-10-08 18:15:05"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"D"</span><span class="p">)</span>

<span class="gp">In [66]: </span><span class="n">stamps</span>
<span class="gh">Out[66]: </span>
<span class="go">DatetimeIndex(['2012-10-08 18:15:05', '2012-10-09 18:15:05',</span>
<span class="go">               '2012-10-10 18:15:05', '2012-10-11 18:15:05'],</span>
<span class="go">              dtype='datetime64[ns]', freq='D')</span>
</pre></div>
</div>
<p>我们减去纪元（1970 年 1 月 1 日 UTC 午夜），然后对“单位”（1 秒）进行向下取整的除法。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [67]: </span><span class="p">(</span><span class="n">stamps</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">"1970-01-01"</span><span class="p">))</span> <span class="o">//</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="s2">"1s"</span><span class="p">)</span>
<span class="gh">Out[67]: </span><span class="go">Index([1349720105, 1349806505, 1349892905, 1349979305], dtype='int64')</span>
</pre></div>
</div>
</section>
<section id="using-the-origin-parameter">
<span id="timeseries-origin"></span><h3>使用 <code class="docutils literal notranslate"><span class="pre">origin</span></code> 参数<a class="headerlink" href="timeseries.html#using-the-origin-parameter" title="Link to this heading">#</a></h3>
<p>使用 <code class="docutils literal notranslate"><span class="pre">origin</span></code> 参数，可以指定创建 <code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code> 的替代起点。例如，使用 1960-01-01 作为起始日期：</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [68]: </span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="s2">"D"</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">"1960-01-01"</span><span class="p">))</span>
<span class="gh">Out[68]: </span><span class="go">DatetimeIndex(['1960-01-02', '1960-01-03', '1960-01-04'], dtype='datetime64[ns]', freq=None)</span>
</pre></div>
</div>
<p>默认设置为 <code class="docutils literal notranslate"><span class="pre">origin='unix'</span></code>，默认为 <code class="docutils literal notranslate"><span class="pre">1970-01-01</span> <span class="pre">00:00:00</span></code>。通常称为“Unix 纪元”或 POSIX 时间。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [69]: </span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="s2">"D"</span><span class="p">)</span>
<span class="gh">Out[69]: </span><span class="go">DatetimeIndex(['1970-01-02', '1970-01-03', '1970-01-04'], dtype='datetime64[ns]', freq=None)</span>
</pre></div>
</div>
</section>
</section>
<section id="generating-ranges-of-timestamps">
<span id="timeseries-daterange"></span><h2>生成时间戳范围<a class="headerlink" href="timeseries.html#generating-ranges-of-timestamps" title="Link to this heading">#</a></h2>
<p>要生成包含时间戳的索引，可以使用 <code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code> 或 <code class="docutils literal notranslate"><span class="pre">Index</span></code> 构造函数，并传入日期时间对象列表。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [70]: </span><span class="n">dates</span> <span class="o">=</span> <span class="p">[</span>
<span class="gp">   ....: </span>    <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
<span class="gp">   ....: </span>    <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
<span class="gp">   ....: </span>    <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
<span class="gp">   ....: </span><span class="p">]</span>
<span class="gp">   ....: </span>

<span class="go"># Note the frequency information</span>
<span class="gp">In [71]: </span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">(</span><span class="n">dates</span><span class="p">)</span>

<span class="gp">In [72]: </span><span class="n">index</span>
<span class="gh">Out[72]: </span><span class="go">DatetimeIndex(['2012-05-01', '2012-05-02', '2012-05-03'], dtype='datetime64[ns]', freq=None)</span>

<span class="go"># Automatically converted to DatetimeIndex</span>
<span class="gp">In [73]: </span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="n">dates</span><span class="p">)</span>

<span class="gp">In [74]: </span><span class="n">index</span>
<span class="gh">Out[74]: </span><span class="go">DatetimeIndex(['2012-05-01', '2012-05-02', '2012-05-03'], dtype='datetime64[ns]', freq=None)</span>
</pre></div>
</div>
<p>在实践中，这会变得非常麻烦，因为我们通常需要一个非常长的索引，其中包含大量时间戳。如果我们需要定期频率的时间戳，我们可以使用 <a class="reference internal" href="../reference/api/pandas.date_range.html#pandas.date_range" title="pandas.date_range"><code class="xref py py-func docutils literal notranslate"><span class="pre">date_range()</span></code></a> 和 <a class="reference internal" href="../reference/api/pandas.bdate_range.html#pandas.bdate_range" title="pandas.bdate_range"><code class="xref py py-func docutils literal notranslate"><span class="pre">bdate_range()</span></code></a> 函数来创建 <code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code>。 <code class="docutils literal notranslate"><span class="pre">date_range</span></code> 的默认频率是<strong>日历日</strong>，而 <code class="docutils literal notranslate"><span class="pre">bdate_range</span></code> 的默认频率是<strong>工作日</strong>。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [75]: </span><span class="n">start</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2011</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="gp">In [76]: </span><span class="n">end</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="gp">In [77]: </span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>

<span class="gp">In [78]: </span><span class="n">index</span>
<span class="gh">Out[78]: </span>
<span class="go">DatetimeIndex(['2011-01-01', '2011-01-02', '2011-01-03', '2011-01-04',</span>
<span class="go">               '2011-01-05', '2011-01-06', '2011-01-07', '2011-01-08',</span>
<span class="go">               '2011-01-09', '2011-01-10',</span>
<span class="go">               ...</span>
<span class="go">               '2011-12-23', '2011-12-24', '2011-12-25', '2011-12-26',</span>
<span class="go">               '2011-12-27', '2011-12-28', '2011-12-29', '2011-12-30',</span>
<span class="go">               '2011-12-31', '2012-01-01'],</span>
<span class="go">              dtype='datetime64[ns]', length=366, freq='D')</span>

<span class="gp">In [79]: </span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">bdate_range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>

<span class="gp">In [80]: </span><span class="n">index</span>
<span class="gh">Out[80]: </span>
<span class="go">DatetimeIndex(['2011-01-03', '2011-01-04', '2011-01-05', '2011-01-06',</span>
<span class="go">               '2011-01-07', '2011-01-10', '2011-01-11', '2011-01-12',</span>
<span class="go">               '2011-01-13', '2011-01-14',</span>
<span class="go">               ...</span>
<span class="go">               '2011-12-19', '2011-12-20', '2011-12-21', '2011-12-22',</span>
<span class="go">               '2011-12-23', '2011-12-26', '2011-12-27', '2011-12-28',</span>
<span class="go">               '2011-12-29', '2011-12-30'],</span>
<span class="go">              dtype='datetime64[ns]', length=260, freq='B')</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">date_range</span></code> 和 <code class="docutils literal notranslate"><span class="pre">bdate_range</span></code> 等便捷函数可以使用各种 <a class="reference internal" href="timeseries.html#timeseries-offset-aliases"><span class="std std-ref">频率别名</span></a>。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [81]: </span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"ME"</span><span class="p">)</span>
<span class="gh">Out[81]: </span>
<span class="go">DatetimeIndex(['2011-01-31', '2011-02-28', '2011-03-31', '2011-04-30',</span>
<span class="go">               '2011-05-31', '2011-06-30', '2011-07-31', '2011-08-31',</span>
<span class="go">               '2011-09-30', '2011-10-31',</span>
<span class="go">               ...</span>
<span class="go">               '2093-07-31', '2093-08-31', '2093-09-30', '2093-10-31',</span>
<span class="go">               '2093-11-30', '2093-12-31', '2094-01-31', '2094-02-28',</span>
<span class="go">               '2094-03-31', '2094-04-30'],</span>
<span class="go">              dtype='datetime64[ns]', length=1000, freq='ME')</span>

<span class="gp">In [82]: </span><span class="n">pd</span><span class="o">.</span><span class="n">bdate_range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"BQS"</span><span class="p">)</span>
<span class="gh">Out[82]: </span>
<span class="go">DatetimeIndex(['2011-01-03', '2011-04-01', '2011-07-01', '2011-10-03',</span>
<span class="go">               '2012-01-02', '2012-04-02', '2012-07-02', '2012-10-01',</span>
<span class="go">               '2013-01-01', '2013-04-01',</span>
<span class="go">               ...</span>
<span class="go">               '2071-01-01', '2071-04-01', '2071-07-01', '2071-10-01',</span>
<span class="go">               '2072-01-01', '2072-04-01', '2072-07-01', '2072-10-03',</span>
<span class="go">               '2073-01-02', '2073-04-03'],</span>
<span class="go">              dtype='datetime64[ns]', length=250, freq='BQS-JAN')</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">date_range</span></code> 和 <code class="docutils literal notranslate"><span class="pre">bdate_range</span></code> 使使用 <code class="docutils literal notranslate"><span class="pre">start</span></code>、<code class="docutils literal notranslate"><span class="pre">end</span></code>、<code class="docutils literal notranslate"><span class="pre">periods</span></code> 和 <code class="docutils literal notranslate"><span class="pre">freq</span></code> 等参数的各种组合轻松生成日期范围。起始和结束日期是严格包含的，因此不会生成超出指定范围的日期。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [83]: </span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"BME"</span><span class="p">)</span>
<span class="gh">Out[83]: </span>
<span class="go">DatetimeIndex(['2011-01-31', '2011-02-28', '2011-03-31', '2011-04-29',</span>
<span class="go">               '2011-05-31', '2011-06-30', '2011-07-29', '2011-08-31',</span>
<span class="go">               '2011-09-30', '2011-10-31', '2011-11-30', '2011-12-30'],</span>
<span class="go">              dtype='datetime64[ns]', freq='BME')</span>

<span class="gp">In [84]: </span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"W"</span><span class="p">)</span>
<span class="gh">Out[84]: </span>
<span class="go">DatetimeIndex(['2011-01-02', '2011-01-09', '2011-01-16', '2011-01-23',</span>
<span class="go">               '2011-01-30', '2011-02-06', '2011-02-13', '2011-02-20',</span>
<span class="go">               '2011-02-27', '2011-03-06', '2011-03-13', '2011-03-20',</span>
<span class="go">               '2011-03-27', '2011-04-03', '2011-04-10', '2011-04-17',</span>
<span class="go">               '2011-04-24', '2011-05-01', '2011-05-08', '2011-05-15',</span>
<span class="go">               '2011-05-22', '2011-05-29', '2011-06-05', '2011-06-12',</span>
<span class="go">               '2011-06-19', '2011-06-26', '2011-07-03', '2011-07-10',</span>
<span class="go">               '2011-07-17', '2011-07-24', '2011-07-31', '2011-08-07',</span>
<span class="go">               '2011-08-14', '2011-08-21', '2011-08-28', '2011-09-04',</span>
<span class="go">               '2011-09-11', '2011-09-18', '2011-09-25', '2011-10-02',</span>
<span class="go">               '2011-10-09', '2011-10-16', '2011-10-23', '2011-10-30',</span>
<span class="go">               '2011-11-06', '2011-11-13', '2011-11-20', '2011-11-27',</span>
<span class="go">               '2011-12-04', '2011-12-11', '2011-12-18', '2011-12-25',</span>
<span class="go">               '2012-01-01'],</span>
<span class="go">              dtype='datetime64[ns]', freq='W-SUN')</span>

<span class="gp">In [85]: </span><span class="n">pd</span><span class="o">.</span><span class="n">bdate_range</span><span class="p">(</span><span class="n">end</span><span class="o">=</span><span class="n">end</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="gh">Out[85]: </span>
<span class="go">DatetimeIndex(['2011-12-05', '2011-12-06', '2011-12-07', '2011-12-08',</span>
<span class="go">               '2011-12-09', '2011-12-12', '2011-12-13', '2011-12-14',</span>
<span class="go">               '2011-12-15', '2011-12-16', '2011-12-19', '2011-12-20',</span>
<span class="go">               '2011-12-21', '2011-12-22', '2011-12-23', '2011-12-26',</span>
<span class="go">               '2011-12-27', '2011-12-28', '2011-12-29', '2011-12-30'],</span>
<span class="go">              dtype='datetime64[ns]', freq='B')</span>

<span class="gp">In [86]: </span><span class="n">pd</span><span class="o">.</span><span class="n">bdate_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="gh">Out[86]: </span>
<span class="go">DatetimeIndex(['2011-01-03', '2011-01-04', '2011-01-05', '2011-01-06',</span>
<span class="go">               '2011-01-07', '2011-01-10', '2011-01-11', '2011-01-12',</span>
<span class="go">               '2011-01-13', '2011-01-14', '2011-01-17', '2011-01-18',</span>
<span class="go">               '2011-01-19', '2011-01-20', '2011-01-21', '2011-01-24',</span>
<span class="go">               '2011-01-25', '2011-01-26', '2011-01-27', '2011-01-28'],</span>
<span class="go">              dtype='datetime64[ns]', freq='B')</span>
</pre></div>
</div>
<p>指定 <code class="docutils literal notranslate"><span class="pre">start</span></code>、<code class="docutils literal notranslate"><span class="pre">end</span></code> 和 <code class="docutils literal notranslate"><span class="pre">periods</span></code> 将生成一个从 <code class="docutils literal notranslate"><span class="pre">start</span></code> 到 <code class="docutils literal notranslate"><span class="pre">end</span></code>（包含）均匀间隔的日期范围，结果 <code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code> 中有 <code class="docutils literal notranslate"><span class="pre">periods</span></code> 个元素。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [87]: </span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">"2018-01-01"</span><span class="p">,</span> <span class="s2">"2018-01-05"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="gh">Out[87]: </span>
<span class="go">DatetimeIndex(['2018-01-01', '2018-01-02', '2018-01-03', '2018-01-04',</span>
<span class="go">               '2018-01-05'],</span>
<span class="go">              dtype='datetime64[ns]', freq=None)</span>

<span class="gp">In [88]: </span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">"2018-01-01"</span><span class="p">,</span> <span class="s2">"2018-01-05"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="gh">Out[88]: </span>
<span class="go">DatetimeIndex(['2018-01-01 00:00:00', '2018-01-01 10:40:00',</span>
<span class="go">               '2018-01-01 21:20:00', '2018-01-02 08:00:00',</span>
<span class="go">               '2018-01-02 18:40:00', '2018-01-03 05:20:00',</span>
<span class="go">               '2018-01-03 16:00:00', '2018-01-04 02:40:00',</span>
<span class="go">               '2018-01-04 13:20:00', '2018-01-05 00:00:00'],</span>
<span class="go">              dtype='datetime64[ns]', freq=None)</span>
</pre></div>
</div>
<section id="custom-frequency-ranges">
<span id="timeseries-custom-freq-ranges"></span><h3>自定义频率范围<a class="headerlink" href="timeseries.html#custom-frequency-ranges" title="Link to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">bdate_range</span></code> 还可以通过使用 <code class="docutils literal notranslate"><span class="pre">weekmask</span></code> 和 <code class="docutils literal notranslate"><span class="pre">holidays</span></code> 参数生成自定义频率日期范围。这些参数仅在传递自定义频率字符串时使用。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [89]: </span><span class="n">weekmask</span> <span class="o">=</span> <span class="s2">"Mon Wed Fri"</span>

<span class="gp">In [90]: </span><span class="n">holidays</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2011</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2011</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">14</span><span class="p">)]</span>

<span class="gp">In [91]: </span><span class="n">pd</span><span class="o">.</span><span class="n">bdate_range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"C"</span><span class="p">,</span> <span class="n">weekmask</span><span class="o">=</span><span class="n">weekmask</span><span class="p">,</span> <span class="n">holidays</span><span class="o">=</span><span class="n">holidays</span><span class="p">)</span>
<span class="gh">Out[91]: </span>
<span class="go">DatetimeIndex(['2011-01-03', '2011-01-07', '2011-01-10', '2011-01-12',</span>
<span class="go">               '2011-01-14', '2011-01-17', '2011-01-19', '2011-01-21',</span>
<span class="go">               '2011-01-24', '2011-01-26',</span>
<span class="go">               ...</span>
<span class="go">               '2011-12-09', '2011-12-12', '2011-12-14', '2011-12-16',</span>
<span class="go">               '2011-12-19', '2011-12-21', '2011-12-23', '2011-12-26',</span>
<span class="go">               '2011-12-28', '2011-12-30'],</span>
<span class="go">              dtype='datetime64[ns]', length=154, freq='C')</span>

<span class="gp">In [92]: </span><span class="n">pd</span><span class="o">.</span><span class="n">bdate_range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"CBMS"</span><span class="p">,</span> <span class="n">weekmask</span><span class="o">=</span><span class="n">weekmask</span><span class="p">)</span>
<span class="gh">Out[92]: </span>
<span class="go">DatetimeIndex(['2011-01-03', '2011-02-02', '2011-03-02', '2011-04-01',</span>
<span class="go">               '2011-05-02', '2011-06-01', '2011-07-01', '2011-08-01',</span>
<span class="go">               '2011-09-02', '2011-10-03', '2011-11-02', '2011-12-02'],</span>
<span class="go">              dtype='datetime64[ns]', freq='CBMS')</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">另请参阅</p>
<p><a class="reference internal" href="timeseries.html#timeseries-custombusinessdays"><span class="std std-ref">自定义工作日</span></a></p>
</div>
</section>
</section>
<section id="timestamp-limitations">
<span id="timeseries-timestamp-limits"></span><h2>时间戳限制<a class="headerlink" href="timeseries.html#timestamp-limitations" title="Link to this heading">#</a></h2>
<p>时间戳表示的限制取决于所选择的分辨率。对于纳秒分辨率，使用 64 位整数可以表示的时间跨度限制在大约 584 年。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [93]: </span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="o">.</span><span class="n">min</span>
<span class="gh">Out[93]: </span><span class="go">Timestamp('1677-09-21 00:12:43.145224193')</span>

<span class="gp">In [94]: </span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="o">.</span><span class="n">max</span>
<span class="gh">Out[94]: </span><span class="go">Timestamp('2262-04-11 23:47:16.854775807')</span>
</pre></div>
</div>
<p>选择秒分辨率时，可用范围增加到 <code class="docutils literal notranslate"><span class="pre">+/-</span> <span class="pre">2.9e11</span> <span class="pre">年</span></code>。不同的分辨率可以通过 <code class="docutils literal notranslate"><span class="pre">as_unit</span></code> 相互转换。</p>
<div class="admonition seealso">
<p class="admonition-title">另请参阅</p>
<p><a class="reference internal" href="timeseries.html#timeseries-oob"><span class="std std-ref">表示超出范围的跨度</span></a></p>
</div>
</section>
<section id="indexing">
<span id="timeseries-datetimeindex"></span><h2>索引<a class="headerlink" href="timeseries.html#indexing" title="Link to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code> 的主要用途之一是作为 pandas 对象的索引。<code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code> 类包含许多时间序列相关的优化：</p>
<ul class="simple">
<li><p>为了使后续日期范围的生成非常快（只需获取一个切片），各种偏移量的大量日期都会在底层预先计算和缓存。</p></li>
<li><p>使用 pandas 对象上的 <code class="docutils literal notranslate"><span class="pre">shift</span></code> 方法进行快速移动。</p></li>
<li><p>具有相同频率的重叠 <code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code> 对象的并集速度非常快（对于快速数据对齐很重要）。</p></li>
<li><p>通过 <code class="docutils literal notranslate"><span class="pre">year</span></code>、<code class="docutils literal notranslate"><span class="pre">month</span></code> 等属性快速访问日期字段。</p></li>
<li><p>正则化函数如 <code class="docutils literal notranslate"><span class="pre">snap</span></code> 和非常快的 <code class="docutils literal notranslate"><span class="pre">asof</span></code> 逻辑。</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code> 对象具有常规 <code class="docutils literal notranslate"><span class="pre">Index</span></code> 对象的所有基本功能，以及大量高级时间序列特定方法，可轻松进行频率处理。</p>
<div class="admonition seealso">
<p class="admonition-title">另请参阅</p>
<p><a class="reference internal" href="basics.html#basics-reindexing"><span class="std std-ref">重新索引方法</span></a></p>
</div>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p>虽然 pandas 不强制您拥有排序的日期索引，但如果日期未排序，其中一些方法的行为可能会出现意外或不正确。</p>
</div>
<p><code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code> 可以像常规索引一样使用，并提供其所有智能功能，如选择、切片等。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [95]: </span><span class="n">rng</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"BME"</span><span class="p">)</span>

<span class="gp">In [96]: </span><span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rng</span><span class="p">)),</span> <span class="n">index</span><span class="o">=</span><span class="n">rng</span><span class="p">)</span>

<span class="gp">In [97]: </span><span class="n">ts</span><span class="o">.</span><span class="n">index</span>
<span class="gh">Out[97]: </span>
<span class="go">DatetimeIndex(['2011-01-31', '2011-02-28', '2011-03-31', '2011-04-29',</span>
<span class="go">               '2011-05-31', '2011-06-30', '2011-07-29', '2011-08-31',</span>
<span class="go">               '2011-09-30', '2011-10-31', '2011-11-30', '2011-12-30'],</span>
<span class="go">              dtype='datetime64[ns]', freq='BME')</span>

<span class="gp">In [98]: </span><span class="n">ts</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
<span class="gh">Out[98]: </span>
<span class="go">DatetimeIndex(['2011-01-31', '2011-02-28', '2011-03-31', '2011-04-29',</span>
<span class="go">               '2011-05-31'],</span>
<span class="go">              dtype='datetime64[ns]', freq='BME')</span>

<span class="gp">In [99]: </span><span class="n">ts</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
<span class="gh">Out[99]: </span>
<span class="go">DatetimeIndex(['2011-01-31', '2011-03-31', '2011-05-31', '2011-07-29',</span>
<span class="go">               '2011-09-30', '2011-11-30'],</span>
<span class="go">              dtype='datetime64[ns]', freq='2BME')</span>
</pre></div>
</div>
<section id="partial-string-indexing">
<span id="timeseries-partialindexing"></span><h3>部分字符串索引<a class="headerlink" href="timeseries.html#partial-string-indexing" title="Link to this heading">#</a></h3>
<p>日期和解析为时间戳的字符串可以作为索引参数传入。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [100]: </span><span class="n">ts</span><span class="p">[</span><span class="s2">"1/31/2011"</span><span class="p">]</span>
<span class="gh">Out[100]: </span><span class="go">0.11920871129693428</span>

<span class="gp">In [101]: </span><span class="n">ts</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2011</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">25</span><span class="p">):]</span>
<span class="gh">Out[101]: </span>
<span class="go">2011-12-30    0.56702</span>
<span class="go">Freq: BME, dtype: float64</span>

<span class="gp">In [102]: </span><span class="n">ts</span><span class="p">[</span><span class="s2">"10/31/2011"</span><span class="p">:</span><span class="s2">"12/31/2011"</span><span class="p">]</span>
<span class="gh">Out[102]: </span>
<span class="go">2011-10-31    0.271860</span>
<span class="go">2011-11-30   -0.424972</span>
<span class="go">2011-12-30    0.567020</span>
<span class="go">Freq: BME, dtype: float64</span>
</pre></div>
</div>
<p>为了方便访问较长的时间序列，您也可以将年份或年份和月份作为字符串传入。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [103]: </span><span class="n">ts</span><span class="p">[</span><span class="s2">"2011"</span><span class="p">]</span>
<span class="gh">Out[103]: </span>
<span class="go">2011-01-31    0.119209</span>
<span class="go">2011-02-28   -1.044236</span>
<span class="go">2011-03-31   -0.861849</span>
<span class="go">2011-04-29   -2.104569</span>
<span class="go">2011-05-31   -0.494929</span>
<span class="go">2011-06-30    1.071804</span>
<span class="go">2011-07-29    0.721555</span>
<span class="go">2011-08-31   -0.706771</span>
<span class="go">2011-09-30   -1.039575</span>
<span class="go">2011-10-31    0.271860</span>
<span class="go">2011-11-30   -0.424972</span>
<span class="go">2011-12-30    0.567020</span>
<span class="go">Freq: BME, dtype: float64</span>

<span class="gp">In [104]: </span><span class="n">ts</span><span class="p">[</span><span class="s2">"2011-6"</span><span class="p">]</span>
<span class="gh">Out[104]: </span>
<span class="go">2011-06-30    1.071804</span>
<span class="go">Freq: BME, dtype: float64</span>
</pre></div>
</div>
<p>这种切片方式也适用于具有 <code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code> 的 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>。由于部分字符串选择是一种标签切片形式，因此端点将<strong>被包含</strong>。这将包括包含日期上的匹配时间。</p>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>从 pandas 1.2.0 开始，使用 getitem（例如 <code class="docutils literal notranslate"><span class="pre">frame[dtstring]</span></code>）通过一个字符串索引 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> 行已被弃用（考虑到是索引行还是选择列的歧义），并将在未来版本中移除。使用 <code class="docutils literal notranslate"><span class="pre">.loc</span></code> 的等效操作（例如 <code class="docutils literal notranslate"><span class="pre">frame.loc[dtstring]</span></code>）仍然支持。</p>
</div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [105]: </span><span class="n">dft</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">100000</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
<span class="gp">   .....: </span>    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"A"</span><span class="p">],</span>
<span class="gp">   .....: </span>    <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">"20130101"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">100000</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"min"</span><span class="p">),</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [106]: </span><span class="n">dft</span>
<span class="gh">Out[106]: </span>
<span class="go">                            A</span>
<span class="go">2013-01-01 00:00:00  0.276232</span>
<span class="go">2013-01-01 00:01:00 -1.087401</span>
<span class="go">2013-01-01 00:02:00 -0.673690</span>
<span class="go">2013-01-01 00:03:00  0.113648</span>
<span class="go">2013-01-01 00:04:00 -1.478427</span>
<span class="go">...                       ...</span>
<span class="go">2013-03-11 10:35:00 -0.747967</span>
<span class="go">2013-03-11 10:36:00 -0.034523</span>
<span class="go">2013-03-11 10:37:00 -0.201754</span>
<span class="go">2013-03-11 10:38:00 -1.509067</span>
<span class="go">2013-03-11 10:39:00 -1.693043</span>

<span class="go">[100000 rows x 1 columns]</span>

<span class="gp">In [107]: </span><span class="n">dft</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">"2013"</span><span class="p">]</span>
<span class="gh">Out[107]: </span>
<span class="go">                            A</span>
<span class="go">2013-01-01 00:00:00  0.276232</span>
<span class="go">2013-01-01 00:01:00 -1.087401</span>
<span class="go">2013-01-01 00:02:00 -0.673690</span>
<span class="go">2013-01-01 00:03:00  0.113648</span>
<span class="go">2013-01-01 00:04:00 -1.478427</span>
<span class="go">...                       ...</span>
<span class="go">2013-03-11 10:35:00 -0.747967</span>
<span class="go">2013-03-11 10:36:00 -0.034523</span>
<span class="go">2013-03-11 10:37:00 -0.201754</span>
<span class="go">2013-03-11 10:38:00 -1.509067</span>
<span class="go">2013-03-11 10:39:00 -1.693043</span>

<span class="go">[100000 rows x 1 columns]</span>
</pre></div>
</div>
<p>这从该月的第一个时间开始，并包括该月的最后一天和时间。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [108]: </span><span class="n">dft</span><span class="p">[</span><span class="s2">"2013-1"</span><span class="p">:</span><span class="s2">"2013-2"</span><span class="p">]</span>
<span class="gh">Out[108]: </span>
<span class="go">                            A</span>
<span class="go">2013-01-01 00:00:00  0.276232</span>
<span class="go">2013-01-01 00:01:00 -1.087401</span>
<span class="go">2013-01-01 00:02:00 -0.673690</span>
<span class="go">2013-01-01 00:03:00  0.113648</span>
<span class="go">2013-01-01 00:04:00 -1.478427</span>
<span class="go">...                       ...</span>
<span class="go">2013-02-28 23:55:00  0.850929</span>
<span class="go">2013-02-28 23:56:00  0.976712</span>
<span class="go">2013-02-28 23:57:00 -2.693884</span>
<span class="go">2013-02-28 23:58:00 -1.575535</span>
<span class="go">2013-02-28 23:59:00 -1.573517</span>

<span class="go">[84960 rows x 1 columns]</span>
</pre></div>
</div>
<p>这指定了一个停止时间，该时间<strong>包含最后一天的所有时间</strong>。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [109]: </span><span class="n">dft</span><span class="p">[</span><span class="s2">"2013-1"</span><span class="p">:</span><span class="s2">"2013-2-28"</span><span class="p">]</span>
<span class="gh">Out[109]: </span>
<span class="go">                            A</span>
<span class="go">2013-01-01 00:00:00  0.276232</span>
<span class="go">2013-01-01 00:01:00 -1.087401</span>
<span class="go">2013-01-01 00:02:00 -0.673690</span>
<span class="go">2013-01-01 00:03:00  0.113648</span>
<span class="go">2013-01-01 00:04:00 -1.478427</span>
<span class="go">...                       ...</span>
<span class="go">2013-02-28 23:55:00  0.850929</span>
<span class="go">2013-02-28 23:56:00  0.976712</span>
<span class="go">2013-02-28 23:57:00 -2.693884</span>
<span class="go">2013-02-28 23:58:00 -1.575535</span>
<span class="go">2013-02-28 23:59:00 -1.573517</span>

<span class="go">[84960 rows x 1 columns]</span>
</pre></div>
</div>
<p>这指定了一个<strong>精确的</strong>停止时间（与上面不同）。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [110]: </span><span class="n">dft</span><span class="p">[</span><span class="s2">"2013-1"</span><span class="p">:</span><span class="s2">"2013-2-28 00:00:00"</span><span class="p">]</span>
<span class="gh">Out[110]: </span>
<span class="go">                            A</span>
<span class="go">2013-01-01 00:00:00  0.276232</span>
<span class="go">2013-01-01 00:01:00 -1.087401</span>
<span class="go">2013-01-01 00:02:00 -0.673690</span>
<span class="go">2013-01-01 00:03:00  0.113648</span>
<span class="go">2013-01-01 00:04:00 -1.478427</span>
<span class="go">...                       ...</span>
<span class="go">2013-02-27 23:56:00  1.197749</span>
<span class="go">2013-02-27 23:57:00  0.720521</span>
<span class="go">2013-02-27 23:58:00 -0.072718</span>
<span class="go">2013-02-27 23:59:00 -0.681192</span>
<span class="go">2013-02-28 00:00:00 -0.557501</span>

<span class="go">[83521 rows x 1 columns]</span>
</pre></div>
</div>
<p>我们停在包含的端点上，因为它是索引的一部分。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [111]: </span><span class="n">dft</span><span class="p">[</span><span class="s2">"2013-1-15"</span><span class="p">:</span><span class="s2">"2013-1-15 12:30:00"</span><span class="p">]</span>
<span class="gh">Out[111]: </span>
<span class="go">                            A</span>
<span class="go">2013-01-15 00:00:00 -0.984810</span>
<span class="go">2013-01-15 00:01:00  0.941451</span>
<span class="go">2013-01-15 00:02:00  1.559365</span>
<span class="go">2013-01-15 00:03:00  1.034374</span>
<span class="go">2013-01-15 00:04:00 -1.480656</span>
<span class="go">...                       ...</span>
<span class="go">2013-01-15 12:26:00  0.371454</span>
<span class="go">2013-01-15 12:27:00 -0.930806</span>
<span class="go">2013-01-15 12:28:00 -0.069177</span>
<span class="go">2013-01-15 12:29:00  0.066510</span>
<span class="go">2013-01-15 12:30:00 -0.003945</span>

<span class="go">[751 rows x 1 columns]</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code> 部分字符串索引也适用于带有 <code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code> 的 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [112]: </span><span class="n">dft2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
<span class="gp">   .....: </span>    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"A"</span><span class="p">],</span>
<span class="gp">   .....: </span>    <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_product</span><span class="p">(</span>
<span class="gp">   .....: </span>        <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">"20130101"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"12h"</span><span class="p">),</span> <span class="p">[</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">]]</span>
<span class="gp">   .....: </span>    <span class="p">),</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [113]: </span><span class="n">dft2</span>
<span class="gh">Out[113]: </span>
<span class="go">                              A</span>
<span class="go">2013-01-01 00:00:00 a -0.298694</span>
<span class="go">                    b  0.823553</span>
<span class="go">2013-01-01 12:00:00 a  0.943285</span>
<span class="go">                    b -1.479399</span>
<span class="go">2013-01-02 00:00:00 a -1.643342</span>
<span class="go">...                         ...</span>
<span class="go">2013-01-04 12:00:00 b  0.069036</span>
<span class="go">2013-01-05 00:00:00 a  0.122297</span>
<span class="go">                    b  1.422060</span>
<span class="go">2013-01-05 12:00:00 a  0.370079</span>
<span class="go">                    b  1.016331</span>

<span class="go">[20 rows x 1 columns]</span>

<span class="gp">In [114]: </span><span class="n">dft2</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">"2013-01-05"</span><span class="p">]</span>
<span class="gh">Out[114]: </span>
<span class="go">                              A</span>
<span class="go">2013-01-05 00:00:00 a  0.122297</span>
<span class="go">                    b  1.422060</span>
<span class="go">2013-01-05 12:00:00 a  0.370079</span>
<span class="go">                    b  1.016331</span>

<span class="gp">In [115]: </span><span class="n">idx</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">IndexSlice</span>

<span class="gp">In [116]: </span><span class="n">dft2</span> <span class="o">=</span> <span class="n">dft2</span><span class="o">.</span><span class="n">swaplevel</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>

<span class="gp">In [117]: </span><span class="n">dft2</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">[:,</span> <span class="s2">"2013-01-05"</span><span class="p">],</span> <span class="p">:]</span>
<span class="gh">Out[117]: </span>
<span class="go">                              A</span>
<span class="go">a 2013-01-05 00:00:00  0.122297</span>
<span class="go">  2013-01-05 12:00:00  0.370079</span>
<span class="go">b 2013-01-05 00:00:00  1.422060</span>
<span class="go">  2013-01-05 12:00:00  1.016331</span>
</pre></div>
</div>
<p>使用字符串索引进行切片也尊重 UTC 偏移。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [118]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">([</span><span class="s2">"2019-01-01"</span><span class="p">],</span> <span class="n">tz</span><span class="o">=</span><span class="s2">"US/Pacific"</span><span class="p">))</span>

<span class="gp">In [119]: </span><span class="n">df</span>
<span class="gh">Out[119]: </span>
<span class="go">                           0</span>
<span class="go">2019-01-01 00:00:00-08:00  0</span>

<span class="gp">In [120]: </span><span class="n">df</span><span class="p">[</span><span class="s2">"2019-01-01 12:00:00+04:00"</span><span class="p">:</span><span class="s2">"2019-01-01 13:00:00+04:00"</span><span class="p">]</span>
<span class="gh">Out[120]: </span>
<span class="go">                           0</span>
<span class="go">2019-01-01 00:00:00-08:00  0</span>
</pre></div>
</div>
</section>
<section id="slice-vs-exact-match">
<span id="timeseries-slice-vs-exact-match"></span><h3>切片 vs. 精确匹配<a class="headerlink" href="timeseries.html#slice-vs-exact-match" title="Link to this heading">#</a></h3>
<p>用作索引参数的同一字符串可以被视为切片或精确匹配，具体取决于索引的分辨率。如果字符串的精度低于索引，它将被视为切片；否则，被视为精确匹配。</p>
<p>考虑一个具有分钟分辨率索引的 <code class="docutils literal notranslate"><span class="pre">Series</span></code> 对象。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [121]: </span><span class="n">series_minute</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
<span class="gp">   .....: </span>    <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">(</span>
<span class="gp">   .....: </span>        <span class="p">[</span><span class="s2">"2011-12-31 23:59:00"</span><span class="p">,</span> <span class="s2">"2012-01-01 00:00:00"</span><span class="p">,</span> <span class="s2">"2012-01-01 00:02:00"</span><span class="p">]</span>
<span class="gp">   .....: </span>    <span class="p">),</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [122]: </span><span class="n">series_minute</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">resolution</span>
<span class="gh">Out[122]: </span><span class="go">'minute'</span>
</pre></div>
</div>
<p>时间戳字符串的精度低于分钟，返回一个 <code class="docutils literal notranslate"><span class="pre">Series</span></code> 对象。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [123]: </span><span class="n">series_minute</span><span class="p">[</span><span class="s2">"2011-12-31 23"</span><span class="p">]</span>
<span class="gh">Out[123]: </span>
<span class="go">2011-12-31 23:59:00    1</span>
<span class="go">dtype: int64</span>
</pre></div>
</div>
<p>分钟分辨率（或更高精度）的时间戳字符串，返回一个标量，即它不被强制转换为切片。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [124]: </span><span class="n">series_minute</span><span class="p">[</span><span class="s2">"2011-12-31 23:59"</span><span class="p">]</span>
<span class="gh">Out[124]: </span><span class="go">1</span>

<span class="gp">In [125]: </span><span class="n">series_minute</span><span class="p">[</span><span class="s2">"2011-12-31 23:59:00"</span><span class="p">]</span>
<span class="gh">Out[125]: </span><span class="go">1</span>
</pre></div>
</div>
<p>如果索引分辨率是秒，那么分钟精度的时间戳将返回一个 <code class="docutils literal notranslate"><span class="pre">Series</span></code>。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [126]: </span><span class="n">series_second</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
<span class="gp">   .....: </span>    <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">(</span>
<span class="gp">   .....: </span>        <span class="p">[</span><span class="s2">"2011-12-31 23:59:59"</span><span class="p">,</span> <span class="s2">"2012-01-01 00:00:00"</span><span class="p">,</span> <span class="s2">"2012-01-01 00:00:01"</span><span class="p">]</span>
<span class="gp">   .....: </span>    <span class="p">),</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [127]: </span><span class="n">series_second</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">resolution</span>
<span class="gh">Out[127]: </span><span class="go">'second'</span>

<span class="gp">In [128]: </span><span class="n">series_second</span><span class="p">[</span><span class="s2">"2011-12-31 23:59"</span><span class="p">]</span>
<span class="gh">Out[128]: </span>
<span class="go">2011-12-31 23:59:59    1</span>
<span class="go">dtype: int64</span>
</pre></div>
</div>
<p>如果时间戳字符串被视为切片，它也可以用于通过 <code class="docutils literal notranslate"><span class="pre">.loc[]</span></code> 索引 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [129]: </span><span class="n">dft_minute</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="p">{</span><span class="s2">"a"</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="s2">"b"</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]},</span> <span class="n">index</span><span class="o">=</span><span class="n">series_minute</span><span class="o">.</span><span class="n">index</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [130]: </span><span class="n">dft_minute</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">"2011-12-31 23"</span><span class="p">]</span>
<span class="gh">Out[130]: </span>
<span class="go">                     a  b</span>
<span class="go">2011-12-31 23:59:00  1  4</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>然而，如果字符串被视为精确匹配，那么 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> 的 <code class="docutils literal notranslate"><span class="pre">[]</span></code> 中的选择将是按列而不是按行，参见<a class="reference internal" href="indexing.html#indexing-basics"><span class="std std-ref">索引基础</span></a>。例如，<code class="docutils literal notranslate"><span class="pre">dft_minute['2011-12-31</span> <span class="pre">23:59']</span></code> 将引发 <code class="docutils literal notranslate"><span class="pre">KeyError</span></code>，因为 <code class="docutils literal notranslate"><span class="pre">'2012-12-31</span> <span class="pre">23:59'</span></code> 与索引具有相同的分辨率，并且没有名为该名称的列。</p>
<p>为了<em>始终</em>进行明确的选择，无论行被视为切片还是单个选择，请使用 <code class="docutils literal notranslate"><span class="pre">.loc</span></code>。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [131]: </span><span class="n">dft_minute</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">"2011-12-31 23:59"</span><span class="p">]</span>
<span class="gh">Out[131]: </span>
<span class="go">a    1</span>
<span class="go">b    4</span>
<span class="go">Name: 2011-12-31 23:59:00, dtype: int64</span>
</pre></div>
</div>
</div>
<p>另请注意，<code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code> 的分辨率不能低于天。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [132]: </span><span class="n">series_monthly</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">([</span><span class="s2">"2011-12"</span><span class="p">,</span> <span class="s2">"2012-01"</span><span class="p">,</span> <span class="s2">"2012-02"</span><span class="p">])</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [133]: </span><span class="n">series_monthly</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">resolution</span>
<span class="gh">Out[133]: </span><span class="go">'day'</span>

<span class="gp">In [134]: </span><span class="n">series_monthly</span><span class="p">[</span><span class="s2">"2011-12"</span><span class="p">]</span>  <span class="c1"># returns Series</span>
<span class="gh">Out[134]: </span>
<span class="go">2011-12-01    1</span>
<span class="go">dtype: int64</span>
</pre></div>
</div>
</section>
<section id="exact-indexing">
<h3>精确索引<a class="headerlink" href="timeseries.html#exact-indexing" title="Link to this heading">#</a></h3>
<p>如前一节所述，使用部分字符串对 <code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code> 进行索引取决于时间段的“准确性”，换句话说，间隔与索引分辨率的精确程度。相比之下，使用 <code class="docutils literal notranslate"><span class="pre">Timestamp</span></code> 或 <code class="docutils literal notranslate"><span class="pre">datetime</span></code> 对象进行索引是精确的，因为这些对象具有精确的含义。它们也遵循<em>包含两个端点</em>的语义。</p>
<p>这些 <code class="docutils literal notranslate"><span class="pre">Timestamp</span></code> 和 <code class="docutils literal notranslate"><span class="pre">datetime</span></code> 对象具有精确的 <code class="docutils literal notranslate"><span class="pre">hours,</span> <span class="pre">minutes,</span></code> 和 <code class="docutils literal notranslate"><span class="pre">seconds</span></code>，即使它们没有明确指定（它们是 <code class="docutils literal notranslate"><span class="pre">0</span></code>）。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [135]: </span><span class="n">dft</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">28</span><span class="p">)]</span>
<span class="gh">Out[135]: </span>
<span class="go">                            A</span>
<span class="go">2013-01-01 00:00:00  0.276232</span>
<span class="go">2013-01-01 00:01:00 -1.087401</span>
<span class="go">2013-01-01 00:02:00 -0.673690</span>
<span class="go">2013-01-01 00:03:00  0.113648</span>
<span class="go">2013-01-01 00:04:00 -1.478427</span>
<span class="go">...                       ...</span>
<span class="go">2013-02-27 23:56:00  1.197749</span>
<span class="go">2013-02-27 23:57:00  0.720521</span>
<span class="go">2013-02-27 23:58:00 -0.072718</span>
<span class="go">2013-02-27 23:59:00 -0.681192</span>
<span class="go">2013-02-28 00:00:00 -0.557501</span>

<span class="go">[83521 rows x 1 columns]</span>
</pre></div>
</div>
<p>没有默认值。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [136]: </span><span class="n">dft</span><span class="p">[</span>
<span class="gp">   .....: </span>    <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span>
<span class="gp">   .....: </span>        <span class="mi">2013</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">0</span>
<span class="gp">   .....: </span>    <span class="p">)</span>
<span class="gp">   .....: </span><span class="p">]</span>
<span class="gp">   .....: </span>
<span class="gh">Out[136]: </span>
<span class="go">                            A</span>
<span class="go">2013-01-01 10:12:00  0.565375</span>
<span class="go">2013-01-01 10:13:00  0.068184</span>
<span class="go">2013-01-01 10:14:00  0.788871</span>
<span class="go">2013-01-01 10:15:00 -0.280343</span>
<span class="go">2013-01-01 10:16:00  0.931536</span>
<span class="go">...                       ...</span>
<span class="go">2013-02-28 10:08:00  0.148098</span>
<span class="go">2013-02-28 10:09:00 -0.388138</span>
<span class="go">2013-02-28 10:10:00  0.139348</span>
<span class="go">2013-02-28 10:11:00  0.085288</span>
<span class="go">2013-02-28 10:12:00  0.950146</span>

<span class="go">[83521 rows x 1 columns]</span>
</pre></div>
</div>
</section>
<section id="truncating-fancy-indexing">
<h3>截断和花式索引<a class="headerlink" href="timeseries.html#truncating-fancy-indexing" title="Link to this heading">#</a></h3>
<p>提供了 <a class="reference internal" href="../reference/api/pandas.DataFrame.truncate.html#pandas.DataFrame.truncate" title="pandas.DataFrame.truncate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">truncate()</span></code></a> 便捷函数，它类似于切片。请注意，<code class="docutils literal notranslate"><span class="pre">truncate</span></code> 对于 <code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code> 中任何未指定的日期组件假定值为 0，而切片则返回任何部分匹配的日期。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [137]: </span><span class="n">rng2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">"2011-01-01"</span><span class="p">,</span> <span class="s2">"2012-01-01"</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"W"</span><span class="p">)</span>

<span class="gp">In [138]: </span><span class="n">ts2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rng2</span><span class="p">)),</span> <span class="n">index</span><span class="o">=</span><span class="n">rng2</span><span class="p">)</span>

<span class="gp">In [139]: </span><span class="n">ts2</span><span class="o">.</span><span class="n">truncate</span><span class="p">(</span><span class="n">before</span><span class="o">=</span><span class="s2">"2011-11"</span><span class="p">,</span> <span class="n">after</span><span class="o">=</span><span class="s2">"2011-12"</span><span class="p">)</span>
<span class="gh">Out[139]: </span>
<span class="go">2011-11-06    0.437823</span>
<span class="go">2011-11-13   -0.293083</span>
<span class="go">2011-11-20   -0.059881</span>
<span class="go">2011-11-27    1.252450</span>
<span class="go">Freq: W-SUN, dtype: float64</span>

<span class="gp">In [140]: </span><span class="n">ts2</span><span class="p">[</span><span class="s2">"2011-11"</span><span class="p">:</span><span class="s2">"2011-12"</span><span class="p">]</span>
<span class="gh">Out[140]: </span>
<span class="go">2011-11-06    0.437823</span>
<span class="go">2011-11-13   -0.293083</span>
<span class="go">2011-11-20   -0.059881</span>
<span class="go">2011-11-27    1.252450</span>
<span class="go">2011-12-04    0.046611</span>
<span class="go">2011-12-11    0.059478</span>
<span class="go">2011-12-18   -0.286539</span>
<span class="go">2011-12-25    0.841669</span>
<span class="go">Freq: W-SUN, dtype: float64</span>
</pre></div>
</div>
<p>即使是打破 <code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code> 频率规律性的复杂花式索引，也会生成一个 <code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code>，尽管频率会丢失。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [141]: </span><span class="n">ts2</span><span class="o">.</span><span class="n">iloc</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">]]</span><span class="o">.</span><span class="n">index</span>
<span class="gh">Out[141]: </span><span class="go">DatetimeIndex(['2011-01-02', '2011-01-16', '2011-02-13'], dtype='datetime64[ns]', freq=None)</span>
</pre></div>
</div>
</section>
</section>
<section id="time-date-components">
<span id="timeseries-components"></span><h2>时间/日期组件<a class="headerlink" href="timeseries.html#time-date-components" title="Link to this heading">#</a></h2>
<p>有几个时间/日期属性可以从 <code class="docutils literal notranslate"><span class="pre">Timestamp</span></code> 或时间戳集合（如 <code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code>）中访问。</p>
<table class="table">
<colgroup>
<col style="width: 18.8%" />
<col style="width: 81.2%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>属性</p></th>
<th class="head"><p>描述</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>year</p></td>
<td><p>日期的年份</p></td>
</tr>
<tr class="row-odd"><td><p>month</p></td>
<td><p>日期的月份</p></td>
</tr>
<tr class="row-even"><td><p>day</p></td>
<td><p>日期的天</p></td>
</tr>
<tr class="row-odd"><td><p>hour</p></td>
<td><p>日期的小时</p></td>
</tr>
<tr class="row-even"><td><p>minute</p></td>
<td><p>日期的分钟</p></td>
</tr>
<tr class="row-odd"><td><p>second</p></td>
<td><p>日期的秒</p></td>
</tr>
<tr class="row-even"><td><p>microsecond</p></td>
<td><p>日期的微秒</p></td>
</tr>
<tr class="row-odd"><td><p>nanosecond</p></td>
<td><p>日期的纳秒</p></td>
</tr>
<tr class="row-even"><td><p>date</p></td>
<td><p>返回 datetime.date（不包含时区信息）</p></td>
</tr>
<tr class="row-odd"><td><p>time</p></td>
<td><p>返回 datetime.time（不包含时区信息）</p></td>
</tr>
<tr class="row-even"><td><p>timetz</p></td>
<td><p>返回带时区信息的 datetime.time 作为本地时间</p></td>
</tr>
<tr class="row-odd"><td><p>dayofyear</p></td>
<td><p>一年中的序数日</p></td>
</tr>
<tr class="row-even"><td><p>day_of_year</p></td>
<td><p>一年中的序数日</p></td>
</tr>
<tr class="row-odd"><td><p>weekofyear</p></td>
<td><p>一年中的周序数</p></td>
</tr>
<tr class="row-even"><td><p>week</p></td>
<td><p>一年中的周序数</p></td>
</tr>
<tr class="row-odd"><td><p>dayofweek</p></td>
<td><p>星期几的数字，周一=0，周日=6</p></td>
</tr>
<tr class="row-even"><td><p>day_of_week</p></td>
<td><p>星期几的数字，周一=0，周日=6</p></td>
</tr>
<tr class="row-odd"><td><p>weekday</p></td>
<td><p>星期几的数字，周一=0，周日=6</p></td>
</tr>
<tr class="row-even"><td><p>quarter</p></td>
<td><p>日期的季度：1-3月=1，4-6月=2，以此类推。</p></td>
</tr>
<tr class="row-odd"><td><p>days_in_month</p></td>
<td><p>日期所在月份的天数</p></td>
</tr>
<tr class="row-even"><td><p>is_month_start</p></td>
<td><p>逻辑值，指示是否为月份的第一天（由频率定义）</p></td>
</tr>
<tr class="row-odd"><td><p>is_month_end</p></td>
<td><p>逻辑值，指示是否为月份的最后一天（由频率定义）</p></td>
</tr>
<tr class="row-even"><td><p>is_quarter_start</p></td>
<td><p>逻辑值，指示是否为季度的第一天（由频率定义）</p></td>
</tr>
<tr class="row-odd"><td><p>is_quarter_end</p></td>
<td><p>逻辑值，指示是否为季度的最后一天（由频率定义）</p></td>
</tr>
<tr class="row-even"><td><p>is_year_start</p></td>
<td><p>逻辑值，指示是否为年份的第一天（由频率定义）</p></td>
</tr>
<tr class="row-odd"><td><p>is_year_end</p></td>
<td><p>逻辑值，指示是否为年份的最后一天（由频率定义）</p></td>
</tr>
<tr class="row-even"><td><p>is_leap_year</p></td>
<td><p>逻辑值，指示日期是否属于闰年</p></td>
</tr>
</tbody>
</table>
<p>此外，如果您有一个包含日期时间类值的 <code class="docutils literal notranslate"><span class="pre">Series</span></code>，则可以通过 <code class="docutils literal notranslate"><span class="pre">.dt</span></code> 访问器访问这些属性，详见<a class="reference internal" href="basics.html#basics-dt-accessors"><span class="std std-ref">.dt 访问器</span></a>一节。</p>
<p>您可以从 ISO 8601 标准中获取 ISO 年的年份、周和日组件。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [142]: </span><span class="n">idx</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="s2">"2019-12-29"</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"D"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="gp">In [143]: </span><span class="n">idx</span><span class="o">.</span><span class="n">isocalendar</span><span class="p">()</span>
<span class="gh">Out[143]: </span>
<span class="go">            year  week  day</span>
<span class="go">2019-12-29  2019    52    7</span>
<span class="go">2019-12-30  2020     1    1</span>
<span class="go">2019-12-31  2020     1    2</span>
<span class="go">2020-01-01  2020     1    3</span>

<span class="gp">In [144]: </span><span class="n">idx</span><span class="o">.</span><span class="n">to_series</span><span class="p">()</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">isocalendar</span><span class="p">()</span>
<span class="gh">Out[144]: </span>
<span class="go">            year  week  day</span>
<span class="go">2019-12-29  2019    52    7</span>
<span class="go">2019-12-30  2020     1    1</span>
<span class="go">2019-12-31  2020     1    2</span>
<span class="go">2020-01-01  2020     1    3</span>
</pre></div>
</div>
</section>
<section id="dateoffset-objects">
<span id="timeseries-offsets"></span><h2>DateOffset 对象<a class="headerlink" href="timeseries.html#dateoffset-objects" title="Link to this heading">#</a></h2>
<p>在前面的例子中，频率字符串（例如 <code class="docutils literal notranslate"><span class="pre">'D'</span></code>）用于指定一个频率，该频率定义了：</p>
<ul class="simple">
<li><p>使用 <a class="reference internal" href="../reference/api/pandas.date_range.html#pandas.date_range" title="pandas.date_range"><code class="xref py py-meth docutils literal notranslate"><span class="pre">date_range()</span></code></a> 时 <a class="reference internal" href="../reference/api/pandas.DatetimeIndex.html#pandas.DatetimeIndex" title="pandas.DatetimeIndex"><code class="xref py py-class docutils literal notranslate"><span class="pre">DatetimeIndex</span></code></a> 中日期时间的间隔方式。</p></li>
<li><p><a class="reference internal" href="../reference/api/pandas.Period.html#pandas.Period" title="pandas.Period"><code class="xref py py-class docutils literal notranslate"><span class="pre">Period</span></code></a> 或 <a class="reference internal" href="../reference/api/pandas.PeriodIndex.html#pandas.PeriodIndex" title="pandas.PeriodIndex"><code class="xref py py-class docutils literal notranslate"><span class="pre">PeriodIndex</span></code></a> 的频率</p></li>
</ul>
<p>这些频率字符串映射到 <code class="xref py py-class docutils literal notranslate"><span class="pre">DateOffset</span></code> 对象及其子类。<code class="xref py py-class docutils literal notranslate"><span class="pre">DateOffset</span></code> 类似于 <a class="reference internal" href="../reference/api/pandas.Timedelta.html#pandas.Timedelta" title="pandas.Timedelta"><code class="xref py py-class docutils literal notranslate"><span class="pre">Timedelta</span></code></a>，它表示一段时间的持续时间，但遵循特定的日历持续时间规则。例如，一个 <a class="reference internal" href="../reference/api/pandas.Timedelta.html#pandas.Timedelta" title="pandas.Timedelta"><code class="xref py py-class docutils literal notranslate"><span class="pre">Timedelta</span></code></a> 天将始终将 <code class="docutils literal notranslate"><span class="pre">datetimes</span></code> 增加 24 小时，而 <code class="xref py py-class docutils literal notranslate"><span class="pre">DateOffset</span></code> 天将使 <code class="docutils literal notranslate"><span class="pre">datetimes</span></code> 增加到下一天的相同时间，无论一天由于夏令时代表 23、24 还是 25 小时。然而，所有小时或更小（<code class="docutils literal notranslate"><span class="pre">Hour</span></code>、<code class="docutils literal notranslate"><span class="pre">Minute</span></code>、<code class="docutils literal notranslate"><span class="pre">Second</span></code>、<code class="docutils literal notranslate"><span class="pre">Milli</span></code>、<code class="docutils literal notranslate"><span class="pre">Micro</span></code>、<code class="docutils literal notranslate"><span class="pre">Nano</span></code>）的 <code class="xref py py-class docutils literal notranslate"><span class="pre">DateOffset</span></code> 子类都表现得像 <a class="reference internal" href="../reference/api/pandas.Timedelta.html#pandas.Timedelta" title="pandas.Timedelta"><code class="xref py py-class docutils literal notranslate"><span class="pre">Timedelta</span></code></a> 并遵守绝对时间。</p>
<p>基本的 <code class="xref py py-class docutils literal notranslate"><span class="pre">DateOffset</span></code> 类似于 <code class="docutils literal notranslate"><span class="pre">dateutil.relativedelta</span></code>（<a class="reference external" href="https://dateutil.readthedocs.io/en/stable/relativedelta.html">relativedelta 文档</a>），它根据指定的相应日历持续时间移动日期时间。可以使用算术运算符（<code class="docutils literal notranslate"><span class="pre">+</span></code>）执行移动。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="go"># This particular day contains a day light savings time transition</span>
<span class="gp">In [145]: </span><span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">"2016-10-30 00:00:00"</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s2">"Europe/Helsinki"</span><span class="p">)</span>

<span class="go"># Respects absolute time</span>
<span class="gp">In [146]: </span><span class="n">ts</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gh">Out[146]: </span><span class="go">Timestamp('2016-10-30 23:00:00+0200', tz='Europe/Helsinki')</span>

<span class="go"># Respects calendar time</span>
<span class="gp">In [147]: </span><span class="n">ts</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gh">Out[147]: </span><span class="go">Timestamp('2016-10-31 00:00:00+0200', tz='Europe/Helsinki')</span>

<span class="gp">In [148]: </span><span class="n">friday</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">"2018-01-05"</span><span class="p">)</span>

<span class="gp">In [149]: </span><span class="n">friday</span><span class="o">.</span><span class="n">day_name</span><span class="p">()</span>
<span class="gh">Out[149]: </span><span class="go">'Friday'</span>

<span class="go"># Add 2 business days (Friday --&gt; Tuesday)</span>
<span class="gp">In [150]: </span><span class="n">two_business_days</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">BDay</span><span class="p">()</span>

<span class="gp">In [151]: </span><span class="n">friday</span> <span class="o">+</span> <span class="n">two_business_days</span>
<span class="gh">Out[151]: </span><span class="go">Timestamp('2018-01-09 00:00:00')</span>

<span class="gp">In [152]: </span><span class="p">(</span><span class="n">friday</span> <span class="o">+</span> <span class="n">two_business_days</span><span class="p">)</span><span class="o">.</span><span class="n">day_name</span><span class="p">()</span>
<span class="gh">Out[152]: </span><span class="go">'Tuesday'</span>
</pre></div>
</div>
<p>大多数 <code class="docutils literal notranslate"><span class="pre">DateOffsets</span></code> 都有关联的频率字符串或偏移别名，可以传入 <code class="docutils literal notranslate"><span class="pre">freq</span></code> 关键字参数。可用的日期偏移量和关联的频率字符串如下：</p>
<table class="table">
<colgroup>
<col style="width: 15.8%" />
<col style="width: 15.8%" />
<col style="width: 68.4%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>日期偏移量</p></th>
<th class="head"><p>频率字符串</p></th>
<th class="head"><p>描述</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference internal" href="../reference/api/pandas.tseries.offsets.DateOffset.html#pandas.tseries.offsets.DateOffset" title="pandas.tseries.offsets.DateOffset"><code class="xref py py-class docutils literal notranslate"><span class="pre">DateOffset</span></code></a></p></td>
<td><p>无</p></td>
<td><p>通用偏移类，默认为绝对24小时</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../reference/api/pandas.tseries.offsets.BDay.html#pandas.tseries.offsets.BDay" title="pandas.tseries.offsets.BDay"><code class="xref py py-class docutils literal notranslate"><span class="pre">BDay</span></code></a> 或 <a class="reference internal" href="../reference/api/pandas.tseries.offsets.BusinessDay.html#pandas.tseries.offsets.BusinessDay" title="pandas.tseries.offsets.BusinessDay"><code class="xref py py-class docutils literal notranslate"><span class="pre">BusinessDay</span></code></a></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">'B'</span></code></p></td>
<td><p>工作日频率 (weekday)</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../reference/api/pandas.tseries.offsets.CDay.html#pandas.tseries.offsets.CDay" title="pandas.tseries.offsets.CDay"><code class="xref py py-class docutils literal notranslate"><span class="pre">CDay</span></code></a> 或 <a class="reference internal" href="../reference/api/pandas.tseries.offsets.CustomBusinessDay.html#pandas.tseries.offsets.CustomBusinessDay" title="pandas.tseries.offsets.CustomBusinessDay"><code class="xref py py-class docutils literal notranslate"><span class="pre">CustomBusinessDay</span></code></a></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">'C'</span></code></p></td>
<td><p>自定义工作日</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../reference/api/pandas.tseries.offsets.Week.html#pandas.tseries.offsets.Week" title="pandas.tseries.offsets.Week"><code class="xref py py-class docutils literal notranslate"><span class="pre">周</span></code></a></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">'W'</span></code></p></td>
<td><p>一周，可选地锚定在一周中的某一天</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../reference/api/pandas.tseries.offsets.WeekOfMonth.html#pandas.tseries.offsets.WeekOfMonth" title="pandas.tseries.offsets.WeekOfMonth"><code class="xref py py-class docutils literal notranslate"><span class="pre">月份的第几周</span></code></a></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">'WOM'</span></code></p></td>
<td><p>每月第y周的第x天</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../reference/api/pandas.tseries.offsets.LastWeekOfMonth.html#pandas.tseries.offsets.LastWeekOfMonth" title="pandas.tseries.offsets.LastWeekOfMonth"><code class="xref py py-class docutils literal notranslate"><span class="pre">月份的最后一周</span></code></a></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">'LWOM'</span></code></p></td>
<td><p>每月最后一周的第x天</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../reference/api/pandas.tseries.offsets.MonthEnd.html#pandas.tseries.offsets.MonthEnd" title="pandas.tseries.offsets.MonthEnd"><code class="xref py py-class docutils literal notranslate"><span class="pre">月末</span></code></a></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">'ME'</span></code></p></td>
<td><p>日历月末</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../reference/api/pandas.tseries.offsets.MonthBegin.html#pandas.tseries.offsets.MonthBegin" title="pandas.tseries.offsets.MonthBegin"><code class="xref py py-class docutils literal notranslate"><span class="pre">月初</span></code></a></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">'MS'</span></code></p></td>
<td><p>日历月初</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../reference/api/pandas.tseries.offsets.BMonthEnd.html#pandas.tseries.offsets.BMonthEnd" title="pandas.tseries.offsets.BMonthEnd"><code class="xref py py-class docutils literal notranslate"><span class="pre">BMonthEnd</span></code></a> 或 <a class="reference internal" href="../reference/api/pandas.tseries.offsets.BusinessMonthEnd.html#pandas.tseries.offsets.BusinessMonthEnd" title="pandas.tseries.offsets.BusinessMonthEnd"><code class="xref py py-class docutils literal notranslate"><span class="pre">BusinessMonthEnd</span></code></a></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">'BME'</span></code></p></td>
<td><p>营业月月末</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../reference/api/pandas.tseries.offsets.BMonthBegin.html#pandas.tseries.offsets.BMonthBegin" title="pandas.tseries.offsets.BMonthBegin"><code class="xref py py-class docutils literal notranslate"><span class="pre">BMonthBegin</span></code></a> 或 <a class="reference internal" href="../reference/api/pandas.tseries.offsets.BusinessMonthBegin.html#pandas.tseries.offsets.BusinessMonthBegin" title="pandas.tseries.offsets.BusinessMonthBegin"><code class="xref py py-class docutils literal notranslate"><span class="pre">BusinessMonthBegin</span></code></a></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">'BMS'</span></code></p></td>
<td><p>营业月月初</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../reference/api/pandas.tseries.offsets.CBMonthEnd.html#pandas.tseries.offsets.CBMonthEnd" title="pandas.tseries.offsets.CBMonthEnd"><code class="xref py py-class docutils literal notranslate"><span class="pre">CBMonthEnd</span></code></a> 或 <a class="reference internal" href="../reference/api/pandas.tseries.offsets.CustomBusinessMonthEnd.html#pandas.tseries.offsets.CustomBusinessMonthEnd" title="pandas.tseries.offsets.CustomBusinessMonthEnd"><code class="xref py py-class docutils literal notranslate"><span class="pre">CustomBusinessMonthEnd</span></code></a></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">'CBME'</span></code></p></td>
<td><p>自定义营业月月末</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../reference/api/pandas.tseries.offsets.CBMonthBegin.html#pandas.tseries.offsets.CBMonthBegin" title="pandas.tseries.offsets.CBMonthBegin"><code class="xref py py-class docutils literal notranslate"><span class="pre">CBMonthBegin</span></code></a> 或 <a class="reference internal" href="../reference/api/pandas.tseries.offsets.CustomBusinessMonthBegin.html#pandas.tseries.offsets.CustomBusinessMonthBegin" title="pandas.tseries.offsets.CustomBusinessMonthBegin"><code class="xref py py-class docutils literal notranslate"><span class="pre">CustomBusinessMonthBegin</span></code></a></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">'CBMS'</span></code></p></td>
<td><p>自定义营业月月初</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../reference/api/pandas.tseries.offsets.SemiMonthEnd.html#pandas.tseries.offsets.SemiMonthEnd" title="pandas.tseries.offsets.SemiMonthEnd"><code class="xref py py-class docutils literal notranslate"><span class="pre">半月末</span></code></a></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">'SME'</span></code></p></td>
<td><p>15日（或其他day_of_month）和日历月末</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../reference/api/pandas.tseries.offsets.SemiMonthBegin.html#pandas.tseries.offsets.SemiMonthBegin" title="pandas.tseries.offsets.SemiMonthBegin"><code class="xref py py-class docutils literal notranslate"><span class="pre">半月起始</span></code></a></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">'SMS'</span></code></p></td>
<td><p>15日（或其他day_of_month）和日历月初</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../reference/api/pandas.tseries.offsets.QuarterEnd.html#pandas.tseries.offsets.QuarterEnd" title="pandas.tseries.offsets.QuarterEnd"><code class="xref py py-class docutils literal notranslate"><span class="pre">季末</span></code></a></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">'QE'</span></code></p></td>
<td><p>日历季末</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../reference/api/pandas.tseries.offsets.QuarterBegin.html#pandas.tseries.offsets.QuarterBegin" title="pandas.tseries.offsets.QuarterBegin"><code class="xref py py-class docutils literal notranslate"><span class="pre">季初</span></code></a></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">'QS'</span></code></p></td>
<td><p>日历季初</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../reference/api/pandas.tseries.offsets.BQuarterEnd.html#pandas.tseries.offsets.BQuarterEnd" title="pandas.tseries.offsets.BQuarterEnd"><code class="xref py py-class docutils literal notranslate"><span class="pre">BQuarterEnd</span></code></a></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">'BQE</span></code></p></td>
<td><p>营业季末</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../reference/api/pandas.tseries.offsets.BQuarterBegin.html#pandas.tseries.offsets.BQuarterBegin" title="pandas.tseries.offsets.BQuarterBegin"><code class="xref py py-class docutils literal notranslate"><span class="pre">BQuarterBegin</span></code></a></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">'BQS'</span></code></p></td>
<td><p>营业季初</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../reference/api/pandas.tseries.offsets.FY5253Quarter.html#pandas.tseries.offsets.FY5253Quarter" title="pandas.tseries.offsets.FY5253Quarter"><code class="xref py py-class docutils literal notranslate"><span class="pre">FY5253季度</span></code></a></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">'REQ'</span></code></p></td>
<td><p>零售（又称52-53周）季度</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../reference/api/pandas.tseries.offsets.YearEnd.html#pandas.tseries.offsets.YearEnd" title="pandas.tseries.offsets.YearEnd"><code class="xref py py-class docutils literal notranslate"><span class="pre">年末</span></code></a></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">'YE'</span></code></p></td>
<td><p>日历年末</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../reference/api/pandas.tseries.offsets.YearBegin.html#pandas.tseries.offsets.YearBegin" title="pandas.tseries.offsets.YearBegin"><code class="xref py py-class docutils literal notranslate"><span class="pre">年初</span></code></a></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">'YS'</span></code> 或 <code class="docutils literal notranslate"><span class="pre">'BYS'</span></code></p></td>
<td><p>日历年初</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../reference/api/pandas.tseries.offsets.BYearEnd.html#pandas.tseries.offsets.BYearEnd" title="pandas.tseries.offsets.BYearEnd"><code class="xref py py-class docutils literal notranslate"><span class="pre">营业年末</span></code></a></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">'BYE'</span></code></p></td>
<td><p>营业年末</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../reference/api/pandas.tseries.offsets.BYearBegin.html#pandas.tseries.offsets.BYearBegin" title="pandas.tseries.offsets.BYearBegin"><code class="xref py py-class docutils literal notranslate"><span class="pre">营业年初</span></code></a></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">'BYS'</span></code></p></td>
<td><p>营业年初</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../reference/api/pandas.tseries.offsets.FY5253.html#pandas.tseries.offsets.FY5253" title="pandas.tseries.offsets.FY5253"><code class="xref py py-class docutils literal notranslate"><span class="pre">FY5253</span></code></a></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">'RE'</span></code></p></td>
<td><p>零售（又称52-53周）年度</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../reference/api/pandas.tseries.offsets.Easter.html#pandas.tseries.offsets.Easter" title="pandas.tseries.offsets.Easter"><code class="xref py py-class docutils literal notranslate"><span class="pre">复活节</span></code></a></p></td>
<td><p>无</p></td>
<td><p>复活节假期</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../reference/api/pandas.tseries.offsets.BusinessHour.html#pandas.tseries.offsets.BusinessHour" title="pandas.tseries.offsets.BusinessHour"><code class="xref py py-class docutils literal notranslate"><span class="pre">营业时间</span></code></a></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">'bh'</span></code></p></td>
<td><p>营业小时</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../reference/api/pandas.tseries.offsets.CustomBusinessHour.html#pandas.tseries.offsets.CustomBusinessHour" title="pandas.tseries.offsets.CustomBusinessHour"><code class="xref py py-class docutils literal notranslate"><span class="pre">自定义营业时间</span></code></a></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">'cbh'</span></code></p></td>
<td><p>自定义营业小时</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../reference/api/pandas.tseries.offsets.Day.html#pandas.tseries.offsets.Day" title="pandas.tseries.offsets.Day"><code class="xref py py-class docutils literal notranslate"><span class="pre">天</span></code></a></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">'D'</span></code></p></td>
<td><p>一个绝对日</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../reference/api/pandas.tseries.offsets.Hour.html#pandas.tseries.offsets.Hour" title="pandas.tseries.offsets.Hour"><code class="xref py py-class docutils literal notranslate"><span class="pre">小时</span></code></a></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">'h'</span></code></p></td>
<td><p>一小时</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../reference/api/pandas.tseries.offsets.Minute.html#pandas.tseries.offsets.Minute" title="pandas.tseries.offsets.Minute"><code class="xref py py-class docutils literal notranslate"><span class="pre">分钟</span></code></a></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">'min'</span></code></p></td>
<td><p>一分钟</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../reference/api/pandas.tseries.offsets.Second.html#pandas.tseries.offsets.Second" title="pandas.tseries.offsets.Second"><code class="xref py py-class docutils literal notranslate"><span class="pre">秒</span></code></a></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">'s'</span></code></p></td>
<td><p>一秒</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../reference/api/pandas.tseries.offsets.Milli.html#pandas.tseries.offsets.Milli" title="pandas.tseries.offsets.Milli"><code class="xref py py-class docutils literal notranslate"><span class="pre">毫秒</span></code></a></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">'ms'</span></code></p></td>
<td><p>一毫秒</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../reference/api/pandas.tseries.offsets.Micro.html#pandas.tseries.offsets.Micro" title="pandas.tseries.offsets.Micro"><code class="xref py py-class docutils literal notranslate"><span class="pre">微秒</span></code></a></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">'us'</span></code></p></td>
<td><p>一微秒</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../reference/api/pandas.tseries.offsets.Nano.html#pandas.tseries.offsets.Nano" title="pandas.tseries.offsets.Nano"><code class="xref py py-class docutils literal notranslate"><span class="pre">纳秒</span></code></a></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">'ns'</span></code></p></td>
<td><p>一纳秒</p></td>
</tr>
</tbody>
</table>
<p><code class="docutils literal notranslate"><span class="pre">DateOffsets</span></code> 还具有 <code class="xref py py-meth docutils literal notranslate"><span class="pre">rollforward()</span></code> 和 <code class="xref py py-meth docutils literal notranslate"><span class="pre">rollback()</span></code> 方法，分别用于将日期向前或向后移动到相对于偏移量的有效偏移日期。例如，业务偏移量会将落在周末（周六和周日）的日期向前滚动到周一，因为业务偏移量在工作日操作。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [153]: </span><span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">"2018-01-06 00:00:00"</span><span class="p">)</span>

<span class="gp">In [154]: </span><span class="n">ts</span><span class="o">.</span><span class="n">day_name</span><span class="p">()</span>
<span class="gh">Out[154]: </span><span class="go">'Saturday'</span>

<span class="go"># BusinessHour's valid offset dates are Monday through Friday</span>
<span class="gp">In [155]: </span><span class="n">offset</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">BusinessHour</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="s2">"09:00"</span><span class="p">)</span>

<span class="go"># Bring the date to the closest offset date (Monday)</span>
<span class="gp">In [156]: </span><span class="n">offset</span><span class="o">.</span><span class="n">rollforward</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span>
<span class="gh">Out[156]: </span><span class="go">Timestamp('2018-01-08 09:00:00')</span>

<span class="go"># Date is brought to the closest offset date first and then the hour is added</span>
<span class="gp">In [157]: </span><span class="n">ts</span> <span class="o">+</span> <span class="n">offset</span>
<span class="gh">Out[157]: </span><span class="go">Timestamp('2018-01-08 10:00:00')</span>
</pre></div>
</div>
<p>默认情况下，这些操作保留时间（小时、分钟等）信息。要将时间重置为午夜，请在应用操作之前或之后使用 <code class="xref py py-meth docutils literal notranslate"><span class="pre">normalize()</span></code>（取决于您是否希望在操作中包含时间信息）。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [158]: </span><span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">"2014-01-01 09:00"</span><span class="p">)</span>

<span class="gp">In [159]: </span><span class="n">day</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">Day</span><span class="p">()</span>

<span class="gp">In [160]: </span><span class="n">day</span> <span class="o">+</span> <span class="n">ts</span>
<span class="gh">Out[160]: </span><span class="go">Timestamp('2014-01-02 09:00:00')</span>

<span class="gp">In [161]: </span><span class="p">(</span><span class="n">day</span> <span class="o">+</span> <span class="n">ts</span><span class="p">)</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span>
<span class="gh">Out[161]: </span><span class="go">Timestamp('2014-01-02 00:00:00')</span>

<span class="gp">In [162]: </span><span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">"2014-01-01 22:00"</span><span class="p">)</span>

<span class="gp">In [163]: </span><span class="n">hour</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">Hour</span><span class="p">()</span>

<span class="gp">In [164]: </span><span class="n">hour</span> <span class="o">+</span> <span class="n">ts</span>
<span class="gh">Out[164]: </span><span class="go">Timestamp('2014-01-01 23:00:00')</span>

<span class="gp">In [165]: </span><span class="p">(</span><span class="n">hour</span> <span class="o">+</span> <span class="n">ts</span><span class="p">)</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span>
<span class="gh">Out[165]: </span><span class="go">Timestamp('2014-01-01 00:00:00')</span>

<span class="gp">In [166]: </span><span class="p">(</span><span class="n">hour</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">"2014-01-01 23:30"</span><span class="p">))</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span>
<span class="gh">Out[166]: </span><span class="go">Timestamp('2014-01-02 00:00:00')</span>
</pre></div>
</div>
<section id="parametric-offsets">
<h3>参数化偏移量<a class="headerlink" href="timeseries.html#parametric-offsets" title="Link to this heading">#</a></h3>
<p>一些偏移量在创建时可以进行“参数化”，从而产生不同的行为。例如，用于生成每周数据的 <code class="docutils literal notranslate"><span class="pre">Week</span></code> 偏移量接受一个 <code class="docutils literal notranslate"><span class="pre">weekday</span></code> 参数，这将导致生成的日期始终落在特定的一周中的某一天。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [167]: </span><span class="n">d</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2008</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="gp">In [168]: </span><span class="n">d</span>
<span class="gh">Out[168]: </span><span class="go">datetime.datetime(2008, 8, 18, 9, 0)</span>

<span class="gp">In [169]: </span><span class="n">d</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">Week</span><span class="p">()</span>
<span class="gh">Out[169]: </span><span class="go">Timestamp('2008-08-25 09:00:00')</span>

<span class="gp">In [170]: </span><span class="n">d</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">Week</span><span class="p">(</span><span class="n">weekday</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="gh">Out[170]: </span><span class="go">Timestamp('2008-08-22 09:00:00')</span>

<span class="gp">In [171]: </span><span class="p">(</span><span class="n">d</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">Week</span><span class="p">(</span><span class="n">weekday</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span><span class="o">.</span><span class="n">weekday</span><span class="p">()</span>
<span class="gh">Out[171]: </span><span class="go">4</span>

<span class="gp">In [172]: </span><span class="n">d</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">Week</span><span class="p">()</span>
<span class="gh">Out[172]: </span><span class="go">Timestamp('2008-08-11 09:00:00')</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">normalize</span></code> 选项将对加法和减法有效。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [173]: </span><span class="n">d</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">Week</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gh">Out[173]: </span><span class="go">Timestamp('2008-08-25 00:00:00')</span>

<span class="gp">In [174]: </span><span class="n">d</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">Week</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gh">Out[174]: </span><span class="go">Timestamp('2008-08-11 00:00:00')</span>
</pre></div>
</div>
<p>另一个例子是使用特定的结束月份对 <code class="docutils literal notranslate"><span class="pre">YearEnd</span></code> 进行参数化。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [175]: </span><span class="n">d</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">YearEnd</span><span class="p">()</span>
<span class="gh">Out[175]: </span><span class="go">Timestamp('2008-12-31 09:00:00')</span>

<span class="gp">In [176]: </span><span class="n">d</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">YearEnd</span><span class="p">(</span><span class="n">month</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
<span class="gh">Out[176]: </span><span class="go">Timestamp('2009-06-30 09:00:00')</span>
</pre></div>
</div>
</section>
<section id="using-offsets-with-series-datetimeindex">
<span id="timeseries-offsetseries"></span><h3>在 <code class="docutils literal notranslate"><span class="pre">Series</span></code> / <code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code> 中使用偏移量<a class="headerlink" href="timeseries.html#using-offsets-with-series-datetimeindex" title="Link to this heading">#</a></h3>
<p>偏移量可以与 <code class="docutils literal notranslate"><span class="pre">Series</span></code> 或 <code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code> 一起使用，以将偏移量应用于每个元素。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [177]: </span><span class="n">rng</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">"2012-01-01"</span><span class="p">,</span> <span class="s2">"2012-01-03"</span><span class="p">)</span>

<span class="gp">In [178]: </span><span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">rng</span><span class="p">)</span>

<span class="gp">In [179]: </span><span class="n">rng</span>
<span class="gh">Out[179]: </span><span class="go">DatetimeIndex(['2012-01-01', '2012-01-02', '2012-01-03'], dtype='datetime64[ns]', freq='D')</span>

<span class="gp">In [180]: </span><span class="n">rng</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="gh">Out[180]: </span><span class="go">DatetimeIndex(['2012-03-01', '2012-03-02', '2012-03-03'], dtype='datetime64[ns]', freq=None)</span>

<span class="gp">In [181]: </span><span class="n">s</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="gh">Out[181]: </span>
<span class="go">0   2012-03-01</span>
<span class="go">1   2012-03-02</span>
<span class="go">2   2012-03-03</span>
<span class="go">dtype: datetime64[ns]</span>

<span class="gp">In [182]: </span><span class="n">s</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="gh">Out[182]: </span>
<span class="go">0   2011-11-01</span>
<span class="go">1   2011-11-02</span>
<span class="go">2   2011-11-03</span>
<span class="go">dtype: datetime64[ns]</span>
</pre></div>
</div>
<p>如果偏移类直接映射到 <code class="docutils literal notranslate"><span class="pre">Timedelta</span></code>（<code class="docutils literal notranslate"><span class="pre">Day</span></code>、<code class="docutils literal notranslate"><span class="pre">Hour</span></code>、<code class="docutils literal notranslate"><span class="pre">Minute</span></code>、<code class="docutils literal notranslate"><span class="pre">Second</span></code>、<code class="docutils literal notranslate"><span class="pre">Micro</span></code>、<code class="docutils literal notranslate"><span class="pre">Milli</span></code>、<code class="docutils literal notranslate"><span class="pre">Nano</span></code>），则它完全可以像 <code class="docutils literal notranslate"><span class="pre">Timedelta</span></code> 一样使用——更多示例请参见<a class="reference internal" href="timedeltas.html#timedeltas-operations"><span class="std std-ref">Timedelta 部分</span></a>。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [183]: </span><span class="n">s</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">Day</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="gh">Out[183]: </span>
<span class="go">0   2011-12-30</span>
<span class="go">1   2011-12-31</span>
<span class="go">2   2012-01-01</span>
<span class="go">dtype: datetime64[ns]</span>

<span class="gp">In [184]: </span><span class="n">td</span> <span class="o">=</span> <span class="n">s</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">"2011-12-29"</span><span class="p">,</span> <span class="s2">"2011-12-31"</span><span class="p">))</span>

<span class="gp">In [185]: </span><span class="n">td</span>
<span class="gh">Out[185]: </span>
<span class="go">0   3 days</span>
<span class="go">1   3 days</span>
<span class="go">2   3 days</span>
<span class="go">dtype: timedelta64[ns]</span>

<span class="gp">In [186]: </span><span class="n">td</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">Minute</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
<span class="gh">Out[186]: </span>
<span class="go">0   3 days 00:15:00</span>
<span class="go">1   3 days 00:15:00</span>
<span class="go">2   3 days 00:15:00</span>
<span class="go">dtype: timedelta64[ns]</span>
</pre></div>
</div>
<p>请注意，某些偏移量（如 <code class="docutils literal notranslate"><span class="pre">BQuarterEnd</span></code>）没有向量化实现。它们仍然可以使用，但计算速度可能会明显慢，并会显示 <code class="docutils literal notranslate"><span class="pre">PerformanceWarning</span></code>。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [187]: </span><span class="n">rng</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">BQuarterEnd</span><span class="p">()</span>
<span class="gh">Out[187]: </span><span class="go">DatetimeIndex(['2012-03-30', '2012-03-30', '2012-03-30'], dtype='datetime64[ns]', freq=None)</span>
</pre></div>
</div>
</section>
<section id="custom-business-days">
<span id="timeseries-custombusinessdays"></span><h3>自定义工作日<a class="headerlink" href="timeseries.html#custom-business-days" title="Link to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">CDay</span></code> 或 <code class="docutils literal notranslate"><span class="pre">CustomBusinessDay</span></code> 类提供了一个参数化的 <code class="docutils literal notranslate"><span class="pre">BusinessDay</span></code> 类，可用于创建自定义工作日历，其中考虑了当地假期和当地周末惯例。</p>
<p>作为一个有趣的例子，我们来看看埃及，那里实行周五至周六的周末。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [188]: </span><span class="n">weekmask_egypt</span> <span class="o">=</span> <span class="s2">"Sun Mon Tue Wed Thu"</span>

<span class="go"># They also observe International Workers' Day so let's</span>
<span class="go"># add that for a couple of years</span>
<span class="gp">In [189]: </span><span class="n">holidays</span> <span class="o">=</span> <span class="p">[</span>
<span class="gp">   .....: </span>    <span class="s2">"2012-05-01"</span><span class="p">,</span>
<span class="gp">   .....: </span>    <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
<span class="gp">   .....: </span>    <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s2">"2014-05-01"</span><span class="p">),</span>
<span class="gp">   .....: </span><span class="p">]</span>
<span class="gp">   .....: </span>

<span class="gp">In [190]: </span><span class="n">bday_egypt</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">CustomBusinessDay</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="n">holidays</span><span class="o">=</span><span class="n">holidays</span><span class="p">,</span>
<span class="gp">   .....: </span>    <span class="n">weekmask</span><span class="o">=</span><span class="n">weekmask_egypt</span><span class="p">,</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [191]: </span><span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>

<span class="gp">In [192]: </span><span class="n">dt</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">bday_egypt</span>
<span class="gh">Out[192]: </span><span class="go">Timestamp('2013-05-05 00:00:00')</span>
</pre></div>
</div>
<p>让我们映射到工作日名称。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [193]: </span><span class="n">dts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="n">bday_egypt</span><span class="p">)</span>

<span class="gp">In [194]: </span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">dts</span><span class="o">.</span><span class="n">weekday</span><span class="p">,</span> <span class="n">dts</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="s2">"Mon Tue Wed Thu Fri Sat Sun"</span><span class="o">.</span><span class="n">split</span><span class="p">()))</span>
<span class="gh">Out[194]: </span>
<span class="go">2013-04-30    Tue</span>
<span class="go">2013-05-02    Thu</span>
<span class="go">2013-05-05    Sun</span>
<span class="go">2013-05-06    Mon</span>
<span class="go">2013-05-07    Tue</span>
<span class="go">Freq: C, dtype: object</span>
</pre></div>
</div>
<p>假期日历可用于提供假期列表。更多信息请参阅<a class="reference internal" href="timeseries.html#timeseries-holiday"><span class="std std-ref">假期日历</span></a>部分。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [195]: </span><span class="kn">from</span><span class="w"> </span><span class="nn">pandas.tseries.holiday</span><span class="w"> </span><span class="kn">import</span> <span class="n">USFederalHolidayCalendar</span>

<span class="gp">In [196]: </span><span class="n">bday_us</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">CustomBusinessDay</span><span class="p">(</span><span class="n">calendar</span><span class="o">=</span><span class="n">USFederalHolidayCalendar</span><span class="p">())</span>

<span class="go"># Friday before MLK Day</span>
<span class="gp">In [197]: </span><span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2014</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">17</span><span class="p">)</span>

<span class="go"># Tuesday after MLK Day (Monday is skipped because it's a holiday)</span>
<span class="gp">In [198]: </span><span class="n">dt</span> <span class="o">+</span> <span class="n">bday_us</span>
<span class="gh">Out[198]: </span><span class="go">Timestamp('2014-01-21 00:00:00')</span>
</pre></div>
</div>
<p>遵守特定假期日历的月度偏移量可以按常规方式定义。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [199]: </span><span class="n">bmth_us</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">CustomBusinessMonthBegin</span><span class="p">(</span><span class="n">calendar</span><span class="o">=</span><span class="n">USFederalHolidayCalendar</span><span class="p">())</span>

<span class="go"># Skip new years</span>
<span class="gp">In [200]: </span><span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">17</span><span class="p">)</span>

<span class="gp">In [201]: </span><span class="n">dt</span> <span class="o">+</span> <span class="n">bmth_us</span>
<span class="gh">Out[201]: </span><span class="go">Timestamp('2014-01-02 00:00:00')</span>

<span class="go"># Define date index with custom offset</span>
<span class="gp">In [202]: </span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="s2">"20100101"</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">"20120101"</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="n">bmth_us</span><span class="p">)</span>
<span class="gh">Out[202]: </span>
<span class="go">DatetimeIndex(['2010-01-04', '2010-02-01', '2010-03-01', '2010-04-01',</span>
<span class="go">               '2010-05-03', '2010-06-01', '2010-07-01', '2010-08-02',</span>
<span class="go">               '2010-09-01', '2010-10-01', '2010-11-01', '2010-12-01',</span>
<span class="go">               '2011-01-03', '2011-02-01', '2011-03-01', '2011-04-01',</span>
<span class="go">               '2011-05-02', '2011-06-01', '2011-07-01', '2011-08-01',</span>
<span class="go">               '2011-09-01', '2011-10-03', '2011-11-01', '2011-12-01'],</span>
<span class="go">              dtype='datetime64[ns]', freq='CBMS')</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p>频率字符串'C'用于表示使用了CustomBusinessDay DateOffset，需要注意的是，由于CustomBusinessDay是一种参数化类型，CustomBusinessDay的实例可能有所不同，并且这无法从'C'频率字符串中检测出来。因此，用户需要确保在用户的应用程序中一致使用'C'频率字符串。</p>
</div>
</section>
<section id="business-hour">
<span id="timeseries-businesshour"></span><h3>营业时间<a class="headerlink" href="timeseries.html#business-hour" title="Link to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">BusinessHour</span></code> 类在 <code class="docutils literal notranslate"><span class="pre">BusinessDay</span></code> 上提供了营业时间表示，允许使用特定的开始和结束时间。</p>
<p>默认情况下，<code class="docutils literal notranslate"><span class="pre">BusinessHour</span></code> 使用 9:00 - 17:00 作为营业时间。添加 <code class="docutils literal notranslate"><span class="pre">BusinessHour</span></code> 将以小时频率增加 <code class="docutils literal notranslate"><span class="pre">Timestamp</span></code>。如果目标 <code class="docutils literal notranslate"><span class="pre">Timestamp</span></code> 超出营业时间，则移至下一个营业时间然后增加。如果结果超出营业时间结束，则剩余小时数将添加到下一个工作日。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [203]: </span><span class="n">bh</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">BusinessHour</span><span class="p">()</span>

<span class="gp">In [204]: </span><span class="n">bh</span>
<span class="gh">Out[204]: </span><span class="go">&lt;BusinessHour: bh=09:00-17:00&gt;</span>

<span class="go"># 2014-08-01 is Friday</span>
<span class="gp">In [205]: </span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">"2014-08-01 10:00"</span><span class="p">)</span><span class="o">.</span><span class="n">weekday</span><span class="p">()</span>
<span class="gh">Out[205]: </span><span class="go">4</span>

<span class="gp">In [206]: </span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">"2014-08-01 10:00"</span><span class="p">)</span> <span class="o">+</span> <span class="n">bh</span>
<span class="gh">Out[206]: </span><span class="go">Timestamp('2014-08-01 11:00:00')</span>

<span class="go"># Below example is the same as: pd.Timestamp('2014-08-01 09:00') + bh</span>
<span class="gp">In [207]: </span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">"2014-08-01 08:00"</span><span class="p">)</span> <span class="o">+</span> <span class="n">bh</span>
<span class="gh">Out[207]: </span><span class="go">Timestamp('2014-08-01 10:00:00')</span>

<span class="go"># If the results is on the end time, move to the next business day</span>
<span class="gp">In [208]: </span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">"2014-08-01 16:00"</span><span class="p">)</span> <span class="o">+</span> <span class="n">bh</span>
<span class="gh">Out[208]: </span><span class="go">Timestamp('2014-08-04 09:00:00')</span>

<span class="go"># Remainings are added to the next day</span>
<span class="gp">In [209]: </span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">"2014-08-01 16:30"</span><span class="p">)</span> <span class="o">+</span> <span class="n">bh</span>
<span class="gh">Out[209]: </span><span class="go">Timestamp('2014-08-04 09:30:00')</span>

<span class="go"># Adding 2 business hours</span>
<span class="gp">In [210]: </span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">"2014-08-01 10:00"</span><span class="p">)</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">BusinessHour</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="gh">Out[210]: </span><span class="go">Timestamp('2014-08-01 12:00:00')</span>

<span class="go"># Subtracting 3 business hours</span>
<span class="gp">In [211]: </span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">"2014-08-01 10:00"</span><span class="p">)</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">BusinessHour</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span>
<span class="gh">Out[211]: </span><span class="go">Timestamp('2014-07-31 15:00:00')</span>
</pre></div>
</div>
<p>您还可以通过关键字指定 <code class="docutils literal notranslate"><span class="pre">start</span></code> 和 <code class="docutils literal notranslate"><span class="pre">end</span></code> 时间。参数必须是 <code class="docutils literal notranslate"><span class="pre">hour:minute</span></code> 表示的 <code class="docutils literal notranslate"><span class="pre">str</span></code> 或 <code class="docutils literal notranslate"><span class="pre">datetime.time</span></code> 实例。将秒、微秒和纳秒指定为营业时间会导致 <code class="docutils literal notranslate"><span class="pre">ValueError</span></code>。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [212]: </span><span class="n">bh</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">BusinessHour</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="s2">"11:00"</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">time</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

<span class="gp">In [213]: </span><span class="n">bh</span>
<span class="gh">Out[213]: </span><span class="go">&lt;BusinessHour: bh=11:00-20:00&gt;</span>

<span class="gp">In [214]: </span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">"2014-08-01 13:00"</span><span class="p">)</span> <span class="o">+</span> <span class="n">bh</span>
<span class="gh">Out[214]: </span><span class="go">Timestamp('2014-08-01 14:00:00')</span>

<span class="gp">In [215]: </span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">"2014-08-01 09:00"</span><span class="p">)</span> <span class="o">+</span> <span class="n">bh</span>
<span class="gh">Out[215]: </span><span class="go">Timestamp('2014-08-01 12:00:00')</span>

<span class="gp">In [216]: </span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">"2014-08-01 18:00"</span><span class="p">)</span> <span class="o">+</span> <span class="n">bh</span>
<span class="gh">Out[216]: </span><span class="go">Timestamp('2014-08-01 19:00:00')</span>
</pre></div>
</div>
<p>将 <code class="docutils literal notranslate"><span class="pre">start</span></code> 时间传递晚于 <code class="docutils literal notranslate"><span class="pre">end</span></code> 时间表示午夜营业时间。在这种情况下，营业时间会跨越午夜并与第二天重叠。有效营业时间根据是否从有效 <code class="docutils literal notranslate"><span class="pre">BusinessDay</span></code> 开始来区分。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [217]: </span><span class="n">bh</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">BusinessHour</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="s2">"17:00"</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">"09:00"</span><span class="p">)</span>

<span class="gp">In [218]: </span><span class="n">bh</span>
<span class="gh">Out[218]: </span><span class="go">&lt;BusinessHour: bh=17:00-09:00&gt;</span>

<span class="gp">In [219]: </span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">"2014-08-01 17:00"</span><span class="p">)</span> <span class="o">+</span> <span class="n">bh</span>
<span class="gh">Out[219]: </span><span class="go">Timestamp('2014-08-01 18:00:00')</span>

<span class="gp">In [220]: </span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">"2014-08-01 23:00"</span><span class="p">)</span> <span class="o">+</span> <span class="n">bh</span>
<span class="gh">Out[220]: </span><span class="go">Timestamp('2014-08-02 00:00:00')</span>

<span class="go"># Although 2014-08-02 is Saturday,</span>
<span class="go"># it is valid because it starts from 08-01 (Friday).</span>
<span class="gp">In [221]: </span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">"2014-08-02 04:00"</span><span class="p">)</span> <span class="o">+</span> <span class="n">bh</span>
<span class="gh">Out[221]: </span><span class="go">Timestamp('2014-08-02 05:00:00')</span>

<span class="go"># Although 2014-08-04 is Monday,</span>
<span class="go"># it is out of business hours because it starts from 08-03 (Sunday).</span>
<span class="gp">In [222]: </span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">"2014-08-04 04:00"</span><span class="p">)</span> <span class="o">+</span> <span class="n">bh</span>
<span class="gh">Out[222]: </span><span class="go">Timestamp('2014-08-04 18:00:00')</span>
</pre></div>
</div>
<p>将 <code class="docutils literal notranslate"><span class="pre">BusinessHour.rollforward</span></code> 和 <code class="docutils literal notranslate"><span class="pre">rollback</span></code> 应用于营业时间之外，结果是下一个营业时间开始或前一天的结束。与其他偏移量不同，<code class="docutils literal notranslate"><span class="pre">BusinessHour.rollforward</span></code> 可能会根据定义输出与 <code class="docutils literal notranslate"><span class="pre">apply</span></code> 不同的结果。</p>
<p>这是因为一天的营业时间结束等于下一天的营业时间开始。例如，在默认营业时间（9:00 - 17:00）下，<code class="docutils literal notranslate"><span class="pre">2014-08-01</span> <span class="pre">17:00</span></code> 和 <code class="docutils literal notranslate"><span class="pre">2014-08-04</span> <span class="pre">09:00</span></code> 之间没有间隔（0 分钟）。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="go"># This adjusts a Timestamp to business hour edge</span>
<span class="gp">In [223]: </span><span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">BusinessHour</span><span class="p">()</span><span class="o">.</span><span class="n">rollback</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">"2014-08-02 15:00"</span><span class="p">))</span>
<span class="gh">Out[223]: </span><span class="go">Timestamp('2014-08-01 17:00:00')</span>

<span class="gp">In [224]: </span><span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">BusinessHour</span><span class="p">()</span><span class="o">.</span><span class="n">rollforward</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">"2014-08-02 15:00"</span><span class="p">))</span>
<span class="gh">Out[224]: </span><span class="go">Timestamp('2014-08-04 09:00:00')</span>

<span class="go"># It is the same as BusinessHour() + pd.Timestamp('2014-08-01 17:00').</span>
<span class="go"># And it is the same as BusinessHour() + pd.Timestamp('2014-08-04 09:00')</span>
<span class="gp">In [225]: </span><span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">BusinessHour</span><span class="p">()</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">"2014-08-02 15:00"</span><span class="p">)</span>
<span class="gh">Out[225]: </span><span class="go">Timestamp('2014-08-04 10:00:00')</span>

<span class="go"># BusinessDay results (for reference)</span>
<span class="gp">In [226]: </span><span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">BusinessHour</span><span class="p">()</span><span class="o">.</span><span class="n">rollforward</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">"2014-08-02"</span><span class="p">))</span>
<span class="gh">Out[226]: </span><span class="go">Timestamp('2014-08-04 09:00:00')</span>

<span class="go"># It is the same as BusinessDay() + pd.Timestamp('2014-08-01')</span>
<span class="go"># The result is the same as rollworward because BusinessDay never overlap.</span>
<span class="gp">In [227]: </span><span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">BusinessHour</span><span class="p">()</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">"2014-08-02"</span><span class="p">)</span>
<span class="gh">Out[227]: </span><span class="go">Timestamp('2014-08-04 10:00:00')</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">BusinessHour</span></code> 将周六和周日视为假期。要使用任意假期，您可以使用 <code class="docutils literal notranslate"><span class="pre">CustomBusinessHour</span></code> 偏移量，如下一小节所述。</p>
</section>
<section id="custom-business-hour">
<span id="timeseries-custombusinesshour"></span><h3>自定义营业时间<a class="headerlink" href="timeseries.html#custom-business-hour" title="Link to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">CustomBusinessHour</span></code> 是 <code class="docutils literal notranslate"><span class="pre">BusinessHour</span></code> 和 <code class="docutils literal notranslate"><span class="pre">CustomBusinessDay</span></code> 的混合体，允许您指定任意假期。<code class="docutils literal notranslate"><span class="pre">CustomBusinessHour</span></code> 的工作方式与 <code class="docutils literal notranslate"><span class="pre">BusinessHour</span></code> 相同，只是它会跳过指定的自定义假期。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [228]: </span><span class="kn">from</span><span class="w"> </span><span class="nn">pandas.tseries.holiday</span><span class="w"> </span><span class="kn">import</span> <span class="n">USFederalHolidayCalendar</span>

<span class="gp">In [229]: </span><span class="n">bhour_us</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">CustomBusinessHour</span><span class="p">(</span><span class="n">calendar</span><span class="o">=</span><span class="n">USFederalHolidayCalendar</span><span class="p">())</span>

<span class="go"># Friday before MLK Day</span>
<span class="gp">In [230]: </span><span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2014</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>

<span class="gp">In [231]: </span><span class="n">dt</span> <span class="o">+</span> <span class="n">bhour_us</span>
<span class="gh">Out[231]: </span><span class="go">Timestamp('2014-01-17 16:00:00')</span>

<span class="go"># Tuesday after MLK Day (Monday is skipped because it's a holiday)</span>
<span class="gp">In [232]: </span><span class="n">dt</span> <span class="o">+</span> <span class="n">bhour_us</span> <span class="o">*</span> <span class="mi">2</span>
<span class="gh">Out[232]: </span><span class="go">Timestamp('2014-01-21 09:00:00')</span>
</pre></div>
</div>
<p>您可以使用 <code class="docutils literal notranslate"><span class="pre">BusinessHour</span></code> 和 <code class="docutils literal notranslate"><span class="pre">CustomBusinessDay</span></code> 支持的关键字参数。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [233]: </span><span class="n">bhour_mon</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">CustomBusinessHour</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="s2">"10:00"</span><span class="p">,</span> <span class="n">weekmask</span><span class="o">=</span><span class="s2">"Tue Wed Thu Fri"</span><span class="p">)</span>

<span class="go"># Monday is skipped because it's a holiday, business hour starts from 10:00</span>
<span class="gp">In [234]: </span><span class="n">dt</span> <span class="o">+</span> <span class="n">bhour_mon</span> <span class="o">*</span> <span class="mi">2</span>
<span class="gh">Out[234]: </span><span class="go">Timestamp('2014-01-21 10:00:00')</span>
</pre></div>
</div>
</section>
<section id="offset-aliases">
<span id="timeseries-offset-aliases"></span><h3>偏移量别名<a class="headerlink" href="timeseries.html#offset-aliases" title="Link to this heading">#</a></h3>
<p>一些有用的常见时间序列频率被赋予了字符串别名。我们将这些别名称为<em>偏移别名</em>。</p>
<table class="table">
<colgroup>
<col style="width: 13.0%" />
<col style="width: 87.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>别名</p></th>
<th class="head"><p>描述</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>B</p></td>
<td><p>工作日频率</p></td>
</tr>
<tr class="row-odd"><td><p>C</p></td>
<td><p>自定义工作日频率</p></td>
</tr>
<tr class="row-even"><td><p>D</p></td>
<td><p>日历日频率</p></td>
</tr>
<tr class="row-odd"><td><p>W</p></td>
<td><p>每周频率</p></td>
</tr>
<tr class="row-even"><td><p>ME</p></td>
<td><p>月末频率</p></td>
</tr>
<tr class="row-odd"><td><p>SME</p></td>
<td><p>半月月末频率（15日和月末）</p></td>
</tr>
<tr class="row-even"><td><p>BME</p></td>
<td><p>营业月月末频率</p></td>
</tr>
<tr class="row-odd"><td><p>CBME</p></td>
<td><p>自定义营业月月末频率</p></td>
</tr>
<tr class="row-even"><td><p>MS</p></td>
<td><p>月起始频率</p></td>
</tr>
<tr class="row-odd"><td><p>SMS</p></td>
<td><p>半月起始频率（1日和15日）</p></td>
</tr>
<tr class="row-even"><td><p>BMS</p></td>
<td><p>营业月起始频率</p></td>
</tr>
<tr class="row-odd"><td><p>CBMS</p></td>
<td><p>自定义营业月起始频率</p></td>
</tr>
<tr class="row-even"><td><p>QE</p></td>
<td><p>季度末频率</p></td>
</tr>
<tr class="row-odd"><td><p>BQE</p></td>
<td><p>营业季末频率</p></td>
</tr>
<tr class="row-even"><td><p>QS</p></td>
<td><p>季度起始频率</p></td>
</tr>
<tr class="row-odd"><td><p>BQS</p></td>
<td><p>营业季起始频率</p></td>
</tr>
<tr class="row-even"><td><p>YE</p></td>
<td><p>年末频率</p></td>
</tr>
<tr class="row-odd"><td><p>BYE</p></td>
<td><p>营业年末频率</p></td>
</tr>
<tr class="row-even"><td><p>YS</p></td>
<td><p>年起始频率</p></td>
</tr>
<tr class="row-odd"><td><p>BYS</p></td>
<td><p>营业年起始频率</p></td>
</tr>
<tr class="row-even"><td><p>h</p></td>
<td><p>小时频率</p></td>
</tr>
<tr class="row-odd"><td><p>bh</p></td>
<td><p>营业小时频率</p></td>
</tr>
<tr class="row-even"><td><p>cbh</p></td>
<td><p>自定义营业小时频率</p></td>
</tr>
<tr class="row-odd"><td><p>min</p></td>
<td><p>分钟频率</p></td>
</tr>
<tr class="row-even"><td><p>s</p></td>
<td><p>秒频率</p></td>
</tr>
<tr class="row-odd"><td><p>ms</p></td>
<td><p>毫秒</p></td>
</tr>
<tr class="row-even"><td><p>us</p></td>
<td><p>微秒</p></td>
</tr>
<tr class="row-odd"><td><p>ns</p></td>
<td><p>纳秒</p></td>
</tr>
</tbody>
</table>
<div class="deprecated">
<p><span class="versionmodified deprecated">自 2.2.0 版起已弃用: </span>别名 <code class="docutils literal notranslate"><span class="pre">H</span></code>、<code class="docutils literal notranslate"><span class="pre">BH</span></code>、<code class="docutils literal notranslate"><span class="pre">CBH</span></code>、<code class="docutils literal notranslate"><span class="pre">T</span></code>、<code class="docutils literal notranslate"><span class="pre">S</span></code>、<code class="docutils literal notranslate"><span class="pre">L</span></code>、<code class="docutils literal notranslate"><span class="pre">U</span></code> 和 <code class="docutils literal notranslate"><span class="pre">N</span></code> 已弃用，推荐使用别名 <code class="docutils literal notranslate"><span class="pre">h</span></code>、<code class="docutils literal notranslate"><span class="pre">bh</span></code>、<code class="docutils literal notranslate"><span class="pre">cbh</span></code>、<code class="docutils literal notranslate"><span class="pre">min</span></code>、<code class="docutils literal notranslate"><span class="pre">s</span></code>、<code class="docutils literal notranslate"><span class="pre">ms</span></code>、<code class="docutils literal notranslate"><span class="pre">us</span></code> 和 <code class="docutils literal notranslate"><span class="pre">ns</span></code>。</p>
</div>
<div class="admonition note">
<p class="admonition-title">注意</p>
<blockquote>
<div><p>使用上述偏移别名时，需要注意的是，像 <a class="reference internal" href="../reference/api/pandas.date_range.html#pandas.date_range" title="pandas.date_range"><code class="xref py py-func docutils literal notranslate"><span class="pre">date_range()</span></code></a>、<a class="reference internal" href="../reference/api/pandas.bdate_range.html#pandas.bdate_range" title="pandas.bdate_range"><code class="xref py py-func docutils literal notranslate"><span class="pre">bdate_range()</span></code></a> 等函数将只返回 <code class="docutils literal notranslate"><span class="pre">start_date</span></code> 和 <code class="docutils literal notranslate"><span class="pre">end_date</span></code> 定义的区间内的时间戳。如果 <code class="docutils literal notranslate"><span class="pre">start_date</span></code> 不对应频率，返回的时间戳将从下一个有效时间戳开始；对于 <code class="docutils literal notranslate"><span class="pre">end_date</span></code>，返回的时间戳将停止在前一个有效时间戳。</p>
</div></blockquote>
<p>例如，对于偏移量 <code class="docutils literal notranslate"><span class="pre">MS</span></code>，如果 <code class="docutils literal notranslate"><span class="pre">start_date</span></code> 不是该月的第一天，则返回的时间戳将从下个月的第一天开始。如果 <code class="docutils literal notranslate"><span class="pre">end_date</span></code> 不是某月的第一天，则最后返回的时间戳将是对应月份的第一天。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [235]: </span><span class="n">dates_lst_1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">"2020-01-06"</span><span class="p">,</span> <span class="s2">"2020-04-03"</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"MS"</span><span class="p">)</span>

<span class="gp">In [236]: </span><span class="n">dates_lst_1</span>
<span class="gh">Out[236]: </span><span class="go">DatetimeIndex(['2020-02-01', '2020-03-01', '2020-04-01'], dtype='datetime64[ns]', freq='MS')</span>

<span class="gp">In [237]: </span><span class="n">dates_lst_2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">"2020-01-01"</span><span class="p">,</span> <span class="s2">"2020-04-01"</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"MS"</span><span class="p">)</span>

<span class="gp">In [238]: </span><span class="n">dates_lst_2</span>
<span class="gh">Out[238]: </span><span class="go">DatetimeIndex(['2020-01-01', '2020-02-01', '2020-03-01', '2020-04-01'], dtype='datetime64[ns]', freq='MS')</span>
</pre></div>
</div>
<p>我们可以看到在上面的例子中，<a class="reference internal" href="../reference/api/pandas.date_range.html#pandas.date_range" title="pandas.date_range"><code class="xref py py-func docutils literal notranslate"><span class="pre">date_range()</span></code></a> 和 <a class="reference internal" href="../reference/api/pandas.bdate_range.html#pandas.bdate_range" title="pandas.bdate_range"><code class="xref py py-func docutils literal notranslate"><span class="pre">bdate_range()</span></code></a> 只会返回 <code class="docutils literal notranslate"><span class="pre">start_date</span></code> 和 <code class="docutils literal notranslate"><span class="pre">end_date</span></code> 之间的有效时间戳。如果这些时间戳对于给定的频率无效，它将滚动到 <code class="docutils literal notranslate"><span class="pre">start_date</span></code> 的下一个有效值（<code class="docutils literal notranslate"><span class="pre">end_date</span></code> 则滚动到前一个有效值）。</p>
</div>
</section>
<section id="period-aliases">
<span id="timeseries-period-aliases"></span><h3>周期别名<a class="headerlink" href="timeseries.html#period-aliases" title="Link to this heading">#</a></h3>
<p>一些有用的常见时间序列频率被赋予了字符串别名。我们将这些别名称为<em>周期别名</em>。</p>
<table class="table">
<colgroup>
<col style="width: 13.0%" />
<col style="width: 87.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>别名</p></th>
<th class="head"><p>描述</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>B</p></td>
<td><p>工作日频率</p></td>
</tr>
<tr class="row-odd"><td><p>D</p></td>
<td><p>日历日频率</p></td>
</tr>
<tr class="row-even"><td><p>W</p></td>
<td><p>每周频率</p></td>
</tr>
<tr class="row-odd"><td><p>M</p></td>
<td><p>月度频率</p></td>
</tr>
<tr class="row-even"><td><p>Q</p></td>
<td><p>季度频率</p></td>
</tr>
<tr class="row-odd"><td><p>Y</p></td>
<td><p>年度频率</p></td>
</tr>
<tr class="row-even"><td><p>h</p></td>
<td><p>小时频率</p></td>
</tr>
<tr class="row-odd"><td><p>min</p></td>
<td><p>分钟频率</p></td>
</tr>
<tr class="row-even"><td><p>s</p></td>
<td><p>秒频率</p></td>
</tr>
<tr class="row-odd"><td><p>ms</p></td>
<td><p>毫秒</p></td>
</tr>
<tr class="row-even"><td><p>us</p></td>
<td><p>微秒</p></td>
</tr>
<tr class="row-odd"><td><p>ns</p></td>
<td><p>纳秒</p></td>
</tr>
</tbody>
</table>
<div class="deprecated">
<p><span class="versionmodified deprecated">自 2.2.0 版起已弃用: </span>别名 <code class="docutils literal notranslate"><span class="pre">A</span></code>、<code class="docutils literal notranslate"><span class="pre">H</span></code>、<code class="docutils literal notranslate"><span class="pre">T</span></code>、<code class="docutils literal notranslate"><span class="pre">S</span></code>、<code class="docutils literal notranslate"><span class="pre">L</span></code>、<code class="docutils literal notranslate"><span class="pre">U</span></code> 和 <code class="docutils literal notranslate"><span class="pre">N</span></code> 已弃用，推荐使用别名 <code class="docutils literal notranslate"><span class="pre">Y</span></code>、<code class="docutils literal notranslate"><span class="pre">h</span></code>、<code class="docutils literal notranslate"><span class="pre">min</span></code>、<code class="docutils literal notranslate"><span class="pre">s</span></code>、<code class="docutils literal notranslate"><span class="pre">ms</span></code>、<code class="docutils literal notranslate"><span class="pre">us</span></code> 和 <code class="docutils literal notranslate"><span class="pre">ns</span></code>。</p>
</div>
</section>
<section id="combining-aliases">
<h3>合并别名<a class="headerlink" href="timeseries.html#combining-aliases" title="Link to this heading">#</a></h3>
<p>如我们之前所见，在大多数函数中，别名和偏移实例是可以互换的。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [239]: </span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"B"</span><span class="p">)</span>
<span class="gh">Out[239]: </span>
<span class="go">DatetimeIndex(['2011-01-03', '2011-01-04', '2011-01-05', '2011-01-06',</span>
<span class="go">               '2011-01-07'],</span>
<span class="go">              dtype='datetime64[ns]', freq='B')</span>

<span class="gp">In [240]: </span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">BDay</span><span class="p">())</span>
<span class="gh">Out[240]: </span>
<span class="go">DatetimeIndex(['2011-01-03', '2011-01-04', '2011-01-05', '2011-01-06',</span>
<span class="go">               '2011-01-07'],</span>
<span class="go">              dtype='datetime64[ns]', freq='B')</span>
</pre></div>
</div>
<p>您可以将日偏移和日内偏移结合起来。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [241]: </span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"2h20min"</span><span class="p">)</span>
<span class="gh">Out[241]: </span>
<span class="go">DatetimeIndex(['2011-01-01 00:00:00', '2011-01-01 02:20:00',</span>
<span class="go">               '2011-01-01 04:40:00', '2011-01-01 07:00:00',</span>
<span class="go">               '2011-01-01 09:20:00', '2011-01-01 11:40:00',</span>
<span class="go">               '2011-01-01 14:00:00', '2011-01-01 16:20:00',</span>
<span class="go">               '2011-01-01 18:40:00', '2011-01-01 21:00:00'],</span>
<span class="go">              dtype='datetime64[ns]', freq='140min')</span>

<span class="gp">In [242]: </span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"1D10us"</span><span class="p">)</span>
<span class="gh">Out[242]: </span>
<span class="go">DatetimeIndex([       '2011-01-01 00:00:00', '2011-01-02 00:00:00.000010',</span>
<span class="go">               '2011-01-03 00:00:00.000020', '2011-01-04 00:00:00.000030',</span>
<span class="go">               '2011-01-05 00:00:00.000040', '2011-01-06 00:00:00.000050',</span>
<span class="go">               '2011-01-07 00:00:00.000060', '2011-01-08 00:00:00.000070',</span>
<span class="go">               '2011-01-09 00:00:00.000080', '2011-01-10 00:00:00.000090'],</span>
<span class="go">              dtype='datetime64[ns]', freq='86400000010us')</span>
</pre></div>
</div>
</section>
<section id="anchored-offsets">
<h3>锚定偏移量<a class="headerlink" href="timeseries.html#anchored-offsets" title="Link to this heading">#</a></h3>
<p>对于某些频率，您可以指定一个锚定后缀。</p>
<table class="table">
<colgroup>
<col style="width: 13.0%" />
<col style="width: 87.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>别名</p></th>
<th class="head"><p>描述</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>W-SUN</p></td>
<td><p>每周频率（星期日）。与“W”相同</p></td>
</tr>
<tr class="row-odd"><td><p>W-MON</p></td>
<td><p>每周频率（星期一）</p></td>
</tr>
<tr class="row-even"><td><p>W-TUE</p></td>
<td><p>每周频率（星期二）</p></td>
</tr>
<tr class="row-odd"><td><p>W-WED</p></td>
<td><p>每周频率（星期三）</p></td>
</tr>
<tr class="row-even"><td><p>W-THU</p></td>
<td><p>每周频率（星期四）</p></td>
</tr>
<tr class="row-odd"><td><p>W-FRI</p></td>
<td><p>每周频率（星期五）</p></td>
</tr>
<tr class="row-even"><td><p>W-SAT</p></td>
<td><p>每周频率（星期六）</p></td>
</tr>
<tr class="row-odd"><td><p>(B)Q(E)(S)-DEC</p></td>
<td><p>季度频率，年末在十二月。与“QE”相同</p></td>
</tr>
<tr class="row-even"><td><p>(B)Q(E)(S)-JAN</p></td>
<td><p>季度频率，年末在一月</p></td>
</tr>
<tr class="row-odd"><td><p>(B)Q(E)(S)-FEB</p></td>
<td><p>季度频率，年末在二月</p></td>
</tr>
<tr class="row-even"><td><p>(B)Q(E)(S)-MAR</p></td>
<td><p>季度频率，年末在三月</p></td>
</tr>
<tr class="row-odd"><td><p>(B)Q(E)(S)-APR</p></td>
<td><p>季度频率，年末在四月</p></td>
</tr>
<tr class="row-even"><td><p>(B)Q(E)(S)-MAY</p></td>
<td><p>季度频率，年末在五月</p></td>
</tr>
<tr class="row-odd"><td><p>(B)Q(E)(S)-JUN</p></td>
<td><p>季度频率，年末在六月</p></td>
</tr>
<tr class="row-even"><td><p>(B)Q(E)(S)-JUL</p></td>
<td><p>季度频率，年末在七月</p></td>
</tr>
<tr class="row-odd"><td><p>(B)Q(E)(S)-AUG</p></td>
<td><p>季度频率，年末在八月</p></td>
</tr>
<tr class="row-even"><td><p>(B)Q(E)(S)-SEP</p></td>
<td><p>季度频率，年末在九月</p></td>
</tr>
<tr class="row-odd"><td><p>(B)Q(E)(S)-OCT</p></td>
<td><p>季度频率，年末在十月</p></td>
</tr>
<tr class="row-even"><td><p>(B)Q(E)(S)-NOV</p></td>
<td><p>季度频率，年末在十一月</p></td>
</tr>
<tr class="row-odd"><td><p>(B)Y(E)(S)-DEC</p></td>
<td><p>年度频率，锚定在十二月末。与“YE”相同</p></td>
</tr>
<tr class="row-even"><td><p>(B)Y(E)(S)-JAN</p></td>
<td><p>年度频率，锚定在一月末</p></td>
</tr>
<tr class="row-odd"><td><p>(B)Y(E)(S)-FEB</p></td>
<td><p>年度频率，锚定在二月末</p></td>
</tr>
<tr class="row-even"><td><p>(B)Y(E)(S)-MAR</p></td>
<td><p>年度频率，锚定在三月末</p></td>
</tr>
<tr class="row-odd"><td><p>(B)Y(E)(S)-APR</p></td>
<td><p>年度频率，锚定在四月末</p></td>
</tr>
<tr class="row-even"><td><p>(B)Y(E)(S)-MAY</p></td>
<td><p>年度频率，锚定在五月末</p></td>
</tr>
<tr class="row-odd"><td><p>(B)Y(E)(S)-JUN</p></td>
<td><p>年度频率，锚定在六月末</p></td>
</tr>
<tr class="row-even"><td><p>(B)Y(E)(S)-JUL</p></td>
<td><p>年度频率，锚定在七月末</p></td>
</tr>
<tr class="row-odd"><td><p>(B)Y(E)(S)-AUG</p></td>
<td><p>年度频率，锚定在八月末</p></td>
</tr>
<tr class="row-even"><td><p>(B)Y(E)(S)-SEP</p></td>
<td><p>年度频率，锚定在九月末</p></td>
</tr>
<tr class="row-odd"><td><p>(B)Y(E)(S)-OCT</p></td>
<td><p>年度频率，锚定在十月末</p></td>
</tr>
<tr class="row-even"><td><p>(B)Y(E)(S)-NOV</p></td>
<td><p>年度频率，锚定在十一月末</p></td>
</tr>
</tbody>
</table>
<p>这些可以作为参数传递给 <code class="docutils literal notranslate"><span class="pre">date_range</span></code>、<code class="docutils literal notranslate"><span class="pre">bdate_range</span></code>、<code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code> 的构造函数以及 pandas 中各种其他时间序列相关函数。</p>
</section>
<section id="anchored-offset-semantics">
<h3>锚定偏移量语义<a class="headerlink" href="timeseries.html#anchored-offset-semantics" title="Link to this heading">#</a></h3>
<p>对于那些锚定在特定频率（<code class="docutils literal notranslate"><span class="pre">MonthEnd</span></code>、<code class="docutils literal notranslate"><span class="pre">MonthBegin</span></code>、<code class="docutils literal notranslate"><span class="pre">WeekEnd</span></code> 等）起始或结束的偏移量，以下规则适用于向前和向后滚动。</p>
<p>当 <code class="docutils literal notranslate"><span class="pre">n</span></code> 不为 0 时，如果给定日期不在锚点上，它将被捕捉到下一个（上一个）锚点，并向前或向后额外移动 <code class="docutils literal notranslate"><span class="pre">|n|-1</span></code> 步。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [243]: </span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">"2014-01-02"</span><span class="p">)</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">MonthBegin</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gh">Out[243]: </span><span class="go">Timestamp('2014-02-01 00:00:00')</span>

<span class="gp">In [244]: </span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">"2014-01-02"</span><span class="p">)</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">MonthEnd</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gh">Out[244]: </span><span class="go">Timestamp('2014-01-31 00:00:00')</span>

<span class="gp">In [245]: </span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">"2014-01-02"</span><span class="p">)</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">MonthBegin</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gh">Out[245]: </span><span class="go">Timestamp('2014-01-01 00:00:00')</span>

<span class="gp">In [246]: </span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">"2014-01-02"</span><span class="p">)</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">MonthEnd</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gh">Out[246]: </span><span class="go">Timestamp('2013-12-31 00:00:00')</span>

<span class="gp">In [247]: </span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">"2014-01-02"</span><span class="p">)</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">MonthBegin</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="gh">Out[247]: </span><span class="go">Timestamp('2014-05-01 00:00:00')</span>

<span class="gp">In [248]: </span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">"2014-01-02"</span><span class="p">)</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">MonthBegin</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="gh">Out[248]: </span><span class="go">Timestamp('2013-10-01 00:00:00')</span>
</pre></div>
</div>
<p>如果给定日期<em>在</em>锚点上，则将其向前或向后移动 <code class="docutils literal notranslate"><span class="pre">|n|</span></code> 个点。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [249]: </span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">"2014-01-01"</span><span class="p">)</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">MonthBegin</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gh">Out[249]: </span><span class="go">Timestamp('2014-02-01 00:00:00')</span>

<span class="gp">In [250]: </span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">"2014-01-31"</span><span class="p">)</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">MonthEnd</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gh">Out[250]: </span><span class="go">Timestamp('2014-02-28 00:00:00')</span>

<span class="gp">In [251]: </span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">"2014-01-01"</span><span class="p">)</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">MonthBegin</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gh">Out[251]: </span><span class="go">Timestamp('2013-12-01 00:00:00')</span>

<span class="gp">In [252]: </span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">"2014-01-31"</span><span class="p">)</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">MonthEnd</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gh">Out[252]: </span><span class="go">Timestamp('2013-12-31 00:00:00')</span>

<span class="gp">In [253]: </span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">"2014-01-01"</span><span class="p">)</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">MonthBegin</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="gh">Out[253]: </span><span class="go">Timestamp('2014-05-01 00:00:00')</span>

<span class="gp">In [254]: </span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">"2014-01-31"</span><span class="p">)</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">MonthBegin</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="gh">Out[254]: </span><span class="go">Timestamp('2013-10-01 00:00:00')</span>
</pre></div>
</div>
<p>当 <code class="docutils literal notranslate"><span class="pre">n=0</span></code> 时，如果日期在锚点上，则不移动；否则，将其向前滚动到下一个锚点。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [255]: </span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">"2014-01-02"</span><span class="p">)</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">MonthBegin</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="gh">Out[255]: </span><span class="go">Timestamp('2014-02-01 00:00:00')</span>

<span class="gp">In [256]: </span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">"2014-01-02"</span><span class="p">)</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">MonthEnd</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="gh">Out[256]: </span><span class="go">Timestamp('2014-01-31 00:00:00')</span>

<span class="gp">In [257]: </span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">"2014-01-01"</span><span class="p">)</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">MonthBegin</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="gh">Out[257]: </span><span class="go">Timestamp('2014-01-01 00:00:00')</span>

<span class="gp">In [258]: </span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">"2014-01-31"</span><span class="p">)</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">MonthEnd</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="gh">Out[258]: </span><span class="go">Timestamp('2014-01-31 00:00:00')</span>
</pre></div>
</div>
</section>
<section id="holidays-holiday-calendars">
<span id="timeseries-holiday"></span><h3>假期 / 假期日历<a class="headerlink" href="timeseries.html#holidays-holiday-calendars" title="Link to this heading">#</a></h3>
<p>假期和日历提供了一种简单的方式来定义假期规则，以便与 <code class="docutils literal notranslate"><span class="pre">CustomBusinessDay</span></code> 或其他需要预定义假期集的分析一起使用。<code class="docutils literal notranslate"><span class="pre">AbstractHolidayCalendar</span></code> 类提供了返回假期列表所需的所有方法，并且只需在特定的假期日历类中定义 <code class="docutils literal notranslate"><span class="pre">rules</span></code>。此外，<code class="docutils literal notranslate"><span class="pre">start_date</span></code> 和 <code class="docutils literal notranslate"><span class="pre">end_date</span></code> 类属性决定了生成假期的日期范围。这些应该在 <code class="docutils literal notranslate"><span class="pre">AbstractHolidayCalendar</span></code> 类上被覆盖，以使该范围适用于所有日历子类。<code class="docutils literal notranslate"><span class="pre">USFederalHolidayCalendar</span></code> 是唯一存在的日历，主要作为开发其他日历的示例。</p>
<p>对于固定日期发生的假期（例如，美国阵亡将士纪念日或7月4日），如果假期落在周末或某些其他非观测日，则遵守规则决定何时遵守该假期。定义的遵守规则有：</p>
<table class="table">
<colgroup>
<col style="width: 17.6%" />
<col style="width: 82.4%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>规则</p></th>
<th class="head"><p>描述</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>nearest_workday</p></td>
<td><p>将周六移至周五，周日移至周一</p></td>
</tr>
<tr class="row-odd"><td><p>sunday_to_monday</p></td>
<td><p>将周日移至下一个周一</p></td>
</tr>
<tr class="row-even"><td><p>next_monday_or_tuesday</p></td>
<td><p>将周六移至周一，周日/周一移至周二</p></td>
</tr>
<tr class="row-odd"><td><p>previous_friday</p></td>
<td><p>将周六和周日移至前一个周五”</p></td>
</tr>
<tr class="row-even"><td><p>next_monday</p></td>
<td><p>将周六和周日移至下一个周一</p></td>
</tr>
</tbody>
</table>
<p>假期和假期日历的定义示例如下：</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [259]: </span><span class="kn">from</span><span class="w"> </span><span class="nn">pandas.tseries.holiday</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
<span class="gp">   .....: </span>    <span class="n">Holiday</span><span class="p">,</span>
<span class="gp">   .....: </span>    <span class="n">USMemorialDay</span><span class="p">,</span>
<span class="gp">   .....: </span>    <span class="n">AbstractHolidayCalendar</span><span class="p">,</span>
<span class="gp">   .....: </span>    <span class="n">nearest_workday</span><span class="p">,</span>
<span class="gp">   .....: </span>    <span class="n">MO</span><span class="p">,</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [260]: </span><span class="k">class</span><span class="w"> </span><span class="nc">ExampleCalendar</span><span class="p">(</span><span class="n">AbstractHolidayCalendar</span><span class="p">):</span>
<span class="gp">   .....: </span>    <span class="n">rules</span> <span class="o">=</span> <span class="p">[</span>
<span class="gp">   .....: </span>        <span class="n">USMemorialDay</span><span class="p">,</span>
<span class="gp">   .....: </span>        <span class="n">Holiday</span><span class="p">(</span><span class="s2">"July 4th"</span><span class="p">,</span> <span class="n">month</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">observance</span><span class="o">=</span><span class="n">nearest_workday</span><span class="p">),</span>
<span class="gp">   .....: </span>        <span class="n">Holiday</span><span class="p">(</span>
<span class="gp">   .....: </span>            <span class="s2">"Columbus Day"</span><span class="p">,</span>
<span class="gp">   .....: </span>            <span class="n">month</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<span class="gp">   .....: </span>            <span class="n">day</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="gp">   .....: </span>            <span class="n">offset</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">weekday</span><span class="o">=</span><span class="n">MO</span><span class="p">(</span><span class="mi">2</span><span class="p">)),</span>
<span class="gp">   .....: </span>        <span class="p">),</span>
<span class="gp">   .....: </span>    <span class="p">]</span>
<span class="gp">   .....: </span>

<span class="gp">In [261]: </span><span class="n">cal</span> <span class="o">=</span> <span class="n">ExampleCalendar</span><span class="p">()</span>

<span class="gp">In [262]: </span><span class="n">cal</span><span class="o">.</span><span class="n">holidays</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">31</span><span class="p">))</span>
<span class="gh">Out[262]: </span><span class="go">DatetimeIndex(['2012-05-28', '2012-07-04', '2012-10-08'], dtype='datetime64[ns]', freq=None)</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">提示<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>weekday=MO(2)</strong> 与 <strong>2 * Week(weekday=2)</strong> 相同</p>
</dd>
</dl>
<p>使用此日历，创建索引或进行偏移量算术时会跳过周末和假期（即，阵亡将士纪念日/7月4日）。例如，下面使用 <code class="docutils literal notranslate"><span class="pre">ExampleCalendar</span></code> 定义了一个自定义工作日偏移量。像任何其他偏移量一样，它可以用于创建 <code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code> 或添加到 <code class="docutils literal notranslate"><span class="pre">datetime</span></code> 或 <code class="docutils literal notranslate"><span class="pre">Timestamp</span></code> 对象。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [263]: </span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="n">start</span><span class="o">=</span><span class="s2">"7/1/2012"</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">"7/10/2012"</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">CDay</span><span class="p">(</span><span class="n">calendar</span><span class="o">=</span><span class="n">cal</span><span class="p">)</span>
<span class="gp">   .....: </span><span class="p">)</span><span class="o">.</span><span class="n">to_pydatetime</span><span class="p">()</span>
<span class="gp">   .....: </span>
<span class="gh">Out[263]: </span>
<span class="go">array([datetime.datetime(2012, 7, 2, 0, 0),</span>
<span class="go">       datetime.datetime(2012, 7, 3, 0, 0),</span>
<span class="go">       datetime.datetime(2012, 7, 5, 0, 0),</span>
<span class="go">       datetime.datetime(2012, 7, 6, 0, 0),</span>
<span class="go">       datetime.datetime(2012, 7, 9, 0, 0),</span>
<span class="go">       datetime.datetime(2012, 7, 10, 0, 0)], dtype=object)</span>

<span class="gp">In [264]: </span><span class="n">offset</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">CustomBusinessDay</span><span class="p">(</span><span class="n">calendar</span><span class="o">=</span><span class="n">cal</span><span class="p">)</span>

<span class="gp">In [265]: </span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span> <span class="o">+</span> <span class="n">offset</span>
<span class="gh">Out[265]: </span><span class="go">Timestamp('2012-05-29 00:00:00')</span>

<span class="gp">In [266]: </span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">offset</span>
<span class="gh">Out[266]: </span><span class="go">Timestamp('2012-07-05 00:00:00')</span>

<span class="gp">In [267]: </span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">offset</span>
<span class="gh">Out[267]: </span><span class="go">Timestamp('2012-07-06 00:00:00')</span>

<span class="gp">In [268]: </span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">+</span> <span class="n">offset</span>
<span class="gh">Out[268]: </span><span class="go">Timestamp('2012-07-09 00:00:00')</span>
</pre></div>
</div>
<p>范围由 <code class="docutils literal notranslate"><span class="pre">AbstractHolidayCalendar</span></code> 的 <code class="docutils literal notranslate"><span class="pre">start_date</span></code> 和 <code class="docutils literal notranslate"><span class="pre">end_date</span></code> 类属性定义。默认值如下所示。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [269]: </span><span class="n">AbstractHolidayCalendar</span><span class="o">.</span><span class="n">start_date</span>
<span class="gh">Out[269]: </span><span class="go">Timestamp('1970-01-01 00:00:00')</span>

<span class="gp">In [270]: </span><span class="n">AbstractHolidayCalendar</span><span class="o">.</span><span class="n">end_date</span>
<span class="gh">Out[270]: </span><span class="go">Timestamp('2200-12-31 00:00:00')</span>
</pre></div>
</div>
<p>这些日期可以通过将属性设置为 datetime/Timestamp/string 来覆盖。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [271]: </span><span class="n">AbstractHolidayCalendar</span><span class="o">.</span><span class="n">start_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="gp">In [272]: </span><span class="n">AbstractHolidayCalendar</span><span class="o">.</span><span class="n">end_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">31</span><span class="p">)</span>

<span class="gp">In [273]: </span><span class="n">cal</span><span class="o">.</span><span class="n">holidays</span><span class="p">()</span>
<span class="gh">Out[273]: </span><span class="go">DatetimeIndex(['2012-05-28', '2012-07-04', '2012-10-08'], dtype='datetime64[ns]', freq=None)</span>
</pre></div>
</div>
<p>每个日历类都可以通过 <code class="docutils literal notranslate"><span class="pre">get_calendar</span></code> 函数按名称访问，该函数返回一个假期类实例。任何导入的日历类都将自动通过此函数可用。此外，<code class="docutils literal notranslate"><span class="pre">HolidayCalendarFactory</span></code> 提供了一个简单的接口来创建日历，这些日历是日历的组合或带有额外规则的日历。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [274]: </span><span class="kn">from</span><span class="w"> </span><span class="nn">pandas.tseries.holiday</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_calendar</span><span class="p">,</span> <span class="n">HolidayCalendarFactory</span><span class="p">,</span> <span class="n">USLaborDay</span>

<span class="gp">In [275]: </span><span class="n">cal</span> <span class="o">=</span> <span class="n">get_calendar</span><span class="p">(</span><span class="s2">"ExampleCalendar"</span><span class="p">)</span>

<span class="gp">In [276]: </span><span class="n">cal</span><span class="o">.</span><span class="n">rules</span>
<span class="gh">Out[276]: </span>
<span class="go">[Holiday: Memorial Day (month=5, day=31, offset=&lt;DateOffset: weekday=MO(-1)&gt;),</span>
<span class="go"> Holiday: July 4th (month=7, day=4, observance=&lt;function nearest_workday at 0x7f9491497c70&gt;),</span>
<span class="go"> Holiday: Columbus Day (month=10, day=1, offset=&lt;DateOffset: weekday=MO(+2)&gt;)]</span>

<span class="gp">In [277]: </span><span class="n">new_cal</span> <span class="o">=</span> <span class="n">HolidayCalendarFactory</span><span class="p">(</span><span class="s2">"NewExampleCalendar"</span><span class="p">,</span> <span class="n">cal</span><span class="p">,</span> <span class="n">USLaborDay</span><span class="p">)</span>

<span class="gp">In [278]: </span><span class="n">new_cal</span><span class="o">.</span><span class="n">rules</span>
<span class="gh">Out[278]: </span>
<span class="go">[Holiday: Labor Day (month=9, day=1, offset=&lt;DateOffset: weekday=MO(+1)&gt;),</span>
<span class="go"> Holiday: Memorial Day (month=5, day=31, offset=&lt;DateOffset: weekday=MO(-1)&gt;),</span>
<span class="go"> Holiday: July 4th (month=7, day=4, observance=&lt;function nearest_workday at 0x7f9491497c70&gt;),</span>
<span class="go"> Holiday: Columbus Day (month=10, day=1, offset=&lt;DateOffset: weekday=MO(+2)&gt;)]</span>
</pre></div>
</div>
</section>
</section>
<section id="time-series-related-instance-methods">
<span id="timeseries-advanced-datetime"></span><h2>时间序列相关实例方法<a class="headerlink" href="timeseries.html#time-series-related-instance-methods" title="Link to this heading">#</a></h2>
<section id="shifting-lagging">
<h3>移位/滞后<a class="headerlink" href="timeseries.html#shifting-lagging" title="Link to this heading">#</a></h3>
<p>可能需要将时间序列中的值在时间上向前或向后<em>移位</em>或<em>滞后</em>。实现此目的的方法是 <a class="reference internal" href="../reference/api/pandas.Series.shift.html#pandas.Series.shift" title="pandas.Series.shift"><code class="xref py py-meth docutils literal notranslate"><span class="pre">shift()</span></code></a>，它在所有 pandas 对象上都可用。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [279]: </span><span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rng</span><span class="p">)),</span> <span class="n">index</span><span class="o">=</span><span class="n">rng</span><span class="p">)</span>

<span class="gp">In [280]: </span><span class="n">ts</span> <span class="o">=</span> <span class="n">ts</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>

<span class="gp">In [281]: </span><span class="n">ts</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="gh">Out[281]: </span>
<span class="go">2012-01-01    NaN</span>
<span class="go">2012-01-02    0.0</span>
<span class="go">2012-01-03    1.0</span>
<span class="go">Freq: D, dtype: float64</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">shift</span></code> 方法接受一个 <code class="docutils literal notranslate"><span class="pre">freq</span></code> 参数，该参数可以接受 <code class="docutils literal notranslate"><span class="pre">DateOffset</span></code> 类或其他 <code class="docutils literal notranslate"><span class="pre">timedelta</span></code> 类似的对象，或者一个 <a class="reference internal" href="timeseries.html#timeseries-offset-aliases"><span class="std std-ref">偏移别名</span></a>。</p>
<p>当指定 <code class="docutils literal notranslate"><span class="pre">freq</span></code> 时，<code class="docutils literal notranslate"><span class="pre">shift</span></code> 方法会更改索引中的所有日期，而不是更改数据和索引的对齐方式。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [282]: </span><span class="n">ts</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"D"</span><span class="p">)</span>
<span class="gh">Out[282]: </span>
<span class="go">2012-01-06    0</span>
<span class="go">2012-01-07    1</span>
<span class="go">2012-01-08    2</span>
<span class="go">Freq: D, dtype: int64</span>

<span class="gp">In [283]: </span><span class="n">ts</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">BDay</span><span class="p">())</span>
<span class="gh">Out[283]: </span>
<span class="go">2012-01-06    0</span>
<span class="go">2012-01-09    1</span>
<span class="go">2012-01-10    2</span>
<span class="go">dtype: int64</span>

<span class="gp">In [284]: </span><span class="n">ts</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"BME"</span><span class="p">)</span>
<span class="gh">Out[284]: </span>
<span class="go">2012-05-31    0</span>
<span class="go">2012-05-31    1</span>
<span class="go">2012-05-31    2</span>
<span class="go">dtype: int64</span>
</pre></div>
</div>
<p>请注意，当指定 <code class="docutils literal notranslate"><span class="pre">freq</span></code> 时，开头条目不再是 NaN，因为数据没有重新对齐。</p>
</section>
<section id="frequency-conversion">
<h3>频率转换<a class="headerlink" href="timeseries.html#frequency-conversion" title="Link to this heading">#</a></h3>
<p>更改频率的主要函数是 <a class="reference internal" href="../reference/api/pandas.Series.asfreq.html#pandas.Series.asfreq" title="pandas.Series.asfreq"><code class="xref py py-meth docutils literal notranslate"><span class="pre">asfreq()</span></code></a> 方法。对于 <code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code>，这基本上只是 <a class="reference internal" href="../reference/api/pandas.Series.reindex.html#pandas.Series.reindex" title="pandas.Series.reindex"><code class="xref py py-meth docutils literal notranslate"><span class="pre">reindex()</span></code></a> 的一个薄但方便的包装器，它会生成一个 <code class="docutils literal notranslate"><span class="pre">date_range</span></code> 并调用 <code class="docutils literal transnotate"><span class="pre">reindex</span></code>。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [285]: </span><span class="n">dr</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">"1/1/2010"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="mi">3</span> <span class="o">*</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">BDay</span><span class="p">())</span>

<span class="gp">In [286]: </span><span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">dr</span><span class="p">)</span>

<span class="gp">In [287]: </span><span class="n">ts</span>
<span class="gh">Out[287]: </span>
<span class="go">2010-01-01    1.494522</span>
<span class="go">2010-01-06   -0.778425</span>
<span class="go">2010-01-11   -0.253355</span>
<span class="go">Freq: 3B, dtype: float64</span>

<span class="gp">In [288]: </span><span class="n">ts</span><span class="o">.</span><span class="n">asfreq</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">BDay</span><span class="p">())</span>
<span class="gh">Out[288]: </span>
<span class="go">2010-01-01    1.494522</span>
<span class="go">2010-01-04         NaN</span>
<span class="go">2010-01-05         NaN</span>
<span class="go">2010-01-06   -0.778425</span>
<span class="go">2010-01-07         NaN</span>
<span class="go">2010-01-08         NaN</span>
<span class="go">2010-01-11   -0.253355</span>
<span class="go">Freq: B, dtype: float64</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">asfreq</span></code> 提供了进一步的便利，您可以为频率转换后可能出现的任何间隙指定插值方法。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [289]: </span><span class="n">ts</span><span class="o">.</span><span class="n">asfreq</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">BDay</span><span class="p">(),</span> <span class="n">method</span><span class="o">=</span><span class="s2">"pad"</span><span class="p">)</span>
<span class="gh">Out[289]: </span>
<span class="go">2010-01-01    1.494522</span>
<span class="go">2010-01-04    1.494522</span>
<span class="go">2010-01-05    1.494522</span>
<span class="go">2010-01-06   -0.778425</span>
<span class="go">2010-01-07   -0.778425</span>
<span class="go">2010-01-08   -0.778425</span>
<span class="go">2010-01-11   -0.253355</span>
<span class="go">Freq: B, dtype: float64</span>
</pre></div>
</div>
</section>
<section id="filling-forward-backward">
<h3>向前/向后填充<a class="headerlink" href="timeseries.html#filling-forward-backward" title="Link to this heading">#</a></h3>
<p>与 <code class="docutils literal notranslate"><span class="pre">asfreq</span></code> 和 <code class="docutils literal notranslate"><span class="pre">reindex</span></code> 相关的是 <a class="reference internal" href="../reference/api/pandas.Series.fillna.html#pandas.Series.fillna" title="pandas.Series.fillna"><code class="xref py py-meth docutils literal notranslate"><span class="pre">fillna()</span></code></a>，这在<a class="reference internal" href="missing_data.html#missing-data-fillna"><span class="std std-ref">缺失数据部分</span></a>中有说明。</p>
</section>
<section id="converting-to-python-datetimes">
<h3>转换为 Python 日期时间<a class="headerlink" href="timeseries.html#converting-to-python-datetimes" title="Link to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code> 可以使用 <code class="docutils literal notranslate"><span class="pre">to_pydatetime</span></code> 方法转换为 Python 原生 <a class="reference external" href="https://docs.pythonlang.cn/3/library/datetime.html#datetime.datetime" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">datetime.datetime</span></code></a> 对象的数组。</p>
</section>
</section>
<section id="resampling">
<span id="timeseries-resampling"></span><h2>重采样<a class="headerlink" href="timeseries.html#resampling" title="Link to this heading">#</a></h2>
<p>pandas 具有简单、强大且高效的功能，用于在频率转换期间执行重采样操作（例如，将秒级数据转换为 5 分钟数据）。这在金融应用中极为常见，但不仅限于此。</p>
<p><a class="reference internal" href="../reference/api/pandas.Series.resample.html#pandas.Series.resample" title="pandas.Series.resample"><code class="xref py py-meth docutils literal notranslate"><span class="pre">resample()</span></code></a> 是一个基于时间的 groupby，后跟对其每个组的归约方法。有关一些高级策略，请参阅一些<a class="reference internal" href="cookbook.html#cookbook-resample"><span class="std std-ref">cookbook 示例</span></a>。</p>
<p><code class="docutils literal transnotate"><span class="pre">resample()</span></code> 方法可以直接从 <code class="docutils literal notranslate"><span class="pre">DataFrameGroupBy</span></code> 对象使用，请参阅<a class="reference internal" href="groupby.html#groupby-transform-window-resample"><span class="std std-ref">groupby 文档</span></a>。</p>
<section id="basics">
<h3>基础知识<a class="headerlink" href="timeseries.html#basics" title="Link to this heading">#</a></h3>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [290]: </span><span class="n">rng</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">"1/1/2012"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"s"</span><span class="p">)</span>

<span class="gp">In [291]: </span><span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">rng</span><span class="p">)),</span> <span class="n">index</span><span class="o">=</span><span class="n">rng</span><span class="p">)</span>

<span class="gp">In [292]: </span><span class="n">ts</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">"5Min"</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="gh">Out[292]: </span>
<span class="go">2012-01-01    25103</span>
<span class="go">Freq: 5min, dtype: int64</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">resample</span></code> 函数非常灵活，允许您指定许多不同的参数来控制频率转换和重采样操作。</p>
<p>任何通过 <a class="reference internal" href="../reference/groupby.html#api-groupby"><span class="std std-ref">GroupBy</span></a> 可用的内置方法都可作为返回对象的方法，包括 <code class="docutils literal notranslate"><span class="pre">sum</span></code>, <code class="docutils literal notranslate"><span class="pre">mean</span></code>, <code class="docutils literal transnotate"><span class="pre">std</span></code>, <code class="docutils literal notranslate"><span class="pre">sem</span></code>, <code class="docutils literal notranslate"><span class="pre">max</span></code>, <code class="docutils literal notranslate"><span class="pre">min</span></code>, <code class="docutils literal notranslate"><span class="pre">median</span></code>, <code class="docutils literal notranslate"><span class="pre">first</span></code>, <code class="docutils literal notranslate"><span class="pre">last</span></code>, <code class="docutils literal notranslate"><span class="pre">ohlc</span></code>。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [293]: </span><span class="n">ts</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">"5Min"</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="gh">Out[293]: </span>
<span class="go">2012-01-01    251.03</span>
<span class="go">Freq: 5min, dtype: float64</span>

<span class="gp">In [294]: </span><span class="n">ts</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">"5Min"</span><span class="p">)</span><span class="o">.</span><span class="n">ohlc</span><span class="p">()</span>
<span class="gh">Out[294]: </span>
<span class="go">            open  high  low  close</span>
<span class="go">2012-01-01   308   460    9    205</span>

<span class="gp">In [295]: </span><span class="n">ts</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">"5Min"</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="gh">Out[295]: </span>
<span class="go">2012-01-01    460</span>
<span class="go">Freq: 5min, dtype: int64</span>
</pre></div>
</div>
<p>对于降采样，<code class="docutils literal notranslate"><span class="pre">closed</span></code> 可以设置为 'left' 或 'right'，以指定区间的哪一端是闭合的。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [296]: </span><span class="n">ts</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">"5Min"</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="s2">"right"</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="gh">Out[296]: </span>
<span class="go">2011-12-31 23:55:00    308.000000</span>
<span class="go">2012-01-01 00:00:00    250.454545</span>
<span class="go">Freq: 5min, dtype: float64</span>

<span class="gp">In [297]: </span><span class="n">ts</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">"5Min"</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="s2">"left"</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="gh">Out[297]: </span>
<span class="go">2012-01-01    251.03</span>
<span class="go">Freq: 5min, dtype: float64</span>
</pre></div>
</div>
<p>诸如 <code class="docutils literal notranslate"><span class="pre">label</span></code> 这样的参数用于操作结果标签。<code class="docutils literal notranslate"><span class="pre">label</span></code> 指定结果是使用区间的开始还是结束进行标记。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [298]: </span><span class="n">ts</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">"5Min"</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>  <span class="c1"># by default label='left'</span>
<span class="gh">Out[298]: </span>
<span class="go">2012-01-01    251.03</span>
<span class="go">Freq: 5min, dtype: float64</span>

<span class="gp">In [299]: </span><span class="n">ts</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">"5Min"</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"left"</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="gh">Out[299]: </span>
<span class="go">2012-01-01    251.03</span>
<span class="go">Freq: 5min, dtype: float64</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p><code class="docutils literal notranslate"><span class="pre">label</span></code> 和 <code class="docutils literal notranslate"><span class="pre">closed</span></code> 的默认值对于所有频率偏移（除了 'ME', 'YE', 'QE', 'BME', 'BYE', 'BQE' 和 'W' 以外）都是 '<strong>left</strong>'，而这些频率偏移的默认值都是 'right'。</p>
<p>这可能会无意中导致“向前看”，即较晚时间的值被拉回到较早时间，如下例中 <a class="reference internal" href="../reference/api/pandas.tseries.offsets.BusinessDay.html#pandas.tseries.offsets.BusinessDay" title="pandas.tseries.offsets.BusinessDay"><code class="xref py py-class docutils literal notranslate"><span class="pre">BusinessDay</span></code></a> 频率所示：</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [300]: </span><span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">"2000-01-01"</span><span class="p">,</span> <span class="s2">"2000-01-05"</span><span class="p">)</span><span class="o">.</span><span class="n">to_series</span><span class="p">()</span>

<span class="gp">In [301]: </span><span class="n">s</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>

<span class="gp">In [302]: </span><span class="n">s</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">day_name</span><span class="p">()</span>
<span class="gh">Out[302]: </span>
<span class="go">2000-01-01     Saturday</span>
<span class="go">2000-01-02       Sunday</span>
<span class="go">2000-01-03          NaN</span>
<span class="go">2000-01-04      Tuesday</span>
<span class="go">2000-01-05    Wednesday</span>
<span class="go">Freq: D, dtype: object</span>

<span class="go"># default: label='left', closed='left'</span>
<span class="gp">In [303]: </span><span class="n">s</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">"B"</span><span class="p">)</span><span class="o">.</span><span class="n">last</span><span class="p">()</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">day_name</span><span class="p">()</span>
<span class="gh">Out[303]: </span>
<span class="go">1999-12-31       Sunday</span>
<span class="go">2000-01-03          NaN</span>
<span class="go">2000-01-04      Tuesday</span>
<span class="go">2000-01-05    Wednesday</span>
<span class="go">Freq: B, dtype: object</span>
</pre></div>
</div>
<p>请注意，星期日的值是如何被拉回到上一个星期五的。要获得星期日的值被推到星期一的行为，请改为使用：</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [304]: </span><span class="n">s</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">"B"</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"right"</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="s2">"right"</span><span class="p">)</span><span class="o">.</span><span class="n">last</span><span class="p">()</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">day_name</span><span class="p">()</span>
<span class="gh">Out[304]: </span>
<span class="go">2000-01-03       Sunday</span>
<span class="go">2000-01-04      Tuesday</span>
<span class="go">2000-01-05    Wednesday</span>
<span class="go">2000-01-06          NaN</span>
<span class="go">Freq: B, dtype: object</span>
</pre></div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">axis</span></code> 参数可以设置为 0 或 1，并允许您对 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> 的指定轴进行重采样。</p>
<p><code class="docutils literal notranslate"><span class="pre">kind</span></code> 可以设置为 'timestamp' 或 'period'，用于将结果索引转换为时间戳和时间跨度表示，或反之。默认情况下，<code class="docutils literal notranslate"><span class="pre">resample</span></code> 会保留输入表示。</p>
<p>当重采样周期数据时（详情见下文），<code class="docutils literal notranslate"><span class="pre">convention</span></code> 可以设置为 'start' 或 'end'。它指定了低频率周期如何转换为高频率周期。</p>
</section>
<section id="upsampling">
<h3>升采样<a class="headerlink" href="timeseries.html#upsampling" title="Link to this heading">#</a></h3>
<p>对于升采样，您可以指定一种升采样方式，并使用 <code class="docutils literal notranslate"><span class="pre">limit</span></code> 参数对创建的间隙进行插值。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="go"># from secondly to every 250 milliseconds</span>
<span class="gp">In [305]: </span><span class="n">ts</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">"250ms"</span><span class="p">)</span><span class="o">.</span><span class="n">asfreq</span><span class="p">()</span>
<span class="gh">Out[305]: </span>
<span class="go">2012-01-01 00:00:00.000    308.0</span>
<span class="go">2012-01-01 00:00:00.250      NaN</span>
<span class="go">2012-01-01 00:00:00.500      NaN</span>
<span class="go">2012-01-01 00:00:00.750      NaN</span>
<span class="go">2012-01-01 00:00:01.000    204.0</span>
<span class="go">Freq: 250ms, dtype: float64</span>

<span class="gp">In [306]: </span><span class="n">ts</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">"250ms"</span><span class="p">)</span><span class="o">.</span><span class="n">ffill</span><span class="p">()</span>
<span class="gh">Out[306]: </span>
<span class="go">2012-01-01 00:00:00.000    308</span>
<span class="go">2012-01-01 00:00:00.250    308</span>
<span class="go">2012-01-01 00:00:00.500    308</span>
<span class="go">2012-01-01 00:00:00.750    308</span>
<span class="go">2012-01-01 00:00:01.000    204</span>
<span class="go">Freq: 250ms, dtype: int64</span>

<span class="gp">In [307]: </span><span class="n">ts</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">"250ms"</span><span class="p">)</span><span class="o">.</span><span class="n">ffill</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="gh">Out[307]: </span>
<span class="go">2012-01-01 00:00:00.000    308.0</span>
<span class="go">2012-01-01 00:00:00.250    308.0</span>
<span class="go">2012-01-01 00:00:00.500    308.0</span>
<span class="go">2012-01-01 00:00:00.750      NaN</span>
<span class="go">2012-01-01 00:00:01.000    204.0</span>
<span class="go">Freq: 250ms, dtype: float64</span>
</pre></div>
</div>
</section>
<section id="sparse-resampling">
<h3>稀疏重采样<a class="headerlink" href="timeseries.html#sparse-resampling" title="Link to this heading">#</a></h3>
<p>稀疏时间序列是指您要重采样的时间段中点数相对较少的情况。天真地对稀疏序列进行升采样可能会生成大量中间值。当您不想使用方法填充这些值时，例如 <code class="docutils literal notranslate"><span class="pre">fill_method</span></code> 为 <code class="docutils literal notranslate"><span class="pre">None</span></code>，则中间值将填充为 <code class="docutils literal transnotate"><span class="pre">NaN</span></code>。</p>
<p>由于 <code class="docutils literal notranslate"><span class="pre">resample</span></code> 是一个基于时间的 groupby，以下是一种有效重采样仅非全 <code class="docutils literal notranslate"><span class="pre">NaN</span></code> 组的方法。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [308]: </span><span class="n">rng</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">"2014-1-1"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"D"</span><span class="p">)</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="s2">"1s"</span><span class="p">)</span>

<span class="gp">In [309]: </span><span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">rng</span><span class="p">)</span>
</pre></div>
</div>
<p>如果我们想对序列的完整范围进行重采样</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [310]: </span><span class="n">ts</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">"3min"</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="gh">Out[310]: </span>
<span class="go">2014-01-01 00:00:00     0</span>
<span class="go">2014-01-01 00:03:00     0</span>
<span class="go">2014-01-01 00:06:00     0</span>
<span class="go">2014-01-01 00:09:00     0</span>
<span class="go">2014-01-01 00:12:00     0</span>
<span class="go">                       ..</span>
<span class="go">2014-04-09 23:48:00     0</span>
<span class="go">2014-04-09 23:51:00     0</span>
<span class="go">2014-04-09 23:54:00     0</span>
<span class="go">2014-04-09 23:57:00     0</span>
<span class="go">2014-04-10 00:00:00    99</span>
<span class="go">Freq: 3min, Length: 47521, dtype: int64</span>
</pre></div>
</div>
<p>我们可以只重采样有数据点的组，如下所示：</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [311]: </span><span class="kn">from</span><span class="w"> </span><span class="nn">functools</span><span class="w"> </span><span class="kn">import</span> <span class="n">partial</span>

<span class="gp">In [312]: </span><span class="kn">from</span><span class="w"> </span><span class="nn">pandas.tseries.frequencies</span><span class="w"> </span><span class="kn">import</span> <span class="n">to_offset</span>

<span class="gp">In [313]: </span><span class="k">def</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">freq</span><span class="p">):</span>
<span class="gp">   .....: </span>    <span class="n">freq</span> <span class="o">=</span> <span class="n">to_offset</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span>
<span class="gp">   .....: </span>    <span class="n">td</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span>
<span class="gp">   .....: </span>    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">((</span><span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="o">//</span> <span class="n">td</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">*</span> <span class="n">td</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [314]: </span><span class="n">ts</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span><span class="nb">round</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"3min"</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="gh">Out[314]: </span>
<span class="go">2014-01-01     0</span>
<span class="go">2014-01-02     1</span>
<span class="go">2014-01-03     2</span>
<span class="go">2014-01-04     3</span>
<span class="go">2014-01-05     4</span>
<span class="go">              ..</span>
<span class="go">2014-04-06    95</span>
<span class="go">2014-04-07    96</span>
<span class="go">2014-04-08    97</span>
<span class="go">2014-04-09    98</span>
<span class="go">2014-04-10    99</span>
<span class="go">Length: 100, dtype: int64</span>
</pre></div>
</div>
</section>
<section id="aggregation">
<span id="timeseries-aggregate"></span><h3>聚合<a class="headerlink" href="timeseries.html#aggregation" title="Link to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">resample()</span></code> 方法返回一个 <code class="docutils literal notranslate"><span class="pre">pandas.api.typing.Resampler</span></code> 实例。与<a class="reference internal" href="basics.html#basics-aggregate"><span class="std std-ref">聚合 API</span></a>、<a class="reference internal" href="groupby.html#groupby-aggregate"><span class="std std-ref">groupby API</span></a> 和 <a class="reference internal" href="window.html#window-overview"><span class="std std-ref">窗口 API</span></a> 类似，<code class="docutils literal notranslate"><span class="pre">Resampler</span></code> 可以选择性地进行重采样。</p>
<p>重采样 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> 时，默认会对所有列使用相同函数进行操作。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [315]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
<span class="gp">   .....: </span>    <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">"1/1/2012"</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"s"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">1000</span><span class="p">),</span>
<span class="gp">   .....: </span>    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"A"</span><span class="p">,</span> <span class="s2">"B"</span><span class="p">,</span> <span class="s2">"C"</span><span class="p">],</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [316]: </span><span class="n">r</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">"3min"</span><span class="p">)</span>

<span class="gp">In [317]: </span><span class="n">r</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="gh">Out[317]: </span>
<span class="go">                            A         B         C</span>
<span class="go">2012-01-01 00:00:00 -0.033823 -0.121514 -0.081447</span>
<span class="go">2012-01-01 00:03:00  0.056909  0.146731 -0.024320</span>
<span class="go">2012-01-01 00:06:00 -0.058837  0.047046 -0.052021</span>
<span class="go">2012-01-01 00:09:00  0.063123 -0.026158 -0.066533</span>
<span class="go">2012-01-01 00:12:00  0.186340 -0.003144  0.074752</span>
<span class="go">2012-01-01 00:15:00 -0.085954 -0.016287 -0.050046</span>
</pre></div>
</div>
<p>我们可以使用标准getitem选择一个或多个特定列。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [318]: </span><span class="n">r</span><span class="p">[</span><span class="s2">"A"</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="gh">Out[318]: </span>
<span class="go">2012-01-01 00:00:00   -0.033823</span>
<span class="go">2012-01-01 00:03:00    0.056909</span>
<span class="go">2012-01-01 00:06:00   -0.058837</span>
<span class="go">2012-01-01 00:09:00    0.063123</span>
<span class="go">2012-01-01 00:12:00    0.186340</span>
<span class="go">2012-01-01 00:15:00   -0.085954</span>
<span class="go">Freq: 3min, Name: A, dtype: float64</span>

<span class="gp">In [319]: </span><span class="n">r</span><span class="p">[[</span><span class="s2">"A"</span><span class="p">,</span> <span class="s2">"B"</span><span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="gh">Out[319]: </span>
<span class="go">                            A         B</span>
<span class="go">2012-01-01 00:00:00 -0.033823 -0.121514</span>
<span class="go">2012-01-01 00:03:00  0.056909  0.146731</span>
<span class="go">2012-01-01 00:06:00 -0.058837  0.047046</span>
<span class="go">2012-01-01 00:09:00  0.063123 -0.026158</span>
<span class="go">2012-01-01 00:12:00  0.186340 -0.003144</span>
<span class="go">2012-01-01 00:15:00 -0.085954 -0.016287</span>
</pre></div>
</div>
<p>您可以传入一个函数列表或字典进行聚合，输出一个 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [320]: </span><span class="n">r</span><span class="p">[</span><span class="s2">"A"</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s2">"sum"</span><span class="p">,</span> <span class="s2">"mean"</span><span class="p">,</span> <span class="s2">"std"</span><span class="p">])</span>
<span class="gh">Out[320]: </span>
<span class="go">                           sum      mean       std</span>
<span class="go">2012-01-01 00:00:00  -6.088060 -0.033823  1.043263</span>
<span class="go">2012-01-01 00:03:00  10.243678  0.056909  1.058534</span>
<span class="go">2012-01-01 00:06:00 -10.590584 -0.058837  0.949264</span>
<span class="go">2012-01-01 00:09:00  11.362228  0.063123  1.028096</span>
<span class="go">2012-01-01 00:12:00  33.541257  0.186340  0.884586</span>
<span class="go">2012-01-01 00:15:00  -8.595393 -0.085954  1.035476</span>
</pre></div>
</div>
<p>在重采样的 <code class="docutils literal transnotate"><span class="pre">DataFrame</span></code> 上，您可以传入一个函数列表，将其应用于每一列，这将生成一个具有层次索引的聚合结果。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [321]: </span><span class="n">r</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s2">"sum"</span><span class="p">,</span> <span class="s2">"mean"</span><span class="p">])</span>
<span class="gh">Out[321]: </span>
<span class="go">                             A            ...          C          </span>
<span class="go">                           sum      mean  ...        sum      mean</span>
<span class="go">2012-01-01 00:00:00  -6.088060 -0.033823  ... -14.660515 -0.081447</span>
<span class="go">2012-01-01 00:03:00  10.243678  0.056909  ...  -4.377642 -0.024320</span>
<span class="go">2012-01-01 00:06:00 -10.590584 -0.058837  ...  -9.363825 -0.052021</span>
<span class="go">2012-01-01 00:09:00  11.362228  0.063123  ... -11.975895 -0.066533</span>
<span class="go">2012-01-01 00:12:00  33.541257  0.186340  ...  13.455299  0.074752</span>
<span class="go">2012-01-01 00:15:00  -8.595393 -0.085954  ...  -5.004580 -0.050046</span>

<span class="go">[6 rows x 6 columns]</span>
</pre></div>
</div>
<p>通过将字典传递给 <code class="docutils literal notranslate"><span class="pre">aggregate</span></code>，您可以对 <code class="docutils literal transnotate"><span class="pre">DataFrame</span></code> 的列应用不同的聚合。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [322]: </span><span class="n">r</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s2">"A"</span><span class="p">:</span> <span class="s2">"sum"</span><span class="p">,</span> <span class="s2">"B"</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)})</span>
<span class="gh">Out[322]: </span>
<span class="go">                             A         B</span>
<span class="go">2012-01-01 00:00:00  -6.088060  1.001294</span>
<span class="go">2012-01-01 00:03:00  10.243678  1.074597</span>
<span class="go">2012-01-01 00:06:00 -10.590584  0.987309</span>
<span class="go">2012-01-01 00:09:00  11.362228  0.944953</span>
<span class="go">2012-01-01 00:12:00  33.541257  1.095025</span>
<span class="go">2012-01-01 00:15:00  -8.595393  1.035312</span>
</pre></div>
</div>
<p>函数名称也可以是字符串。为了使字符串有效，它必须在重采样对象上实现。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [323]: </span><span class="n">r</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s2">"A"</span><span class="p">:</span> <span class="s2">"sum"</span><span class="p">,</span> <span class="s2">"B"</span><span class="p">:</span> <span class="s2">"std"</span><span class="p">})</span>
<span class="gh">Out[323]: </span>
<span class="go">                             A         B</span>
<span class="go">2012-01-01 00:00:00  -6.088060  1.001294</span>
<span class="go">2012-01-01 00:03:00  10.243678  1.074597</span>
<span class="go">2012-01-01 00:06:00 -10.590584  0.987309</span>
<span class="go">2012-01-01 00:09:00  11.362228  0.944953</span>
<span class="go">2012-01-01 00:12:00  33.541257  1.095025</span>
<span class="go">2012-01-01 00:15:00  -8.595393  1.035312</span>
</pre></div>
</div>
<p>此外，您还可以为每个列单独指定多个聚合函数。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [324]: </span><span class="n">r</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s2">"A"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"sum"</span><span class="p">,</span> <span class="s2">"std"</span><span class="p">],</span> <span class="s2">"B"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"mean"</span><span class="p">,</span> <span class="s2">"std"</span><span class="p">]})</span>
<span class="gh">Out[324]: </span>
<span class="go">                             A                   B          </span>
<span class="go">                           sum       std      mean       std</span>
<span class="go">2012-01-01 00:00:00  -6.088060  1.043263 -0.121514  1.001294</span>
<span class="go">2012-01-01 00:03:00  10.243678  1.058534  0.146731  1.074597</span>
<span class="go">2012-01-01 00:06:00 -10.590584  0.949264  0.047046  0.987309</span>
<span class="go">2012-01-01 00:09:00  11.362228  1.028096 -0.026158  0.944953</span>
<span class="go">2012-01-01 00:12:00  33.541257  0.884586 -0.003144  1.095025</span>
<span class="go">2012-01-01 00:15:00  -8.595393  1.035476 -0.016287  1.035312</span>
</pre></div>
</div>
<p>如果 <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> 没有日期时间索引，但您想根据帧中的日期时间列进行重采样，则可以将其传递给 <code class="docutils literal notranslate"><span class="pre">on</span></code> 关键字。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [325]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="p">{</span><span class="s2">"date"</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">"2015-01-01"</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"W"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span> <span class="s2">"a"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">)},</span>
<span class="gp">   .....: </span>    <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_arrays</span><span class="p">(</span>
<span class="gp">   .....: </span>        <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">"2015-01-01"</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"W"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">5</span><span class="p">)],</span>
<span class="gp">   .....: </span>        <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s2">"v"</span><span class="p">,</span> <span class="s2">"d"</span><span class="p">],</span>
<span class="gp">   .....: </span>    <span class="p">),</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [326]: </span><span class="n">df</span>
<span class="gh">Out[326]: </span>
<span class="go">                   date  a</span>
<span class="go">v d                       </span>
<span class="go">1 2015-01-04 2015-01-04  0</span>
<span class="go">2 2015-01-11 2015-01-11  1</span>
<span class="go">3 2015-01-18 2015-01-18  2</span>
<span class="go">4 2015-01-25 2015-01-25  3</span>
<span class="go">5 2015-02-01 2015-02-01  4</span>

<span class="gp">In [327]: </span><span class="n">df</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">"ME"</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">"date"</span><span class="p">)[[</span><span class="s2">"a"</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="gh">Out[327]: </span>
<span class="go">            a</span>
<span class="go">date         </span>
<span class="go">2015-01-31  6</span>
<span class="go">2015-02-28  4</span>
</pre></div>
</div>
<p>类似地，如果您想通过 <code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code> 的日期时间级别进行重采样，其名称或位置可以传递给 <code class="docutils literal notranslate"><span class="pre">level</span></code> 关键字。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [328]: </span><span class="n">df</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">"ME"</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">"d"</span><span class="p">)[[</span><span class="s2">"a"</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="gh">Out[328]: </span>
<span class="go">            a</span>
<span class="go">d            </span>
<span class="go">2015-01-31  6</span>
<span class="go">2015-02-28  4</span>
</pre></div>
</div>
</section>
<section id="iterating-through-groups">
<span id="timeseries-iterating-label"></span><h3>遍历分组<a class="headerlink" href="timeseries.html#iterating-through-groups" title="Link to this heading">#</a></h3>
<p>有了 <code class="docutils literal notranslate"><span class="pre">Resampler</span></code> 对象，遍历分组数据就非常自然，其功能与 <a class="reference external" href="https://docs.pythonlang.cn/3/library/itertools.html#itertools.groupby" title="(in Python v3.13)"><code class="xref py py-func docutils literal notranslate"><span class="pre">itertools.groupby()</span></code></a> 类似。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [329]: </span><span class="n">small</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span>
<span class="gp">   .....: </span>    <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span>
<span class="gp">   .....: </span>        <span class="p">[</span>
<span class="gp">   .....: </span>            <span class="s2">"2017-01-01T00:00:00"</span><span class="p">,</span>
<span class="gp">   .....: </span>            <span class="s2">"2017-01-01T00:30:00"</span><span class="p">,</span>
<span class="gp">   .....: </span>            <span class="s2">"2017-01-01T00:31:00"</span><span class="p">,</span>
<span class="gp">   .....: </span>            <span class="s2">"2017-01-01T01:00:00"</span><span class="p">,</span>
<span class="gp">   .....: </span>            <span class="s2">"2017-01-01T03:00:00"</span><span class="p">,</span>
<span class="gp">   .....: </span>            <span class="s2">"2017-01-01T03:05:00"</span><span class="p">,</span>
<span class="gp">   .....: </span>        <span class="p">]</span>
<span class="gp">   .....: </span>    <span class="p">),</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [330]: </span><span class="n">resampled</span> <span class="o">=</span> <span class="n">small</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">"h"</span><span class="p">)</span>

<span class="gp">In [331]: </span><span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">resampled</span><span class="p">:</span>
<span class="gp">   .....: </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">"Group: "</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
<span class="gp">   .....: </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">"-"</span> <span class="o">*</span> <span class="mi">27</span><span class="p">)</span>
<span class="gp">   .....: </span>    <span class="nb">print</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">"</span><span class="se">\n\n</span><span class="s2">"</span><span class="p">)</span>
<span class="gp">   .....: </span>
<span class="go">Group:  2017-01-01 00:00:00</span>
<span class="gt">---------------------------</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>    <span class="mi">0</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">00</span>    <span class="mi">1</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">31</span><span class="p">:</span><span class="mi">00</span>    <span class="mi">2</span>
<span class="ne">dtype</span>: int64

<span class="ne">Group</span>:  2017-01-01 01:00:00
<span class="gt">---------------------------</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">01</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>    <span class="mi">3</span>
<span class="ne">dtype</span>: int64

<span class="ne">Group</span>:  2017-01-01 02:00:00
<span class="gt">---------------------------</span>
<span class="n">Series</span><span class="p">([],</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span><span class="p">)</span>

<span class="ne">Group</span>:  2017-01-01 03:00:00
<span class="gt">---------------------------</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">03</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>    <span class="mi">4</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">03</span><span class="p">:</span><span class="mi">05</span><span class="p">:</span><span class="mi">00</span>    <span class="mi">5</span>
<span class="ne">dtype</span>: int64
</pre></div>
</div>
<p>更多信息请参见<a class="reference internal" href="groupby.html#groupby-iterating-label"><span class="std std-ref">遍历分组</span></a>或 <code class="xref py py-class docutils literal notranslate"><span class="pre">Resampler.__iter__</span></code>。</p>
</section>
<section id="use-origin-or-offset-to-adjust-the-start-of-the-bins">
<span id="timeseries-adjust-the-start-of-the-bins"></span><h3>使用 <code class="docutils literal transnotate"><span class="pre">origin</span></code> 或 <code class="docutils literal notranslate"><span class="pre">offset</span></code> 调整分箱的起始点<a class="headerlink" href="timeseries.html#use-origin-or-offset-to-adjust-the-start-of-the-bins" title="Link to this heading">#</a></h3>
<p>分组的分箱会根据时间序列起始点的当天开始时间进行调整。这对于是天数倍数（如 <code class="docutils literal notranslate"><span class="pre">30D</span></code>）或能将一天均匀划分（如 <code class="docutils literal notranslate"><span class="pre">90s</span></code> 或 <code class="docutils literal transnotate"><span class="pre">1min</span></code>）的频率非常有效。这可能会对不符合此标准的一些频率造成不一致。要更改此行为，您可以使用参数 <code class="docutils literal notranslate"><span class="pre">origin</span></code> 指定一个固定的时间戳。</p>
<p>例如：</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [332]: </span><span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="s2">"2000-10-01 23:30:00"</span><span class="p">,</span> <span class="s2">"2000-10-02 00:30:00"</span>

<span class="gp">In [333]: </span><span class="n">middle</span> <span class="o">=</span> <span class="s2">"2000-10-02 00:00:00"</span>

<span class="gp">In [334]: </span><span class="n">rng</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"7min"</span><span class="p">)</span>

<span class="gp">In [335]: </span><span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rng</span><span class="p">))</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">rng</span><span class="p">)</span>

<span class="gp">In [336]: </span><span class="n">ts</span>
<span class="gh">Out[336]: </span>
<span class="go">2000-10-01 23:30:00     0</span>
<span class="go">2000-10-01 23:37:00     3</span>
<span class="go">2000-10-01 23:44:00     6</span>
<span class="go">2000-10-01 23:51:00     9</span>
<span class="go">2000-10-01 23:58:00    12</span>
<span class="go">2000-10-02 00:05:00    15</span>
<span class="go">2000-10-02 00:12:00    18</span>
<span class="go">2000-10-02 00:19:00    21</span>
<span class="go">2000-10-02 00:26:00    24</span>
<span class="go">Freq: 7min, dtype: int64</span>
</pre></div>
</div>
<p>在这里我们可以看到，当使用 <code class="docutils literal notranslate"><span class="pre">origin</span></code> 及其默认值 (<code class="docutils literal notranslate"><span class="pre">'start_day'</span></code>) 时，在 <code class="docutils literal notranslate"><span class="pre">'2000-10-02</span> <span class="pre">00:00:00'</span></code> 之后的结果会因时间序列的起始点而不同。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [337]: </span><span class="n">ts</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">"17min"</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s2">"start_day"</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="gh">Out[337]: </span>
<span class="go">2000-10-01 23:14:00     0</span>
<span class="go">2000-10-01 23:31:00     9</span>
<span class="go">2000-10-01 23:48:00    21</span>
<span class="go">2000-10-02 00:05:00    54</span>
<span class="go">2000-10-02 00:22:00    24</span>
<span class="go">Freq: 17min, dtype: int64</span>

<span class="gp">In [338]: </span><span class="n">ts</span><span class="p">[</span><span class="n">middle</span><span class="p">:</span><span class="n">end</span><span class="p">]</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">"17min"</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s2">"start_day"</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="gh">Out[338]: </span>
<span class="go">2000-10-02 00:00:00    33</span>
<span class="go">2000-10-02 00:17:00    45</span>
<span class="go">Freq: 17min, dtype: int64</span>
</pre></div>
</div>
<p>这里我们可以看到，当将 <code class="docutils literal notranslate"><span class="pre">origin</span></code> 设置为 <code class="docutils literal notranslate"><span class="pre">'epoch'</span></code> 时，在 <code class="docutils literal notranslate"><span class="pre">'2000-10-02</span> <span class="pre">00:00:00'</span></code> 之后的结果会因时间序列的起始点而相同。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [339]: </span><span class="n">ts</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">"17min"</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s2">"epoch"</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="gh">Out[339]: </span>
<span class="go">2000-10-01 23:18:00     0</span>
<span class="go">2000-10-01 23:35:00    18</span>
<span class="go">2000-10-01 23:52:00    27</span>
<span class="go">2000-10-02 00:09:00    39</span>
<span class="go">2000-10-02 00:26:00    24</span>
<span class="go">Freq: 17min, dtype: int64</span>

<span class="gp">In [340]: </span><span class="n">ts</span><span class="p">[</span><span class="n">middle</span><span class="p">:</span><span class="n">end</span><span class="p">]</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">"17min"</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s2">"epoch"</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="gh">Out[340]: </span>
<span class="go">2000-10-01 23:52:00    15</span>
<span class="go">2000-10-02 00:09:00    39</span>
<span class="go">2000-10-02 00:26:00    24</span>
<span class="go">Freq: 17min, dtype: int64</span>
</pre></div>
</div>
<p>如果需要，您可以为 <code class="docutils literal notranslate"><span class="pre">origin</span></code> 使用自定义时间戳。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [341]: </span><span class="n">ts</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">"17min"</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s2">"2001-01-01"</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="gh">Out[341]: </span>
<span class="go">2000-10-01 23:30:00     9</span>
<span class="go">2000-10-01 23:47:00    21</span>
<span class="go">2000-10-02 00:04:00    54</span>
<span class="go">2000-10-02 00:21:00    24</span>
<span class="go">Freq: 17min, dtype: int64</span>

<span class="gp">In [342]: </span><span class="n">ts</span><span class="p">[</span><span class="n">middle</span><span class="p">:</span><span class="n">end</span><span class="p">]</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">"17min"</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">"2001-01-01"</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="gh">Out[342]: </span>
<span class="go">2000-10-02 00:04:00    54</span>
<span class="go">2000-10-02 00:21:00    24</span>
<span class="go">Freq: 17min, dtype: int64</span>
</pre></div>
</div>
<p>如果需要，您可以只用一个 <code class="docutils literal notranslate"><span class="pre">offset</span></code> Timedelta 来调整分箱，该 Timedelta 将添加到默认的 <code class="docutils literal notranslate"><span class="pre">origin</span></code>。这两个示例对于此时间序列是等效的。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [343]: </span><span class="n">ts</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">"17min"</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s2">"start"</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="gh">Out[343]: </span>
<span class="go">2000-10-01 23:30:00     9</span>
<span class="go">2000-10-01 23:47:00    21</span>
<span class="go">2000-10-02 00:04:00    54</span>
<span class="go">2000-10-02 00:21:00    24</span>
<span class="go">Freq: 17min, dtype: int64</span>

<span class="gp">In [344]: </span><span class="n">ts</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">"17min"</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="s2">"23h30min"</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="gh">Out[344]: </span>
<span class="go">2000-10-01 23:30:00     9</span>
<span class="go">2000-10-01 23:47:00    21</span>
<span class="go">2000-10-02 00:04:00    54</span>
<span class="go">2000-10-02 00:21:00    24</span>
<span class="go">Freq: 17min, dtype: int64</span>
</pre></div>
</div>
<p>请注意在最后一个示例中，<code class="docutils literal notranslate"><span class="pre">origin</span></code> 使用了 <code class="docutils literal notranslate"><span class="pre">'start'</span></code>。在这种情况下，<code class="docutils literal notranslate"><span class="pre">origin</span></code> 将设置为时间序列的第一个值。</p>
</section>
<section id="backward-resample">
<h3>向后重采样<a class="headerlink" href="timeseries.html#backward-resample" title="Link to this heading">#</a></h3>
<div class="versionadded">
<p><span class="versionmodified added">在版本 1.3.0 中添加。</span></p>
</div>
<p>有时，我们不是调整分箱的起点，而是需要固定分箱的终点，以便使用给定的 <code class="docutils literal notranslate"><span class="pre">freq</span></code> 进行向后重采样。向后重采样默认将 <code class="docutils literal notranslate"><span class="pre">closed</span></code> 设置为 <code class="docutils literal notranslate"><span class="pre">'right'</span></code>，因为最后一个值应被视为最后一个分箱的边缘点。</p>
<p>我们可以将 <code class="docutils literal notranslate"><span class="pre">origin</span></code> 设置为 <code class="docutils literal notranslate"><span class="pre">'end'</span></code>。特定 <code class="docutils literal notranslate"><span class="pre">Timestamp</span></code> 索引的值表示从当前 <code class="docutils literal notranslate"><span class="pre">Timestamp</span></code> 减去 <code class="docutils literal notranslate"><span class="pre">freq</span></code> 到当前 <code class="docutils literal notranslate"><span class="pre">Timestamp</span></code>（右闭合）的重采样结果。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [345]: </span><span class="n">ts</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">'17min'</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">'end'</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="gh">Out[345]: </span>
<span class="go">2000-10-01 23:35:00     0</span>
<span class="go">2000-10-01 23:52:00    18</span>
<span class="go">2000-10-02 00:09:00    27</span>
<span class="go">2000-10-02 00:26:00    63</span>
<span class="go">Freq: 17min, dtype: int64</span>
</pre></div>
</div>
<p>此外，与 <code class="docutils literal transnotate"><span class="pre">'start_day'</span></code> 选项相比，<code class="docutils literal notranslate"><span class="pre">end_day</span></code> 也受支持。这将把原点设置为最大 <code class="docutils literal transnotate"><span class="pre">Timestamp</span></code> 的午夜上限。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [346]: </span><span class="n">ts</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">'17min'</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">'end_day'</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="gh">Out[346]: </span>
<span class="go">2000-10-01 23:38:00     3</span>
<span class="go">2000-10-01 23:55:00    15</span>
<span class="go">2000-10-02 00:12:00    45</span>
<span class="go">2000-10-02 00:29:00    45</span>
<span class="go">Freq: 17min, dtype: int64</span>
</pre></div>
</div>
<p>以上结果使用 <code class="docutils literal notranslate"><span class="pre">2000-10-02</span> <span class="pre">00:29:00</span></code> 作为最后一个分箱的右边缘，因为进行了以下计算。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [347]: </span><span class="n">ceil_mid</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="s1">'D'</span><span class="p">)</span>

<span class="gp">In [348]: </span><span class="n">freq</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">Minute</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span>

<span class="gp">In [349]: </span><span class="n">bin_res</span> <span class="o">=</span> <span class="n">ceil_mid</span> <span class="o">-</span> <span class="n">freq</span> <span class="o">*</span> <span class="p">((</span><span class="n">ceil_mid</span> <span class="o">-</span> <span class="n">rng</span><span class="o">.</span><span class="n">max</span><span class="p">())</span> <span class="o">//</span> <span class="n">freq</span><span class="p">)</span>

<span class="gp">In [350]: </span><span class="n">bin_res</span>
<span class="gh">Out[350]: </span><span class="go">Timestamp('2000-10-02 00:29:00')</span>
</pre></div>
</div>
</section>
</section>
<section id="time-span-representation">
<span id="timeseries-periods"></span><h2>时间跨度表示<a class="headerlink" href="timeseries.html#time-span-representation" title="Link to this heading">#</a></h2>
<p>pandas 中，常规的时间间隔由 <code class="docutils literal notranslate"><span class="pre">Period</span></code> 对象表示，而 <code class="docutils literal notranslate"><span class="pre">Period</span></code> 对象的序列则收集在 <code class="docutils literal notranslate"><span class="pre">PeriodIndex</span></code> 中，可以使用便捷函数 <code class="docutils literal notranslate"><span class="pre">period_range</span></code> 创建。</p>
<section id="period">
<h3>周期<a class="headerlink" href="timeseries.html#period" title="Link to this heading">#</a></h3>
<p>一个 <code class="docutils literal notranslate"><span class="pre">Period</span></code> 表示一个时间跨度（例如，一天、一个月、一个季度等）。您可以使用频率别名（如下所示）通过 <code class="docutils literal transnotate"><span class="pre">freq</span></code> 关键字指定跨度。由于 <code class="docutils literal notranslate"><span class="pre">freq</span></code> 表示 <code class="docutils literal transnotate"><span class="pre">Period</span></code> 的跨度，它不能是负数，例如“-3D”。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [351]: </span><span class="n">pd</span><span class="o">.</span><span class="n">Period</span><span class="p">(</span><span class="s2">"2012"</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"Y-DEC"</span><span class="p">)</span>
<span class="gh">Out[351]: </span><span class="go">Period('2012', 'Y-DEC')</span>

<span class="gp">In [352]: </span><span class="n">pd</span><span class="o">.</span><span class="n">Period</span><span class="p">(</span><span class="s2">"2012-1-1"</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"D"</span><span class="p">)</span>
<span class="gh">Out[352]: </span><span class="go">Period('2012-01-01', 'D')</span>

<span class="gp">In [353]: </span><span class="n">pd</span><span class="o">.</span><span class="n">Period</span><span class="p">(</span><span class="s2">"2012-1-1 19:00"</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"h"</span><span class="p">)</span>
<span class="gh">Out[353]: </span><span class="go">Period('2012-01-01 19:00', 'h')</span>

<span class="gp">In [354]: </span><span class="n">pd</span><span class="o">.</span><span class="n">Period</span><span class="p">(</span><span class="s2">"2012-1-1 19:00"</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"5h"</span><span class="p">)</span>
<span class="gh">Out[354]: </span><span class="go">Period('2012-01-01 19:00', '5h')</span>
</pre></div>
</div>
<p>对周期进行整数加减会使其按自身频率移动。具有不同 <code class="docutils literal notranslate"><span class="pre">freq</span></code>（跨度）的 <code class="docutils literal notranslate"><span class="pre">Period</span></code> 之间不允许算术运算。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [355]: </span><span class="n">p</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Period</span><span class="p">(</span><span class="s2">"2012"</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"Y-DEC"</span><span class="p">)</span>

<span class="gp">In [356]: </span><span class="n">p</span> <span class="o">+</span> <span class="mi">1</span>
<span class="gh">Out[356]: </span><span class="go">Period('2013', 'Y-DEC')</span>

<span class="gp">In [357]: </span><span class="n">p</span> <span class="o">-</span> <span class="mi">3</span>
<span class="gh">Out[357]: </span><span class="go">Period('2009', 'Y-DEC')</span>

<span class="gp">In [358]: </span><span class="n">p</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Period</span><span class="p">(</span><span class="s2">"2012-01"</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"2M"</span><span class="p">)</span>

<span class="gp">In [359]: </span><span class="n">p</span> <span class="o">+</span> <span class="mi">2</span>
<span class="gh">Out[359]: </span><span class="go">Period('2012-05', '2M')</span>

<span class="gp">In [360]: </span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span>
<span class="gh">Out[360]: </span><span class="go">Period('2011-11', '2M')</span>

<span class="gp">In [361]: </span><span class="n">p</span> <span class="o">==</span> <span class="n">pd</span><span class="o">.</span><span class="n">Period</span><span class="p">(</span><span class="s2">"2012-01"</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"3M"</span><span class="p">)</span>
<span class="gh">Out[361]: </span><span class="go">False</span>
</pre></div>
</div>
<p>如果 <code class="docutils literal notranslate"><span class="pre">Period</span></code> 的频率是每日或更高（<code class="docutils literal notranslate"><span class="pre">D</span></code>, <code class="docutils literal notranslate"><span class="pre">h</span></code>, <code class="docutils literal notranslate"><span class="pre">min</span></code>, <code class="docutils literal notranslate"><span class="pre">s</span></code>, <code class="docutils literal notranslate"><span class="pre">ms</span></code>, <code class="docutils literal notranslate"><span class="pre">us</span></code> 和 <code class="docutils literal notranslate"><span class="pre">ns</span></code>），则可以添加 <code class="docutils literal transnotate"><span class="pre">offsets</span></code> 和 <code class="docutils literal notranslate"><span class="pre">timedelta</span></code> 类型，如果结果可以具有相同的频率。否则，将引发 <code class="docutils literal transnotate"><span class="pre">ValueError</span></code>。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [362]: </span><span class="n">p</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Period</span><span class="p">(</span><span class="s2">"2014-07-01 09:00"</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"h"</span><span class="p">)</span>

<span class="gp">In [363]: </span><span class="n">p</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">Hour</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="gh">Out[363]: </span><span class="go">Period('2014-07-01 11:00', 'h')</span>

<span class="gp">In [364]: </span><span class="n">p</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">120</span><span class="p">)</span>
<span class="gh">Out[364]: </span><span class="go">Period('2014-07-01 11:00', 'h')</span>

<span class="gp">In [365]: </span><span class="n">p</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="mi">7200</span><span class="p">,</span> <span class="s2">"s"</span><span class="p">)</span>
<span class="gh">Out[365]: </span><span class="go">Period('2014-07-01 11:00', 'h')</span>
</pre></div>
</div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [366]: </span><span class="n">p</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">Minute</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ValueError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="nn">File ~/work/pandas/pandas/pandas/_libs/tslibs/period.pyx:1824,</span> in <span class="ni">pandas._libs.tslibs.period._Period._add_timedeltalike_scalar</span><span class="nt">()</span>

<span class="nn">File ~/work/pandas/pandas/pandas/_libs/tslibs/timedeltas.pyx:278,</span> in <span class="ni">pandas._libs.tslibs.timedeltas.delta_to_nanoseconds</span><span class="nt">()</span>

<span class="nn">File ~/work/pandas/pandas/pandas/_libs/tslibs/np_datetime.pyx:661,</span> in <span class="ni">pandas._libs.tslibs.np_datetime.convert_reso</span><span class="nt">()</span>

<span class="ne">ValueError</span>: Cannot losslessly convert units

<span class="n">The</span> <span class="n">above</span> <span class="n">exception</span> <span class="n">was</span> <span class="n">the</span> <span class="n">direct</span> <span class="n">cause</span> <span class="n">of</span> <span class="n">the</span> <span class="n">following</span> <span class="n">exception</span><span class="p">:</span>

<span class="ne">IncompatibleFrequency</span><span class="g g-Whitespace">                     </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">366</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">p</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">Minute</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="nn">File ~/work/pandas/pandas/pandas/_libs/tslibs/period.pyx:1845,</span> in <span class="ni">pandas._libs.tslibs.period._Period.__add__</span><span class="nt">()</span>

<span class="nn">File ~/work/pandas/pandas/pandas/_libs/tslibs/period.pyx:1826,</span> in <span class="ni">pandas._libs.tslibs.period._Period._add_timedeltalike_scalar</span><span class="nt">()</span>

<span class="ne">IncompatibleFrequency</span>: Input cannot be converted to Period(freq=h)
</pre></div>
</div>
<p>如果 <code class="docutils literal notranslate"><span class="pre">Period</span></code> 具有其他频率，则只能添加相同的 <code class="docutils literal notranslate"><span class="pre">offsets</span></code>。否则，将引发 <code class="docutils literal transnotate"><span class="pre">ValueError</span></code>。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [367]: </span><span class="n">p</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Period</span><span class="p">(</span><span class="s2">"2014-07"</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"M"</span><span class="p">)</span>

<span class="gp">In [368]: </span><span class="n">p</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">MonthEnd</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="gh">Out[368]: </span><span class="go">Period('2014-10', 'M')</span>
</pre></div>
</div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [369]: </span><span class="n">p</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">MonthBegin</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">IncompatibleFrequency</span><span class="g g-Whitespace">                     </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">369</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">p</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">MonthBegin</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="nn">File ~/work/pandas/pandas/pandas/_libs/tslibs/period.pyx:1847,</span> in <span class="ni">pandas._libs.tslibs.period._Period.__add__</span><span class="nt">()</span>

<span class="nn">File ~/work/pandas/pandas/pandas/_libs/tslibs/period.pyx:1837,</span> in <span class="ni">pandas._libs.tslibs.period._Period._add_offset</span><span class="nt">()</span>

<span class="nn">File ~/work/pandas/pandas/pandas/_libs/tslibs/period.pyx:1732,</span> in <span class="ni">pandas._libs.tslibs.period.PeriodMixin._require_matching_freq</span><span class="nt">()</span>

<span class="ne">IncompatibleFrequency</span>: Input has different freq=3M from Period(freq=M)
</pre></div>
</div>
<p>计算相同频率的 <code class="docutils literal transnotate"><span class="pre">Period</span></code> 实例之间的差值将返回它们之间的频率单位数。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [370]: </span><span class="n">pd</span><span class="o">.</span><span class="n">Period</span><span class="p">(</span><span class="s2">"2012"</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"Y-DEC"</span><span class="p">)</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">Period</span><span class="p">(</span><span class="s2">"2002"</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"Y-DEC"</span><span class="p">)</span>
<span class="gh">Out[370]: </span><span class="go">&lt;10 * YearEnds: month=12&gt;</span>
</pre></div>
</div>
</section>
<section id="periodindex-and-period-range">
<h3>PeriodIndex 和 period_range<a class="headerlink" href="timeseries.html#periodindex-and-period-range" title="Link to this heading">#</a></h3>
<p>可以将常规的 <code class="docutils literal notranslate"><span class="pre">Period</span></code> 对象序列收集到 <code class="docutils literal notranslate"><span class="pre">PeriodIndex</span></code> 中，可以使用 <code class="docutils literal notranslate"><span class="pre">period_range</span></code> 便利函数来构建。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [371]: </span><span class="n">prng</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">period_range</span><span class="p">(</span><span class="s2">"1/1/2011"</span><span class="p">,</span> <span class="s2">"1/1/2012"</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"M"</span><span class="p">)</span>

<span class="gp">In [372]: </span><span class="n">prng</span>
<span class="gh">Out[372]: </span>
<span class="go">PeriodIndex(['2011-01', '2011-02', '2011-03', '2011-04', '2011-05', '2011-06',</span>
<span class="go">             '2011-07', '2011-08', '2011-09', '2011-10', '2011-11', '2011-12',</span>
<span class="go">             '2012-01'],</span>
<span class="go">            dtype='period[M]')</span>
</pre></div>
</div>
<p><code class="docutils literal transnotate"><span class="pre">PeriodIndex</span></code> 构造函数也可以直接使用。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [373]: </span><span class="n">pd</span><span class="o">.</span><span class="n">PeriodIndex</span><span class="p">([</span><span class="s2">"2011-1"</span><span class="p">,</span> <span class="s2">"2011-2"</span><span class="p">,</span> <span class="s2">"2011-3"</span><span class="p">],</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"M"</span><span class="p">)</span>
<span class="gh">Out[373]: </span><span class="go">PeriodIndex(['2011-01', '2011-02', '2011-03'], dtype='period[M]')</span>
</pre></div>
</div>
<p>传递乘法的频率会输出一个具有乘法跨度的 <code class="docutils literal transnotate"><span class="pre">Period</span></code> 序列。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [374]: </span><span class="n">pd</span><span class="o">.</span><span class="n">period_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="s2">"2014-01"</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"3M"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="gh">Out[374]: </span><span class="go">PeriodIndex(['2014-01', '2014-04', '2014-07', '2014-10'], dtype='period[3M]')</span>
</pre></div>
</div>
<p>如果 <code class="docutils literal notranslate"><span class="pre">start</span></code> 或 <code class="docutils literal transnotate"><span class="pre">end</span></code> 是 <code class="docutils literal notranslate"><span class="pre">Period</span></code> 对象，它们将用作 <code class="docutils literal transnotate"><span class="pre">PeriodIndex</span></code> 的锚定端点，其频率与 <code class="docutils literal transnotate"><span class="pre">PeriodIndex</span></code> 构造函数匹配。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [375]: </span><span class="n">pd</span><span class="o">.</span><span class="n">period_range</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="n">start</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Period</span><span class="p">(</span><span class="s2">"2017Q1"</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"Q"</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Period</span><span class="p">(</span><span class="s2">"2017Q2"</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"Q"</span><span class="p">),</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"M"</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>
<span class="gh">Out[375]: </span><span class="go">PeriodIndex(['2017-03', '2017-04', '2017-05', '2017-06'], dtype='period[M]')</span>
</pre></div>
</div>
<p>就像 <code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code> 一样，<code class="docutils literal notranslate"><span class="pre">PeriodIndex</span></code> 也可以用于索引 pandas 对象。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [376]: </span><span class="n">ps</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">prng</span><span class="p">)),</span> <span class="n">prng</span><span class="p">)</span>

<span class="gp">In [377]: </span><span class="n">ps</span>
<span class="gh">Out[377]: </span>
<span class="go">2011-01   -2.916901</span>
<span class="go">2011-02    0.514474</span>
<span class="go">2011-03    1.346470</span>
<span class="go">2011-04    0.816397</span>
<span class="go">2011-05    2.258648</span>
<span class="go">2011-06    0.494789</span>
<span class="go">2011-07    0.301239</span>
<span class="go">2011-08    0.464776</span>
<span class="go">2011-09   -1.393581</span>
<span class="go">2011-10    0.056780</span>
<span class="go">2011-11    0.197035</span>
<span class="go">2011-12    2.261385</span>
<span class="go">2012-01   -0.329583</span>
<span class="go">Freq: M, dtype: float64</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">PeriodIndex</span></code> 支持与 <code class="docutils literal notranslate"><span class="pre">Period</span></code> 相同的加法和减法规则。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [378]: </span><span class="n">idx</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">period_range</span><span class="p">(</span><span class="s2">"2014-07-01 09:00"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"h"</span><span class="p">)</span>

<span class="gp">In [379]: </span><span class="n">idx</span>
<span class="gh">Out[379]: </span>
<span class="go">PeriodIndex(['2014-07-01 09:00', '2014-07-01 10:00', '2014-07-01 11:00',</span>
<span class="go">             '2014-07-01 12:00', '2014-07-01 13:00'],</span>
<span class="go">            dtype='period[h]')</span>

<span class="gp">In [380]: </span><span class="n">idx</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">Hour</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="gh">Out[380]: </span>
<span class="go">PeriodIndex(['2014-07-01 11:00', '2014-07-01 12:00', '2014-07-01 13:00',</span>
<span class="go">             '2014-07-01 14:00', '2014-07-01 15:00'],</span>
<span class="go">            dtype='period[h]')</span>

<span class="gp">In [381]: </span><span class="n">idx</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">period_range</span><span class="p">(</span><span class="s2">"2014-07"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"M"</span><span class="p">)</span>

<span class="gp">In [382]: </span><span class="n">idx</span>
<span class="gh">Out[382]: </span><span class="go">PeriodIndex(['2014-07', '2014-08', '2014-09', '2014-10', '2014-11'], dtype='period[M]')</span>

<span class="gp">In [383]: </span><span class="n">idx</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">MonthEnd</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="gh">Out[383]: </span><span class="go">PeriodIndex(['2014-10', '2014-11', '2014-12', '2015-01', '2015-02'], dtype='period[M]')</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">PeriodIndex</span></code> 有自己的名为 <code class="docutils literal notranslate"><span class="pre">period</span></code> 的 dtype，请参阅<a class="reference internal" href="timeseries.html#timeseries-period-dtype"><span class="std std-ref">周期数据类型</span></a>。</p>
</section>
<section id="period-dtypes">
<span id="timeseries-period-dtype"></span><h3>周期数据类型<a class="headerlink" href="timeseries.html#period-dtypes" title="Link to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">PeriodIndex</span></code> 有一个自定义的 <code class="docutils literal notranslate"><span class="pre">period</span></code> 数据类型。这是一个 pandas 扩展数据类型，类似于<a class="reference internal" href="timeseries.html#timeseries-timezone-series"><span class="std std-ref">时区感知数据类型</span></a> (<code class="docutils literal notranslate"><span class="pre">datetime64[ns,</span> <span class="pre">tz]</span></code>)。</p>
<p><code class="docutils literal notranslate"><span class="pre">period</span></code> 数据类型保存 <code class="docutils literal notranslate"><span class="pre">freq</span></code> 属性，并使用<a class="reference internal" href="timeseries.html#timeseries-period-aliases"><span class="std std-ref">频率字符串</span></a>表示为 <code class="docutils literal transnotate"><span class="pre">period[freq]</span></code>，例如 <code class="docutils literal notranslate"><span class="pre">period[D]</span></code> 或 <code class="docutils literal notranslate"><span class="pre">period[M]</span></code>。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [384]: </span><span class="n">pi</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">period_range</span><span class="p">(</span><span class="s2">"2016-01-01"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"M"</span><span class="p">)</span>

<span class="gp">In [385]: </span><span class="n">pi</span>
<span class="gh">Out[385]: </span><span class="go">PeriodIndex(['2016-01', '2016-02', '2016-03'], dtype='period[M]')</span>

<span class="gp">In [386]: </span><span class="n">pi</span><span class="o">.</span><span class="n">dtype</span>
<span class="gh">Out[386]: </span><span class="go">period[M]</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">period</span></code> 数据类型可以在 <code class="docutils literal notranslate"><span class="pre">.astype(...)</span></code> 中使用。它允许像 <code class="docutils literal notranslate"><span class="pre">.asfreq()</span></code> 一样更改 <code class="docutils literal notranslate"><span class="pre">PeriodIndex</span></code> 的 <code class="docutils literal notranslate"><span class="pre">freq</span></code>，并像 <code class="docutils literal notranslate"><span class="pre">to_period()</span></code> 一样将 <code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code> 转换为 <code class="docutils literal transnotate"><span class="pre">PeriodIndex</span></code>。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="go"># change monthly freq to daily freq</span>
<span class="gp">In [387]: </span><span class="n">pi</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">"period[D]"</span><span class="p">)</span>
<span class="gh">Out[387]: </span><span class="go">PeriodIndex(['2016-01-31', '2016-02-29', '2016-03-31'], dtype='period[D]')</span>

<span class="go"># convert to DatetimeIndex</span>
<span class="gp">In [388]: </span><span class="n">pi</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">"datetime64[ns]"</span><span class="p">)</span>
<span class="gh">Out[388]: </span><span class="go">DatetimeIndex(['2016-01-01', '2016-02-01', '2016-03-01'], dtype='datetime64[ns]', freq='MS')</span>

<span class="go"># convert to PeriodIndex</span>
<span class="gp">In [389]: </span><span class="n">dti</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">"2011-01-01"</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"ME"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="gp">In [390]: </span><span class="n">dti</span>
<span class="gh">Out[390]: </span><span class="go">DatetimeIndex(['2011-01-31', '2011-02-28', '2011-03-31'], dtype='datetime64[ns]', freq='ME')</span>

<span class="gp">In [391]: </span><span class="n">dti</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">"period[M]"</span><span class="p">)</span>
<span class="gh">Out[391]: </span><span class="go">PeriodIndex(['2011-01', '2011-02', '2011-03'], dtype='period[M]')</span>
</pre></div>
</div>
</section>
<section id="periodindex-partial-string-indexing">
<h3>PeriodIndex 部分字符串索引<a class="headerlink" href="timeseries.html#periodindex-partial-string-indexing" title="Link to this heading">#</a></h3>
<p>PeriodIndex 现在支持对非单调索引进行部分字符串切片。</p>
<p>您可以将日期和字符串传递给具有 <code class="docutils literal notranslate"><span class="pre">PeriodIndex</span></code> 的 <code class="docutils literal notranslate"><span class="pre">Series</span></code> 和 <code class="docutils literal transnotate"><span class="pre">DataFrame</span></code>，其方式与 <code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code> 相同。有关详细信息，请参阅<a class="reference internal" href="timeseries.html#timeseries-partialindexing"><span class="std std-ref">DatetimeIndex 部分字符串索引</span></a>。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [392]: </span><span class="n">ps</span><span class="p">[</span><span class="s2">"2011-01"</span><span class="p">]</span>
<span class="gh">Out[392]: </span><span class="go">-2.9169013294054507</span>

<span class="gp">In [393]: </span><span class="n">ps</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2011</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">25</span><span class="p">):]</span>
<span class="gh">Out[393]: </span>
<span class="go">2011-12    2.261385</span>
<span class="go">2012-01   -0.329583</span>
<span class="go">Freq: M, dtype: float64</span>

<span class="gp">In [394]: </span><span class="n">ps</span><span class="p">[</span><span class="s2">"10/31/2011"</span><span class="p">:</span><span class="s2">"12/31/2011"</span><span class="p">]</span>
<span class="gh">Out[394]: </span>
<span class="go">2011-10    0.056780</span>
<span class="go">2011-11    0.197035</span>
<span class="go">2011-12    2.261385</span>
<span class="go">Freq: M, dtype: float64</span>
</pre></div>
</div>
<p>传入一个表示比 <code class="docutils literal notranslate"><span class="pre">PeriodIndex</span></code> 频率低的字符串，会返回部分切片数据。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [395]: </span><span class="n">ps</span><span class="p">[</span><span class="s2">"2011"</span><span class="p">]</span>
<span class="gh">Out[395]: </span>
<span class="go">2011-01   -2.916901</span>
<span class="go">2011-02    0.514474</span>
<span class="go">2011-03    1.346470</span>
<span class="go">2011-04    0.816397</span>
<span class="go">2011-05    2.258648</span>
<span class="go">2011-06    0.494789</span>
<span class="go">2011-07    0.301239</span>
<span class="go">2011-08    0.464776</span>
<span class="go">2011-09   -1.393581</span>
<span class="go">2011-10    0.056780</span>
<span class="go">2011-11    0.197035</span>
<span class="go">2011-12    2.261385</span>
<span class="go">Freq: M, dtype: float64</span>

<span class="gp">In [396]: </span><span class="n">dfp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">600</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
<span class="gp">   .....: </span>    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"A"</span><span class="p">],</span>
<span class="gp">   .....: </span>    <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">period_range</span><span class="p">(</span><span class="s2">"2013-01-01 9:00"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"min"</span><span class="p">),</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [397]: </span><span class="n">dfp</span>
<span class="gh">Out[397]: </span>
<span class="go">                         A</span>
<span class="go">2013-01-01 09:00 -0.538468</span>
<span class="go">2013-01-01 09:01 -1.365819</span>
<span class="go">2013-01-01 09:02 -0.969051</span>
<span class="go">2013-01-01 09:03 -0.331152</span>
<span class="go">2013-01-01 09:04 -0.245334</span>
<span class="go">...                    ...</span>
<span class="go">2013-01-01 18:55  0.522460</span>
<span class="go">2013-01-01 18:56  0.118710</span>
<span class="go">2013-01-01 18:57  0.167517</span>
<span class="go">2013-01-01 18:58  0.922883</span>
<span class="go">2013-01-01 18:59  1.721104</span>

<span class="go">[600 rows x 1 columns]</span>

<span class="gp">In [398]: </span><span class="n">dfp</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">"2013-01-01 10h"</span><span class="p">]</span>
<span class="gh">Out[398]: </span>
<span class="go">                         A</span>
<span class="go">2013-01-01 10:00 -0.308975</span>
<span class="go">2013-01-01 10:01  0.542520</span>
<span class="go">2013-01-01 10:02  1.061068</span>
<span class="go">2013-01-01 10:03  0.754005</span>
<span class="go">2013-01-01 10:04  0.352933</span>
<span class="go">...                    ...</span>
<span class="go">2013-01-01 10:55 -0.865621</span>
<span class="go">2013-01-01 10:56 -1.167818</span>
<span class="go">2013-01-01 10:57 -2.081748</span>
<span class="go">2013-01-01 10:58 -0.527146</span>
<span class="go">2013-01-01 10:59  0.802298</span>

<span class="go">[60 rows x 1 columns]</span>
</pre></div>
</div>
<p>与 <code class="docutils literal transnotate"><span class="pre">DatetimeIndex</span></code> 一样，端点将包含在结果中。下面的示例切片从 10:00 到 11:59 的数据。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [399]: </span><span class="n">dfp</span><span class="p">[</span><span class="s2">"2013-01-01 10h"</span><span class="p">:</span><span class="s2">"2013-01-01 11h"</span><span class="p">]</span>
<span class="gh">Out[399]: </span>
<span class="go">                         A</span>
<span class="go">2013-01-01 10:00 -0.308975</span>
<span class="go">2013-01-01 10:01  0.542520</span>
<span class="go">2013-01-01 10:02  1.061068</span>
<span class="go">2013-01-01 10:03  0.754005</span>
<span class="go">2013-01-01 10:04  0.352933</span>
<span class="go">...                    ...</span>
<span class="go">2013-01-01 11:55 -0.590204</span>
<span class="go">2013-01-01 11:56  1.539990</span>
<span class="go">2013-01-01 11:57 -1.224826</span>
<span class="go">2013-01-01 11:58  0.578798</span>
<span class="go">2013-01-01 11:59 -0.685496</span>

<span class="go">[120 rows x 1 columns]</span>
</pre></div>
</div>
</section>
<section id="frequency-conversion-and-resampling-with-periodindex">
<h3>使用 PeriodIndex 进行频率转换和重采样<a class="headerlink" href="timeseries.html#frequency-conversion-and-resampling-with-periodindex" title="Link to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Period</span></code> 和 <code class="docutils literal notranslate"><span class="pre">PeriodIndex</span></code> 的频率可以通过 <code class="docutils literal transnotate"><span class="pre">asfreq</span></code> 方法进行转换。让我们从 2011 财年开始，该财年于 12 月结束。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [400]: </span><span class="n">p</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Period</span><span class="p">(</span><span class="s2">"2011"</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"Y-DEC"</span><span class="p">)</span>

<span class="gp">In [401]: </span><span class="n">p</span>
<span class="gh">Out[401]: </span><span class="go">Period('2011', 'Y-DEC')</span>
</pre></div>
</div>
<p>我们可以将其转换为月频率。使用 <code class="docutils literal notranslate"><span class="pre">how</span></code> 参数，我们可以指定是返回起始月份还是结束月份。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [402]: </span><span class="n">p</span><span class="o">.</span><span class="n">asfreq</span><span class="p">(</span><span class="s2">"M"</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">"start"</span><span class="p">)</span>
<span class="gh">Out[402]: </span><span class="go">Period('2011-01', 'M')</span>

<span class="gp">In [403]: </span><span class="n">p</span><span class="o">.</span><span class="n">asfreq</span><span class="p">(</span><span class="s2">"M"</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">"end"</span><span class="p">)</span>
<span class="gh">Out[403]: </span><span class="go">Period('2011-12', 'M')</span>
</pre></div>
</div>
<p>为了方便，提供了速记 's' 和 'e'。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [404]: </span><span class="n">p</span><span class="o">.</span><span class="n">asfreq</span><span class="p">(</span><span class="s2">"M"</span><span class="p">,</span> <span class="s2">"s"</span><span class="p">)</span>
<span class="gh">Out[404]: </span><span class="go">Period('2011-01', 'M')</span>

<span class="gp">In [405]: </span><span class="n">p</span><span class="o">.</span><span class="n">asfreq</span><span class="p">(</span><span class="s2">"M"</span><span class="p">,</span> <span class="s2">"e"</span><span class="p">)</span>
<span class="gh">Out[405]: </span><span class="go">Period('2011-12', 'M')</span>
</pre></div>
</div>
<p>转换为“超周期”（例如，年频率是季度频率的超周期）会自动返回包含输入周期的超周期。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [406]: </span><span class="n">p</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Period</span><span class="p">(</span><span class="s2">"2011-12"</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"M"</span><span class="p">)</span>

<span class="gp">In [407]: </span><span class="n">p</span><span class="o">.</span><span class="n">asfreq</span><span class="p">(</span><span class="s2">"Y-NOV"</span><span class="p">)</span>
<span class="gh">Out[407]: </span><span class="go">Period('2012', 'Y-NOV')</span>
</pre></div>
</div>
<p>请注意，由于我们转换为年频率并在 11 月结束，因此 2011 年 12 月的月周期实际上在 2012 年 Y-NOV 周期中。</p>
<p id="timeseries-quarterly">带锚定频率的周期转换对于处理经济学、商业和其他领域常见的各种季度数据特别有用。许多组织根据其财政年度开始和结束的月份定义季度。因此，2011 年第一季度可能在 2010 年开始，或者在 2011 年几个月后开始。通过锚定频率，pandas 支持所有季度频率 <code class="docutils literal notranslate"><span class="pre">Q-JAN</span></code> 到 <code class="docutils literal transnotate"><span class="pre">Q-DEC</span></code>。</p>
<p><code class="docutils literal notranslate"><span class="pre">Q-DEC</span></code> 定义常规日历季度。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [408]: </span><span class="n">p</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Period</span><span class="p">(</span><span class="s2">"2012Q1"</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"Q-DEC"</span><span class="p">)</span>

<span class="gp">In [409]: </span><span class="n">p</span><span class="o">.</span><span class="n">asfreq</span><span class="p">(</span><span class="s2">"D"</span><span class="p">,</span> <span class="s2">"s"</span><span class="p">)</span>
<span class="gh">Out[409]: </span><span class="go">Period('2012-01-01', 'D')</span>

<span class="gp">In [410]: </span><span class="n">p</span><span class="o">.</span><span class="n">asfreq</span><span class="p">(</span><span class="s2">"D"</span><span class="p">,</span> <span class="s2">"e"</span><span class="p">)</span>
<span class="gh">Out[410]: </span><span class="go">Period('2012-03-31', 'D')</span>
</pre></div>
</div>
<p><code class="docutils literal transnotate"><span class="pre">Q-MAR</span></code> 定义财政年度在三月结束。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [411]: </span><span class="n">p</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Period</span><span class="p">(</span><span class="s2">"2011Q4"</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"Q-MAR"</span><span class="p">)</span>

<span class="gp">In [412]: </span><span class="n">p</span><span class="o">.</span><span class="n">asfreq</span><span class="p">(</span><span class="s2">"D"</span><span class="p">,</span> <span class="s2">"s"</span><span class="p">)</span>
<span class="gh">Out[412]: </span><span class="go">Period('2011-01-01', 'D')</span>

<span class="gp">In [413]: </span><span class="n">p</span><span class="o">.</span><span class="n">asfreq</span><span class="p">(</span><span class="s2">"D"</span><span class="p">,</span> <span class="s2">"e"</span><span class="p">)</span>
<span class="gh">Out[413]: </span><span class="go">Period('2011-03-31', 'D')</span>
</pre></div>
</div>
</section>
</section>
<section id="converting-between-representations">
<span id="timeseries-interchange"></span><h2>表示之间的转换<a class="headerlink" href="timeseries.html#converting-between-representations" title="Link to this heading">#</a></h2>
<p>时间戳数据可以使用 <code class="docutils literal notranslate"><span class="pre">to_period</span></code> 转换为 PeriodIndex 索引的数据，反之则可以使用 <code class="docutils literal notranslate"><span class="pre">to_timestamp</span></code>。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [414]: </span><span class="n">rng</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">"1/1/2012"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"ME"</span><span class="p">)</span>

<span class="gp">In [415]: </span><span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rng</span><span class="p">)),</span> <span class="n">index</span><span class="o">=</span><span class="n">rng</span><span class="p">)</span>

<span class="gp">In [416]: </span><span class="n">ts</span>
<span class="gh">Out[416]: </span>
<span class="go">2012-01-31    1.931253</span>
<span class="go">2012-02-29   -0.184594</span>
<span class="go">2012-03-31    0.249656</span>
<span class="go">2012-04-30   -0.978151</span>
<span class="go">2012-05-31   -0.873389</span>
<span class="go">Freq: ME, dtype: float64</span>

<span class="gp">In [417]: </span><span class="n">ps</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">to_period</span><span class="p">()</span>

<span class="gp">In [418]: </span><span class="n">ps</span>
<span class="gh">Out[418]: </span>
<span class="go">2012-01    1.931253</span>
<span class="go">2012-02   -0.184594</span>
<span class="go">2012-03    0.249656</span>
<span class="go">2012-04   -0.978151</span>
<span class="go">2012-05   -0.873389</span>
<span class="go">Freq: M, dtype: float64</span>

<span class="gp">In [419]: </span><span class="n">ps</span><span class="o">.</span><span class="n">to_timestamp</span><span class="p">()</span>
<span class="gh">Out[419]: </span>
<span class="go">2012-01-01    1.931253</span>
<span class="go">2012-02-01   -0.184594</span>
<span class="go">2012-03-01    0.249656</span>
<span class="go">2012-04-01   -0.978151</span>
<span class="go">2012-05-01   -0.873389</span>
<span class="go">Freq: MS, dtype: float64</span>
</pre></div>
</div>
<p>请记住，可以使用 's' 和 'e' 来返回周期的开始或结束时间戳。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [420]: </span><span class="n">ps</span><span class="o">.</span><span class="n">to_timestamp</span><span class="p">(</span><span class="s2">"D"</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">"s"</span><span class="p">)</span>
<span class="gh">Out[420]: </span>
<span class="go">2012-01-01    1.931253</span>
<span class="go">2012-02-01   -0.184594</span>
<span class="go">2012-03-01    0.249656</span>
<span class="go">2012-04-01   -0.978151</span>
<span class="go">2012-05-01   -0.873389</span>
<span class="go">Freq: MS, dtype: float64</span>
</pre></div>
</div>
<p>周期和时间戳之间的转换使得一些便捷的算术函数得以使用。在下面的示例中，我们将一个财政年度于 11 月结束的季度频率转换为季度结束后的下个月月底的上午 9 点。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [421]: </span><span class="n">prng</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">period_range</span><span class="p">(</span><span class="s2">"1990Q1"</span><span class="p">,</span> <span class="s2">"2000Q4"</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"Q-NOV"</span><span class="p">)</span>

<span class="gp">In [422]: </span><span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">prng</span><span class="p">)),</span> <span class="n">prng</span><span class="p">)</span>

<span class="gp">In [423]: </span><span class="n">ts</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="p">(</span><span class="n">prng</span><span class="o">.</span><span class="n">asfreq</span><span class="p">(</span><span class="s2">"M"</span><span class="p">,</span> <span class="s2">"e"</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">asfreq</span><span class="p">(</span><span class="s2">"h"</span><span class="p">,</span> <span class="s2">"s"</span><span class="p">)</span> <span class="o">+</span> <span class="mi">9</span>

<span class="gp">In [424]: </span><span class="n">ts</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="gh">Out[424]: </span>
<span class="go">1990-03-01 09:00   -0.109291</span>
<span class="go">1990-06-01 09:00   -0.637235</span>
<span class="go">1990-09-01 09:00   -1.735925</span>
<span class="go">1990-12-01 09:00    2.096946</span>
<span class="go">1991-03-01 09:00   -1.039926</span>
<span class="go">Freq: h, dtype: float64</span>
</pre></div>
</div>
</section>
<section id="representing-out-of-bounds-spans">
<span id="timeseries-oob"></span><h2>表示超出范围的跨度<a class="headerlink" href="timeseries.html#representing-out-of-bounds-spans" title="Link to this heading">#</a></h2>
<p>如果您的数据超出了 <code class="docutils literal notranslate"><span class="pre">Timestamp</span></code> 的范围，请参阅<a class="reference internal" href="timeseries.html#timeseries-timestamp-limits"><span class="std std-ref">时间戳限制</span></a>，那么您可以使用 <code class="docutils literal notranslate"><span class="pre">PeriodIndex</span></code> 和/或 <code class="docutils literal notranslate"><span class="pre">Periods</span></code> 的 <code class="docutils literal transnotate"><span class="pre">Series</span></code> 进行计算。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [425]: </span><span class="n">span</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">period_range</span><span class="p">(</span><span class="s2">"1215-01-01"</span><span class="p">,</span> <span class="s2">"1381-01-01"</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"D"</span><span class="p">)</span>

<span class="gp">In [426]: </span><span class="n">span</span>
<span class="gh">Out[426]: </span>
<span class="go">PeriodIndex(['1215-01-01', '1215-01-02', '1215-01-03', '1215-01-04',</span>
<span class="go">             '1215-01-05', '1215-01-06', '1215-01-07', '1215-01-08',</span>
<span class="go">             '1215-01-09', '1215-01-10',</span>
<span class="go">             ...</span>
<span class="go">             '1380-12-23', '1380-12-24', '1380-12-25', '1380-12-26',</span>
<span class="go">             '1380-12-27', '1380-12-28', '1380-12-29', '1380-12-30',</span>
<span class="go">             '1380-12-31', '1381-01-01'],</span>
<span class="go">            dtype='period[D]', length=60632)</span>
</pre></div>
</div>
<p>从基于 <code class="docutils literal notranslate"><span class="pre">int64</span></code> 的 YYYYMMDD 表示转换。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [427]: </span><span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">20121231</span><span class="p">,</span> <span class="mi">20141130</span><span class="p">,</span> <span class="mi">99991231</span><span class="p">])</span>

<span class="gp">In [428]: </span><span class="n">s</span>
<span class="gh">Out[428]: </span>
<span class="go">0    20121231</span>
<span class="go">1    20141130</span>
<span class="go">2    99991231</span>
<span class="go">dtype: int64</span>

<span class="gp">In [429]: </span><span class="k">def</span><span class="w"> </span><span class="nf">conv</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="gp">   .....: </span>    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Period</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">x</span> <span class="o">//</span> <span class="mi">10000</span><span class="p">,</span> <span class="n">month</span><span class="o">=</span><span class="n">x</span> <span class="o">//</span> <span class="mi">100</span> <span class="o">%</span> <span class="mi">100</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="n">x</span> <span class="o">%</span> <span class="mi">100</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"D"</span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [430]: </span><span class="n">s</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">conv</span><span class="p">)</span>
<span class="gh">Out[430]: </span>
<span class="go">0    2012-12-31</span>
<span class="go">1    2014-11-30</span>
<span class="go">2    9999-12-31</span>
<span class="go">dtype: period[D]</span>

<span class="gp">In [431]: </span><span class="n">s</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">conv</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
<span class="gh">Out[431]: </span><span class="go">Period('9999-12-31', 'D')</span>
</pre></div>
</div>
<p>这些可以很容易地转换为 <code class="docutils literal notranslate"><span class="pre">PeriodIndex</span></code>。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [432]: </span><span class="n">span</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">PeriodIndex</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">conv</span><span class="p">))</span>

<span class="gp">In [433]: </span><span class="n">span</span>
<span class="gh">Out[433]: </span><span class="go">PeriodIndex(['2012-12-31', '2014-11-30', '9999-12-31'], dtype='period[D]')</span>
</pre></div>
</div>
</section>
<section id="time-zone-handling">
<span id="timeseries-timezone"></span><h2>时区处理<a class="headerlink" href="timeseries.html#time-zone-handling" title="Link to this heading">#</a></h2>
<p>pandas 使用 <code class="docutils literal transnotate"><span class="pre">pytz</span></code> 和 <code class="docutils literal notranslate"><span class="pre">dateutil</span></code> 库或标准库中的 <a class="reference external" href="https://docs.pythonlang.cn/3/library/datetime.html#datetime.timezone" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">datetime.timezone</span></code></a> 对象，为处理不同时区的时间戳提供了丰富的支持。</p>
<section id="working-with-time-zones">
<h3>使用时区<a class="headerlink" href="timeseries.html#working-with-time-zones" title="Link to this heading">#</a></h3>
<p>默认情况下，pandas 对象不感知时区。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [434]: </span><span class="n">rng</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">"3/6/2012 00:00"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"D"</span><span class="p">)</span>

<span class="gp">In [435]: </span><span class="n">rng</span><span class="o">.</span><span class="n">tz</span> <span class="ow">is</span> <span class="kc">None</span>
<span class="gh">Out[435]: </span><span class="go">True</span>
</pre></div>
</div>
<p>要将这些日期本地化到特定时区（为朴素日期分配特定时区），您可以使用 <code class="docutils literal notranslate"><span class="pre">tz_localize</span></code> 方法或 <a class="reference internal" href="../reference/api/pandas.date_range.html#pandas.date_range" title="pandas.date_range"><code class="xref py py-func docutils literal notranslate"><span class="pre">date_range()</span></code></a>、<a class="reference internal" href="../reference/api/pandas.Timestamp.html#pandas.Timestamp" title="pandas.Timestamp"><code class="xref py py-class docutils literal notranslate"><span class="pre">Timestamp</span></code></a> 或 <a class="reference internal" href="../reference/api/pandas.DatetimeIndex.html#pandas.DatetimeIndex" title="pandas.DatetimeIndex"><code class="xref py py-class docutils literal notranslate"><span class="pre">DatetimeIndex</span></code></a> 中的 <code class="docutils literal notranslate"><span class="pre">tz</span></code> 关键字参数。您可以传递 <code class="docutils literal notranslate"><span class="pre">pytz</span></code> 或 <code class="docutils literal transnotate"><span class="pre">dateutil</span></code> 时区对象，或 Olson 时区数据库字符串。Olson 时区字符串默认返回 <code class="docutils literal notranslate"><span class="pre">pytz</span></code> 时区对象。要返回 <code class="docutils literal transnotate"><span class="pre">dateutil</span></code> 时区对象，请在字符串前附加 <code class="docutils literal transnotate"><span class="pre">dateutil/</span></code>。</p>
<ul class="simple">
<li><p>在 <code class="docutils literal notranslate"><span class="pre">pytz</span></code> 中，您可以使用 <code class="docutils literal transnotate"><span class="pre">from</span> <span class="pre">pytz</span> <span class="pre">import</span> <span class="pre">common_timezones,</span> <span class="pre">all_timezones</span></code> 找到常用（和不常用）时区的列表。</p></li>
<li><p><code class="docutils literal transnotate"><span class="pre">dateutil</span></code> 使用操作系统时区，因此没有固定的可用列表。对于常用时区，名称与 <code class="docutils literal transnotate"><span class="pre">pytz</span></code> 相同。</p></li>
</ul>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [436]: </span><span class="kn">import</span><span class="w"> </span><span class="nn">dateutil</span>

<span class="go"># pytz</span>
<span class="gp">In [437]: </span><span class="n">rng_pytz</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">"3/6/2012 00:00"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"D"</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s2">"Europe/London"</span><span class="p">)</span>

<span class="gp">In [438]: </span><span class="n">rng_pytz</span><span class="o">.</span><span class="n">tz</span>
<span class="gh">Out[438]: </span><span class="go">&lt;DstTzInfo 'Europe/London' LMT-1 day, 23:59:00 STD&gt;</span>

<span class="go"># dateutil</span>
<span class="gp">In [439]: </span><span class="n">rng_dateutil</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">"3/6/2012 00:00"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"D"</span><span class="p">)</span>

<span class="gp">In [440]: </span><span class="n">rng_dateutil</span> <span class="o">=</span> <span class="n">rng_dateutil</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="s2">"dateutil/Europe/London"</span><span class="p">)</span>

<span class="gp">In [441]: </span><span class="n">rng_dateutil</span><span class="o">.</span><span class="n">tz</span>
<span class="gh">Out[441]: </span><span class="go">tzfile('/usr/share/zoneinfo/Europe/London')</span>

<span class="go"># dateutil - utc special case</span>
<span class="gp">In [442]: </span><span class="n">rng_utc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="s2">"3/6/2012 00:00"</span><span class="p">,</span>
<span class="gp">   .....: </span>    <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
<span class="gp">   .....: </span>    <span class="n">freq</span><span class="o">=</span><span class="s2">"D"</span><span class="p">,</span>
<span class="gp">   .....: </span>    <span class="n">tz</span><span class="o">=</span><span class="n">dateutil</span><span class="o">.</span><span class="n">tz</span><span class="o">.</span><span class="n">tzutc</span><span class="p">(),</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [443]: </span><span class="n">rng_utc</span><span class="o">.</span><span class="n">tz</span>
<span class="gh">Out[443]: </span><span class="go">tzutc()</span>
</pre></div>
</div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="go"># datetime.timezone</span>
<span class="gp">In [444]: </span><span class="n">rng_utc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="s2">"3/6/2012 00:00"</span><span class="p">,</span>
<span class="gp">   .....: </span>    <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
<span class="gp">   .....: </span>    <span class="n">freq</span><span class="o">=</span><span class="s2">"D"</span><span class="p">,</span>
<span class="gp">   .....: </span>    <span class="n">tz</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">,</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>

<span class="gp">In [445]: </span><span class="n">rng_utc</span><span class="o">.</span><span class="n">tz</span>
<span class="gh">Out[445]: </span><span class="go">datetime.timezone.utc</span>
</pre></div>
</div>
<p>请注意，<code class="docutils literal transnotate"><span class="pre">UTC</span></code> 时区在 <code class="docutils literal transnotate"><span class="pre">dateutil</span></code> 中是一个特殊情况，应明确构造为 <code class="docutils literal transnotate"><span class="pre">dateutil.tz.tzutc</span></code> 的实例。您也可以首先明确构造其他时区对象。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [446]: </span><span class="kn">import</span><span class="w"> </span><span class="nn">pytz</span>

<span class="go"># pytz</span>
<span class="gp">In [447]: </span><span class="n">tz_pytz</span> <span class="o">=</span> <span class="n">pytz</span><span class="o">.</span><span class="n">timezone</span><span class="p">(</span><span class="s2">"Europe/London"</span><span class="p">)</span>

<span class="gp">In [448]: </span><span class="n">rng_pytz</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">"3/6/2012 00:00"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"D"</span><span class="p">)</span>

<span class="gp">In [449]: </span><span class="n">rng_pytz</span> <span class="o">=</span> <span class="n">rng_pytz</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="n">tz_pytz</span><span class="p">)</span>

<span class="gp">In [450]: </span><span class="n">rng_pytz</span><span class="o">.</span><span class="n">tz</span> <span class="o">==</span> <span class="n">tz_pytz</span>
<span class="gh">Out[450]: </span><span class="go">True</span>

<span class="go"># dateutil</span>
<span class="gp">In [451]: </span><span class="n">tz_dateutil</span> <span class="o">=</span> <span class="n">dateutil</span><span class="o">.</span><span class="n">tz</span><span class="o">.</span><span class="n">gettz</span><span class="p">(</span><span class="s2">"Europe/London"</span><span class="p">)</span>

<span class="gp">In [452]: </span><span class="n">rng_dateutil</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">"3/6/2012 00:00"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"D"</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="n">tz_dateutil</span><span class="p">)</span>

<span class="gp">In [453]: </span><span class="n">rng_dateutil</span><span class="o">.</span><span class="n">tz</span> <span class="o">==</span> <span class="n">tz_dateutil</span>
<span class="gh">Out[453]: </span><span class="go">True</span>
</pre></div>
</div>
<p>要将时区感知的 pandas 对象从一个时区转换为另一个时区，您可以使用 <code class="docutils literal notranslate"><span class="pre">tz_convert</span></code> 方法。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [454]: </span><span class="n">rng_pytz</span><span class="o">.</span><span class="n">tz_convert</span><span class="p">(</span><span class="s2">"US/Eastern"</span><span class="p">)</span>
<span class="gh">Out[454]: </span>
<span class="go">DatetimeIndex(['2012-03-05 19:00:00-05:00', '2012-03-06 19:00:00-05:00',</span>
<span class="go">               '2012-03-07 19:00:00-05:00'],</span>
<span class="go">              dtype='datetime64[ns, US/Eastern]', freq=None)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p>当使用 <code class="docutils literal notranslate"><span class="pre">pytz</span></code> 时区时，<a class="reference internal" href="../reference/api/pandas.DatetimeIndex.html#pandas.DatetimeIndex" title="pandas.DatetimeIndex"><code class="xref py py-class docutils literal notranslate"><span class="pre">DatetimeIndex</span></code></a> 将构造一个与相同时间区输入的 <a class="reference internal" href="../reference/api/pandas.Timestamp.html#pandas.Timestamp" title="pandas.Timestamp"><code class="xref py py-class docutils literal notranslate"><span class="pre">Timestamp</span></code></a> 不同的时区对象。<a class="reference internal" href="../reference/api/pandas.DatetimeIndex.html#pandas.DatetimeIndex" title="pandas.DatetimeIndex"><code class="xref py py-class docutils literal notranslate"><span class="pre">DatetimeIndex</span></code></a> 可以包含一组 <a class="reference internal" href="../reference/api/pandas.Timestamp.html#pandas.Timestamp" title="pandas.Timestamp"><code class="xref py py-class docutils literal notranslate"><span class="pre">Timestamp</span></code></a> 对象，这些对象可能具有不同的 UTC 偏移量，不能由一个 <code class="docutils literal transnotate"><span class="pre">pytz</span></code> 时区实例简洁表示，而一个 <a class="reference internal" href="../reference/api/pandas.Timestamp.html#pandas.Timestamp" title="pandas.Timestamp"><code class="xref py py-class docutils literal notranslate"><span class="pre">Timestamp</span></code></a> 表示一个特定 UTC 偏移量的时间点。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [455]: </span><span class="n">dti</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">"2019-01-01"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"D"</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s2">"US/Pacific"</span><span class="p">)</span>

<span class="gp">In [456]: </span><span class="n">dti</span><span class="o">.</span><span class="n">tz</span>
<span class="gh">Out[456]: </span><span class="go">&lt;DstTzInfo 'US/Pacific' LMT-1 day, 16:07:00 STD&gt;</span>

<span class="gp">In [457]: </span><span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">"2019-01-01"</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s2">"US/Pacific"</span><span class="p">)</span>

<span class="gp">In [458]: </span><span class="n">ts</span><span class="o">.</span><span class="n">tz</span>
<span class="gh">Out[458]: </span><span class="go">&lt;DstTzInfo 'US/Pacific' PST-1 day, 16:00:00 STD&gt;</span>
</pre></div>
</div>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>请注意库之间的转换。对于某些时区，<code class="docutils literal transnotate"><span class="pre">pytz</span></code> 和 <code class="docutils literal notranslate"><span class="pre">dateutil</span></code> 对时区有不同的定义。这对于不常见的时区来说是个更大的问题，而不是对于像 <code class="docutils literal transnotate"><span class="pre">US/Eastern</span></code> 这样的“标准”时区。</p>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>请注意，不同版本时区库的时区定义可能不被视为相等。这在使用某个版本本地化后，又用不同版本进行操作的存储数据时可能会导致问题。有关如何处理这种情况，请参阅<a class="reference internal" href="io.html#io-hdf5-notes"><span class="std std-ref">此处</span></a>。</p>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>对于 <code class="docutils literal transnotate"><span class="pre">pytz</span></code> 时区，直接将时区对象传递给 <code class="docutils literal notranslate"><span class="pre">datetime.datetime</span></code> 构造函数是不正确的（例如，<code class="docutils literal transnotate"><span class="pre">datetime.datetime(2011,</span> <span class="pre">1,</span> <span class="pre">1,</span> <span class="pre">tzinfo=pytz.timezone('US/Eastern'))</span></code>。相反，日期时间需要使用 <code class="docutils literal transnotate"><span class="pre">pytz</span></code> 时区对象上的 <code class="docutils literal notranslate"><span class="pre">localize</span></code> 方法进行本地化。</p>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>请注意，对于未来的时间，任何时区库都不能保证时区（和 UTC）之间的正确转换，因为时区与 UTC 的偏移量可能会被相应政府更改。</p>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>如果您使用 2038-01-18 之后的日期，由于年 2038 问题导致底层库存在缺陷，夏令时 (DST) 调整将不会应用于时区感知日期。如果底层库得到修复，DST 转换将被应用。</p>
<p>例如，对于两个处于英国夏令时（因此通常为 GMT+1）的日期，以下两个断言都评估为真：</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [459]: </span><span class="n">d_2037</span> <span class="o">=</span> <span class="s2">"2037-03-31T010101"</span>

<span class="gp">In [460]: </span><span class="n">d_2038</span> <span class="o">=</span> <span class="s2">"2038-03-31T010101"</span>

<span class="gp">In [461]: </span><span class="n">DST</span> <span class="o">=</span> <span class="s2">"Europe/London"</span>

<span class="gp">In [462]: </span><span class="k">assert</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="n">d_2037</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="n">DST</span><span class="p">)</span> <span class="o">!=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="n">d_2037</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s2">"GMT"</span><span class="p">)</span>

<span class="gp">In [463]: </span><span class="k">assert</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="n">d_2038</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="n">DST</span><span class="p">)</span> <span class="o">==</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="n">d_2038</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s2">"GMT"</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>在底层，所有时间戳都以 UTC 格式存储。来自时区感知的 <a class="reference internal" href="../reference/api/pandas.DatetimeIndex.html#pandas.DatetimeIndex" title="pandas.DatetimeIndex"><code class="xref py py-class docutils literal notranslate"><span class="pre">DatetimeIndex</span></code></a> 或 <a class="reference internal" href="../reference/api/pandas.Timestamp.html#pandas.Timestamp" title="pandas.Timestamp"><code class="xref py py-class docutils literal notranslate"><span class="pre">Timestamp</span></code></a> 的值将根据时区进行本地化（日、小时、分钟等）。但是，具有相同 UTC 值的时间戳仍被视为相等，即使它们位于不同的时区。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [464]: </span><span class="n">rng_eastern</span> <span class="o">=</span> <span class="n">rng_utc</span><span class="o">.</span><span class="n">tz_convert</span><span class="p">(</span><span class="s2">"US/Eastern"</span><span class="p">)</span>

<span class="gp">In [465]: </span><span class="n">rng_berlin</span> <span class="o">=</span> <span class="n">rng_utc</span><span class="o">.</span><span class="n">tz_convert</span><span class="p">(</span><span class="s2">"Europe/Berlin"</span><span class="p">)</span>

<span class="gp">In [466]: </span><span class="n">rng_eastern</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="gh">Out[466]: </span><span class="go">Timestamp('2012-03-07 19:00:00-0500', tz='US/Eastern')</span>

<span class="gp">In [467]: </span><span class="n">rng_berlin</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="gh">Out[467]: </span><span class="go">Timestamp('2012-03-08 01:00:00+0100', tz='Europe/Berlin')</span>

<span class="gp">In [468]: </span><span class="n">rng_eastern</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">rng_berlin</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="gh">Out[468]: </span><span class="go">True</span>
</pre></div>
</div>
<p>不同时区的 <a class="reference internal" href="../reference/api/pandas.Series.html#pandas.Series" title="pandas.Series"><code class="xref py py-class docutils literal notranslate"><span class="pre">Series</span></code></a> 之间的操作将产生 UTC <a class="reference internal" href="../reference/api/pandas.Series.html#pandas.Series" title="pandas.Series"><code class="xref py py-class docutils literal notranslate"><span class="pre">Series</span></code></a>，根据 UTC 时间戳对齐数据。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [469]: </span><span class="n">ts_utc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">"20130101"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s2">"UTC"</span><span class="p">))</span>

<span class="gp">In [470]: </span><span class="n">eastern</span> <span class="o">=</span> <span class="n">ts_utc</span><span class="o">.</span><span class="n">tz_convert</span><span class="p">(</span><span class="s2">"US/Eastern"</span><span class="p">)</span>

<span class="gp">In [471]: </span><span class="n">berlin</span> <span class="o">=</span> <span class="n">ts_utc</span><span class="o">.</span><span class="n">tz_convert</span><span class="p">(</span><span class="s2">"Europe/Berlin"</span><span class="p">)</span>

<span class="gp">In [472]: </span><span class="n">result</span> <span class="o">=</span> <span class="n">eastern</span> <span class="o">+</span> <span class="n">berlin</span>

<span class="gp">In [473]: </span><span class="n">result</span>
<span class="gh">Out[473]: </span>
<span class="go">2013-01-01 00:00:00+00:00    0</span>
<span class="go">2013-01-02 00:00:00+00:00    2</span>
<span class="go">2013-01-03 00:00:00+00:00    4</span>
<span class="go">Freq: D, dtype: int64</span>

<span class="gp">In [474]: </span><span class="n">result</span><span class="o">.</span><span class="n">index</span>
<span class="gh">Out[474]: </span>
<span class="go">DatetimeIndex(['2013-01-01 00:00:00+00:00', '2013-01-02 00:00:00+00:00',</span>
<span class="go">               '2013-01-03 00:00:00+00:00'],</span>
<span class="go">              dtype='datetime64[ns, UTC]', freq='D')</span>
</pre></div>
</div>
<p>要删除时区信息，请使用 <code class="docutils literal notranslate"><span class="pre">tz_localize(None)</span></code> 或 <code class="docutils literal notranslate"><span class="pre">tz_convert(None)</span></code>。<code class="docutils literal notranslate"><span class="pre">tz_localize(None)</span></code> 将删除时区，产生本地时间表示。<code class="docutils literal transnotate"><span class="pre">tz_convert(None)</span></code> 将在转换为 UTC 时间后删除时区。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [475]: </span><span class="n">didx</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="s2">"2014-08-01 09:00"</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"h"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s2">"US/Eastern"</span><span class="p">)</span>

<span class="gp">In [476]: </span><span class="n">didx</span>
<span class="gh">Out[476]: </span>
<span class="go">DatetimeIndex(['2014-08-01 09:00:00-04:00', '2014-08-01 10:00:00-04:00',</span>
<span class="go">               '2014-08-01 11:00:00-04:00'],</span>
<span class="go">              dtype='datetime64[ns, US/Eastern]', freq='h')</span>

<span class="gp">In [477]: </span><span class="n">didx</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
<span class="gh">Out[477]: </span>
<span class="go">DatetimeIndex(['2014-08-01 09:00:00', '2014-08-01 10:00:00',</span>
<span class="go">               '2014-08-01 11:00:00'],</span>
<span class="go">              dtype='datetime64[ns]', freq=None)</span>

<span class="gp">In [478]: </span><span class="n">didx</span><span class="o">.</span><span class="n">tz_convert</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
<span class="gh">Out[478]: </span>
<span class="go">DatetimeIndex(['2014-08-01 13:00:00', '2014-08-01 14:00:00',</span>
<span class="go">               '2014-08-01 15:00:00'],</span>
<span class="go">              dtype='datetime64[ns]', freq='h')</span>

<span class="go"># tz_convert(None) is identical to tz_convert('UTC').tz_localize(None)</span>
<span class="gp">In [479]: </span><span class="n">didx</span><span class="o">.</span><span class="n">tz_convert</span><span class="p">(</span><span class="s2">"UTC"</span><span class="p">)</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
<span class="gh">Out[479]: </span>
<span class="go">DatetimeIndex(['2014-08-01 13:00:00', '2014-08-01 14:00:00',</span>
<span class="go">               '2014-08-01 15:00:00'],</span>
<span class="go">              dtype='datetime64[ns]', freq=None)</span>
</pre></div>
</div>
</section>
<section id="fold">
<span id="timeseries-fold"></span><h3>折叠<a class="headerlink" href="timeseries.html#fold" title="Link to this heading">#</a></h3>
<p>对于模糊时间，pandas 支持显式指定仅关键字参数 fold。由于夏令时，从夏季到冬季时间转换时，一个挂钟时间可能会出现两次；fold 描述日期时间类是对应于挂钟第一次（0）还是第二次（1）到达模糊时间。Fold 仅支持从朴素的 <code class="docutils literal notranslate"><span class="pre">datetime.datetime</span></code>（参见 <a class="reference external" href="https://docs.pythonlang.cn/3/library/datetime.html">datetime 文档</a>了解详细信息）或从 <a class="reference internal" href="../reference/api/pandas.Timestamp.html#pandas.Timestamp" title="pandas.Timestamp"><code class="xref py py-class docutils literal notranslate"><span class="pre">Timestamp</span></code></a> 构造，或从组件构造（参见下文）。仅支持 <code class="docutils literal notranslate"><span class="pre">dateutil</span></code> 时区（参见 <a class="reference external" href="https://dateutil.readthedocs.io/en/stable/tz.html#dateutil.tz.enfold">dateutil 文档</a>了解处理模糊日期时间的 <code class="docutils literal notranslate"><span class="pre">dateutil</span></code> 方法），因为 <code class="docutils literal transnotate"><span class="pre">pytz</span></code> 时区不支持 fold（参见 <a class="reference external" href="http://pytz.sourceforge.net/index.html">pytz 文档</a>了解 <code class="docutils literal transnotate"><span class="pre">pytz</span></code> 如何处理模糊日期时间的详细信息）。要使用 <code class="docutils literal transnotate"><span class="pre">pytz</span></code> 本地化模糊日期时间，请使用 <a class="reference internal" href="../reference/api/pandas.Timestamp.tz_localize.html#pandas.Timestamp.tz_localize" title="pandas.Timestamp.tz_localize"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Timestamp.tz_localize()</span></code></a>。一般来说，如果您需要直接控制如何处理模糊日期时间，我们建议依赖 <a class="reference internal" href="../reference/api/pandas.Timestamp.tz_localize.html#pandas.Timestamp.tz_localize" title="pandas.Timestamp.tz_localize"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Timestamp.tz_localize()</span></code></a>。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [480]: </span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2019</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<span class="gp">   .....: </span>    <span class="n">tz</span><span class="o">=</span><span class="s2">"dateutil/Europe/London"</span><span class="p">,</span>
<span class="gp">   .....: </span>    <span class="n">fold</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>
<span class="gh">Out[480]: </span><span class="go">Timestamp('2019-10-27 01:30:00+0100', tz='dateutil//usr/share/zoneinfo/Europe/London')</span>

<span class="gp">In [481]: </span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="n">year</span><span class="o">=</span><span class="mi">2019</span><span class="p">,</span>
<span class="gp">   .....: </span>    <span class="n">month</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<span class="gp">   .....: </span>    <span class="n">day</span><span class="o">=</span><span class="mi">27</span><span class="p">,</span>
<span class="gp">   .....: </span>    <span class="n">hour</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="gp">   .....: </span>    <span class="n">minute</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
<span class="gp">   .....: </span>    <span class="n">tz</span><span class="o">=</span><span class="s2">"dateutil/Europe/London"</span><span class="p">,</span>
<span class="gp">   .....: </span>    <span class="n">fold</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>
<span class="gh">Out[481]: </span><span class="go">Timestamp('2019-10-27 01:30:00+0000', tz='dateutil//usr/share/zoneinfo/Europe/London')</span>
</pre></div>
</div>
</section>
<section id="ambiguous-times-when-localizing">
<span id="timeseries-timezone-ambiguous"></span><h3>本地化时的模糊时间<a class="headerlink" href="timeseries.html#ambiguous-times-when-localizing" title="Link to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">tz_localize</span></code> 可能无法确定时间戳的 UTC 偏移量，因为本地时区的夏令时 (DST) 导致某些时间在一天内出现两次（“时钟回拨”）。以下选项可用：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">'raise'</span></code>：引发 <code class="docutils literal notranslate"><span class="pre">pytz.AmbiguousTimeError</span></code>（默认行为）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'infer'</span></code>：尝试根据时间戳的单调性确定正确的偏移量。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'NaT'</span></code>：将模糊时间替换为 <code class="docutils literal notranslate"><span class="pre">NaT</span></code>。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bool</span></code>：<code class="docutils literal notranslate"><span class="pre">True</span></code> 表示夏令时，<code class="docutils literal notranslate"><span class="pre">False</span></code> 表示非夏令时。序列时间支持布尔值数组。</p></li>
</ul>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [482]: </span><span class="n">rng_hourly</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">(</span>
<span class="gp">   .....: </span>    <span class="p">[</span><span class="s2">"11/06/2011 00:00"</span><span class="p">,</span> <span class="s2">"11/06/2011 01:00"</span><span class="p">,</span> <span class="s2">"11/06/2011 01:00"</span><span class="p">,</span> <span class="s2">"11/06/2011 02:00"</span><span class="p">]</span>
<span class="gp">   .....: </span><span class="p">)</span>
<span class="gp">   .....: </span>
</pre></div>
</div>
<p>这将失败，因为存在模糊时间（<code class="docutils literal notranslate"><span class="pre">'11/06/2011</span> <span class="pre">01:00'</span></code>）。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [483]: </span><span class="n">rng_hourly</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="s1">'US/Eastern'</span><span class="p">)</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">AmbiguousTimeError</span><span class="g g-Whitespace">                        </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">483</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">rng_hourly</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="s1">'US/Eastern'</span><span class="p">)</span>

<span class="nn">File ~/work/pandas/pandas/pandas/core/indexes/datetimes.py:293,</span> in <span class="ni">DatetimeIndex.tz_localize</span><span class="nt">(self, tz, ambiguous, nonexistent)</span>
<span class="g g-Whitespace">    </span><span class="mi">286</span> <span class="nd">@doc</span><span class="p">(</span><span class="n">DatetimeArray</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">287</span> <span class="k">def</span><span class="w"> </span><span class="nf">tz_localize</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">288</span>     <span class="bp">self</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">291</span>     <span class="n">nonexistent</span><span class="p">:</span> <span class="n">TimeNonexistent</span> <span class="o">=</span> <span class="s2">"raise"</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">292</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">293</span>     <span class="n">arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="n">tz</span><span class="p">,</span> <span class="n">ambiguous</span><span class="p">,</span> <span class="n">nonexistent</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">294</span>     <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_simple_new</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

<span class="nn">File ~/work/pandas/pandas/pandas/core/arrays/_mixins.py:81,</span> in <span class="ni">ravel_compat.&lt;locals&gt;.method</span><span class="nt">(self, *args, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">78</span> <span class="nd">@wraps</span><span class="p">(</span><span class="n">meth</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">79</span> <span class="k">def</span><span class="w"> </span><span class="nf">method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="g g-Whitespace">     </span><span class="mi">80</span>     <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">81</span>         <span class="k">return</span> <span class="n">meth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">83</span>     <span class="n">flags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ndarray</span><span class="o">.</span><span class="n">flags</span>
<span class="g g-Whitespace">     </span><span class="mi">84</span>     <span class="n">flat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="s2">"K"</span><span class="p">)</span>

<span class="nn">File ~/work/pandas/pandas/pandas/core/arrays/datetimes.py:1090,</span> in <span class="ni">DatetimeArray.tz_localize</span><span class="nt">(self, tz, ambiguous, nonexistent)</span>
<span class="g g-Whitespace">   </span><span class="mi">1087</span>     <span class="n">tz</span> <span class="o">=</span> <span class="n">timezones</span><span class="o">.</span><span class="n">maybe_get_tz</span><span class="p">(</span><span class="n">tz</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1088</span>     <span class="c1"># Convert to UTC</span>
<span class="ne">-&gt; </span><span class="mi">1090</span>     <span class="n">new_dates</span> <span class="o">=</span> <span class="n">tzconversion</span><span class="o">.</span><span class="n">tz_localize_to_utc</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1091</span>         <span class="bp">self</span><span class="o">.</span><span class="n">asi8</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1092</span>         <span class="n">tz</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1093</span>         <span class="n">ambiguous</span><span class="o">=</span><span class="n">ambiguous</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1094</span>         <span class="n">nonexistent</span><span class="o">=</span><span class="n">nonexistent</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1095</span>         <span class="n">creso</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_creso</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1096</span>     <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1097</span> <span class="n">new_dates_dt64</span> <span class="o">=</span> <span class="n">new_dates</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="sa">f</span><span class="s2">"M8[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="si">}</span><span class="s2">]"</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1098</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">tz_to_dtype</span><span class="p">(</span><span class="n">tz</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>

<span class="nn">File ~/work/pandas/pandas/pandas/_libs/tslibs/tzconversion.pyx:371,</span> in <span class="ni">pandas._libs.tslibs.tzconversion.tz_localize_to_utc</span><span class="nt">()</span>

<span class="ne">AmbiguousTimeError</span>: Cannot infer dst time from 2011-11-06 01:00:00, try using the 'ambiguous' argument
</pre></div>
</div>
<p>通过指定以下内容来处理这些模糊时间。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [484]: </span><span class="n">rng_hourly</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="s2">"US/Eastern"</span><span class="p">,</span> <span class="n">ambiguous</span><span class="o">=</span><span class="s2">"infer"</span><span class="p">)</span>
<span class="gh">Out[484]: </span>
<span class="go">DatetimeIndex(['2011-11-06 00:00:00-04:00', '2011-11-06 01:00:00-04:00',</span>
<span class="go">               '2011-11-06 01:00:00-05:00', '2011-11-06 02:00:00-05:00'],</span>
<span class="go">              dtype='datetime64[ns, US/Eastern]', freq=None)</span>

<span class="gp">In [485]: </span><span class="n">rng_hourly</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="s2">"US/Eastern"</span><span class="p">,</span> <span class="n">ambiguous</span><span class="o">=</span><span class="s2">"NaT"</span><span class="p">)</span>
<span class="gh">Out[485]: </span>
<span class="go">DatetimeIndex(['2011-11-06 00:00:00-04:00', 'NaT', 'NaT',</span>
<span class="go">               '2011-11-06 02:00:00-05:00'],</span>
<span class="go">              dtype='datetime64[ns, US/Eastern]', freq=None)</span>

<span class="gp">In [486]: </span><span class="n">rng_hourly</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="s2">"US/Eastern"</span><span class="p">,</span> <span class="n">ambiguous</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">])</span>
<span class="gh">Out[486]: </span>
<span class="go">DatetimeIndex(['2011-11-06 00:00:00-04:00', '2011-11-06 01:00:00-04:00',</span>
<span class="go">               '2011-11-06 01:00:00-05:00', '2011-11-06 02:00:00-05:00'],</span>
<span class="go">              dtype='datetime64[ns, US/Eastern]', freq=None)</span>
</pre></div>
</div>
</section>
<section id="nonexistent-times-when-localizing">
<span id="timeseries-timezone-nonexistent"></span><h3>本地化时不存在的时间<a class="headerlink" href="timeseries.html#nonexistent-times-when-localizing" title="Link to this heading">#</a></h3>
<p>DST 转换也可能使本地时间提前 1 小时，从而产生不存在的本地时间（“时钟提前”）。本地化具有不存在时间的时间序列的行为可以通过 <code class="docutils literal notranslate"><span class="pre">nonexistent</span></code> 参数控制。以下选项可用：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">'raise'</span></code>：引发 <code class="docutils literal notranslate"><span class="pre">pytz.NonExistentTimeError</span></code>（默认行为）</p></li>
<li><p><code class="docutils literal transnotate"><span class="pre">'NaT'</span></code>：将不存在的时间替换为 <code class="docutils literal transnotate"><span class="pre">NaT</span></code>。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'shift_forward'</span></code>：将不存在的时间向前移动到最近的真实时间。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'shift_backward'</span></code>：将不存在的时间向后移动到最近的真实时间。</p></li>
<li><p>timedelta 对象：将不存在的时间按 timedelta 持续时间移动。</p></li>
</ul>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [487]: </span><span class="n">dti</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="s2">"2015-03-29 02:30:00"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"h"</span><span class="p">)</span>

<span class="go"># 2:30 is a nonexistent time</span>
</pre></div>
</div>
<p>默认情况下，不存在时间的本地化会引发错误。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [488]: </span><span class="n">dti</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="s1">'Europe/Warsaw'</span><span class="p">)</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NonExistentTimeError</span><span class="g g-Whitespace">                      </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">488</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">dti</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="s1">'Europe/Warsaw'</span><span class="p">)</span>

<span class="nn">File ~/work/pandas/pandas/pandas/core/indexes/datetimes.py:293,</span> in <span class="ni">DatetimeIndex.tz_localize</span><span class="nt">(self, tz, ambiguous, nonexistent)</span>
<span class="g g-Whitespace">    </span><span class="mi">286</span> <span class="nd">@doc</span><span class="p">(</span><span class="n">DatetimeArray</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">287</span> <span class="k">def</span><span class="w"> </span><span class="nf">tz_localize</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">288</span>     <span class="bp">self</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">291</span>     <span class="n">nonexistent</span><span class="p">:</span> <span class="n">TimeNonexistent</span> <span class="o">=</span> <span class="s2">"raise"</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">292</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">293</span>     <span class="n">arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="n">tz</span><span class="p">,</span> <span class="n">ambiguous</span><span class="p">,</span> <span class="n">nonexistent</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">294</span>     <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_simple_new</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

<span class="nn">File ~/work/pandas/pandas/pandas/core/arrays/_mixins.py:81,</span> in <span class="ni">ravel_compat.&lt;locals&gt;.method</span><span class="nt">(self, *args, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">78</span> <span class="nd">@wraps</span><span class="p">(</span><span class="n">meth</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">79</span> <span class="k">def</span><span class="w"> </span><span class="nf">method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="g g-Whitespace">     </span><span class="mi">80</span>     <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">81</span>         <span class="k">return</span> <span class="n">meth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">83</span>     <span class="n">flags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ndarray</span><span class="o">.</span><span class="n">flags</span>
<span class="g g-Whitespace">     </span><span class="mi">84</span>     <span class="n">flat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="s2">"K"</span><span class="p">)</span>

<span class="nn">File ~/work/pandas/pandas/pandas/core/arrays/datetimes.py:1090,</span> in <span class="ni">DatetimeArray.tz_localize</span><span class="nt">(self, tz, ambiguous, nonexistent)</span>
<span class="g g-Whitespace">   </span><span class="mi">1087</span>     <span class="n">tz</span> <span class="o">=</span> <span class="n">timezones</span><span class="o">.</span><span class="n">maybe_get_tz</span><span class="p">(</span><span class="n">tz</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1088</span>     <span class="c1"># Convert to UTC</span>
<span class="ne">-&gt; </span><span class="mi">1090</span>     <span class="n">new_dates</span> <span class="o">=</span> <span class="n">tzconversion</span><span class="o">.</span><span class="n">tz_localize_to_utc</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1091</span>         <span class="bp">self</span><span class="o">.</span><span class="n">asi8</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1092</span>         <span class="n">tz</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1093</span>         <span class="n">ambiguous</span><span class="o">=</span><span class="n">ambiguous</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1094</span>         <span class="n">nonexistent</span><span class="o">=</span><span class="n">nonexistent</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1095</span>         <span class="n">creso</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_creso</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1096</span>     <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1097</span> <span class="n">new_dates_dt64</span> <span class="o">=</span> <span class="n">new_dates</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="sa">f</span><span class="s2">"M8[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="si">}</span><span class="s2">]"</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1098</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">tz_to_dtype</span><span class="p">(</span><span class="n">tz</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>

<span class="nn">File ~/work/pandas/pandas/pandas/_libs/tslibs/tzconversion.pyx:431,</span> in <span class="ni">pandas._libs.tslibs.tzconversion.tz_localize_to_utc</span><span class="nt">()</span>

<span class="ne">NonExistentTimeError</span>: 2015-03-29 02:30:00
</pre></div>
</div>
<p>将不存在的时间转换为 <code class="docutils literal transnotate"><span class="pre">NaT</span></code> 或移动时间。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [489]: </span><span class="n">dti</span>
<span class="gh">Out[489]: </span>
<span class="go">DatetimeIndex(['2015-03-29 02:30:00', '2015-03-29 03:30:00',</span>
<span class="go">               '2015-03-29 04:30:00'],</span>
<span class="go">              dtype='datetime64[ns]', freq='h')</span>

<span class="gp">In [490]: </span><span class="n">dti</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="s2">"Europe/Warsaw"</span><span class="p">,</span> <span class="n">nonexistent</span><span class="o">=</span><span class="s2">"shift_forward"</span><span class="p">)</span>
<span class="gh">Out[490]: </span>
<span class="go">DatetimeIndex(['2015-03-29 03:00:00+02:00', '2015-03-29 03:30:00+02:00',</span>
<span class="go">               '2015-03-29 04:30:00+02:00'],</span>
<span class="go">              dtype='datetime64[ns, Europe/Warsaw]', freq=None)</span>

<span class="gp">In [491]: </span><span class="n">dti</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="s2">"Europe/Warsaw"</span><span class="p">,</span> <span class="n">nonexistent</span><span class="o">=</span><span class="s2">"shift_backward"</span><span class="p">)</span>
<span class="gh">Out[491]: </span>
<span class="go">DatetimeIndex(['2015-03-29 01:59:59.999999999+01:00',</span>
<span class="go">                         '2015-03-29 03:30:00+02:00',</span>
<span class="go">                         '2015-03-29 04:30:00+02:00'],</span>
<span class="go">              dtype='datetime64[ns, Europe/Warsaw]', freq=None)</span>

<span class="gp">In [492]: </span><span class="n">dti</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="s2">"Europe/Warsaw"</span><span class="p">,</span> <span class="n">nonexistent</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">"h"</span><span class="p">))</span>
<span class="gh">Out[492]: </span>
<span class="go">DatetimeIndex(['2015-03-29 03:30:00+02:00', '2015-03-29 03:30:00+02:00',</span>
<span class="go">               '2015-03-29 04:30:00+02:00'],</span>
<span class="go">              dtype='datetime64[ns, Europe/Warsaw]', freq=None)</span>

<span class="gp">In [493]: </span><span class="n">dti</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="s2">"Europe/Warsaw"</span><span class="p">,</span> <span class="n">nonexistent</span><span class="o">=</span><span class="s2">"NaT"</span><span class="p">)</span>
<span class="gh">Out[493]: </span>
<span class="go">DatetimeIndex(['NaT', '2015-03-29 03:30:00+02:00',</span>
<span class="go">               '2015-03-29 04:30:00+02:00'],</span>
<span class="go">              dtype='datetime64[ns, Europe/Warsaw]', freq=None)</span>
</pre></div>
</div>
</section>
<section id="time-zone-series-operations">
<span id="timeseries-timezone-series"></span><h3>时区 Series 操作<a class="headerlink" href="timeseries.html#time-zone-series-operations" title="Link to this heading">#</a></h3>
<p>一个具有时区<strong>朴素</strong>值的 <a class="reference internal" href="../reference/api/pandas.Series.html#pandas.Series" title="pandas.Series"><code class="xref py py-class docutils literal notranslate"><span class="pre">Series</span></code></a> 表示为 <code class="docutils literal notranslate"><span class="pre">datetime64[ns]</span></code> 的数据类型。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [494]: </span><span class="n">s_naive</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">"20130101"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>

<span class="gp">In [495]: </span><span class="n">s_naive</span>
<span class="gh">Out[495]: </span>
<span class="go">0   2013-01-01</span>
<span class="go">1   2013-01-02</span>
<span class="go">2   2013-01-03</span>
<span class="go">dtype: datetime64[ns]</span>
</pre></div>
</div>
<p>一个具有时区<strong>感知</strong>值的 <a class="reference internal" href="../reference/api/pandas.Series.html#pandas.Series" title="pandas.Series"><code class="xref py py-class docutils literal notranslate"><span class="pre">Series</span></code></a> 表示为 <code class="docutils literal notranslate"><span class="pre">datetime64[ns,</span> <span class="pre">tz]</span></code> 的数据类型，其中 <code class="docutils literal transnotate"><span class="pre">tz</span></code> 是时区。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [496]: </span><span class="n">s_aware</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">"20130101"</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s2">"US/Eastern"</span><span class="p">))</span>

<span class="gp">In [497]: </span><span class="n">s_aware</span>
<span class="gh">Out[497]: </span>
<span class="go">0   2013-01-01 00:00:00-05:00</span>
<span class="go">1   2013-01-02 00:00:00-05:00</span>
<span class="go">2   2013-01-03 00:00:00-05:00</span>
<span class="go">dtype: datetime64[ns, US/Eastern]</span>
</pre></div>
</div>
<p>这两种 <a class="reference internal" href="../reference/api/pandas.Series.html#pandas.Series" title="pandas.Series"><code class="xref py py-class docutils literal notranslate"><span class="pre">Series</span></code></a> 的时区信息都可以通过 <code class="docutils literal notranslate"><span class="pre">.dt</span></code> 访问器进行操作，请参阅<a class="reference internal" href="basics.html#basics-dt-accessors"><span class="std std-ref">dt 访问器部分</span></a>。</p>
<p>例如，要本地化并将朴素时间戳转换为时区感知时间戳。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [498]: </span><span class="n">s_naive</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="s2">"UTC"</span><span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">tz_convert</span><span class="p">(</span><span class="s2">"US/Eastern"</span><span class="p">)</span>
<span class="gh">Out[498]: </span>
<span class="go">0   2012-12-31 19:00:00-05:00</span>
<span class="go">1   2013-01-01 19:00:00-05:00</span>
<span class="go">2   2013-01-02 19:00:00-05:00</span>
<span class="go">dtype: datetime64[ns, US/Eastern]</span>
</pre></div>
</div>
<p>时区信息也可以使用 <code class="docutils literal notranslate"><span class="pre">astype</span></code> 方法进行操作。此方法可以在不同的时区感知数据类型之间进行转换。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="go"># convert to a new time zone</span>
<span class="gp">In [499]: </span><span class="n">s_aware</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">"datetime64[ns, CET]"</span><span class="p">)</span>
<span class="gh">Out[499]: </span>
<span class="go">0   2013-01-01 06:00:00+01:00</span>
<span class="go">1   2013-01-02 06:00:00+01:00</span>
<span class="go">2   2013-01-03 06:00:00+01:00</span>
<span class="go">dtype: datetime64[ns, CET]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p>在 <code class="docutils literal transnotate"><span class="pre">Series</span></code> 上使用 <a class="reference internal" href="../reference/api/pandas.Series.to_numpy.html#pandas.Series.to_numpy" title="pandas.Series.to_numpy"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Series.to_numpy()</span></code></a> 会返回数据的 NumPy 数组。NumPy 目前不支持时区（尽管它会以本地时区<em>打印</em>！），因此对于时区感知数据会返回一个 Timestamps 的对象数组。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [500]: </span><span class="n">s_naive</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="gh">Out[500]: </span>
<span class="go">array(['2013-01-01T00:00:00.000000000', '2013-01-02T00:00:00.000000000',</span>
<span class="go">       '2013-01-03T00:00:00.000000000'], dtype='datetime64[ns]')</span>

<span class="gp">In [501]: </span><span class="n">s_aware</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="gh">Out[501]: </span>
<span class="go">array([Timestamp('2013-01-01 00:00:00-0500', tz='US/Eastern'),</span>
<span class="go">       Timestamp('2013-01-02 00:00:00-0500', tz='US/Eastern'),</span>
<span class="go">       Timestamp('2013-01-03 00:00:00-0500', tz='US/Eastern')],</span>
<span class="go">      dtype=object)</span>
</pre></div>
</div>
<p>通过转换为 Timestamp 的对象数组，可以保留时区信息。例如，当转换回 Series 时：</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [502]: </span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">s_aware</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>
<span class="gh">Out[502]: </span>
<span class="go">0   2013-01-01 00:00:00-05:00</span>
<span class="go">1   2013-01-02 00:00:00-05:00</span>
<span class="go">2   2013-01-03 00:00:00-05:00</span>
<span class="go">dtype: datetime64[ns, US/Eastern]</span>
</pre></div>
</div>
<p>但是，如果您需要实际的 NumPy <code class="docutils literal notranslate"><span class="pre">datetime64[ns]</span></code> 数组（值已转换为 UTC），而不是对象数组，则可以指定 <code class="docutils literal notranslate"><span class="pre">dtype</span></code> 参数。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [503]: </span><span class="n">s_aware</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="s2">"datetime64[ns]"</span><span class="p">)</span>
<span class="gh">Out[503]: </span>
<span class="go">array(['2013-01-01T05:00:00.000000000', '2013-01-02T05:00:00.000000000',</span>
<span class="go">       '2013-01-03T05:00:00.000000000'], dtype='datetime64[ns]')</span>
</pre></div>
</div>
</div>
</section>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev" href="window.html" title="previous page"> <i class="fa-solid fa-angle-left"></i> <div class="prev-next-info"> <p class="prev-next-subtitle">上一页</p> <p class="prev-next-title">窗口操作</p> </div> </a> <a class="right-next" href="timedeltas.html" title="next page"> <div class="prev-next-info"> <p class="prev-next-subtitle">下一页</p> <p class="prev-next-title">时间差</p> </div> <i class="fa-solid fa-angle-right"></i> </a></div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">

  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> 本页内容</div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="timeseries.html#overview">概述</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="timeseries.html#timestamps-vs-time-spans">时间戳与时间跨度</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="timeseries.html#converting-to-timestamps">转换为时间戳</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="timeseries.html#providing-a-format-argument">提供格式参数</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="timeseries.html#assembling-datetime-from-multiple-dataframe-columns">从多个 DataFrame 列组装日期时间</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="timeseries.html#invalid-data">无效数据</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="timeseries.html#epoch-timestamps">纪元时间戳</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="timeseries.html#from-timestamps-to-epoch">从时间戳到纪元</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="timeseries.html#using-the-origin-parameter">使用 <code class="docutils literal notranslate"><span class="pre">origin</span></code> 参数</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="timeseries.html#generating-ranges-of-timestamps">生成时间戳范围</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="timeseries.html#custom-frequency-ranges">自定义频率范围</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="timeseries.html#timestamp-limitations">时间戳限制</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="timeseries.html#indexing">索引</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="timeseries.html#partial-string-indexing">部分字符串索引</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="timeseries.html#slice-vs-exact-match">切片与精确匹配</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="timeseries.html#exact-indexing">精确索引</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="timeseries.html#truncating-fancy-indexing">截断与高级索引</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="timeseries.html#time-date-components">时间/日期组件</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="timeseries.html#dateoffset-objects">DateOffset 对象</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="timeseries.html#parametric-offsets">参数化偏移量</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="timeseries.html#using-offsets-with-series-datetimeindex">将偏移量与 <code class="docutils literal transnotate"><span class="pre">Series</span></code> / <code class="docutils literal notranslate"><span class="pre">DatetimeIndex</span></code> 一起使用</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="timeseries.html#custom-business-days">自定义工作日</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="timeseries.html#business-hour">工作时间</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="timeseries.html#custom-business-hour">自定义工作时间</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="timeseries.html#offset-aliases">偏移别名</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="timeseries.html#period-aliases">周期别名</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="timeseries.html#combining-aliases">组合别名</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="timeseries.html#anchored-offsets">锚定偏移量</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="timeseries.html#anchored-offset-semantics">锚定偏移量语义</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="timeseries.html#holidays-holiday-calendars">节假日 / 节假日日历</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="timeseries.html#time-series-related-instance-methods">时间序列相关实例方法</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="timeseries.html#shifting-lagging">移位 / 滞后</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="timeseries.html#frequency-conversion">频率转换</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="timeseries.html#filling-forward-backward">向前/向后填充</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="timeseries.html#converting-to-python-datetimes">转换为 Python 日期时间</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="timeseries.html#resampling">重采样</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="timeseries.html#basics">基础知识</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="timeseries.html#upsampling">升采样</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="timeseries.html#sparse-resampling">稀疏重采样</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="timeseries.html#aggregation">聚合</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="timeseries.html#iterating-through-groups">遍历分组</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="timeseries.html#use-origin-or-offset-to-adjust-the-start-of-the-bins">使用 <code class="docutils literal transnotate"><span class="pre">origin</span></code> 或 <code class="docutils literal notranslate"><span class="pre">offset</span></code> 调整分箱的起始点</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="timeseries.html#backward-resample">向后重采样</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="timeseries.html#time-span-representation">时间跨度表示</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="timeseries.html#period">Period</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="timeseries.html#periodindex-and-period-range">PeriodIndex 和 period_range</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="timeseries.html#period-dtypes">周期数据类型</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="timeseries.html#periodindex-partial-string-indexing">PeriodIndex 部分字符串索引</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="timeseries.html#frequency-conversion-and-resampling-with-periodindex">使用 PeriodIndex 进行频率转换和重采样</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="timeseries.html#converting-between-representations">表示之间的转换</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="timeseries.html#representing-out-of-bounds-spans">表示超出范围的跨度</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="timeseries.html#time-zone-handling">时区处理</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="timeseries.html#working-with-time-zones">使用时区</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="timeseries.html#fold">折叠</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="timeseries.html#ambiguous-times-when-localizing">本地化时的模糊时间</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="timeseries.html#nonexistent-times-when-localizing">本地化时不存在的时间</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="timeseries.html#time-zone-series-operations">时区 Series 操作</a></li>
</ul>
</li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  <div class="tocsection sourcelink">
    <a href="../_sources/user_guide/timeseries.rst.txt">
      <i class="fa-solid fa-file-lines"></i> 显示源文件</a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js%3Fdigest=5b4479735964841361fd"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js%3Fdigest=5b4479735964841361fd"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item"><p class="copyright">© 2025, pandas via <a href="https://numfocus.org">NumFOCUS, Inc.</a> 由 <a href="https://www.ovhcloud.com">OVHcloud</a> 托管。</p></div>
      
        <div class="footer-item">

  <p class="sphinx-version">使用 <a href="https://sphinx-doc.cn/">Sphinx</a> 8.1.3 创建。<br />
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">使用 <a href="https://pydata.sphinx-doc.cn/en/stable/index.html">PyData Sphinx 主题</a> 0.14.4 构建。</p></div>
      
    </div>
  
</div>

  </footer>
  
</body></html>