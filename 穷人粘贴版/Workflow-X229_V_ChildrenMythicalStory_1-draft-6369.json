{"type":"coze-workflow-clipboard-data","source":{"workflowId":"7531681974962044947","spaceId":"","host":"www.coze.cn","isDouyin":false,"flowMode":0},"json":{"edges":[{"sourceNodeID":"100001","sourcePortID":"","targetNodeID":"121343"},{"sourceNodeID":"159377","sourcePortID":"","targetNodeID":"900001"},{"sourceNodeID":"121343","sourcePortID":"","targetNodeID":"1165778"},{"sourceNodeID":"121343","sourcePortID":"","targetNodeID":"1301843"},{"sourceNodeID":"186126","sourcePortID":"","targetNodeID":"121555"},{"sourceNodeID":"121555","sourcePortID":"batch-output","targetNodeID":"163547"},{"sourceNodeID":"170966","sourcePortID":"","targetNodeID":"163547"},{"sourceNodeID":"163547","sourcePortID":"","targetNodeID":"168118"},{"sourceNodeID":"1165778","sourcePortID":"","targetNodeID":"186126"},{"sourceNodeID":"168118","sourcePortID":"","targetNodeID":"125268"},{"sourceNodeID":"125268","sourcePortID":"","targetNodeID":"109941"},{"sourceNodeID":"146723","sourcePortID":"","targetNodeID":"180947"},{"sourceNodeID":"180947","sourcePortID":"","targetNodeID":"1204256"},{"sourceNodeID":"109941","sourcePortID":"","targetNodeID":"1087428"},{"sourceNodeID":"1204256","sourcePortID":"","targetNodeID":"158201"},{"sourceNodeID":"158201","sourcePortID":"","targetNodeID":"1182713"},{"sourceNodeID":"1182713","sourcePortID":"","targetNodeID":"104782"},{"sourceNodeID":"104782","sourcePortID":"","targetNodeID":"159377"},{"sourceNodeID":"1087428","sourcePortID":"","targetNodeID":"1190196"},{"sourceNodeID":"1190196","sourcePortID":"","targetNodeID":"120984"},{"sourceNodeID":"120984","sourcePortID":"","targetNodeID":"146723"},{"sourceNodeID":"1301843","sourcePortID":"","targetNodeID":"1866199"},{"sourceNodeID":"1866199","sourcePortID":"","targetNodeID":"170966"}],"nodes":[{"blocks":[],"data":{"nodeMeta":{"description":"工作流的起始节点，用于设定启动工作流需要的信息","icon":"https://lf3-static.bytednsdoc.com/obj/eden-cn/dvsmryvd_avi_dvsm/ljhwZthlaukjlkulzlp/icon/icon-Start-v2.jpg","subTitle":"","title":"开始"},"outputs":[{"defaultValue":"夸父逐日","description":"古代神话类的故事名字","name":"story","required":true,"type":"string"}],"trigger_parameters":[{"description":"古代神话类的故事名字","name":"story","required":true,"type":"string"}]},"edges":null,"id":"100001","meta":{"canvasPosition":{"x":0,"y":0},"defaultCollapsed":false,"position":{"x":-2469.872394088699,"y":695.448321400109}},"type":"1"},{"blocks":[],"data":{"inputs":{"inputParameters":[{"input":{"type":"string","value":{"content":{"blockID":"104782","name":"draft_url","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"output"}],"terminatePlan":"returnVariables"},"nodeMeta":{"description":"工作流的最终节点，用于返回工作流运行后的结果信息","icon":"https://lf3-static.bytednsdoc.com/obj/eden-cn/dvsmryvd_avi_dvsm/ljhwZthlaukjlkulzlp/icon/icon-End-v2.jpg","subTitle":"","title":"结束"}},"edges":null,"id":"900001","meta":{"canvasPosition":{"x":0,"y":0},"defaultCollapsed":false,"position":{"x":3170.130598689585,"y":521.1606446470533}},"type":"2"},{"blocks":[],"data":{"inputs":{"inputParameters":[{"input":{"type":"string","value":{"content":{"blockID":"100001","name":"story","source":"block-output"},"dependencies":{"variables":null},"inputMode":"","rawMeta":{"type":1},"type":"ref"}},"left":{},"name":"input","right":{}}],"llmParam":[{"input":{"type":"float","value":{"content":"0.8","dependencies":{"variables":null},"inputMode":"","rawMeta":{"type":4},"type":"literal"}},"left":{},"name":"temperature","right":{}},{"input":{"type":"integer","value":{"content":"1024","dependencies":{"variables":null},"inputMode":"","rawMeta":{"type":2},"type":"literal"}},"left":{},"name":"maxTokens","right":{}},{"input":{"type":"integer","value":{"content":"0","dependencies":{"variables":null},"inputMode":"","rawMeta":{"type":2},"type":"literal"}},"left":{},"name":"responseFormat","right":{}},{"input":{"type":"string","value":{"content":"DeepSeek-V3","dependencies":{"variables":null},"inputMode":"","rawMeta":{"type":1},"type":"literal"}},"left":{},"name":"modleName","right":{}},{"input":{"type":"integer","value":{"content":"1738675210","dependencies":{"variables":null},"inputMode":"","rawMeta":{"type":2},"type":"literal"}},"left":{},"name":"modelType","right":{}},{"input":{"type":"string","value":{"content":"balance","dependencies":{"variables":null},"inputMode":"","rawMeta":{"type":1},"type":"literal"}},"left":{},"name":"generationDiversity","right":{}},{"input":{"type":"string","value":{"content":"主题：{{input}}\n","dependencies":{"variables":null},"inputMode":"","rawMeta":{"type":1},"type":"literal"}},"left":{},"name":"prompt","right":{}},{"input":{"type":"boolean","value":{"content":false,"dependencies":{"variables":null},"inputMode":"","rawMeta":{"type":3},"type":"literal"}},"left":{},"name":"enableChatHistory","right":{}},{"input":{"type":"integer","value":{"content":"3","dependencies":{"variables":null},"inputMode":"","rawMeta":{"type":2},"type":"literal"}},"left":{},"name":"chatHistoryRound","right":{}},{"input":{"type":"string","value":{"content":"# 角色\n你是一个擅长讲述儿童神话故事的讲述者，能用生动活泼、充满童趣的语言，将各种元素改编成适合儿童听的神话故事。\n\n## 技能\n### 技能 1: 改编儿童神话故事\n1. 以提供的内容为基础，把其中的历史元素、人物等巧妙转化为神话元素和神话角色。例如，将历史人物变成具有神奇魔力的神仙、精灵或妖怪等。\n2. 每段不超过 3 句话，多用短句制造轻松有趣的节奏。\n3. 加入至少 2 处符合神话故事风格的神奇元素描述，比如神奇的法宝、神秘的法术等。\n4. 在关键转折点使用充满奇幻色彩的感官描写，如闪耀的光芒、奇异的香味、神秘的触感等。\n5. 结尾以“小朋友们，这时候大家明白了……”句式点题。\n6. 生成 1000 字左右的儿童神话故事口播文案。\n7. 文案由长短句构成，遇到长句会用逗号分隔成短句，每个短句不能超过 19 个汉字。\n\n## 限制:\n- 只围绕将给定内容改编为儿童神话故事展开，拒绝回答无关话题。\n- 所输出的内容必须按照上述要求进行组织，不能偏离框架要求。 ","dependencies":{"variables":null},"inputMode":"","rawMeta":{"type":1},"type":"literal"}},"left":{},"name":"systemPrompt","right":{}},{"input":{"type":"string","value":{"content":"","dependencies":{"variables":null},"inputMode":"","rawMeta":{"type":1},"type":"literal"}},"left":{},"name":"stableSystemPrompt","right":{}}],"settingOnError":{"processType":1,"switch":false,"timeoutMs":180000}},"nodeMeta":{"description":"调用大语言模型,使用变量和提示词生成回复","icon":"https://lf3-static.bytednsdoc.com/obj/eden-cn/dvsmryvd_avi_dvsm/ljhwZthlaukjlkulzlp/icon/icon-LLM-v2.jpg","title":"大模型-生成故事内容"},"outputs":[{"input":{},"name":"content","required":false,"type":"string"}],"settings":null,"version":"3"},"edges":null,"id":"121343","meta":{"canvasPosition":{"x":0,"y":0},"defaultCollapsed":false,"position":{"x":-1970.3663541318274,"y":656.448321400109}},"type":"3"},{"blocks":[{"blocks":[],"data":{"inputs":{"apiParam":null,"inputParameters":[{"input":{"type":"string","value":{"content":{"blockID":"121555","name":"scenes.desc_promopt","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"desc_promopt"}],"modelSetting":{"custom_ratio":{"height":768,"width":1024},"ddim_steps":40,"images_reference":{},"model":8,"ratio":0},"prompt":{"negative_prompt":"","prompt":"卡通可爱插画风格：{{desc_promopt}}"},"references":[],"settingOnError":{"processType":1,"retryTimes":0,"switch":false,"timeoutMs":60000}},"nodeMeta":{"description":"通过文字描述/添加参考图生成图片","icon":"https://lf3-static.bytednsdoc.com/obj/eden-cn/dvsmryvd_avi_dvsm/ljhwZthlaukjlkulzlp/icon/icon-ImageGeneration-v2.jpg","subTitle":"图像生成","title":"图像生成"},"outputs":[{"assistType":2,"name":"data","required":false,"type":"string"},{"name":"msg","required":false,"type":"string"}],"settings":null,"version":""},"edges":null,"id":"131139","meta":{"canvasPosition":{"x":0,"y":0},"defaultCollapsed":false,"position":{"x":-158.61965605279613,"y":45.35000000000007}},"type":"16"},{"blocks":[],"data":{"inputs":{"branches":[{"condition":{"conditions":[{"left":{"input":{"assistType":2,"type":"string","value":{"content":{"blockID":"131139","name":"data","source":"block-output"},"type":"ref"}}},"operator":10}],"logic":2}}]},"nodeMeta":{"description":"连接多个下游分支，若设定的条件成立则仅运行对应的分支，若均不成立则只运行“否则”分支","icon":"https://lf3-static.bytednsdoc.com/obj/eden-cn/dvsmryvd_avi_dvsm/ljhwZthlaukjlkulzlp/icon/icon-Condition-v2.jpg","mainColor":"#00B2B2","subTitle":"选择器","title":"选择器"}},"edges":null,"id":"133787","meta":{"canvasPosition":{"x":0,"y":0},"defaultCollapsed":false,"position":{"x":321.4466939355177,"y":58.35}},"type":"8"},{"blocks":[],"data":{"inputs":{"code":"// 在这里，您可以通过 ‘params’  获取节点中的输入变量，并通过 'ret' 输出结果\n// 'params' 和 'ret' 已经被正确地注入到环境中\n// 下面是一个示例，获取节点输入中参数名为‘input’的值：\n// const input = params.input; \n// 下面是一个示例，输出一个包含多种数据类型的 'ret' 对象：\n// const ret = { \"name\": ‘小明’, \"hobbies\": [“看书”, “旅游”] };\n\nasync function main({ params }: Args): Promise<Output> {\n\n\n    var image1 = params.image1;\n    var image2 = params.image2;\n    if(!image1){\n        image1 = image2;\n    }\n\n\n\n    // 构建输出对象\n    const ret = {\n        \"image_url\":  image1\n    };\n\n    return ret;\n}","functionID":"38wbe7wwsww9x","inputParameters":[{"input":{"assistType":2,"type":"string","value":{"content":{"blockID":"131139","name":"data","source":"block-output"},"dependencies":{"variables":null},"inputMode":"","rawMeta":{"type":7},"type":"ref"}},"left":{},"name":"image1","right":{}},{"input":{"assistType":2,"type":"string","value":{"content":{"blockID":"1667619","name":"data","source":"block-output"},"dependencies":{"variables":null},"inputMode":"","rawMeta":{"type":7},"type":"ref"}},"left":{},"name":"image2","right":{}}],"language":5,"settingOnError":{"processType":1,"switch":false,"timeoutMs":60000}},"nodeMeta":{"description":"编写代码，处理输入变量来生成返回值","icon":"https://lf3-static.bytednsdoc.com/obj/eden-cn/dvsmryvd_avi_dvsm/ljhwZthlaukjlkulzlp/icon/icon-Code-v2.jpg","title":"代码_结果合并"},"outputs":[{"input":{},"name":"image_url","required":false,"type":"string"}],"settings":null,"version":""},"edges":null,"id":"187299","meta":{"canvasPosition":{"x":0,"y":0},"defaultCollapsed":false,"position":{"x":1678.8720501986647,"y":26}},"type":"5"},{"blocks":[],"data":{"inputs":{"apiParam":[{"input":{"type":"string","value":{"content":"7439197952104726528","rawMeta":{"type":1},"type":"literal"}},"name":"apiID"},{"input":{"type":"string","value":{"content":"sd_better_prompt","rawMeta":{"type":1},"type":"literal"}},"name":"apiName"},{"input":{"type":"string","value":{"content":"7439197952104710144","rawMeta":{"type":1},"type":"literal"}},"name":"pluginID"},{"input":{"type":"string","value":{"content":"提示词优化","rawMeta":{"type":1},"type":"literal"}},"name":"pluginName"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"pluginVersion"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"tips"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"outDocLink"}],"inputParameters":[{"input":{"type":"string","value":{"content":{"blockID":"121555","name":"scenes.desc_promopt","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"prompt"}],"settingOnError":{"processType":1,"retryTimes":0,"timeoutMs":180000}},"nodeMeta":{"description":"智能优化图像提示词","icon":"https://lf3-static.bytednsdoc.com/obj/eden-cn/dvsmryvd_avi_dvsm/ljhwZthlaukjlkulzlp/icon/icon-plugin-better_prompt-v2.jpg","subtitle":"提示词优化:sd_better_prompt","title":"sd_better_prompt"},"outputs":[{"name":"data","required":false,"type":"string"},{"name":"msg","required":false,"type":"string"}]},"edges":null,"id":"109484","meta":{"canvasPosition":{"x":0,"y":0},"defaultCollapsed":false,"position":{"x":758.8720501986647,"y":197.75}},"type":"4"},{"blocks":[],"data":{"inputs":{"apiParam":null,"inputParameters":[{"input":{"type":"string","value":{"content":{"blockID":"109484","name":"data","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"desc_promopt"}],"modelSetting":{"custom_ratio":{"height":768,"width":1024},"ddim_steps":40,"images_reference":{},"model":8,"ratio":0},"prompt":{"negative_prompt":"","prompt":"{{desc_promopt}}"},"references":[],"settingOnError":{"processType":1,"retryTimes":0,"switch":false,"timeoutMs":60000}},"nodeMeta":{"description":"通过文字描述/添加参考图生成图片","icon":"https://lf3-static.bytednsdoc.com/obj/eden-cn/dvsmryvd_avi_dvsm/ljhwZthlaukjlkulzlp/icon/icon-ImageGeneration-v2.jpg","subTitle":"图像生成","title":"图像生成_补图"},"outputs":[{"assistType":2,"name":"data","required":false,"type":"string"},{"name":"msg","required":false,"type":"string"}],"settings":null,"version":""},"edges":null,"id":"1667619","meta":{"canvasPosition":{"x":0,"y":0},"defaultCollapsed":false,"position":{"x":1183.7559377191153,"y":139.4}},"type":"16"},{"blocks":[],"data":{"inputs":{"apiParam":[{"input":{"type":"string","value":{"content":"7426655854067367946","rawMeta":{"type":1},"type":"literal"}},"name":"apiID"},{"input":{"type":"string","value":{"content":"speech_synthesis","rawMeta":{"type":1},"type":"literal"}},"name":"apiName"},{"input":{"type":"string","value":{"content":"7426655854067351562","rawMeta":{"type":1},"type":"literal"}},"name":"pluginID"},{"input":{"type":"string","value":{"content":"语音合成","rawMeta":{"type":1},"type":"literal"}},"name":"pluginName"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"pluginVersion"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"tips"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"outDocLink"}],"inputParameters":[{"input":{"type":"string","value":{"content":{"blockID":"121555","name":"scenes.cap","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"text"},{"input":{"type":"float","value":{"content":1,"rawMeta":{"type":4},"type":"literal"}},"name":"speed_ratio"},{"input":{"assistType":12,"type":"string","value":{"content":"7426725529589628955","rawMeta":{"fileName":"东方浩然","type":18},"type":"literal"}},"name":"voice_id"}],"settingOnError":{"processType":1,"retryTimes":0,"timeoutMs":180000}},"nodeMeta":{"description":"根据音色和文本合成音频","icon":"https://p26-flow-product-sign.byteimg.com/tos-cn-i-13w3uml6bg/dc534eb73e7046b1807db96af7c0e212~tplv-13w3uml6bg-resize:128:128.image?rk3s=2e2596fd&x-expires=1749019302&x-signature=ANAaS2aakkuW4eUDLIx7DP8XEoI%3D","subtitle":"语音合成:speech_synthesis","title":"speech_synthesis"},"outputs":[{"name":"code","required":false,"type":"float"},{"name":"data","required":false,"schema":[{"name":"link","required":false,"type":"string"}],"type":"object"},{"name":"log_id","required":false,"type":"string"},{"name":"msg","required":false,"type":"string"}]},"edges":null,"id":"182040","meta":{"canvasPosition":{"x":0,"y":0},"defaultCollapsed":false,"position":{"x":-178.68600604110992,"y":295.49952498247075}},"type":"4"},{"blocks":[],"data":{"inputs":{"apiParam":[{"input":{"type":"string","value":{"content":"7474863657353117750","rawMeta":{"type":1},"type":"literal"}},"name":"apiID"},{"input":{"type":"string","value":{"content":"get_audio_duration","rawMeta":{"type":1},"type":"literal"}},"name":"apiName"},{"input":{"type":"string","value":{"content":"7457837925833801768","rawMeta":{"type":1},"type":"literal"}},"name":"pluginID"},{"input":{"type":"string","value":{"content":"视频合成_剪映小助手","rawMeta":{"type":1},"type":"literal"}},"name":"pluginName"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"pluginVersion"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"tips"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"outDocLink"}],"inputParameters":[{"input":{"type":"string","value":{"content":{"blockID":"182040","name":"data.link","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"mp3_url"}],"settingOnError":{"processType":1,"retryTimes":0,"timeoutMs":180000}},"nodeMeta":{"description":"剪映草稿，视频合成方案。👆👆👆插件详情页面查看案例","icon":"https://p6-flow-product-sign.byteimg.com/tos-cn-i-13w3uml6bg/58f8745c794f452a9b0c572c9a4b3e3a~tplv-13w3uml6bg-resize:128:128.image?rk3s=2e2596fd&x-expires=1749019424&x-signature=3ok2yPv6y4mL9ketOUBg8SWfFhM%3D","subtitle":"视频合成_剪映小助手:get_audio_duration","title":"get_audio_duration"},"outputs":[{"name":"message","required":false,"type":"string"},{"name":"duration","required":false,"type":"integer"}]},"edges":null,"id":"178228","meta":{"canvasPosition":{"x":0,"y":0},"defaultCollapsed":false,"position":{"x":291.34716895304723,"y":353.7317499415692}},"type":"4"}],"data":{"inputs":{"batchSize":{"type":"integer","value":{"content":"100","type":"literal"}},"concurrentSize":{"type":"integer","value":{"content":3,"rawMeta":{"type":2},"type":"literal"}},"inputParameters":[{"input":{"schema":{"schema":[{"name":"cap","type":"string"},{"name":"desc_promopt","type":"string"}],"type":"object"},"type":"list","value":{"content":{"blockID":"186126","name":"scenes","source":"block-output"},"rawMeta":{"type":103},"type":"ref"}},"name":"scenes"}]},"nodeMeta":{"description":"通过设定批量运行次数和逻辑，运行批处理体内的任务","icon":"https://lf3-static.bytednsdoc.com/obj/eden-cn/dvsmryvd_avi_dvsm/ljhwZthlaukjlkulzlp/icon/icon-Batch-v2.jpg","mainColor":"#00B2B2","subTitle":"批处理","title":"批处理"},"outputs":[{"input":{"schema":{"type":"string"},"type":"list","value":{"content":{"blockID":"187299","name":"image_url","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"image_list"},{"input":{"schema":{"type":"string"},"type":"list","value":{"content":{"blockID":"182040","name":"data.link","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"link_list"},{"input":{"schema":{"type":"integer"},"type":"list","value":{"content":{"blockID":"178228","name":"duration","source":"block-output"},"rawMeta":{"type":2},"type":"ref"}},"name":"duration_list"}]},"edges":[{"sourceNodeID":"121555","sourcePortID":"batch-function-inline-output","targetNodeID":"131139"},{"sourceNodeID":"131139","sourcePortID":"","targetNodeID":"133787"},{"sourceNodeID":"133787","sourcePortID":"true","targetNodeID":"187299"},{"sourceNodeID":"133787","sourcePortID":"false","targetNodeID":"109484"},{"sourceNodeID":"1667619","sourcePortID":"","targetNodeID":"187299"},{"sourceNodeID":"187299","sourcePortID":"","targetNodeID":"121555","targetPortID":"batch-function-inline-input"},{"sourceNodeID":"109484","sourcePortID":"","targetNodeID":"1667619"},{"sourceNodeID":"121555","sourcePortID":"batch-function-inline-output","targetNodeID":"182040"},{"sourceNodeID":"182040","sourcePortID":"","targetNodeID":"178228"},{"sourceNodeID":"178228","sourcePortID":"","targetNodeID":"121555","targetPortID":"batch-function-inline-input"}],"id":"121555","meta":{"canvasPosition":{"x":-1225.5015582057586,"y":1466.5112562517957},"defaultCollapsed":false,"position":{"x":-305.6609415431988,"y":738.8055591927193}},"type":"28"},{"blocks":[],"data":{"inputs":{"code":"// 在这里，您可以通过 ‘params’  获取节点中的输入变量，并通过 'ret' 输出结果\n// 'params' 和 'ret' 已经被正确地注入到环境中\n// 下面是一个示例，获取节点输入中参数名为‘input’的值：\n// const input = params.input; \n// 下面是一个示例，输出一个包含多种数据类型的 'ret' 对象：\n// const ret = { \"name\": ‘小明’, \"hobbies\": [“看书”, “旅游”] };\n\nasync function main({ params }: Args): Promise<Output> {\n\n\n    const { image_list, audio_list, duration_list, scenes } = params;\n\n    // 处理音频数据\n    const audioData = [];\n    let audioStartTime = 0;\n    const aideoTimelines = [];\n    let maxDuration = 0;\n\n    const imageData = [];\n    \n    \n    for (let i = 0; i < audio_list.length && i < duration_list.length; i++) {\n        const duration = duration_list[i];\n        audioData.push({\n            audio_url: audio_list[i],\n            duration,\n            start: audioStartTime,\n            end: audioStartTime + duration\n        });\n        aideoTimelines.push({\n            start: audioStartTime,\n            end: audioStartTime + duration\n        });\n\n        if((i-1)%2==0){\n            imageData.push({\n                image_url: image_list[i],\n                start: audioStartTime,\n                end: audioStartTime + duration,\n                width: 1440,\n                height: 1080,\n                in_animation: \"轻微放大\",\n                in_animation_duration: 100000\n            });\n        } else{\n            imageData.push({\n                image_url: image_list[i],\n                start: audioStartTime,\n                end: audioStartTime + duration,\n                width: 1440,\n                height: 1080\n            });\n        }\n       \n        \n        audioStartTime += duration;\n        maxDuration = audioStartTime;\n    }\n\n    const roleImgData = [];\n    roleImgData.push({\n        image_url: params.role_img_url,\n        start: 0,\n        end: duration_list[0],\n        width: 1440,\n        height: 1080\n    });\n\n\n    const captions = scenes.map(item => item.cap);\n    const subtitleDurations = duration_list;\n    \n    const { textTimelines, processedSubtitles } = processSubtitles(\n        captions,\n        subtitleDurations\n    );\n\n\n    // 开场标题\n    const title = params.title;  // 标题\n    const title_list = [];\n    title_list.push(title);\n    const title_timelimes = [\n        {\n            start: 0,\n            end: duration_list[0]\n        }\n    ];\n    \n    // 开场音效 4884897\n    var kc_audio_url = \"https://p9-bot-workflow-sign.byteimg.com/tos-cn-i-mdko3gqilj/c04e7b48586a48f1863e421be4b10cf1.MP3~tplv-mdko3gqilj-image.image?rk3s=81d4c505&x-expires=1777550323&x-signature=T%2BNjvPHPyHnGICvWRFDeFaj17UM%3D&x-wf-file_name=%E6%95%85%E4%BA%8B%E5%BC%80%E5%9C%BA%E9%9F%B3%E6%95%88.MP3\";\n    // 背景音乐 343666938\n    var bg_audio_url =\"https://p3-bot-workflow-sign.byteimg.com/tos-cn-i-mdko3gqilj/5603dc783a6c4b75a4bf4e1b44086ad5.MP3~tplv-mdko3gqilj-image.image?rk3s=81d4c505&x-expires=1777550332&x-signature=E1123RzPTMD%2BipseRN4itYxhZyc%3D&x-wf-file_name=%E6%95%85%E4%BA%8B%E8%83%8C%E6%99%AF%E9%9F%B3%E4%B9%90.MP3\";\n\n    const bg_audio_data = [];\n    bg_audio_data.push({\n        audio_url: bg_audio_url,\n        duraion: maxDuration,\n        start: 0,\n        end: maxDuration\n    });\n\n    const kc_audio_data = [];\n    kc_audio_data.push({\n        audio_url: kc_audio_url,\n        duration: 4884897,\n        start: 0,\n        end: 4884897\n    });\n    \n    // 构建输出对象\n    const ret = {\n        \"audioData\": JSON.stringify(audioData),\n        \"bgAudioData\": JSON.stringify(bg_audio_data),\n        \"kcAudioData\": JSON.stringify(kc_audio_data),\n        \"imageData\": JSON.stringify(imageData),\n        \"text_timielines\":textTimelines,\n        \"text_captions\":processedSubtitles,\n        \"title_list\": title_list,\n        \"title_timelimes\": title_timelimes,\n        \"roleImgData\": JSON.stringify(roleImgData)\n    };\n\n    return ret;\n}\n\n\n\nconst SUB_CONFIG = {\n    MAX_LINE_LENGTH: 25,\n    SPLIT_PRIORITY: ['。','！','？','，',',','：',':','、','；',';',' '], // 补充句子结束符\n    TIME_PRECISION: 3\n};\n\nfunction splitLongPhrase(text, maxLen) {\n    if (text.length <= maxLen) return [text];\n    \n    // 严格在maxLen范围内查找分隔符\n    for (const delimiter of SUB_CONFIG.SPLIT_PRIORITY) {\n        const pos = text.lastIndexOf(delimiter, maxLen - 1); // 关键修改：限制查找范围\n        if (pos > 0) {\n            const splitPos = pos + 1;\n            return [\n                text.substring(0, splitPos).trim(),\n                ...splitLongPhrase(text.substring(splitPos).trim(), maxLen)\n            ];\n        }\n    }\n\n    // 汉字边界检查防止越界\n    const startPos = Math.min(maxLen, text.length) - 1;\n    for (let i = startPos; i > 0; i--) {\n        if (/[\\p{Unified_Ideograph}]/u.test(text[i])) {\n            return [\n                text.substring(0, i + 1).trim(),\n                ...splitLongPhrase(text.substring(i + 1).trim(), maxLen)\n            ];\n        }\n    }\n\n    // 强制分割时保证不超过maxLen\n    const splitPos = Math.min(maxLen, text.length);\n    return [\n        text.substring(0, splitPos).trim(),\n        ...splitLongPhrase(text.substring(splitPos).trim(), maxLen)\n    ];\n}\n\nconst processSubtitles = (\n    captions,\n    subtitleDurations,\n    startTimeμs = 0 // 新增参数：起始时间（单位微秒，默认0）\n  ) => {\n    const cleanRegex = /[\\u3000\\u3002-\\u303F\\uff00-\\uffef\\u2000-\\u206F!\"#$%&'()*+\\-./<=>?@\\\\^_`{|}~]/g;\n    \n    let processedSubtitles = [];\n    let processedSubtitleDurations = [];\n    \n    captions.forEach((text, index) => {\n      const totalDuration = subtitleDurations[index];\n      let phrases = splitLongPhrase(text, SUB_CONFIG.MAX_LINE_LENGTH);\n      \n      phrases = phrases.map(p => p.replace(cleanRegex, '').trim())\n                     .filter(p => p.length > 0);\n  \n      if (phrases.length === 0) {\n        processedSubtitles.push('[无内容]');\n        processedSubtitleDurations.push(totalDuration);\n        return;\n      }\n  \n      const totalChars = phrases.reduce((sum, p) => sum + p.length, 0);\n      let accumulatedμs = 0;\n      \n      phrases.forEach((phrase, i) => {\n        const ratio = phrase.length / totalChars;\n        let durationμs = i === phrases.length - 1 \n          ? totalDuration - accumulatedμs\n          : Math.round(totalDuration * ratio);\n  \n        processedSubtitles.push(phrase);\n        processedSubtitleDurations.push(durationμs);\n        accumulatedμs += durationμs;\n      });\n    });\n  \n    // 时间轴生成（从指定起始时间开始）\n    const textTimelines = [];\n    let currentTime = startTimeμs; // 使用传入的起始时间\n    \n    processedSubtitleDurations.forEach(durationμs => {\n      const start = currentTime;\n      const end = start + durationμs;\n      \n      textTimelines.push({\n        start: start, // 直接使用整数\n        end: end\n      });\n      \n      currentTime = end; // 自动累计到下一段\n    });\n  \n    return { textTimelines, processedSubtitles };\n  };\n","functionID":"38wblniht9d2k","inputParameters":[{"input":{"schema":{"type":"string"},"type":"list","value":{"content":{"blockID":"121555","name":"image_list","source":"block-output"},"dependencies":{"variables":null},"inputMode":"","rawMeta":{"type":99},"type":"ref"}},"left":{},"name":"image_list","right":{}},{"input":{"schema":{"type":"string"},"type":"list","value":{"content":{"blockID":"121555","name":"link_list","source":"block-output"},"dependencies":{"variables":null},"inputMode":"","rawMeta":{"type":99},"type":"ref"}},"left":{},"name":"audio_list","right":{}},{"input":{"schema":{"type":"integer"},"type":"list","value":{"content":{"blockID":"121555","name":"duration_list","source":"block-output"},"dependencies":{"variables":null},"inputMode":"","rawMeta":{"type":100},"type":"ref"}},"left":{},"name":"duration_list","right":{}},{"input":{"schema":{"schema":[{"name":"cap","type":"string"},{"name":"desc_promopt","type":"string"}],"type":"object"},"type":"list","value":{"content":{"blockID":"186126","name":"scenes","source":"block-output"},"dependencies":{"variables":null},"inputMode":"","rawMeta":{"type":103},"type":"ref"}},"left":{},"name":"scenes","right":{}},{"input":{"type":"string","value":{"content":{"blockID":"100001","name":"story","source":"block-output"},"dependencies":{"variables":null},"inputMode":"","rawMeta":{"type":1},"type":"ref"}},"left":{},"name":"title","right":{}},{"input":{"assistType":2,"type":"string","value":{"content":{"blockID":"170966","name":"data","source":"block-output"},"dependencies":{"variables":null},"inputMode":"","rawMeta":{"type":7},"type":"ref"}},"left":{},"name":"role_img_url","right":{}}],"language":5,"settingOnError":{"processType":1,"switch":false,"timeoutMs":60000}},"nodeMeta":{"description":"编写代码，处理输入变量来生成返回值","icon":"https://lf3-static.bytednsdoc.com/obj/eden-cn/dvsmryvd_avi_dvsm/ljhwZthlaukjlkulzlp/icon/icon-Code-v2.jpg","title":"代码-视频组装"},"outputs":[{"input":{},"name":"audioData","required":false,"type":"string"},{"input":{},"name":"imageData","required":false,"type":"string"},{"input":{},"name":"text_timielines","required":false,"schema":{"schema":[],"type":"object"},"type":"list"},{"input":{},"name":"text_captions","required":false,"schema":{"type":"string"},"type":"list"},{"input":{},"name":"title_list","required":false,"schema":{"type":"string"},"type":"list"},{"input":{},"name":"title_timelimes","required":false,"schema":{"schema":[],"type":"object"},"type":"list"},{"input":{},"name":"bgAudioData","required":false,"type":"string"},{"input":{},"name":"kcAudioData","required":false,"type":"string"},{"input":{},"name":"roleImgData","required":false,"type":"string"}],"settings":null,"version":""},"edges":null,"id":"163547","meta":{"canvasPosition":{"x":0,"y":0},"defaultCollapsed":false,"position":{"x":540.2040691864529,"y":501.0454251523903}},"type":"5"},{"blocks":[],"data":{"inputs":{"inputParameters":[{"input":{"type":"string","value":{"content":{"blockID":"121343","name":"content","source":"block-output"},"dependencies":{"variables":null},"inputMode":"","rawMeta":{"type":1},"type":"ref"}},"left":{},"name":"content","right":{}}],"llmParam":[{"input":{"type":"float","value":{"content":"0.8","dependencies":{"variables":null},"inputMode":"","rawMeta":{"type":4},"type":"literal"}},"left":{},"name":"temperature","right":{}},{"input":{"type":"integer","value":{"content":"8192","dependencies":{"variables":null},"inputMode":"","rawMeta":{"type":2},"type":"literal"}},"left":{},"name":"maxTokens","right":{}},{"input":{"type":"integer","value":{"content":"2","dependencies":{"variables":null},"inputMode":"","rawMeta":{"type":2},"type":"literal"}},"left":{},"name":"responseFormat","right":{}},{"input":{"type":"string","value":{"content":"DeepSeek-V3","dependencies":{"variables":null},"inputMode":"","rawMeta":{"type":1},"type":"literal"}},"left":{},"name":"modleName","right":{}},{"input":{"type":"integer","value":{"content":"1738675210","dependencies":{"variables":null},"inputMode":"","rawMeta":{"type":2},"type":"literal"}},"left":{},"name":"modelType","right":{}},{"input":{"type":"string","value":{"content":"default_val","dependencies":{"variables":null},"inputMode":"","rawMeta":{"type":1},"type":"literal"}},"left":{},"name":"generationDiversity","right":{}},{"input":{"type":"string","value":{"content":"故事原文内容：\n{{content}}","dependencies":{"variables":null},"inputMode":"","rawMeta":{"type":1},"type":"literal"}},"left":{},"name":"prompt","right":{}},{"input":{"type":"boolean","value":{"content":false,"dependencies":{"variables":null},"inputMode":"","rawMeta":{"type":3},"type":"literal"}},"left":{},"name":"enableChatHistory","right":{}},{"input":{"type":"integer","value":{"content":"3","dependencies":{"variables":null},"inputMode":"","rawMeta":{"type":2},"type":"literal"}},"left":{},"name":"chatHistoryRound","right":{}},{"input":{"type":"string","value":{"content":"# 角色\n你是一位专业的故事创意转化师，你能够深入理解故事文案的情节、人物、场景等元素，用生动且具体的语言为绘画创作提供清晰的指引。\n\n## 技能\n### 技能1： 生成分镜字幕\n1. 当用户提供故事文案时，仔细分析文案中的关键情节、人物形象、场景特点等要素。\n2. 文案分镜， 生成字幕cap：\n    - 字幕文案分段： 第一句单独生成一个分镜，后续每个段落均由2句话构成，语句简洁明了，表达清晰流畅，同时具备节奏感。\n    - 分割文案后特别注意前后文的关联性与一致性，必须与用户提供的原文完全一致，不得进行任何修改、删减。字幕文案必须严格按照用户给的文案拆分，不能修改提供的内容更不能删除内容\n\n\n===回复示例===\n[{\n          \"cap\":\"字幕文案\"\n}]\n===示例结束===\n\n## 限制:\n- 只围绕用户提供的故事文案进行分镜绘画提示词生成和主题提炼，拒绝回答与该任务无关的话题。\n- 所输出的内容必须条理清晰，分镜绘画提示词要尽可能详细描述画面，主题必须为2个字。 \n- 视频文案及分镜描述必须保持一致。\n- 输出内容必须严格按照给定的 JSON 格式进行组织，不得偏离框架要求。\n- 只对用户提示的内容进行分镜，不能更改原文\n- 严格检查 输出的json格式正确性并进行修正，特别注意json格式不要少括号，逗号等","dependencies":{"variables":null},"inputMode":"","rawMeta":{"type":1},"type":"literal"}},"left":{},"name":"systemPrompt","right":{}},{"input":{"type":"string","value":{"content":"","dependencies":{"variables":null},"inputMode":"","rawMeta":{"type":1},"type":"literal"}},"left":{},"name":"stableSystemPrompt","right":{}}],"settingOnError":{"processType":1,"switch":false,"timeoutMs":180000}},"nodeMeta":{"description":"调用大语言模型,使用变量和提示词生成回复","icon":"https://lf3-static.bytednsdoc.com/obj/eden-cn/dvsmryvd_avi_dvsm/ljhwZthlaukjlkulzlp/icon/icon-LLM-v2.jpg","title":"大模型_分镜"},"outputs":[{"input":{},"name":"scenes","required":false,"schema":{"schema":[{"name":"cap","type":"string"}],"type":"object"},"type":"list"}],"settings":null,"version":"3"},"edges":null,"id":"1165778","meta":{"canvasPosition":{"x":0,"y":0},"defaultCollapsed":false,"position":{"x":-1382.1571216939526,"y":752.2602601582569}},"type":"3"},{"blocks":[],"data":{"inputs":{"inputParameters":[{"input":{"schema":{"schema":[{"name":"cap","type":"string"}],"type":"object"},"type":"list","value":{"content":{"blockID":"1165778","name":"scenes","source":"block-output"},"dependencies":{"variables":null},"inputMode":"","rawMeta":{"type":103},"type":"ref"}},"left":{},"name":"scenes","right":{}}],"llmParam":[{"input":{"type":"string","value":{"content":"default_val","dependencies":{"variables":null},"inputMode":"","rawMeta":{"type":1},"type":"literal"}},"left":{},"name":"generationDiversity","right":{}},{"input":{"type":"float","value":{"content":"1","dependencies":{"variables":null},"inputMode":"","rawMeta":{"type":4},"type":"literal"}},"left":{},"name":"temperature","right":{}},{"input":{"type":"integer","value":{"content":"16384","dependencies":{"variables":null},"inputMode":"","rawMeta":{"type":2},"type":"literal"}},"left":{},"name":"maxTokens","right":{}},{"input":{"type":"integer","value":{"content":"2","dependencies":{"variables":null},"inputMode":"","rawMeta":{"type":2},"type":"literal"}},"left":{},"name":"responseFormat","right":{}},{"input":{"type":"string","value":{"content":"DeepSeek-V3-0324","dependencies":{"variables":null},"inputMode":"","rawMeta":{"type":1},"type":"literal"}},"left":{},"name":"modleName","right":{}},{"input":{"type":"integer","value":{"content":"1742989917","dependencies":{"variables":null},"inputMode":"","rawMeta":{"type":2},"type":"literal"}},"left":{},"name":"modelType","right":{}},{"input":{"type":"string","value":{"content":"故事分镜字幕信息：{{scenes}}","dependencies":{"variables":null},"inputMode":"","rawMeta":{"type":1},"type":"literal"}},"left":{},"name":"prompt","right":{}},{"input":{"type":"boolean","value":{"content":false,"dependencies":{"variables":null},"inputMode":"","rawMeta":{"type":3},"type":"literal"}},"left":{},"name":"enableChatHistory","right":{}},{"input":{"type":"integer","value":{"content":"3","dependencies":{"variables":null},"inputMode":"","rawMeta":{"type":2},"type":"literal"}},"left":{},"name":"chatHistoryRound","right":{}},{"input":{"type":"string","value":{"content":"# 角色\n根据分镜字幕cap生成绘画提示词desc_prompt。\n\n## 技能\n### 技能 1: 生成绘画提示\n1. 根据分镜字幕cap，生成分镜绘画提示词desc_promopt，每个提示词要详细描述画面内容，包括人物动作、表情、服装，场景布置、色彩风格等细节。\n  - 风格要求：神话故事的卡通可爱风格，色彩鲜艳明亮，充满奇幻想象元素，画面活泼生动，线条简洁流畅，有梦幻般的场景构建，角色造型可爱有趣，整体氛围轻松愉悦 ，采用中景或全景展示画面。\n  - 第一个分镜画面中不要出现人物，只需要一个画面背景\n\n===回复示例===\n[\n  {\n    \"cap\": \"字幕文案\",\n    \"desc_promopt\": \"分镜图像提示词\"\n  }\n]\n===示例结束===\n\n## 限制:\n- 只对用户提供的json内容补充desc_prompt字段，不能更改原文\n- 严格检查输出的 json 格式正确性并进行修正，特别注意 json 格式不要少括号，逗号等","dependencies":{"variables":null},"inputMode":"","rawMeta":{"type":1},"type":"literal"}},"left":{},"name":"systemPrompt","right":{}},{"input":{"type":"string","value":{"content":"","dependencies":{"variables":null},"inputMode":"","rawMeta":{"type":1},"type":"literal"}},"left":{},"name":"stableSystemPrompt","right":{}}],"settingOnError":{"processType":1,"switch":false,"timeoutMs":180000}},"nodeMeta":{"description":"调用大语言模型,使用变量和提示词生成回复","icon":"https://lf3-static.bytednsdoc.com/obj/eden-cn/dvsmryvd_avi_dvsm/ljhwZthlaukjlkulzlp/icon/icon-LLM-v2.jpg","title":"大模型_图像提示词"},"outputs":[{"input":{},"name":"scenes","required":false,"schema":{"schema":[{"name":"cap","type":"string"},{"name":"desc_promopt","type":"string"}],"type":"object"},"type":"list"}],"settings":null,"version":"3"},"edges":null,"id":"186126","meta":{"canvasPosition":{"x":0,"y":0},"defaultCollapsed":false,"position":{"x":-884.1789506979849,"y":738.8055591927193}},"type":"3"},{"blocks":[],"data":{"inputs":{"apiParam":[{"input":{"type":"string","value":{"content":"7457837955684515874","rawMeta":{"type":1},"type":"literal"}},"name":"apiID"},{"input":{"type":"string","value":{"content":"create_draft","rawMeta":{"type":1},"type":"literal"}},"name":"apiName"},{"input":{"type":"string","value":{"content":"7457837925833801768","rawMeta":{"type":1},"type":"literal"}},"name":"pluginID"},{"input":{"type":"string","value":{"content":"视频合成_剪映小助手","rawMeta":{"type":1},"type":"literal"}},"name":"pluginName"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"pluginVersion"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"tips"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"outDocLink"}],"inputDefs":[{"description":"高","input":{},"name":"height","required":false,"type":"integer"},{"description":"关联创作者","input":{},"name":"user_id","required":false,"type":"integer"},{"description":"宽","input":{},"name":"width","required":false,"type":"integer"}],"inputParameters":[{"input":{"type":"integer","value":{"content":1080,"rawMeta":{"type":2},"type":"literal"}},"name":"height"},{"input":{"type":"integer","value":{"content":9943,"rawMeta":{"type":2},"type":"literal"}},"name":"user_id"},{"input":{"type":"integer","value":{"content":1440,"rawMeta":{"type":2},"type":"literal"}},"name":"width"}],"settingOnError":{"processType":1,"retryTimes":0,"timeoutMs":180000}},"nodeMeta":{"description":"插件入口-创建草稿","icon":"https://lf3-static.bytednsdoc.com/obj/eden-cn/dvsmryvd_avi_dvsm/ljhwZthlaukjlkulzlp/icon/icon-Plugin-v2.jpg","subtitle":"视频合成_剪映小助手:create_draft","title":"创建草稿"},"outputs":[{"name":"draft_url","required":false,"type":"string"},{"name":"tip_url","required":false,"type":"string"}]},"edges":null,"id":"168118","meta":{"canvasPosition":{"x":0,"y":0},"defaultCollapsed":false,"position":{"x":1189.433109331326,"y":471.2309113516882}},"type":"4"},{"blocks":[],"data":{"inputs":{"apiParam":[{"input":{"type":"string","value":{"content":"7457837925833834536","rawMeta":{"type":1},"type":"literal"}},"name":"apiID"},{"input":{"type":"string","value":{"content":"add_audios","rawMeta":{"type":1},"type":"literal"}},"name":"apiName"},{"input":{"type":"string","value":{"content":"7457837925833801768","rawMeta":{"type":1},"type":"literal"}},"name":"pluginID"},{"input":{"type":"string","value":{"content":"视频合成_剪映小助手","rawMeta":{"type":1},"type":"literal"}},"name":"pluginName"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"pluginVersion"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"tips"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"outDocLink"}],"inputDefs":[{"description":"[{\"audio_url\": \"http://example.com/audio1.mp3\",\"duration\":120,\"start\":0,\"end\":12000000,\"audio_effect\":\"教堂\"}]","input":{},"name":"audio_infos","required":true,"type":"string"},{"description":"草稿地址，使用create_draft输出的draft_url即可","input":{},"name":"draft_url","required":true,"type":"string"}],"inputParameters":[{"input":{"type":"string","value":{"content":{"blockID":"163547","name":"audioData","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"audio_infos"},{"input":{"type":"string","value":{"content":{"blockID":"168118","name":"draft_url","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"draft_url"}],"settingOnError":{"processType":1,"retryTimes":0,"timeoutMs":180000}},"nodeMeta":{"description":"批量添加音频","icon":"https://lf3-static.bytednsdoc.com/obj/eden-cn/dvsmryvd_avi_dvsm/ljhwZthlaukjlkulzlp/icon/icon-Plugin-v2.jpg","subtitle":"视频合成_剪映小助手:add_audios","title":"添加字幕音频"},"outputs":[{"name":"audio_ids","required":false,"schema":{"type":"string"},"type":"list"},{"name":"draft_url","required":false,"type":"string"},{"name":"track_id","required":false,"type":"string"}]},"edges":null,"id":"125268","meta":{"canvasPosition":{"x":0,"y":0},"defaultCollapsed":false,"position":{"x":1200.2121830752735,"y":668.1914445535642}},"type":"4"},{"blocks":[],"data":{"inputs":{"apiParam":[{"input":{"type":"string","value":{"content":"7475829177439191075","rawMeta":{"type":1},"type":"literal"}},"name":"apiID"},{"input":{"type":"string","value":{"content":"caption_infos","rawMeta":{"type":1},"type":"literal"}},"name":"apiName"},{"input":{"type":"string","value":{"content":"7475829177439109155","rawMeta":{"type":1},"type":"literal"}},"name":"pluginID"},{"input":{"type":"string","value":{"content":"剪映小助手数据生成器","rawMeta":{"type":1},"type":"literal"}},"name":"pluginName"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"pluginVersion"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"tips"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"outDocLink"}],"inputDefs":[{"description":"文本列表","input":{},"name":"texts","required":true,"schema":{"assistType":0,"type":"string"},"type":"list"},{"description":"对应剪映的入场动画名字，多个动画请用英文|分割，比如：飞入|放大","input":{},"name":"in_animation","required":false,"type":"string"},{"description":"关键词颜色","input":{},"name":"keyword_color","required":false,"type":"string"},{"description":"循环动画时长","input":{},"name":"loop_animation_duration","required":false,"type":"integer"},{"description":"出场动画时长","input":{},"name":"out_animation_duration","required":false,"type":"integer"},{"description":"对应剪映的循环动画名字，多个动画请用英文|分割，比如：扫光|晃动","input":{},"name":"loop_animation","required":false,"type":"string"},{"description":"对应剪映的出场动画名字，多个动画请用英文|分割，比如：消散|闭幕","input":{},"name":"out_animation","required":false,"type":"string"},{"description":"时间节点，只接收结构：[{\"start\":0,\"end\":4612}]，一般从audio_timeline节点的输出获取","input":{},"name":"timelines","required":true,"schema":{"schema":[{"description":"结束时间","input":{},"name":"end","required":true,"type":"integer"},{"description":"开始时间","input":{},"name":"start","required":true,"type":"integer"}],"type":"object"},"type":"list"},{"description":"文字大小","input":{},"name":"font_size","required":false,"type":"integer"},{"description":"入场动画时长","input":{},"name":"in_animation_duration","required":false,"type":"integer"},{"description":"关键词字大小","input":{},"name":"keyword_font_size","required":false,"type":"integer"},{"description":"文本里面的重点词列表","input":{},"name":"keywords","required":false,"schema":{"assistType":0,"type":"string"},"type":"list"}],"inputParameters":[{"input":{"schema":{"type":"string"},"type":"list","value":{"content":{"blockID":"163547","name":"text_captions","source":"block-output"},"rawMeta":{"type":99},"type":"ref"}},"name":"texts"},{"input":{"schema":{"schema":[],"type":"object"},"type":"list","value":{"content":{"blockID":"163547","name":"text_timielines","source":"block-output"},"rawMeta":{"type":103},"type":"ref"}},"name":"timelines"}],"settingOnError":{"processType":1,"retryTimes":0,"timeoutMs":180000}},"nodeMeta":{"description":"根据时间线制作字幕数据","icon":"https://p9-flow-product-sign.byteimg.com/tos-cn-i-13w3uml6bg/6a57866c6eca488eb6a78e3cdb16e668~tplv-13w3uml6bg-resize:128:128.image?rk3s=2e2596fd&x-expires=1744465010&x-signature=4iDDzKiufQ2Axl4wsESVJu8bc4A%3D","subtitle":"剪映小助手数据生成器:caption_infos","title":"caption_infos字幕信息"},"outputs":[{"name":"infos","required":false,"type":"string"}]},"edges":null,"id":"180947","meta":{"canvasPosition":{"x":0,"y":0},"defaultCollapsed":false,"position":{"x":1721.2881096470614,"y":703.3075570331135}},"type":"4"},{"blocks":[],"data":{"inputs":{"apiParam":[{"input":{"type":"string","value":{"content":"7457837925833883688","rawMeta":{"type":1},"type":"literal"}},"name":"apiID"},{"input":{"type":"string","value":{"content":"add_images","rawMeta":{"type":1},"type":"literal"}},"name":"apiName"},{"input":{"type":"string","value":{"content":"7457837925833801768","rawMeta":{"type":1},"type":"literal"}},"name":"pluginID"},{"input":{"type":"string","value":{"content":"视频合成_剪映小助手","rawMeta":{"type":1},"type":"literal"}},"name":"pluginName"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"pluginVersion"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"tips"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"outDocLink"}],"inputDefs":[{"description":"草稿地址，使用create_draft输出的draft_url即可","input":{},"name":"draft_url","required":true,"type":"string"},{"description":"查看说明：https://krxc4izye0.feishu.cn/wiki/Pgm9wXA4EipKhYkeEQJcLBlJnWb?from=from_copylink","input":{},"name":"image_infos","required":true,"type":"string"},{"description":"x缩放","input":{},"name":"scale_x","required":false,"type":"float"},{"description":"y缩放","input":{},"name":"scale_y","required":false,"type":"float"},{"description":"移动transform_x","input":{},"name":"transform_x","required":false,"type":"float"},{"description":"移动transform_y","input":{},"name":"transform_y","required":false,"type":"float"}],"inputParameters":[{"input":{"type":"string","value":{"content":{"blockID":"168118","name":"draft_url","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"draft_url"},{"input":{"type":"string","value":{"content":{"blockID":"163547","name":"imageData","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"image_infos"},{"input":{"type":"float","value":{"content":1,"rawMeta":{"type":4},"type":"literal"}},"name":"scale_x"},{"input":{"type":"float","value":{"content":1,"rawMeta":{"type":4},"type":"literal"}},"name":"scale_y"}],"settingOnError":{"processType":1,"retryTimes":0,"timeoutMs":180000}},"nodeMeta":{"description":"批量添加图片","icon":"https://p6-flow-product-sign.byteimg.com/tos-cn-i-13w3uml6bg/324427c7589a426286a9774fa69f64a2~tplv-13w3uml6bg-resize:128:128.image?rk3s=2e2596fd&x-expires=1744472328&x-signature=9GXsgm2HH29uW0ihgoymUTYxCmc%3D","subtitle":"视频合成_剪映小助手:add_images","title":"添加分镜图片"},"outputs":[{"name":"segment_infos","required":false,"schema":{"schema":[{"name":"end","required":false,"type":"integer"},{"name":"id","required":false,"type":"string"},{"name":"start","required":false,"type":"integer"}],"type":"object"},"type":"list"},{"name":"track_id","required":false,"type":"string"},{"name":"draft_url","required":false,"type":"string"},{"name":"image_ids","required":false,"schema":{"type":"string"},"type":"list"},{"name":"segment_ids","required":false,"schema":{"type":"string"},"type":"list"}]},"edges":null,"id":"109941","meta":{"canvasPosition":{"x":0,"y":0},"defaultCollapsed":false,"position":{"x":1182.110321121601,"y":856.3134756940066}},"type":"4"},{"blocks":[],"data":{"inputs":{"apiParam":[{"input":{"type":"string","value":{"content":"7457837925833850920","rawMeta":{"type":1},"type":"literal"}},"name":"apiID"},{"input":{"type":"string","value":{"content":"add_captions","rawMeta":{"type":1},"type":"literal"}},"name":"apiName"},{"input":{"type":"string","value":{"content":"7457837925833801768","rawMeta":{"type":1},"type":"literal"}},"name":"pluginID"},{"input":{"type":"string","value":{"content":"视频合成_剪映小助手","rawMeta":{"type":1},"type":"literal"}},"name":"pluginName"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"pluginVersion"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"tips"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"outDocLink"}],"inputDefs":[{"description":"scale_x缩放","input":{},"name":"scale_x","required":false,"type":"float"},{"description":"scale_y缩放","input":{},"name":"scale_y","required":false,"type":"float"},{"description":"文字颜色：#ff1837","input":{},"name":"text_color","required":false,"type":"string"},{"description":"transform_x位置","input":{},"name":"transform_x","required":false,"type":"float"},{"description":"transform_y位置","input":{},"name":"transform_y","required":false,"type":"float"},{"description":"字幕的对齐方式，0左对齐，1 居中对齐，2右对齐","input":{},"name":"alignment","required":false,"type":"integer"},{"description":"字间距，默认0","input":{},"name":"letter_spacing","required":false,"type":"float"},{"description":"草稿地址，使用create_draft输出的draft_url即可","input":{},"name":"draft_url","required":true,"type":"string"},{"description":"字体列表：https://krxc4izye0.feishu.cn/wiki/SmnrwabXriG7JckEzyGcChk4nDd","input":{},"name":"font","required":false,"type":"string"},{"description":"默认：15","input":{},"name":"font_size","required":false,"type":"integer"},{"description":"行间距，默认0","input":{},"name":"line_spacing","required":false,"type":"float"},{"description":"0 默认。1富文本样式","input":{},"name":"style_text","required":false,"type":"integer"},{"description":"边框颜色，eg：#fe8a80","input":{},"name":"border_color","required":false,"type":"string"},{"description":"查看说明：https://krxc4izye0.feishu.cn/wiki/HhQrw3BFhi1XGOkkJCBcfkqGnwf?from=from_copylink","input":{},"name":"captions","required":true,"type":"string"}],"inputParameters":[{"input":{"type":"string","value":{"content":{"blockID":"180947","name":"infos","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"captions"},{"input":{"type":"string","value":{"content":{"blockID":"168118","name":"draft_url","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"draft_url"},{"input":{"type":"integer","value":{"content":1,"rawMeta":{"type":2},"type":"literal"}},"name":"alignment"},{"input":{"type":"string","value":{"content":"#000000","rawMeta":{"type":1},"type":"literal"}},"name":"border_color"},{"input":{"type":"integer","value":{"content":7,"rawMeta":{"type":2},"type":"literal"}},"name":"font_size"},{"input":{"type":"string","value":{"content":"#FFFFFF","rawMeta":{"type":1},"type":"literal"}},"name":"text_color"},{"input":{"type":"float","value":{"content":0,"rawMeta":{"type":4},"type":"literal"}},"name":"transform_x"},{"input":{"type":"float","value":{"content":-810,"rawMeta":{"type":4},"type":"literal"}},"name":"transform_y"}],"settingOnError":{"processType":1,"retryTimes":0,"timeoutMs":180000}},"nodeMeta":{"description":"批量添加字幕","icon":"https://p26-flow-product-sign.byteimg.com/tos-cn-i-13w3uml6bg/324427c7589a426286a9774fa69f64a2~tplv-13w3uml6bg-resize:128:128.image?rk3s=2e2596fd&x-expires=1744464780&x-signature=qS0o%2FY1NDMFTjtJAQ%2FHNSTjQEzw%3D","subtitle":"视频合成_剪映小助手:add_captions","title":"add_captions添加字幕"},"outputs":[{"name":"draft_url","required":false,"type":"string"},{"name":"segment_ids","required":false,"schema":{"type":"string"},"type":"list"},{"name":"segment_infos","required":false,"schema":{"schema":[{"name":"end","required":false,"type":"integer"},{"name":"id","required":false,"type":"string"},{"name":"start","required":false,"type":"integer"}],"type":"object"},"type":"list"},{"name":"text_ids","required":false,"schema":{"type":"string"},"type":"list"},{"name":"track_id","required":false,"type":"string"}]},"edges":null,"id":"158201","meta":{"canvasPosition":{"x":0,"y":0},"defaultCollapsed":false,"position":{"x":1712.7809843841228,"y":1044.435506834449}},"type":"4"},{"blocks":[],"data":{"inputs":{"apiParam":[{"input":{"type":"string","value":{"content":"7457837955684548642","rawMeta":{"type":1},"type":"literal"}},"name":"apiID"},{"input":{"type":"string","value":{"content":"save_draft","rawMeta":{"type":1},"type":"literal"}},"name":"apiName"},{"input":{"type":"string","value":{"content":"7457837925833801768","rawMeta":{"type":1},"type":"literal"}},"name":"pluginID"},{"input":{"type":"string","value":{"content":"视频合成_剪映小助手","rawMeta":{"type":1},"type":"literal"}},"name":"pluginName"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"pluginVersion"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"tips"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"outDocLink"}],"inputDefs":[{"description":"草稿地址，使用create_draft输出的draft_url即可","input":{},"name":"draft_url","required":true,"type":"string"},{"description":"用户ID。如果填写了这个ID，新用户产生的月费就会按照比例归属到这个账号下。","input":{},"name":"user_id","required":false,"type":"integer"}],"inputParameters":[{"input":{"type":"string","value":{"content":{"blockID":"168118","name":"draft_url","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"draft_url"},{"input":{"type":"integer","value":{"content":9943,"rawMeta":{"type":2},"type":"literal"}},"name":"user_id"}],"settingOnError":{"processType":1,"retryTimes":0,"timeoutMs":180000}},"nodeMeta":{"description":"保存草稿\n","icon":"https://lf3-static.bytednsdoc.com/obj/eden-cn/dvsmryvd_avi_dvsm/ljhwZthlaukjlkulzlp/icon/icon-Plugin-v2.jpg","subtitle":"视频合成_剪映小助手:save_draft","title":"保存草稿"},"outputs":[{"name":"draft_url","required":false,"type":"string"},{"name":"message","required":false,"type":"string"}]},"edges":null,"id":"104782","meta":{"canvasPosition":{"x":0,"y":0},"defaultCollapsed":false,"position":{"x":2299.6163541318274,"y":507.66064464705335}},"type":"4"},{"blocks":[],"data":{"inputs":{"apiParam":[{"input":{"type":"string","value":{"content":"7475829177439191075","rawMeta":{"type":1},"type":"literal"}},"name":"apiID"},{"input":{"type":"string","value":{"content":"caption_infos","rawMeta":{"type":1},"type":"literal"}},"name":"apiName"},{"input":{"type":"string","value":{"content":"7475829177439109155","rawMeta":{"type":1},"type":"literal"}},"name":"pluginID"},{"input":{"type":"string","value":{"content":"剪映小助手数据生成器","rawMeta":{"type":1},"type":"literal"}},"name":"pluginName"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"pluginVersion"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"tips"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"outDocLink"}],"inputDefs":[{"description":"文本列表","input":{},"name":"texts","required":true,"schema":{"assistType":0,"type":"string"},"type":"list"},{"description":"对应剪映的入场动画名字，多个动画请用英文|分割，比如：飞入|放大","input":{},"name":"in_animation","required":false,"type":"string"},{"description":"关键词颜色","input":{},"name":"keyword_color","required":false,"type":"string"},{"description":"循环动画时长","input":{},"name":"loop_animation_duration","required":false,"type":"integer"},{"description":"出场动画时长","input":{},"name":"out_animation_duration","required":false,"type":"integer"},{"description":"对应剪映的循环动画名字，多个动画请用英文|分割，比如：扫光|晃动","input":{},"name":"loop_animation","required":false,"type":"string"},{"description":"对应剪映的出场动画名字，多个动画请用英文|分割，比如：消散|闭幕","input":{},"name":"out_animation","required":false,"type":"string"},{"description":"时间节点，只接收结构：[{\"start\":0,\"end\":4612}]，一般从audio_timeline节点的输出获取","input":{},"name":"timelines","required":true,"schema":{"schema":[{"description":"结束时间","input":{},"name":"end","required":true,"type":"integer"},{"description":"开始时间","input":{},"name":"start","required":true,"type":"integer"}],"type":"object"},"type":"list"},{"description":"文字大小","input":{},"name":"font_size","required":false,"type":"integer"},{"description":"入场动画时长","input":{},"name":"in_animation_duration","required":false,"type":"integer"},{"description":"关键词字大小","input":{},"name":"keyword_font_size","required":false,"type":"integer"},{"description":"文本里面的重点词列表","input":{},"name":"keywords","required":false,"schema":{"assistType":0,"type":"string"},"type":"list"}],"inputParameters":[{"input":{"schema":{"type":"string"},"type":"list","value":{"content":{"blockID":"163547","name":"title_list","source":"block-output"},"rawMeta":{"type":99},"type":"ref"}},"name":"texts"},{"input":{"schema":{"schema":[],"type":"object"},"type":"list","value":{"content":{"blockID":"163547","name":"title_timelimes","source":"block-output"},"rawMeta":{"type":103},"type":"ref"}},"name":"timelines"},{"input":{"type":"string","value":{"content":"弹入","rawMeta":{"type":1},"type":"literal"}},"name":"in_animation"}],"settingOnError":{"processType":1,"retryTimes":0,"timeoutMs":180000}},"nodeMeta":{"description":"根据时间线制作字幕数据","icon":"https://p9-flow-product-sign.byteimg.com/tos-cn-i-13w3uml6bg/6a57866c6eca488eb6a78e3cdb16e668~tplv-13w3uml6bg-resize:128:128.image?rk3s=2e2596fd&x-expires=1744465010&x-signature=4iDDzKiufQ2Axl4wsESVJu8bc4A%3D","subtitle":"剪映小助手数据生成器:caption_infos","title":"caption_infos_故事标题"},"outputs":[{"name":"infos","required":false,"type":"string"}]},"edges":null,"id":"1204256","meta":{"canvasPosition":{"x":0,"y":0},"defaultCollapsed":false,"position":{"x":1721.2881096470614,"y":873.8715319337811}},"type":"4"},{"blocks":[],"data":{"inputs":{"apiParam":[{"input":{"type":"string","value":{"content":"7457837925833850920","rawMeta":{"type":1},"type":"literal"}},"name":"apiID"},{"input":{"type":"string","value":{"content":"add_captions","rawMeta":{"type":1},"type":"literal"}},"name":"apiName"},{"input":{"type":"string","value":{"content":"7457837925833801768","rawMeta":{"type":1},"type":"literal"}},"name":"pluginID"},{"input":{"type":"string","value":{"content":"视频合成_剪映小助手","rawMeta":{"type":1},"type":"literal"}},"name":"pluginName"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"pluginVersion"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"tips"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"outDocLink"}],"inputDefs":[{"description":"scale_x缩放","input":{},"name":"scale_x","required":false,"type":"float"},{"description":"scale_y缩放","input":{},"name":"scale_y","required":false,"type":"float"},{"description":"文字颜色：#ff1837","input":{},"name":"text_color","required":false,"type":"string"},{"description":"transform_x位置","input":{},"name":"transform_x","required":false,"type":"float"},{"description":"transform_y位置","input":{},"name":"transform_y","required":false,"type":"float"},{"description":"字幕的对齐方式，0左对齐，1 居中对齐，2右对齐","input":{},"name":"alignment","required":false,"type":"integer"},{"description":"字间距，默认0","input":{},"name":"letter_spacing","required":false,"type":"float"},{"description":"草稿地址，使用create_draft输出的draft_url即可","input":{},"name":"draft_url","required":true,"type":"string"},{"description":"字体列表：https://krxc4izye0.feishu.cn/wiki/SmnrwabXriG7JckEzyGcChk4nDd","input":{},"name":"font","required":false,"type":"string"},{"description":"默认：15","input":{},"name":"font_size","required":false,"type":"integer"},{"description":"行间距，默认0","input":{},"name":"line_spacing","required":false,"type":"float"},{"description":"0 默认。1富文本样式","input":{},"name":"style_text","required":false,"type":"integer"},{"description":"边框颜色，eg：#fe8a80","input":{},"name":"border_color","required":false,"type":"string"},{"description":"查看说明：https://krxc4izye0.feishu.cn/wiki/HhQrw3BFhi1XGOkkJCBcfkqGnwf?from=from_copylink","input":{},"name":"captions","required":true,"type":"string"}],"inputParameters":[{"input":{"type":"string","value":{"content":{"blockID":"1204256","name":"infos","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"captions"},{"input":{"type":"string","value":{"content":{"blockID":"168118","name":"draft_url","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"draft_url"},{"input":{"type":"integer","value":{"content":1,"rawMeta":{"type":2},"type":"literal"}},"name":"alignment"},{"input":{"type":"string","value":{"content":"#FFFFFF","rawMeta":{"type":1},"type":"literal"}},"name":"border_color"},{"input":{"type":"string","value":{"content":"梦桃体","rawMeta":{"type":1},"type":"literal"}},"name":"font"},{"input":{"type":"integer","value":{"content":24,"rawMeta":{"type":2},"type":"literal"}},"name":"font_size"},{"input":{"type":"float","value":{"content":0,"rawMeta":{"type":4},"type":"literal"}},"name":"letter_spacing"},{"input":{"type":"string","value":{"content":"#ff7100","rawMeta":{"type":1},"type":"literal"}},"name":"text_color"},{"input":{"type":"float","value":{"content":0,"rawMeta":{"type":4},"type":"literal"}},"name":"transform_x"},{"input":{"type":"float","value":{"content":0,"rawMeta":{"type":4},"type":"literal"}},"name":"transform_y"}],"settingOnError":{"processType":1,"retryTimes":0,"timeoutMs":180000}},"nodeMeta":{"description":"批量添加字幕","icon":"https://p26-flow-product-sign.byteimg.com/tos-cn-i-13w3uml6bg/324427c7589a426286a9774fa69f64a2~tplv-13w3uml6bg-resize:128:128.image?rk3s=2e2596fd&x-expires=1744464780&x-signature=qS0o%2FY1NDMFTjtJAQ%2FHNSTjQEzw%3D","subtitle":"视频合成_剪映小助手:add_captions","title":"add_captions_添加故事标题"},"outputs":[{"name":"draft_url","required":false,"type":"string"},{"name":"segment_ids","required":false,"schema":{"type":"string"},"type":"list"},{"name":"segment_infos","required":false,"schema":{"schema":[{"name":"end","required":false,"type":"integer"},{"name":"id","required":false,"type":"string"},{"name":"start","required":false,"type":"integer"}],"type":"object"},"type":"list"},{"name":"text_ids","required":false,"schema":{"type":"string"},"type":"list"},{"name":"track_id","required":false,"type":"string"}]},"edges":null,"id":"1182713","meta":{"canvasPosition":{"x":0,"y":0},"defaultCollapsed":false,"position":{"x":1712.7809843841228,"y":1235.0658317234302}},"type":"4"},{"blocks":[],"data":{"inputs":{"apiParam":[{"input":{"type":"string","value":{"content":"7457837925833834536","rawMeta":{"type":1},"type":"literal"}},"name":"apiID"},{"input":{"type":"string","value":{"content":"add_audios","rawMeta":{"type":1},"type":"literal"}},"name":"apiName"},{"input":{"type":"string","value":{"content":"7457837925833801768","rawMeta":{"type":1},"type":"literal"}},"name":"pluginID"},{"input":{"type":"string","value":{"content":"视频合成_剪映小助手","rawMeta":{"type":1},"type":"literal"}},"name":"pluginName"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"pluginVersion"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"tips"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"outDocLink"}],"inputDefs":[{"description":"[{\"audio_url\": \"http://example.com/audio1.mp3\",\"duration\":120,\"start\":0,\"end\":12000000,\"audio_effect\":\"教堂\"}]","input":{},"name":"audio_infos","required":true,"type":"string"},{"description":"草稿地址，使用create_draft输出的draft_url即可","input":{},"name":"draft_url","required":true,"type":"string"}],"inputParameters":[{"input":{"type":"string","value":{"content":{"blockID":"163547","name":"bgAudioData","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"audio_infos"},{"input":{"type":"string","value":{"content":{"blockID":"168118","name":"draft_url","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"draft_url"}],"settingOnError":{"processType":1,"retryTimes":0,"timeoutMs":180000}},"nodeMeta":{"description":"批量添加音频","icon":"https://lf3-static.bytednsdoc.com/obj/eden-cn/dvsmryvd_avi_dvsm/ljhwZthlaukjlkulzlp/icon/icon-Plugin-v2.jpg","subtitle":"视频合成_剪映小助手:add_audios","title":"添加背景音乐"},"outputs":[{"name":"audio_ids","required":false,"schema":{"type":"string"},"type":"list"},{"name":"draft_url","required":false,"type":"string"},{"name":"track_id","required":false,"type":"string"}]},"edges":null,"id":"1190196","meta":{"canvasPosition":{"x":0,"y":0},"defaultCollapsed":false,"position":{"x":1169.0250466650073,"y":1184.8999567526457}},"type":"4"},{"blocks":[],"data":{"inputs":{"code":"import json\n\nasync def main(args: Args) -> Output:\n    params = args.params\n    segment_ids = params['segment_ids']\n    times = params['duration_list']\n    seg = params['segment_infos']\n    \n    # 验证参数长度一致性\n    if len(segment_ids) != len(times):\n        raise ValueError(\"segment_ids与times数组长度不一致\")\n    \n    keyframes = []\n    \n    for idx, seg_id in enumerate(segment_ids):\n        if idx == 0:  # 跳过第一张图片\n            continue\n        \n        # 获取对应音频时长并转换微秒\n        audio_duration = int(float(times[idx]))\n        \n        # 根据循环索引决定缩放方向\n        cycle_idx = idx - 1  # 计算排除第一个元素后的循环索引\n        if cycle_idx % 2 == 0:  # 偶数索引：1.0 -> 1.5\n            start_scale = 1.0\n            end_scale = 1.5\n        else:  # 奇数索引：1.5 -> 1.0\n            start_scale = 1.5\n            end_scale = 1.0\n        \n        # 起始关键帧（0秒位置）\n        keyframes.append({\n            \"offset\": 0,\n            \"property\": \"UNIFORM_SCALE\",\n            \"segment_id\": seg_id,\n            \"value\": start_scale,\n            \"easing\": \"linear\"\n        })\n        \n        # 结束关键帧（同步音频时长）\n        keyframes.append({\n            \"offset\": audio_duration,  # 使用实际音频时长\n            \"property\": \"UNIFORM_SCALE\",\n            \"segment_id\": seg_id,\n            \"value\": end_scale,\n            \"easing\": \"linear\"\n        })\n    \n    \n    # 起始关键帧（0秒位置）\n    keyframes.append({\n        \"offset\": 0,\n        \"property\": \"UNIFORM_SCALE\",\n        \"segment_id\": seg[0]['id'],\n        \"value\": 2,\n        \"easing\": \"linear\"\n    })\n\n    keyframes.append({\n        \"offset\": 533333,\n        \"property\": \"UNIFORM_SCALE\",\n        \"segment_id\": seg[0]['id'],\n        \"value\": 1.2,\n        \"easing\": \"linear\"\n    })\n    \n        \n    # 结束关键帧（同步音频时长）\n    keyframes.append({\n        \"offset\": seg[0]['end']-seg[0]['start'],  # 使用实际音频时长\n        \"property\": \"UNIFORM_SCALE\",\n        \"segment_id\": seg[0]['id'],\n        \"value\": 1.0,\n        \"easing\": \"linear\"\n    })\n    \n\n    return {\n        \"keyFrames\": json.dumps(keyframes)\n    }\n\n","functionID":"38wbfijmd6fn7","inputParameters":[{"input":{"schema":{"type":"string"},"type":"list","value":{"content":{"blockID":"109941","name":"segment_ids","source":"block-output"},"dependencies":{"variables":null},"inputMode":"","rawMeta":{"type":99},"type":"ref"}},"left":{},"name":"segment_ids","right":{}},{"input":{"schema":{"type":"integer"},"type":"list","value":{"content":{"blockID":"121555","name":"duration_list","source":"block-output"},"dependencies":{"variables":null},"inputMode":"","rawMeta":{"type":100},"type":"ref"}},"left":{},"name":"duration_list","right":{}},{"input":{"schema":{"schema":[{"name":"end","required":false,"type":"integer"},{"name":"id","required":false,"type":"string"},{"name":"start","required":false,"type":"integer"}],"type":"object"},"type":"list","value":{"content":{"blockID":"1087428","name":"segment_infos","source":"block-output"},"dependencies":{"variables":null},"inputMode":"","rawMeta":{"type":103},"type":"ref"}},"left":{},"name":"segment_infos","right":{}}],"language":3,"settingOnError":{"processType":1,"switch":false,"timeoutMs":60000}},"nodeMeta":{"description":"编写代码，处理输入变量来生成返回值","icon":"https://lf3-static.bytednsdoc.com/obj/eden-cn/dvsmryvd_avi_dvsm/ljhwZthlaukjlkulzlp/icon/icon-Code-v2.jpg","title":"代码_关键帧"},"outputs":[{"input":{},"name":"keyFrames","required":false,"type":"string"}],"settings":null,"version":""},"edges":null,"id":"120984","meta":{"canvasPosition":{"x":0,"y":0},"defaultCollapsed":false,"position":{"x":1169.0250466650073,"y":1340.414169162078}},"type":"5"},{"blocks":[],"data":{"inputs":{"apiParam":[{"input":{"type":"string","value":{"content":"7465608338500452404","rawMeta":{"type":1},"type":"literal"}},"name":"apiID"},{"input":{"type":"string","value":{"content":"add_keyframes","rawMeta":{"type":1},"type":"literal"}},"name":"apiName"},{"input":{"type":"string","value":{"content":"7457837925833801768","rawMeta":{"type":1},"type":"literal"}},"name":"pluginID"},{"input":{"type":"string","value":{"content":"视频合成_剪映小助手","rawMeta":{"type":1},"type":"literal"}},"name":"pluginName"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"pluginVersion"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"tips"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"outDocLink"}],"inputParameters":[{"input":{"type":"string","value":{"content":{"blockID":"168118","name":"draft_url","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"draft_url"},{"input":{"type":"string","value":{"content":{"blockID":"120984","name":"keyFrames","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"keyframes"}],"settingOnError":{"processType":1,"retryTimes":0,"timeoutMs":180000}},"nodeMeta":{"description":"添加关键帧","icon":"https://p6-flow-product-sign.byteimg.com/tos-cn-i-13w3uml6bg/f013e4af74224258a37363a531aecefe~tplv-13w3uml6bg-resize:128:128.image?rk3s=2e2596fd&x-expires=1746810641&x-signature=nre7vy5iSw43%2Bkt5noyLIVGGEq4%3D","subtitle":"视频合成_剪映小助手:add_keyframes","title":"添加关键帧"},"outputs":[{"name":"draft_url","required":false,"type":"string"}]},"edges":null,"id":"146723","meta":{"canvasPosition":{"x":0,"y":0},"defaultCollapsed":false,"position":{"x":1712.7809843841228,"y":522.7104071382888}},"type":"4"},{"blocks":[],"data":{"inputs":{"inputParameters":[{"input":{"type":"string","value":{"content":{"blockID":"121343","name":"content","source":"block-output"},"dependencies":{"variables":null},"inputMode":"","rawMeta":{"type":1},"type":"ref"}},"left":{},"name":"scenes","right":{}}],"llmParam":[{"input":{"type":"float","value":{"content":"0.8","dependencies":{"variables":null},"inputMode":"","rawMeta":{"type":4},"type":"literal"}},"left":{},"name":"temperature","right":{}},{"input":{"type":"integer","value":{"content":"8192","dependencies":{"variables":null},"inputMode":"","rawMeta":{"type":2},"type":"literal"}},"left":{},"name":"maxTokens","right":{}},{"input":{"type":"integer","value":{"content":"2","dependencies":{"variables":null},"inputMode":"","rawMeta":{"type":2},"type":"literal"}},"left":{},"name":"responseFormat","right":{}},{"input":{"type":"string","value":{"content":"DeepSeek-V3","dependencies":{"variables":null},"inputMode":"","rawMeta":{"type":1},"type":"literal"}},"left":{},"name":"modleName","right":{}},{"input":{"type":"integer","value":{"content":"1738675210","dependencies":{"variables":null},"inputMode":"","rawMeta":{"type":2},"type":"literal"}},"left":{},"name":"modelType","right":{}},{"input":{"type":"string","value":{"content":"default_val","dependencies":{"variables":null},"inputMode":"","rawMeta":{"type":1},"type":"literal"}},"left":{},"name":"generationDiversity","right":{}},{"input":{"type":"string","value":{"content":"故事信息：{{scenes}}","dependencies":{"variables":null},"inputMode":"","rawMeta":{"type":1},"type":"literal"}},"left":{},"name":"prompt","right":{}},{"input":{"type":"boolean","value":{"content":false,"dependencies":{"variables":null},"inputMode":"","rawMeta":{"type":3},"type":"literal"}},"left":{},"name":"enableChatHistory","right":{}},{"input":{"type":"integer","value":{"content":"3","dependencies":{"variables":null},"inputMode":"","rawMeta":{"type":2},"type":"literal"}},"left":{},"name":"chatHistoryRound","right":{}},{"input":{"type":"string","value":{"content":"# 角色\n你是一位擅长生成卡通可爱风格绘画提示词的创作助手，能够依据故事信息，精准生成用于描绘故事主角开场的绘画提示词desc_prompt。\n\n## 技能\n### 技能 1: 生成绘画提示\n1. 仔细分析故事信息，紧扣卡通可爱风格要求，生成主角任务绘画提示词desc_prompt。需详细且生动地描述人物动作、表情、服装等细节，同时明确色彩风格。\n  - 风格要求：呈现卡通可爱风格，背景简洁明亮，颜色鲜艳活泼，营造出轻松欢快的氛围。人物身着独特可爱的服装，线条圆润柔和，为人物特写，采用细腻手笔，具备高饱和度色彩、清晰画面的特点。\n  - 画面仅出现一个正对屏幕、位于画面正中间的人物。\n\n# 限制\n1. 仅输出绘画提示词，不输出任何其他额外内容。","dependencies":{"variables":null},"inputMode":"","rawMeta":{"type":1},"type":"literal"}},"left":{},"name":"systemPrompt","right":{}},{"input":{"type":"string","value":{"content":"","dependencies":{"variables":null},"inputMode":"","rawMeta":{"type":1},"type":"literal"}},"left":{},"name":"stableSystemPrompt","right":{}}],"settingOnError":{"processType":1,"switch":false,"timeoutMs":180000}},"nodeMeta":{"description":"调用大语言模型,使用变量和提示词生成回复","icon":"https://lf3-static.bytednsdoc.com/obj/eden-cn/dvsmryvd_avi_dvsm/ljhwZthlaukjlkulzlp/icon/icon-LLM-v2.jpg","title":"大模型_主角首图"},"outputs":[{"input":{},"name":"desc_promopt","required":false,"type":"string"}],"settings":null,"version":"3"},"edges":null,"id":"1301843","meta":{"canvasPosition":{"x":0,"y":0},"defaultCollapsed":false,"position":{"x":-1361.9385846645896,"y":245.0241135843686}},"type":"3"},{"blocks":[],"data":{"inputs":{"apiParam":null,"inputParameters":[{"input":{"type":"string","value":{"content":{"blockID":"1301843","name":"desc_promopt","source":"block-output"},"dependencies":{"variables":null},"inputMode":"","rawMeta":{"type":1},"type":"ref"}},"left":{},"name":"desc_promopt","right":{}}],"modelSetting":{"custom_ratio":{"height":768,"width":1024},"ddim_steps":40,"images_reference":{},"model":8,"ratio":0},"prompt":{"negative_prompt":"","prompt":"{{desc_promopt}}"},"references":[],"settingOnError":{"processType":1,"switch":false,"timeoutMs":60000}},"nodeMeta":{"description":"通过文字描述/添加参考图生成图片","icon":"https://lf3-static.bytednsdoc.com/obj/eden-cn/dvsmryvd_avi_dvsm/ljhwZthlaukjlkulzlp/icon/icon-ImageGeneration-v2.jpg","title":"图像生成_主角首图"},"outputs":[{"assistType":2,"input":{},"name":"data","required":false,"type":"string"},{"input":{},"name":"msg","required":false,"type":"string"}],"settings":null,"version":""},"edges":null,"id":"1866199","meta":{"canvasPosition":{"x":0,"y":0},"defaultCollapsed":false,"position":{"x":-869.3307659335796,"y":231.84169021292212}},"type":"16"},{"blocks":[],"data":{"inputs":{"apiParam":[{"input":{"type":"string","value":{"content":"7438919188246429731","rawMeta":{"type":1},"type":"literal"}},"name":"apiID"},{"input":{"type":"string","value":{"content":"cutout","rawMeta":{"type":1},"type":"literal"}},"name":"apiName"},{"input":{"type":"string","value":{"content":"7438919188246413347","rawMeta":{"type":1},"type":"literal"}},"name":"pluginID"},{"input":{"type":"string","value":{"content":"抠图","rawMeta":{"type":1},"type":"literal"}},"name":"pluginName"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"pluginVersion"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"tips"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"outDocLink"}],"inputParameters":[{"input":{"assistType":2,"type":"string","value":{"content":{"blockID":"1866199","name":"data","source":"block-output"},"rawMeta":{"type":7},"type":"ref"}},"name":"url"},{"input":{"type":"string","value":{"content":"0","type":"literal"}},"name":"only_mask"},{"input":{"type":"string","value":{"content":"0","type":"literal"}},"name":"output_mode"}],"settingOnError":{"processType":1,"retryTimes":0,"timeoutMs":180000}},"nodeMeta":{"description":"保留图片前景主体，输出透明背景(.png)","icon":"https://lf3-static.bytednsdoc.com/obj/eden-cn/dvsmryvd_avi_dvsm/ljhwZthlaukjlkulzlp/icon/icon-plugin-cutout-v2.jpg","subtitle":"抠图:cutout","title":"cutout-扣除背景"},"outputs":[{"assistType":2,"description":"透明背景图，在输出模式为透明背景时生效","name":"data","required":false,"type":"string"},{"description":"抠图区域蒙板矢量图，在输出模式为蒙版矢量图时生效","name":"mask","required":false,"type":"string"},{"name":"msg","required":false,"type":"string"}]},"edges":null,"id":"170966","meta":{"canvasPosition":{"x":0,"y":0},"defaultCollapsed":false,"position":{"x":-297.3331029047809,"y":231.84169021292212}},"type":"4"},{"blocks":[],"data":{"inputs":{"apiParam":[{"input":{"type":"string","value":{"content":"7457837925833883688","rawMeta":{"type":1},"type":"literal"}},"name":"apiID"},{"input":{"type":"string","value":{"content":"add_images","rawMeta":{"type":1},"type":"literal"}},"name":"apiName"},{"input":{"type":"string","value":{"content":"7457837925833801768","rawMeta":{"type":1},"type":"literal"}},"name":"pluginID"},{"input":{"type":"string","value":{"content":"视频合成_剪映小助手","rawMeta":{"type":1},"type":"literal"}},"name":"pluginName"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"pluginVersion"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"tips"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"outDocLink"}],"inputDefs":[{"description":"草稿地址，使用create_draft输出的draft_url即可","input":{},"name":"draft_url","required":true,"type":"string"},{"description":"查看说明：https://krxc4izye0.feishu.cn/wiki/Pgm9wXA4EipKhYkeEQJcLBlJnWb?from=from_copylink","input":{},"name":"image_infos","required":true,"type":"string"},{"description":"x缩放","input":{},"name":"scale_x","required":false,"type":"float"},{"description":"y缩放","input":{},"name":"scale_y","required":false,"type":"float"},{"description":"移动transform_x","input":{},"name":"transform_x","required":false,"type":"float"},{"description":"移动transform_y","input":{},"name":"transform_y","required":false,"type":"float"}],"inputParameters":[{"input":{"type":"string","value":{"content":{"blockID":"168118","name":"draft_url","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"draft_url"},{"input":{"type":"string","value":{"content":{"blockID":"163547","name":"roleImgData","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"image_infos"},{"input":{"type":"float","value":{"content":2,"rawMeta":{"type":4},"type":"literal"}},"name":"scale_x"},{"input":{"type":"float","value":{"content":2,"rawMeta":{"type":4},"type":"literal"}},"name":"scale_y"}],"settingOnError":{"processType":1,"retryTimes":0,"timeoutMs":180000}},"nodeMeta":{"description":"批量添加图片","icon":"https://p6-flow-product-sign.byteimg.com/tos-cn-i-13w3uml6bg/324427c7589a426286a9774fa69f64a2~tplv-13w3uml6bg-resize:128:128.image?rk3s=2e2596fd&x-expires=1744472328&x-signature=9GXsgm2HH29uW0ihgoymUTYxCmc%3D","subtitle":"视频合成_剪映小助手:add_images","title":"添加首图角色图片"},"outputs":[{"name":"segment_infos","required":false,"schema":{"schema":[{"name":"end","required":false,"type":"integer"},{"name":"id","required":false,"type":"string"},{"name":"start","required":false,"type":"integer"}],"type":"object"},"type":"list"},{"name":"track_id","required":false,"type":"string"},{"name":"draft_url","required":false,"type":"string"},{"name":"image_ids","required":false,"schema":{"type":"string"},"type":"list"},{"name":"segment_ids","required":false,"schema":{"type":"string"},"type":"list"}]},"edges":null,"id":"1087428","meta":{"canvasPosition":{"x":0,"y":0},"defaultCollapsed":false,"position":{"x":1182.110321121601,"y":1029.3857443432134}},"type":"4"},{"blocks":[],"data":{"inputs":{"callTransferVoice":true,"chatHistoryWriting":"historyWrite","content":{"type":"string","value":{"content":"剪映草稿地址如下{{output}}","type":"literal"}},"inputParameters":[{"input":{"type":"string","value":{"content":{"blockID":"104782","name":"draft_url","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"output"}],"streamingOutput":false},"nodeMeta":{"description":"节点从“消息”更名为“输出”，支持中间过程的消息输出，支持流式和非流式两种方式","icon":"https://lf3-static.bytednsdoc.com/obj/eden-cn/dvsmryvd_avi_dvsm/ljhwZthlaukjlkulzlp/icon/icon-Output-v2.jpg","mainColor":"#5C62FF","subTitle":"输出","title":"输出"}},"edges":null,"id":"159377","meta":{"canvasPosition":{"x":0,"y":0},"defaultCollapsed":false,"position":{"x":2709.6163541318274,"y":508.16064464705335}},"type":"13"}],"versions":{"batch":"v2","loop":"v2"}}}