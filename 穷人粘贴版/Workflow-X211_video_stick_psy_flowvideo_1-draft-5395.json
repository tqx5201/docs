{"type":"coze-workflow-clipboard-data","source":{"workflowId":"7531677784520605750","spaceId":"","host":"www.coze.cn","isDouyin":false,"flowMode":0},"json":{"edges":[{"sourceNodeID":"100001","sourcePortID":"","targetNodeID":"177659"},{"sourceNodeID":"103582","sourcePortID":"","targetNodeID":"900001"},{"sourceNodeID":"136025","sourcePortID":"","targetNodeID":"152455"},{"sourceNodeID":"152455","sourcePortID":"","targetNodeID":"158360"},{"sourceNodeID":"177659","sourcePortID":"true","targetNodeID":"136025"},{"sourceNodeID":"173538","sourcePortID":"","targetNodeID":"163129"},{"sourceNodeID":"163129","sourcePortID":"","targetNodeID":"422322"},{"sourceNodeID":"159614","sourcePortID":"","targetNodeID":"173538"},{"sourceNodeID":"133547","sourcePortID":"","targetNodeID":"169595"},{"sourceNodeID":"169595","sourcePortID":"loop-output","targetNodeID":"152586"},{"sourceNodeID":"557830","sourcePortID":"","targetNodeID":"168118"},{"sourceNodeID":"168118","sourcePortID":"","targetNodeID":"125268"},{"sourceNodeID":"125268","sourcePortID":"","targetNodeID":"109941"},{"sourceNodeID":"152586","sourcePortID":"","targetNodeID":"158857"},{"sourceNodeID":"109941","sourcePortID":"","targetNodeID":"159780"},{"sourceNodeID":"159780","sourcePortID":"","targetNodeID":"154660"},{"sourceNodeID":"616043","sourcePortID":"","targetNodeID":"104782"},{"sourceNodeID":"132546","sourcePortID":"false","targetNodeID":"104782"},{"sourceNodeID":"104782","sourcePortID":"","targetNodeID":"107896"},{"sourceNodeID":"150526","sourcePortID":"","targetNodeID":"180223"},{"sourceNodeID":"180223","sourcePortID":"","targetNodeID":"180947"},{"sourceNodeID":"135409","sourcePortID":"","targetNodeID":"158201"},{"sourceNodeID":"158201","sourcePortID":"","targetNodeID":"183571"},{"sourceNodeID":"180947","sourcePortID":"","targetNodeID":"198051"},{"sourceNodeID":"158360","sourcePortID":"","targetNodeID":"154682"},{"sourceNodeID":"154682","sourcePortID":"","targetNodeID":"159614"},{"sourceNodeID":"764135","sourcePortID":"","targetNodeID":"133547"},{"sourceNodeID":"160030","sourcePortID":"","targetNodeID":"150526"},{"sourceNodeID":"154660","sourcePortID":"","targetNodeID":"135409"},{"sourceNodeID":"158857","sourcePortID":"","targetNodeID":"160030"},{"sourceNodeID":"198051","sourcePortID":"","targetNodeID":"185330"},{"sourceNodeID":"183571","sourcePortID":"","targetNodeID":"132546"},{"sourceNodeID":"177659","sourcePortID":"false","targetNodeID":"158360"},{"sourceNodeID":"132546","sourcePortID":"true","targetNodeID":"114259"},{"sourceNodeID":"114259","sourcePortID":"","targetNodeID":"604929"},{"sourceNodeID":"185330","sourcePortID":"","targetNodeID":"864795"},{"sourceNodeID":"864795","sourcePortID":"","targetNodeID":"557830"},{"sourceNodeID":"604929","sourcePortID":"","targetNodeID":"616043"},{"sourceNodeID":"107896","sourcePortID":"","targetNodeID":"103582"},{"sourceNodeID":"422322","sourcePortID":"batch-output","targetNodeID":"152899"},{"sourceNodeID":"152899","sourcePortID":"","targetNodeID":"764135"}],"nodes":[{"blocks":[],"data":{"nodeMeta":{"description":"工作流的起始节点，用于设定启动工作流需要的信息","icon":"https://lf3-static.bytednsdoc.com/obj/eden-cn/dvsmryvd_avi_dvsm/ljhwZthlaukjlkulzlp/icon/icon-Start-v2.jpg","subTitle":"","title":"开始"},"outputs":[{"description":"请输入标题，例如：羊群效应","name":"title","required":true,"type":"string"},{"defaultValue":"","description":"（可选）请输入左上角注解，例如：平台账号昵称","name":"left_top","required":false,"type":"string"},{"description":"（可选）请输入右上角注解，例如：个人观点·仅供参考","name":"right_top","required":false,"type":"string"},{"description":"（可选）text自定义字幕文案","name":"text","required":false,"type":"string"},{"name":"type","required":false,"type":"string"},{"assistType":2,"description":"（可选）","name":"logo","required":false,"type":"string"},{"defaultValue":true,"description":"是否展示图片顶部字幕（显示或者隐藏）","name":"is_show_img_keywords","required":true,"type":"boolean"},{"description":"颜色风格（彩色）","name":"style","required":true,"type":"string"},{"description":"音色：（邻家女孩）","name":"vo_type","required":true,"type":"string"}],"trigger_parameters":[{"description":"请输入标题，例如：羊群效应","name":"title","required":true,"type":"string"},{"description":"（可选）请输入左上角注解，例如：平台账号昵称","name":"left_top","required":false,"type":"string"},{"description":"（可选）请输入右上角注解，例如：个人观点·仅供参考","name":"right_top","required":false,"type":"string"},{"description":"（可选）text自定义字幕文案","name":"text","required":false,"type":"string"},{"name":"type","required":false,"type":"string"},{"assistType":2,"description":"（可选）","name":"logo","required":false,"type":"string"},{"description":"是否展示图片顶部字幕（显示或者隐藏）","name":"is_show_img_keywords","required":true,"type":"boolean"},{"description":"颜色风格（彩色）","name":"style","required":true,"type":"string"},{"description":"音色：（邻家女孩）","name":"vo_type","required":true,"type":"string"}]},"edges":null,"id":"100001","meta":{"position":{"x":-6043.459574993857,"y":-777.0760885205722}},"type":"1"},{"blocks":[],"data":{"inputs":{"inputParameters":[{"input":{"type":"string","value":{"content":{"blockID":"107896","name":"Group1","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"draft_url"},{"input":{"type":"string","value":{"content":{"blockID":"100001","name":"title","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"title"}],"terminatePlan":"returnVariables"},"nodeMeta":{"description":"工作流的最终节点，用于返回工作流运行后的结果信息","icon":"https://lf3-static.bytednsdoc.com/obj/eden-cn/dvsmryvd_avi_dvsm/ljhwZthlaukjlkulzlp/icon/icon-End-v2.jpg","subTitle":"","title":"结束"}},"edges":null,"id":"900001","meta":{"position":{"x":6934.279115084298,"y":436.72183963823835}},"type":"2"},{"blocks":[],"data":{"inputs":{"inputParameters":[{"input":{"type":"string","value":{"content":{"blockID":"100001","name":"title","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"title"}],"llmParam":[{"input":{"type":"string","value":{"content":"default_val","rawMeta":{"type":1},"type":"literal"}},"name":"generationDiversity"},{"input":{"type":"float","value":{"content":"0.8","rawMeta":{"type":4},"type":"literal"}},"name":"temperature"},{"input":{"type":"integer","value":{"content":"16068","rawMeta":{"type":2},"type":"literal"}},"name":"maxTokens"},{"input":{"type":"integer","value":{"content":"2","rawMeta":{"type":2},"type":"literal"}},"name":"responseFormat"},{"input":{"type":"string","value":{"content":"DeepSeek-V3-0324","rawMeta":{"type":1},"type":"literal"}},"name":"modleName"},{"input":{"type":"integer","value":{"content":"1742989917","rawMeta":{"type":2},"type":"literal"}},"name":"modelType"},{"input":{"type":"string","value":{"content":"请以“{{title}}”作为心理主题方向\n","rawMeta":{"type":1},"type":"literal"}},"name":"prompt"},{"input":{"type":"boolean","value":{"content":false,"rawMeta":{"type":3},"type":"literal"}},"name":"enableChatHistory"},{"input":{"type":"integer","value":{"content":"3","rawMeta":{"type":2},"type":"literal"}},"name":"chatHistoryRound"},{"input":{"type":"string","value":{"content":"# 角色\n心理学知识分享博主，作为心理学知识分享博主，善于通过理论解读和案例分析，帮助读者理解心理现象背后的原理，用通俗易懂的方式呈现心理学的智慧。\n你是一个专门制作以火柴人形式呈现心理知识相关视频内容的专家。\n\n\n## 技能  创作心理学科普文案\n-目标：依据用户提供的心理主题方向，创作具有启发性和实用性的的心理科普文章\n-文章结构：采用总分结构，开篇引出主题，分段阐述心理学理论与实际应用，结合案例进行说明，结尾总结要点并提供行动建议。\n-案例生动呈现：选取贴近生活的案例，从情境描述、心理分析、应对策略等维度展开多角度剖析。\n-语言风格：保持专业性和通俗性平衡，关键理论突出解释，专业术语配合括号解释，段落间逻辑清晰。\n-论证方式：采用经典心理学理论框架，注重理论与实践结合，避免过度 简化或夸大。\n同样的话不要 反复说，不要重复\n输出格式：采用合理长短句结构，不需要有数字分段，直接输出文章内容，标题和1个核心关键词。\n- 字数300字以内\n{\n     \"title\":<标题>,\n     \"cap\":<关键词>,\n     \"content\":<文章内容>\n}\n\n## 限制\n-严格依据用户提供的标题和内容进行撰写，不得偏离主题。\n-输出不需要输出语气词，只需要输出口播的稿件，其他不需要输出。带有（）的语气词不需要输出。\n-内容中可适当引用经典心理学理论或案例，增强论证的说服力，但要避免过度堆砌理论知识。\n-使用专业术语时要配合简洁明了的解释，确保听众容易理解，避免出现晦涩难懂的表述  \n-严禁使用未经科学验证的心理理论","rawMeta":{"type":1},"type":"literal"}},"name":"systemPrompt"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"stableSystemPrompt"},{"input":{"type":"boolean","value":{"content":false,"rawMeta":{"type":3},"type":"literal"}},"name":"canContinue"}],"settingOnError":{"processType":1,"retryTimes":0,"switch":false,"timeoutMs":600000}},"nodeMeta":{"description":"调用大语言模型,使用变量和提示词生成回复","icon":"https://lf3-static.bytednsdoc.com/obj/eden-cn/dvsmryvd_avi_dvsm/ljhwZthlaukjlkulzlp/icon/icon-LLM-v2.jpg","subTitle":"大模型","title":"大模型_心理学视频文案"},"outputs":[{"name":"title","required":false,"type":"string"},{"name":"content","required":false,"type":"string"},{"name":"cap","required":false,"type":"string"}],"version":"3"},"edges":null,"id":"152455","meta":{"position":{"x":-4603.995657965912,"y":-1070.8360862729412}},"type":"3"},{"blocks":[],"data":{"inputs":{"callTransferVoice":true,"chatHistoryWriting":"historyWrite","content":{"type":"string","value":{"content":"正在生成文案...","type":"literal"}},"inputParameters":[],"streamingOutput":false},"nodeMeta":{"description":"节点从“消息”更名为“输出”，支持中间过程的消息输出，支持流式和非流式两种方式","icon":"https://lf3-static.bytednsdoc.com/obj/eden-cn/dvsmryvd_avi_dvsm/ljhwZthlaukjlkulzlp/icon/icon-Output-v2.jpg","mainColor":"#5C62FF","subTitle":"输出","title":"输出"}},"edges":null,"id":"136025","meta":{"position":{"x":-5063.995657965912,"y":-847.5618896865407}},"type":"13"},{"blocks":[],"data":{"inputs":{"callTransferVoice":true,"chatHistoryWriting":"historyWrite","content":{"type":"string","value":{"content":"正在生成画面配图...","type":"literal"}},"inputParameters":[],"streamingOutput":false},"nodeMeta":{"description":"节点从“消息”更名为“输出”，支持中间过程的消息输出，支持流式和非流式两种方式","icon":"https://lf3-static.bytednsdoc.com/obj/eden-cn/dvsmryvd_avi_dvsm/ljhwZthlaukjlkulzlp/icon/icon-Output-v2.jpg","mainColor":"#5C62FF","subTitle":"输出","title":"输出_1"}},"edges":null,"id":"163129","meta":{"position":{"x":-2753.5008914688265,"y":-776.1368896865409}},"type":"13"},{"blocks":[],"data":{"inputs":{"inputParameters":[{"input":{"type":"string","value":{"content":{"blockID":"158360","name":"content","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"content"},{"input":{"type":"string","value":{"content":{"blockID":"158360","name":"title","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"title"},{"input":{"type":"string","value":{"content":{"blockID":"159614","name":"llm_prompt","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"llm_prompt"}],"llmParam":[{"input":{"type":"string","value":{"content":"default_val","rawMeta":{"type":1},"type":"literal"}},"name":"generationDiversity"},{"input":{"type":"float","value":{"content":"1","rawMeta":{"type":4},"type":"literal"}},"name":"temperature"},{"input":{"type":"integer","value":{"content":"16384","rawMeta":{"type":2},"type":"literal"}},"name":"maxTokens"},{"input":{"type":"integer","value":{"content":"2","rawMeta":{"type":2},"type":"literal"}},"name":"responseFormat"},{"input":{"type":"string","value":{"content":"DeepSeek-V3-0324","rawMeta":{"type":1},"type":"literal"}},"name":"modleName"},{"input":{"type":"integer","value":{"content":"1742989917","rawMeta":{"type":2},"type":"literal"}},"name":"modelType"},{"input":{"type":"string","value":{"content":"心理学科普内容：\n{{content}}","rawMeta":{"type":1},"type":"literal"}},"name":"prompt"},{"input":{"type":"boolean","value":{"content":false,"rawMeta":{"type":3},"type":"literal"}},"name":"enableChatHistory"},{"input":{"type":"integer","value":{"content":"3","rawMeta":{"type":2},"type":"literal"}},"name":"chatHistoryRound"},{"input":{"type":"string","value":{"content":"# 角色\n你是一位专业且富有创意的视频分镜描述专家，专注于火柴人风格的心理学视频分镜创作，能够将心理学科普文章转化为生动、形象且符合极简风格要求的视频分镜描述。\n\n## 技能\n### 技能 1: 创作视频分镜描述\n1. 仔细研读用户提供的心理学科普文章内容，全面理解其中的心理学知识、情节以及人物情绪等关键要素。\n2. 按照要求创作心理学视频分镜描述，确保：\n    - 字幕文案分段：每个段落均由一句话构成，语句简洁明了，表达清晰流畅，同时具备节奏感。\n    - 分镜描述：画面呈现极简风格，清晰直观。画面描述要精准、细致地体现情节细节以及人物情绪等方面。\n    - 字幕文案必须严格按照用户给的文案拆分，不能禁止严禁修改提供的内容\n    - 至少8个分镜， 不超过50个分镜\n### 技能 2: 生成分镜图像提示词\n依据分镜描述，生成对应的[分镜图像提示词]，需严格遵循以下要求：\n{{llm_prompt}}\n\n### 技能3：生成分镜关键词\n输出desc_keywords关键词信息，根据分镜及完整视频文案，提供当前分镜合理的视频关键词，用于动态显示在视频上，如果当前分镜不适合显示关键词，就可以不提供，关键词可以是多个词语，每个词不超过4个字，最多3个词，关键词不允许重复\n\n### 技能 4: 输出 JSON 格式内容\n将生成的内容按照 JSON 格式输出，具体格式如下：\n[\n{\n    \"story_name\":\"分镜名称\",\n    \"desc\":\"分镜描述\",\n    \"cap\":\"对应字幕文案\",\n    \"desc_keywords\":[\"关键词1\",\"关键词2\"],\n    \"desc_promopt\":\"分镜图像提示词\"\n}\n]\n\n## 限制\n- 视频文案及分镜描述必须保持一致，且整个视频内容需以火柴人形式呈现。\n- 输出内容必须严格按照给定的 JSON 格式进行组织，不得偏离框架要求。\n- 只对用户提示的内容进行分镜，不能更改原文\n- desc_keywords关键词不允许重复，且要贴合分镜语境","rawMeta":{"type":1},"type":"literal"}},"name":"systemPrompt"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"stableSystemPrompt"},{"input":{"type":"boolean","value":{"content":false,"rawMeta":{"type":3},"type":"literal"}},"name":"canContinue"}],"settingOnError":{"processType":1,"retryTimes":0,"switch":false,"timeoutMs":600000}},"nodeMeta":{"description":"调用大语言模型,使用变量和提示词生成回复","icon":"https://lf3-static.bytednsdoc.com/obj/eden-cn/dvsmryvd_avi_dvsm/ljhwZthlaukjlkulzlp/icon/icon-LLM-v2.jpg","subTitle":"大模型","title":"大模型_分镜画面描述"},"outputs":[{"name":"list","required":false,"schema":{"schema":[{"name":"story_name","type":"string"},{"name":"desc","type":"string"},{"name":"cap","type":"string"},{"name":"desc_promopt","type":"string"},{"name":"desc_keywords","schema":{"type":"string"},"type":"list"}],"type":"object"},"type":"list"}],"version":"3"},"edges":null,"id":"173538","meta":{"position":{"x":-3223.995657965909,"y":-802.1368896865409}},"type":"3"},{"blocks":[{"blocks":[],"data":{"inputs":{"apiParam":[{"input":{"type":"string","value":{"content":"7426655854067367946","rawMeta":{"type":1},"type":"literal"}},"name":"apiID"},{"input":{"type":"string","value":{"content":"speech_synthesis","rawMeta":{"type":1},"type":"literal"}},"name":"apiName"},{"input":{"type":"string","value":{"content":"7426655854067351562","rawMeta":{"type":1},"type":"literal"}},"name":"pluginID"},{"input":{"type":"string","value":{"content":"语音合成","rawMeta":{"type":1},"type":"literal"}},"name":"pluginName"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"pluginVersion"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"tips"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"outDocLink"}],"inputDefs":[{"defaultValue":"爽快思思/Skye","description":"音色ID，默认为爽快思思/Skye。详细音色列表参考 https://bytedance.larkoffice.com/docx/WdDOdiB1BoRyBNxlkXWcn0n3nLc, default value is 爽快思思/Skye","input":{},"name":"speaker_id","required":false,"type":"string"},{"defaultValue":1,"description":"语速，范围是[0.2,3]，默认为1，通常保留一位小数即可, default value is 1","input":{},"name":"speed_ratio","required":false,"type":"float"},{"description":"要合成音频的文本内容","input":{},"name":"text","required":true,"type":"string"},{"assistType":12,"description":"voice id","input":{},"name":"voice_id","required":false,"type":"string"},{"description":"语音语种，非必填，参考 https://bytedance.larkoffice.com/docx/WdDOdiB1BoRyBNxlkXWcn0n3nLc","input":{},"name":"language","required":false,"type":"string"}],"inputParameters":[{"input":{"type":"string","value":{"content":{"blockID":"169595","name":"input.cap","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"text"},{"input":{"type":"string","value":{"content":{"blockID":"152899","name":"speakerid","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"speaker_id"},{"input":{"type":"float","value":{"content":1.2,"rawMeta":{"type":4},"type":"literal"}},"name":"speed_ratio"}],"settingOnError":{"processType":1,"retryTimes":0,"timeoutMs":180000}},"nodeMeta":{"description":"根据音色和文本合成音频","icon":"https://lf3-static.bytednsdoc.com/obj/eden-cn/dvsmryvd_avi_dvsm/ljhwZthlaukjlkulzlp/icon/icon-Plugin-v2.jpg","subtitle":"语音合成:speech_synthesis","title":"speech_synthesis"},"outputs":[{"name":"log_id","required":false,"type":"string"},{"name":"msg","required":false,"type":"string"},{"name":"code","required":false,"type":"float"},{"name":"data","required":false,"schema":[{"name":"link","required":false,"type":"string"}],"type":"object"}]},"edges":null,"id":"122703","meta":{"position":{"x":180,"y":0}},"type":"4"},{"blocks":[],"data":{"inputs":{"apiParam":[{"input":{"type":"string","value":{"content":"7474863657353117750","rawMeta":{"type":1},"type":"literal"}},"name":"apiID"},{"input":{"type":"string","value":{"content":"get_audio_duration","rawMeta":{"type":1},"type":"literal"}},"name":"apiName"},{"input":{"type":"string","value":{"content":"7457837925833801768","rawMeta":{"type":1},"type":"literal"}},"name":"pluginID"},{"input":{"type":"string","value":{"content":"视频合成_剪映小助手","rawMeta":{"type":1},"type":"literal"}},"name":"pluginName"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"pluginVersion"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"tips"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"outDocLink"}],"inputDefs":[{"description":"音频链接","input":{},"name":"mp3_url","required":true,"type":"string"}],"inputParameters":[{"input":{"type":"string","value":{"content":{"blockID":"122703","name":"data.link","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"mp3_url"}],"settingOnError":{"processType":1,"retryTimes":0,"timeoutMs":180000}},"nodeMeta":{"description":"获取音频时长","icon":"https://lf3-static.bytednsdoc.com/obj/eden-cn/dvsmryvd_avi_dvsm/ljhwZthlaukjlkulzlp/icon/icon-Plugin-v2.jpg","subtitle":"视频合成_剪映小助手:get_audio_duration","title":"get_audio_duration"},"outputs":[{"name":"message","required":false,"type":"string"},{"name":"duration","required":false,"type":"integer"}]},"edges":null,"id":"199916","meta":{"position":{"x":640,"y":0}},"type":"4"}],"data":{"inputs":{"inputParameters":[{"input":{"schema":{"schema":[{"name":"story_name","type":"string"},{"name":"desc","type":"string"},{"name":"cap","type":"string"},{"name":"desc_promopt","type":"string"},{"name":"desc_keywords","schema":{"type":"string"},"type":"list"}],"type":"object"},"type":"list","value":{"content":{"blockID":"173538","name":"list","source":"block-output"},"rawMeta":{"type":103},"type":"ref"}},"name":"input"}],"loopCount":{"type":"integer","value":{"content":"10","type":"literal"}},"loopType":"array","variableParameters":[]},"nodeMeta":{"description":"用于通过设定循环次数和逻辑，重复执行一系列任务","icon":"https://lf3-static.bytednsdoc.com/obj/eden-cn/dvsmryvd_avi_dvsm/ljhwZthlaukjlkulzlp/icon/icon-Loop-v2.jpg","mainColor":"#00B2B2","subTitle":"循环","title":"循环"},"outputs":[{"input":{"schema":{"type":"string"},"type":"list","value":{"content":{"blockID":"122703","name":"data.link","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"output"},{"input":{"schema":{"type":"integer"},"type":"list","value":{"content":{"blockID":"199916","name":"duration","source":"block-output"},"rawMeta":{"type":2},"type":"ref"}},"name":"duration_list"}]},"edges":[{"sourceNodeID":"169595","sourcePortID":"loop-function-inline-output","targetNodeID":"122703"},{"sourceNodeID":"122703","sourcePortID":"","targetNodeID":"199916"},{"sourceNodeID":"199916","sourcePortID":"","targetNodeID":"169595","targetPortID":"loop-function-inline-input"}],"id":"169595","meta":{"canvasPosition":{"x":-488.061783954838,"y":-246.48756325697366},"position":{"x":66.0043420340904,"y":-789.1368896865409}},"type":"21"},{"blocks":[],"data":{"inputs":{"apiParam":[{"input":{"type":"string","value":{"content":"7457837955684515874","rawMeta":{"type":1},"type":"literal"}},"name":"apiID"},{"input":{"type":"string","value":{"content":"create_draft","rawMeta":{"type":1},"type":"literal"}},"name":"apiName"},{"input":{"type":"string","value":{"content":"7457837925833801768","rawMeta":{"type":1},"type":"literal"}},"name":"pluginID"},{"input":{"type":"string","value":{"content":"视频合成_剪映小助手","rawMeta":{"type":1},"type":"literal"}},"name":"pluginName"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"pluginVersion"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"tips"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"outDocLink"}],"inputDefs":[{"description":"高","input":{},"name":"height","required":false,"type":"integer"},{"description":"关联创作者","input":{},"name":"user_id","required":false,"type":"integer"},{"description":"宽","input":{},"name":"width","required":false,"type":"integer"}],"inputParameters":[{"input":{"type":"integer","value":{"content":1080,"rawMeta":{"type":2},"type":"literal"}},"name":"height"},{"input":{"type":"integer","value":{"content":1262,"rawMeta":{"type":2},"type":"literal"}},"name":"user_id"},{"input":{"type":"integer","value":{"content":1920,"rawMeta":{"type":2},"type":"literal"}},"name":"width"}],"settingOnError":{"processType":1,"retryTimes":0,"timeoutMs":180000}},"nodeMeta":{"description":"插件入口-创建草稿","icon":"https://lf3-static.bytednsdoc.com/obj/eden-cn/dvsmryvd_avi_dvsm/ljhwZthlaukjlkulzlp/icon/icon-Plugin-v2.jpg","subtitle":"视频合成_剪映小助手:create_draft","title":"create_draft"},"outputs":[{"name":"draft_url","required":false,"type":"string"},{"name":"tip_url","required":false,"type":"string"}]},"edges":null,"id":"168118","meta":{"position":{"x":3482.3027487482677,"y":-762.7103482356168}},"type":"4"},{"blocks":[],"data":{"inputs":{"apiParam":[{"input":{"type":"string","value":{"content":"7457837925833834536","rawMeta":{"type":1},"type":"literal"}},"name":"apiID"},{"input":{"type":"string","value":{"content":"add_audios","rawMeta":{"type":1},"type":"literal"}},"name":"apiName"},{"input":{"type":"string","value":{"content":"7457837925833801768","rawMeta":{"type":1},"type":"literal"}},"name":"pluginID"},{"input":{"type":"string","value":{"content":"视频合成_剪映小助手","rawMeta":{"type":1},"type":"literal"}},"name":"pluginName"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"pluginVersion"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"tips"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"outDocLink"}],"inputDefs":[{"description":"[{\"audio_url\": \"http://example.com/audio1.mp3\",\"duration\":120,\"start\":0,\"end\":12000000,\"audio_effect\":\"教堂\"}]","input":{},"name":"audio_infos","required":true,"type":"string"},{"description":"草稿地址，使用create_draft输出的draft_url即可","input":{},"name":"draft_url","required":true,"type":"string"}],"inputParameters":[{"input":{"type":"string","value":{"content":{"blockID":"180223","name":"infos","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"audio_infos"},{"input":{"type":"string","value":{"content":{"blockID":"168118","name":"draft_url","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"draft_url"}],"settingOnError":{"processType":1,"retryTimes":0,"timeoutMs":180000}},"nodeMeta":{"description":"批量添加音频","icon":"https://lf3-static.bytednsdoc.com/obj/eden-cn/dvsmryvd_avi_dvsm/ljhwZthlaukjlkulzlp/icon/icon-Plugin-v2.jpg","subtitle":"视频合成_剪映小助手:add_audios","title":"add_audios"},"outputs":[{"name":"audio_ids","required":false,"schema":{"type":"string"},"type":"list"},{"name":"draft_url","required":false,"type":"string"},{"name":"track_id","required":false,"type":"string"}]},"edges":null,"id":"125268","meta":{"position":{"x":3461.632564805189,"y":-572.0534596324964}},"type":"4"},{"blocks":[],"data":{"inputs":{"code":"// 在这里，您可以通过 ‘params’  获取节点中的输入变量，并通过 'ret' 输出结果\n// 'params' 和 'ret' 已经被正确地注入到环境中\n// 下面是一个示例，获取节点输入中参数名为‘input’的值：\n// const input = params.input; \n// 下面是一个示例，输出一个包含多种数据类型的 'ret' 对象：\n// const ret = { \"name\": ‘小明’, \"hobbies\": [“看书”, “旅游”] };\nasync function main({ params }: Args): Promise<Output> {\n    const { image_list, list, audio_list, duration_list, bg_image } = params;\n\n    // 处理音频数据\n    const audioData = [];\n    let audioStartTime = 0;\n    const videoTimelines = [];\n    let maxDuration = 0;\n\n    for (let i = 0; i < audio_list.length && i < duration_list.length; i++) {\n        const duration = duration_list[i];\n        audioData.push({\n            audio_url: audio_list[i],\n            duration,\n            start: audioStartTime,\n            end: audioStartTime + duration,\n            audio_effect: \"教学\"\n        });\n        videoTimelines.push({\n            start: audioStartTime,\n            end: audioStartTime + duration\n        });\n        audioStartTime += duration;\n        maxDuration = audioStartTime;\n    }\n\n    // 处理图片数据\n    const imageData = [];\n   \n    // const imgData = processImageSequence(image_list, duration_list);\n    \n    // 使用示例\n    const scheduler = new AnimationScheduler();\n\n    // 配置为顺序模式\n    // configure({\n    //     mode: ANIMATION_MODES.SEQUENTIAL,\n    //     animationPreset: 'SEQUENCE'\n    // });\n    \n    // // 示例1：创建对称动画布局\n    // configure({\n    //     mode: ANIMATION_MODES.SYMMETRIC,\n    //     animationPreset: 'SYMMETRIC',\n    //     symmetricPairing: 'LR', // 左右对称配对\n    //     trackWeights: { left: 2, middle: 1, right: 2 } // 增加左右轨道权重\n    // });\n\n  \n    // 示例3：完全随机模式配置\n    // configure({\n    //     mode: ANIMATION_MODES.RANDOM,\n    //     animationPreset: 'RANDOM',\n    //     overlapTolerance: 0.6,      // 允许更多重叠\n    //     groupSyncThreshold: 3       // 每5个元素形成一组\n    // });\n\n    // // 示例4：自定义顺序模式\n    // configure({\n    //     mode: ANIMATION_MODES.SEQUENTIAL,\n    //     sequentialOrder: ['middle', 'left', 'right'], // 自定义播放顺序\n    //     trackWeights: { left: 1, middle: 3, right: 1 } // 中间轨道权重最高\n    // });\n    const type = params.type;\n    if(type == \"中心聚焦模式\"){\n        // 示例2：配置中心聚焦模式\n        // configure({\n        //     mode: ANIMATION_MODES.CENTER_FOCUS,\n        //     animationPreset: 'FOCUS',\n        //     durationSettings: {\n        //         baseExtension: 800000,  // 扩展800ms\n        //         minDuration: 1500000    // 最小1500ms\n        //     }\n        // });\n    }else if(type==\"随机模式\"){\n        // 示例3：完全随机模式配置\n        // configure({\n        //     mode: ANIMATION_MODES.RANDOM,\n        //     animationPreset: 'RANDOM',\n        //     overlapTolerance: 0.6,      // 允许更多重叠\n        //     groupSyncThreshold: 3       // 每5个元素形成一组\n        // });\n    } else if(type==\"对称布局模式\"){\n        // 示例1：创建对称动画布局\n        // configure({\n        //     mode: ANIMATION_MODES.SYMMETRIC,\n        //     animationPreset: 'SYMMETRIC',\n        //     symmetricPairing: 'LR', // 左右对称配对\n        //     trackWeights: { left: 2, middle: 1, right: 2 } // 增加左右轨道权重\n        // });\n    } else{\n        // 默认顺序模式\n    }\n\n\n    // 处理图片序列\n    const imgData = scheduler.process(image_list,duration_list);\n\n   \n    // 处理背景图片\n    const bgImageData = [\n        {\n            image_url: bg_image,\n            width: 1920,\n            height: 1080,\n            start: 0,\n            end: maxDuration + 600000\n        }\n    ];\n\n    // 处理字幕数据\n    const captions = list.map(item => item.cap);\n    const subtitleDurations = duration_list;\n\n    const processedSubtitles = [];\n    const processedSubtitleDurations = [];\n\n    for (let i = 0; i < captions.length; i++) {\n        const text = captions[i];\n        const totalDuration = subtitleDurations[i];\n\n        const subtitles = text.split(/[，。！,!?]/).filter(part => part.trim() !== '');\n        const subtitleCount = subtitles.length;\n\n        if (subtitleCount > 0) {\n            const perSubtitleDuration = totalDuration / subtitleCount;\n            for (let j = 0; j < subtitleCount; j++) {\n                processedSubtitles.push(subtitles[j]);\n                processedSubtitleDurations.push(perSubtitleDuration);\n            }\n        } else {\n            processedSubtitles.push(text);\n            processedSubtitleDurations.push(totalDuration);\n        }\n    }\n\n    // 处理字幕时间线\n    const textTimelines = [];\n    let textStartTime = 0;\n\n    for (const duration of processedSubtitleDurations) {\n        const endTime = textStartTime + duration;\n        textTimelines.push({\n            start: textStartTime,\n            end: endTime\n        });\n        textStartTime = endTime;\n    }\n\n    \n    // 构建输出对象\n    const result = {\n        audio_list: JSON.stringify(audioData),\n        image_list: JSON.stringify(imageData),\n        timelines: videoTimelines,\n        text_timelines: textTimelines,\n        text_cap: processedSubtitles,\n        max_time: maxDuration,\n        bg_image: JSON.stringify(bgImageData),\n        imageDataLeft:JSON.stringify(imgData.left),\n        imageDataRight:JSON.stringify(imgData.right),\n        imageDataMiddle:JSON.stringify(imgData.middle),\n        imgData: imgData\n    };\n\n    return result;\n}\n\n\n\n/*\n * 入场动画预设池\n * 说明：定义不同布局模式下的可用动画类型组合\n * 结构：模式名 -> 轨道位置 -> 可选的动画类型数组\n */\nconst ANIMATION_PRESETS = {\n    // 顺序模式预设：左中右轨道使用不同动画组合\n    SEQUENCE: {\n        left: [\"向右滑动\", \"放大\"],       // 左轨道可选动画\n        middle: [\"向上滑动\", \"放大\"],     // 中间轨道可选动画\n        right: [\"向左滑动\", \"向左转入\"]    // 右轨道可选动画\n    },\n    // 中心聚焦模式预设：中间轨道优先配置\n    FOCUS: {\n        middle: [\"放大\", \"向上滑动\"],     // 中间轨道使用更突出的动画\n        left: [\"向右滑动\", \"放大\"],\n        right: [\"向左滑动\", \"向左转入\"]\n    },\n    // 对称模式预设：左右轨道使用对称动画组合\n    SYMMETRIC: {\n        left: [\"向右滑动\", \"放大\"],\n        right: [\"向左滑动\", \"向左转入\"],\n        middle: [\"向上滑动\", \"放大\"],\n    },\n    // 随机模式预设：所有位置共享动画池\n    RANDOM: {\n        all: [\"向右滑动\", \"放大\", \"向下滑动\",\"向左转入\"] // 全轨道共用动画池\n    }\n};\n\n/*\n * 动画模式枚举\n * 说明：定义不同的动画调度策略模式\n */\nconst ANIMATION_MODES = {\n    SEQUENTIAL: 'sequential',    // 顺序模式：按指定顺序播放\n    CENTER_FOCUS: 'center',      // 中心聚焦模式：中间元素优先\n    SYMMETRIC: 'symmetric',      // 对称模式：左右对称播放\n    RANDOM: 'random'             // 随机模式：完全随机选择\n};\n\n/*\n * 全局配置参数\n * 示例用法：\n * configure({\n *   mode: ANIMATION_MODES.SYMMETRIC,\n *   animationPreset: 'SYMMETRIC',\n *   trackWeights: { left: 2, middle: 1, right: 2 }\n * })\n */\nconst CONFIG = {\n    mode: ANIMATION_MODES.SEQUENTIAL, // 动画调度模式（默认顺序模式）\n    animationPreset: 'SEQUENCE',       // 使用的动画预设名称\n    trackWeights: { left: 1, middle: 1, right: 1 }, // 轨道选择权重（中间轨道权重更高）\n    overlapTolerance: 1,            // 重叠容忍度（0-1，值越大允许更多重叠）\n    groupSyncThreshold: 3,            // 组同步阈值（元素数量达到阈值后同步）\n    sequentialOrder: ['left', 'middle', 'right'], // 顺序模式的播放顺序\n    symmetricPairing: 'LR',           // 对称模式配对方式（LR: 左右对称 / LMR: 包含中间）\n    durationSettings: {               // 时长相关配置\n        unit: 1,                      // 时间单位系数（示例：1表示1ms）\n        baseExtension: 500000,        // 基础时长扩展（500ms）\n        minDuration: 1000000,         // 最小持续时间（1000ms）\n        groupRatio: 1.8               // 组时长比例系数\n    }\n};\n\n// 核心处理器\nclass AnimationScheduler {\n    constructor() {\n        this.tracks = { left: [], middle: [], right: [] };\n        this.timeWindows = [];\n        this.groups = [];\n        this.currentGroup = null;\n    }\n\n    process(imageList, durationList) {\n        imageList.forEach((img, idx) => {\n            this._processImage(img, idx, durationList);\n        });\n        this._postProcess();\n        return this._formatOutput();\n    }\n\n    _processImage(image, index, durations) {\n        const start = this._getStartTime(index, durations);\n        const originalDuration = durations[index] * CONFIG.durationSettings.unit;\n        \n        this._createGroupIfNeeded(index);\n        \n        const track = this._selectTrack(start, originalDuration);\n        const { endTime, groupEnd } = this._calculateTiming(start, originalDuration);\n        \n        const animation = this._selectAnimation(track);\n        const item = this._createItem(image, track, start, endTime, animation);\n        \n        this._updateState(item, groupEnd);\n    }\n\n    _createGroupIfNeeded(index) {\n        let shouldCreate = false;\n        \n        // 顺序模式专用分组逻辑\n        if (CONFIG.mode === ANIMATION_MODES.SEQUENTIAL) {\n            const groupSize = CONFIG.sequentialOrder.length;\n            shouldCreate = (index % groupSize === 0) || (this.groups.length === 0);\n        } \n        // 其他模式原有逻辑\n        else {\n            shouldCreate = \n                index % 3 === 0 || \n                (CONFIG.mode === ANIMATION_MODES.SYMMETRIC && index % 2 === 0) ||\n                this.groups.length === 0;\n        }\n\n        if (shouldCreate) {\n            this.currentGroup = {\n                items: [],\n                animationType: this._getGroupAnimationType(),\n                endTime: 0\n            };\n            this.groups.push(this.currentGroup);\n        }\n    }\n\n\n    _getGroupAnimationType() {\n        const preset = ANIMATION_PRESETS[CONFIG.animationPreset];\n        switch(CONFIG.mode) {\n            case ANIMATION_MODES.SEQUENTIAL:\n                return {\n                    left: this._randomPick(preset.left),\n                    middle: this._randomPick(preset.middle),\n                    right: this._randomPick(preset.right)\n                };\n            case ANIMATION_MODES.CENTER_FOCUS:\n                return {\n                    middle: this._randomPick(preset.middle),\n                    left: this._randomPick(preset.left),\n                    right: this._randomPick(preset.right)\n                };\n            case ANIMATION_MODES.SYMMETRIC:\n                return CONFIG.symmetricPairing === 'LR' ? {\n                    left: this._randomPick(preset.left),\n                    right: this._randomPick(preset.right)\n                } : {\n                    left: this._randomPick(preset.left),\n                    middle: this._randomPick(preset.middle),\n                    right: this._randomPick(preset.right)\n                };\n            case ANIMATION_MODES.RANDOM:\n                return { all: this._randomPick(preset.all) };\n            default:\n                throw new Error('未知动画模式');\n        }\n    }\n\n    _selectTrack(start, duration) {\n        // 新增顺序模式专用处理逻辑\n        if (CONFIG.mode === ANIMATION_MODES.SEQUENTIAL) {\n            const groupSize = CONFIG.sequentialOrder.length;\n            const positionInGroup = this.currentGroup.items.length % groupSize;\n            const targetTrack = CONFIG.sequentialOrder[positionInGroup];\n            \n            // 强制等待机制：如果当前轨道冲突，延迟到下一个可用时间点\n            const lastInTrack = [...this.tracks[targetTrack]].pop();\n            if (lastInTrack && lastInTrack.end > start) {\n                start = lastInTrack.end + 100000; // 增加100ms间隔\n            }\n            \n            return targetTrack;\n        }\n\n        // 保留其他模式的原有逻辑\n        const candidates = Object.keys(this.tracks).map(track => ({\n            track,\n            score: this._calculateTrackScore(track, start, start + duration)\n        }));\n        return candidates.sort((a, b) => b.score - a.score)[0].track;\n    }\n    _fallbackToOriginalLogic(start, duration) {\n        const candidates = Object.keys(this.tracks).map(track => ({\n            track,\n            score: this._calculateTrackScore(track, start, start + duration)\n        }));\n        return candidates.sort((a, b) => b.score - a.score)[0].track;\n    }\n\n    _calculateTrackScore(track, start, end) {\n        const overlapCount = this.tracks[track]\n            .filter(item => item.end > start && item.start < end)\n            .length;\n        \n        const recentUsage = this.tracks[track]\n            .filter(item => item.end > start - 500000)\n            .length;\n        \n        const weights = {\n            availability: overlapCount === 0 ? 400 : 0,\n            overlap: -overlapCount * 150,\n            recent: -recentUsage * 50,\n            configWeight: CONFIG.trackWeights[track] * 200,\n            random: Math.random() * 100\n        };\n        \n        return Object.values(weights).reduce((sum, val) => sum + val, 0);\n    }\n\n    _calculateTiming(start, originalDuration) {\n        const baseEnd = start + originalDuration;\n        let endTime = baseEnd + CONFIG.durationSettings.baseExtension;\n        \n        // 顺序模式强制组同步\n        if (CONFIG.mode === ANIMATION_MODES.SEQUENTIAL) {\n            // 始终保证最小持续时间\n            const minEnd = start + CONFIG.durationSettings.minDuration;\n            endTime = Math.max(endTime, minEnd);\n\n            // 动态扩展组持续时间\n            if (this.currentGroup.items.length > 0) {\n                // 取当前元素需要的结束时间和组现有结束时间的较大者\n                endTime = Math.max(endTime, this.currentGroup.endTime);\n            }\n            \n            // 更新组结束时间为当前最大值\n            this.currentGroup.endTime = Math.max(this.currentGroup.endTime || 0, endTime);\n            endTime = this.currentGroup.endTime;\n        } else {\n            // 保留原有逻辑\n            if (this.currentGroup.items.length > 0) {\n                const lastItem = this.currentGroup.items[this.currentGroup.items.length - 1];\n                endTime = Math.max(endTime, lastItem.end);\n            }\n            \n            endTime = Math.max(\n                endTime,\n                start + CONFIG.durationSettings.minDuration\n            );\n        }\n        \n        return {\n            endTime,\n            groupEnd: CONFIG.mode === ANIMATION_MODES.SYMMETRIC ? endTime : null\n        };\n    }\n\n    _createItem(image, track, start, end, animation) {\n        return {\n            image_url: image,\n            in_animation: animation,\n            start: this._adjustTiming(start, track),\n            end: this._adjustTiming(end, track),\n            width: 1920,\n            height: 1080,\n            track\n        };\n    }\n\n    _adjustTiming(time, track) {\n        if (CONFIG.mode === ANIMATION_MODES.SYMMETRIC) {\n            return track === 'right' ? time + 100000 : time;\n        }\n        return time;\n    }\n\n    _selectAnimation(track) {\n        if (CONFIG.mode === ANIMATION_MODES.RANDOM) {\n            return this.currentGroup.animationType.all;\n        }\n        return this.currentGroup.animationType[track];\n    }\n\n    _updateState(item, groupEnd) {\n        this.tracks[item.track].push(item);\n        this.currentGroup.items.push(item);\n        \n        // 强制同步组内所有元素的结束时间\n        this.currentGroup.items.forEach(i => i.end = this.currentGroup.endTime);\n        \n        this.currentGroup.endTime = Math.max(\n            this.currentGroup.endTime, \n            groupEnd || item.end\n        );\n    }\n\n    _postProcess() {\n        this._adjustTrackOverlaps();\n        this._balanceDurations();\n    }\n\n    _adjustTrackOverlaps() {\n        Object.values(this.tracks).forEach(track => {\n            track.sort((a, b) => a.start - b.start);\n            for (let i = 1; i < track.length; i++) {\n                const prev = track[i - 1];\n                const curr = track[i];\n                if (prev.end > curr.start) {\n                    const adjust = (prev.end - curr.start) * CONFIG.overlapTolerance;\n                    prev.end -= adjust;\n                    curr.start = prev.end;\n                }\n            }\n        });\n    }\n\n    _balanceDurations() {\n        if (CONFIG.mode === ANIMATION_MODES.CENTER_FOCUS) {\n            this.tracks.middle.forEach(item => {\n                item.end += 300000; // 延长中间元素\n            });\n        }\n    }\n\n    _getStartTime(index, durations) {\n        return index === 0 ? 0 : durations\n            .slice(0, index)\n            .reduce((sum, dur) => sum + dur * CONFIG.durationSettings.unit, 0);\n    }\n\n    _formatOutput() {\n        return Object.entries(this.tracks).reduce((acc, [track, items]) => {\n            acc[track] = items.map(item => ({\n                image_url: item.image_url,\n                in_animation: item.in_animation,\n                start: item.start,\n                end: item.end,\n                width: item.width,\n                height: item.height\n            }));\n            return acc;\n        }, { left: [], middle: [], right: [] });\n    }\n\n    _randomPick(arr) {\n        return arr[Math.floor(Math.random() * arr.length)];\n    }\n}\n\n\n/*\n * 配置接口函数\n * 用法示例：动态修改配置参数\n * configure({\n *   mode: ANIMATION_MODES.RANDOM,\n *   overlapTolerance: 0.5,\n *   durationSettings: {\n *     minDuration: 2000000 // 设置最小持续时间为2000ms\n *   }\n * })\n */\nfunction configure(options) {\n    Object.assign(CONFIG, options);\n}\n\n// --------------------------\n// 主要配置参数使用示例说明：\n// --------------------------\n\n// // 示例1：创建对称动画布局\n// configure({\n//     mode: ANIMATION_MODES.SYMMETRIC,\n//     animationPreset: 'SYMMETRIC',\n//     symmetricPairing: 'LR', // 左右对称配对\n//     trackWeights: { left: 2, middle: 1, right: 2 } // 增加左右轨道权重\n// });\n\n// // 示例2：配置中心聚焦模式\n// configure({\n//     mode: ANIMATION_MODES.CENTER_FOCUS,\n//     animationPreset: 'FOCUS',\n//     durationSettings: {\n//         baseExtension: 800000,  // 扩展800ms\n//         minDuration: 1500000    // 最小1500ms\n//     }\n// });\n\n// // 示例3：完全随机模式配置\n// configure({\n//     mode: ANIMATION_MODES.RANDOM,\n//     animationPreset: 'RANDOM',\n//     overlapTolerance: 0.6,      // 允许更多重叠\n//     groupSyncThreshold: 5       // 每5个元素形成一组\n// });\n\n// // 示例4：自定义顺序模式\n// configure({\n//     mode: ANIMATION_MODES.SEQUENTIAL,\n//     sequentialOrder: ['middle', 'left', 'right'], // 自定义播放顺序\n//     trackWeights: { left: 1, middle: 3, right: 1 } // 中间轨道权重最高\n// });\n\n// // 使用示例\n// const scheduler = new AnimationScheduler();\n\n// // 配置为中心聚焦模式\n// configure({\n//     mode: ANIMATION_MODES.CENTER_FOCUS,\n//     animationPreset: 'FOCUS'\n// });\n\n// // 处理图片序列\n// const result = scheduler.process(\n//     ['img1.jpg', 'img2.jpg', 'img3.jpg'],\n//     [1000, 1500, 1200]\n// );\n\n","inputParameters":[{"input":{"schema":{"type":"string"},"type":"list","value":{"content":{"blockID":"169595","name":"output","source":"block-output"},"rawMeta":{"type":99},"type":"ref"}},"name":"audio_list"},{"input":{"schema":{"type":"integer"},"type":"list","value":{"content":{"blockID":"169595","name":"duration_list","source":"block-output"},"rawMeta":{"type":100},"type":"ref"}},"name":"duration_list"},{"input":{"schema":{"assistType":2,"type":"string"},"type":"list","value":{"content":{"blockID":"422322","name":"data_list","source":"block-output"},"rawMeta":{"type":104},"type":"ref"}},"name":"image_list"},{"input":{"schema":{"schema":[{"name":"story_name","type":"string"},{"name":"desc","type":"string"},{"name":"cap","type":"string"},{"name":"desc_promopt","type":"string"},{"name":"desc_keywords","schema":{"type":"string"},"type":"list"}],"type":"object"},"type":"list","value":{"content":{"blockID":"173538","name":"list","source":"block-output"},"rawMeta":{"type":103},"type":"ref"}},"name":"list"},{"input":{"assistType":2,"type":"string","value":{"content":{"blockID":"764135","name":"data","source":"block-output"},"rawMeta":{"type":7},"type":"ref"}},"name":"bg_image"},{"input":{"type":"string","value":{"content":{"blockID":"100001","name":"type","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"type"}],"language":5,"settingOnError":{"processType":1,"retryTimes":0,"switch":false,"timeoutMs":60000}},"nodeMeta":{"description":"编写代码，处理输入变量来生成返回值","icon":"https://lf3-static.bytednsdoc.com/obj/eden-cn/dvsmryvd_avi_dvsm/ljhwZthlaukjlkulzlp/icon/icon-Code-v2.jpg","subTitle":"代码","title":"代码"},"outputs":[{"name":"image_list","required":false,"type":"string"},{"name":"timelines","required":false,"schema":{"schema":[{"name":"start","type":"integer"},{"name":"end","type":"integer"}],"type":"object"},"type":"list"},{"name":"text_timelines","required":false,"schema":{"schema":[{"name":"start","type":"integer"},{"name":"end","type":"integer"}],"type":"object"},"type":"list"},{"name":"text_cap","required":false,"schema":{"type":"string"},"type":"list"},{"name":"max_time","required":false,"type":"integer"},{"name":"bg_image","required":false,"type":"string"},{"name":"imageDataLeft","required":false,"type":"string"},{"name":"imageDataRight","required":false,"type":"string"},{"name":"imageDataMiddle","required":false,"type":"string"},{"name":"imgData","required":false,"schema":[{"name":"left","schema":{"schema":[],"type":"object"},"type":"list"},{"name":"middle","schema":{"schema":[],"type":"object"},"type":"list"},{"name":"right","schema":{"schema":[],"type":"object"},"type":"list"}],"type":"object"}]},"edges":null,"id":"152586","meta":{"position":{"x":856.0043420340904,"y":-776.1368896865409}},"type":"5"},{"blocks":[],"data":{"inputs":{"apiParam":[{"input":{"type":"string","value":{"content":"7457837925833883688","rawMeta":{"type":1},"type":"literal"}},"name":"apiID"},{"input":{"type":"string","value":{"content":"add_images","rawMeta":{"type":1},"type":"literal"}},"name":"apiName"},{"input":{"type":"string","value":{"content":"7457837925833801768","rawMeta":{"type":1},"type":"literal"}},"name":"pluginID"},{"input":{"type":"string","value":{"content":"视频合成_剪映小助手","rawMeta":{"type":1},"type":"literal"}},"name":"pluginName"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"pluginVersion"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"tips"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"outDocLink"}],"inputDefs":[{"description":"查看说明：https://krxc4izye0.feishu.cn/wiki/Pgm9wXA4EipKhYkeEQJcLBlJnWb?from=from_copylink","input":{},"name":"image_infos","required":true,"type":"string"},{"description":"x缩放","input":{},"name":"scale_x","required":false,"type":"float"},{"description":"y缩放","input":{},"name":"scale_y","required":false,"type":"float"},{"description":"移动transform_x","input":{},"name":"transform_x","required":false,"type":"float"},{"description":"移动transform_y","input":{},"name":"transform_y","required":false,"type":"float"},{"description":"草稿地址，使用create_draft输出的draft_url即可","input":{},"name":"draft_url","required":true,"type":"string"}],"inputParameters":[{"input":{"type":"string","value":{"content":{"blockID":"168118","name":"draft_url","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"draft_url"},{"input":{"type":"string","value":{"content":{"blockID":"152586","name":"imageDataLeft","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"image_infos"},{"input":{"type":"float","value":{"content":0.3,"rawMeta":{"type":4},"type":"literal"}},"name":"scale_x"},{"input":{"type":"float","value":{"content":0.3,"rawMeta":{"type":4},"type":"literal"}},"name":"scale_y"},{"input":{"type":"float","value":{"content":-920,"rawMeta":{"type":4},"type":"literal"}},"name":"transform_x"},{"input":{"type":"float","value":{"content":-345,"rawMeta":{"type":4},"type":"literal"}},"name":"transform_y"}],"settingOnError":{"processType":1,"retryTimes":0,"timeoutMs":180000}},"nodeMeta":{"description":"批量添加图片","icon":"https://lf3-static.bytednsdoc.com/obj/eden-cn/dvsmryvd_avi_dvsm/ljhwZthlaukjlkulzlp/icon/icon-Plugin-v2.jpg","subtitle":"视频合成_剪映小助手:add_images","title":"add_images"},"outputs":[{"name":"segment_ids","required":false,"schema":{"type":"string"},"type":"list"},{"name":"segment_infos","required":false,"schema":{"schema":[{"name":"id","required":false,"type":"string"},{"name":"start","required":false,"type":"integer"},{"name":"end","required":false,"type":"integer"}],"type":"object"},"type":"list"},{"name":"track_id","required":false,"type":"string"},{"name":"draft_url","required":false,"type":"string"},{"name":"image_ids","required":false,"schema":{"type":"string"},"type":"list"}]},"edges":null,"id":"159780","meta":{"position":{"x":3976.151012987285,"y":-322.3197886453107}},"type":"4"},{"blocks":[],"data":{"inputs":{"apiParam":[{"input":{"type":"string","value":{"content":"7457837955684548642","rawMeta":{"type":1},"type":"literal"}},"name":"apiID"},{"input":{"type":"string","value":{"content":"save_draft","rawMeta":{"type":1},"type":"literal"}},"name":"apiName"},{"input":{"type":"string","value":{"content":"7457837925833801768","rawMeta":{"type":1},"type":"literal"}},"name":"pluginID"},{"input":{"type":"string","value":{"content":"视频合成_剪映小助手","rawMeta":{"type":1},"type":"literal"}},"name":"pluginName"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"pluginVersion"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"tips"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"outDocLink"}],"inputDefs":[{"description":"草稿地址，使用create_draft输出的draft_url即可","input":{},"name":"draft_url","required":true,"type":"string"},{"description":"用户ID。如果填写了这个ID，新用户产生的月费就会按照比例归属到这个账号下。","input":{},"name":"user_id","required":false,"type":"integer"}],"inputParameters":[{"input":{"type":"string","value":{"content":{"blockID":"168118","name":"draft_url","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"draft_url"},{"input":{"type":"integer","value":{"content":1262,"rawMeta":{"type":2},"type":"literal"}},"name":"user_id"}],"settingOnError":{"processType":1,"retryTimes":0,"timeoutMs":180000}},"nodeMeta":{"description":"保存草稿\n","icon":"https://lf3-static.bytednsdoc.com/obj/eden-cn/dvsmryvd_avi_dvsm/ljhwZthlaukjlkulzlp/icon/icon-Plugin-v2.jpg","subtitle":"视频合成_剪映小助手:save_draft","title":"save_draft"},"outputs":[{"name":"draft_url","required":false,"type":"string"},{"name":"message","required":false,"type":"string"}]},"edges":null,"id":"104782","meta":{"position":{"x":4966.060613381348,"y":417.9491817894442}},"type":"4"},{"blocks":[],"data":{"inputs":{"apiParam":[{"input":{"type":"string","value":{"content":"7475829177439158307","rawMeta":{"type":1},"type":"literal"}},"name":"apiID"},{"input":{"type":"string","value":{"content":"audio_infos","rawMeta":{"type":1},"type":"literal"}},"name":"apiName"},{"input":{"type":"string","value":{"content":"7475829177439109155","rawMeta":{"type":1},"type":"literal"}},"name":"pluginID"},{"input":{"type":"string","value":{"content":"剪映小助手数据生成器","rawMeta":{"type":1},"type":"literal"}},"name":"pluginName"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"pluginVersion"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"tips"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"outDocLink"}],"inputDefs":[{"description":"音频列表","input":{},"name":"mp3_urls","required":true,"schema":{"assistType":0,"type":"string"},"type":"list"},{"description":"时间线","input":{},"name":"timelines","required":true,"schema":{"schema":[{"description":"结束时间","input":{},"name":"end","required":true,"type":"integer"},{"description":"开始时间","input":{},"name":"start","required":true,"type":"integer"}],"type":"object"},"type":"list"},{"description":"音量大小，0-10,默认1","input":{},"name":"volume","required":false,"type":"float"},{"description":"特效音，eg：教堂，默认无","input":{},"name":"audio_effect","required":false,"type":"string"}],"inputParameters":[{"input":{"schema":{"type":"string"},"type":"list","value":{"content":{"blockID":"169595","name":"output","source":"block-output"},"rawMeta":{"type":99},"type":"ref"}},"name":"mp3_urls"},{"input":{"schema":{"schema":[{"name":"start","type":"integer"},{"name":"end","type":"integer"}],"type":"object"},"type":"list","value":{"content":{"blockID":"152586","name":"timelines","source":"block-output"},"rawMeta":{"type":103},"type":"ref"}},"name":"timelines"},{"input":{"type":"float","value":{"content":2,"rawMeta":{"type":4},"type":"literal"}},"name":"volume"}],"settingOnError":{"processType":1,"retryTimes":0,"timeoutMs":180000}},"nodeMeta":{"description":"根据时间线制作音频数据","icon":"https://lf3-static.bytednsdoc.com/obj/eden-cn/dvsmryvd_avi_dvsm/ljhwZthlaukjlkulzlp/icon/icon-Plugin-v2.jpg","subtitle":"剪映小助手数据生成器:audio_infos","title":"audio_infos"},"outputs":[{"name":"infos","required":false,"type":"string"}]},"edges":null,"id":"180223","meta":{"position":{"x":2696.0043420340908,"y":-776.1368896865409}},"type":"4"},{"blocks":[],"data":{"inputs":{"apiParam":[{"input":{"type":"string","value":{"content":"7457837925833850920","rawMeta":{"type":1},"type":"literal"}},"name":"apiID"},{"input":{"type":"string","value":{"content":"add_captions","rawMeta":{"type":1},"type":"literal"}},"name":"apiName"},{"input":{"type":"string","value":{"content":"7457837925833801768","rawMeta":{"type":1},"type":"literal"}},"name":"pluginID"},{"input":{"type":"string","value":{"content":"视频合成_剪映小助手","rawMeta":{"type":1},"type":"literal"}},"name":"pluginName"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"pluginVersion"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"tips"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"outDocLink"}],"inputDefs":[{"description":"草稿地址，使用create_draft输出的draft_url即可","input":{},"name":"draft_url","required":true,"type":"string"},{"description":"默认：15","input":{},"name":"font_size","required":false,"type":"integer"},{"description":"scale_x缩放","input":{},"name":"scale_x","required":false,"type":"float"},{"description":"0 默认。1富文本样式","input":{},"name":"style_text","required":false,"type":"integer"},{"description":"文字颜色：#ff1837","input":{},"name":"text_color","required":false,"type":"string"},{"description":"transform_x位置","input":{},"name":"transform_x","required":false,"type":"float"},{"description":"查看说明：https://krxc4izye0.feishu.cn/wiki/HhQrw3BFhi1XGOkkJCBcfkqGnwf?from=from_copylink","input":{},"name":"captions","required":true,"type":"string"},{"description":"边框颜色，eg：#fe8a80","input":{},"name":"border_color","required":false,"type":"string"},{"description":"字体列表：https://krxc4izye0.feishu.cn/wiki/SmnrwabXriG7JckEzyGcChk4nDd","input":{},"name":"font","required":false,"type":"string"},{"description":"字间距，默认0","input":{},"name":"letter_spacing","required":false,"type":"float"},{"description":"行间距，默认0","input":{},"name":"line_spacing","required":false,"type":"float"},{"description":"scale_y缩放","input":{},"name":"scale_y","required":false,"type":"float"},{"description":"transform_y位置","input":{},"name":"transform_y","required":false,"type":"float"},{"description":"字幕的对齐方式，0左对齐，1 居中对齐，2右对齐","input":{},"name":"alignment","required":false,"type":"integer"}],"inputParameters":[{"input":{"type":"string","value":{"content":{"blockID":"180947","name":"infos","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"captions"},{"input":{"type":"string","value":{"content":{"blockID":"168118","name":"draft_url","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"draft_url"},{"input":{"type":"integer","value":{"content":1,"rawMeta":{"type":2},"type":"literal"}},"name":"alignment"},{"input":{"type":"integer","value":{"content":6,"rawMeta":{"type":2},"type":"literal"}},"name":"font_size"},{"input":{"type":"float","value":{"content":0.7,"rawMeta":{"type":4},"type":"literal"}},"name":"scale_x"},{"input":{"type":"float","value":{"content":0.7,"rawMeta":{"type":4},"type":"literal"}},"name":"scale_y"},{"input":{"type":"integer","value":{"content":0,"rawMeta":{"type":2},"type":"literal"}},"name":"style_text"},{"input":{"type":"string","value":{"content":"171616","rawMeta":{"type":1},"type":"literal"}},"name":"text_color"},{"input":{"type":"float","value":{"content":0,"rawMeta":{"type":4},"type":"literal"}},"name":"transform_x"},{"input":{"type":"float","value":{"content":-815,"rawMeta":{"type":4},"type":"literal"}},"name":"transform_y"}],"settingOnError":{"processType":1,"retryTimes":0,"timeoutMs":180000}},"nodeMeta":{"description":"批量添加字幕","icon":"https://p26-flow-product-sign.byteimg.com/tos-cn-i-13w3uml6bg/324427c7589a426286a9774fa69f64a2~tplv-13w3uml6bg-resize:128:128.image?rk3s=2e2596fd&x-expires=1744464780&x-signature=qS0o%2FY1NDMFTjtJAQ%2FHNSTjQEzw%3D","subtitle":"视频合成_剪映小助手:add_captions","title":"add_captions"},"outputs":[{"name":"draft_url","required":false,"type":"string"},{"name":"segment_ids","required":false,"schema":{"type":"string"},"type":"list"},{"name":"segment_infos","required":false,"schema":{"schema":[{"name":"end","required":false,"type":"integer"},{"name":"id","required":false,"type":"string"},{"name":"start","required":false,"type":"integer"}],"type":"object"},"type":"list"},{"name":"text_ids","required":false,"schema":{"type":"string"},"type":"list"},{"name":"track_id","required":false,"type":"string"}]},"edges":null,"id":"158201","meta":{"position":{"x":3482.3027487482677,"y":-103.04156066239635}},"type":"4"},{"blocks":[],"data":{"inputs":{"apiParam":[{"input":{"type":"string","value":{"content":"7475829177439191075","rawMeta":{"type":1},"type":"literal"}},"name":"apiID"},{"input":{"type":"string","value":{"content":"caption_infos","rawMeta":{"type":1},"type":"literal"}},"name":"apiName"},{"input":{"type":"string","value":{"content":"7475829177439109155","rawMeta":{"type":1},"type":"literal"}},"name":"pluginID"},{"input":{"type":"string","value":{"content":"剪映小助手数据生成器","rawMeta":{"type":1},"type":"literal"}},"name":"pluginName"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"pluginVersion"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"tips"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"outDocLink"}],"inputDefs":[{"description":"关键词颜色","input":{},"name":"keyword_color","required":false,"type":"string"},{"description":"关键词字大小","input":{},"name":"keyword_font_size","required":false,"type":"integer"},{"description":"文本列表","input":{},"name":"texts","required":true,"schema":{"assistType":0,"type":"string"},"type":"list"},{"description":"时间节点，只接收结构：[{\"start\":0,\"end\":4612}]，一般从audio_timeline节点的输出获取","input":{},"name":"timelines","required":true,"schema":{"schema":[{"description":"结束时间","input":{},"name":"end","required":true,"type":"integer"},{"description":"开始时间","input":{},"name":"start","required":true,"type":"integer"}],"type":"object"},"type":"list"},{"description":"对应剪映的循环动画名字，多个动画请用英文|分割，比如：扫光|晃动","input":{},"name":"loop_animation","required":false,"type":"string"},{"description":"循环动画时长","input":{},"name":"loop_animation_duration","required":false,"type":"integer"},{"description":"对应剪映的出场动画名字，多个动画请用英文|分割，比如：消散|闭幕","input":{},"name":"out_animation","required":false,"type":"string"},{"description":"出场动画时长","input":{},"name":"out_animation_duration","required":false,"type":"integer"},{"description":"文字大小","input":{},"name":"font_size","required":false,"type":"integer"},{"description":"对应剪映的入场动画名字，多个动画请用英文|分割，比如：飞入|放大","input":{},"name":"in_animation","required":false,"type":"string"},{"description":"入场动画时长","input":{},"name":"in_animation_duration","required":false,"type":"integer"},{"description":"文本里面的重点词列表","input":{},"name":"keywords","required":false,"schema":{"assistType":0,"type":"string"},"type":"list"}],"inputParameters":[{"input":{"schema":{"type":"string"},"type":"list","value":{"content":{"blockID":"152586","name":"text_cap","source":"block-output"},"rawMeta":{"type":99},"type":"ref"}},"name":"texts"},{"input":{"schema":{"schema":[{"name":"start","type":"integer"},{"name":"end","type":"integer"}],"type":"object"},"type":"list","value":{"content":{"blockID":"152586","name":"text_timelines","source":"block-output"},"rawMeta":{"type":103},"type":"ref"}},"name":"timelines"}],"settingOnError":{"processType":1,"retryTimes":0,"timeoutMs":180000}},"nodeMeta":{"description":"根据时间线制作字幕数据","icon":"https://p9-flow-product-sign.byteimg.com/tos-cn-i-13w3uml6bg/6a57866c6eca488eb6a78e3cdb16e668~tplv-13w3uml6bg-resize:128:128.image?rk3s=2e2596fd&x-expires=1744465010&x-signature=4iDDzKiufQ2Axl4wsESVJu8bc4A%3D","subtitle":"剪映小助手数据生成器:caption_infos","title":"caption_infos"},"outputs":[{"name":"infos","required":false,"type":"string"}]},"edges":null,"id":"180947","meta":{"position":{"x":2683.3900829615677,"y":-572.0534596324964}},"type":"4"},{"blocks":[],"data":{"inputs":{"apiParam":[{"input":{"type":"string","value":{"content":"7457837925833883688","rawMeta":{"type":1},"type":"literal"}},"name":"apiID"},{"input":{"type":"string","value":{"content":"add_images","rawMeta":{"type":1},"type":"literal"}},"name":"apiName"},{"input":{"type":"string","value":{"content":"7457837925833801768","rawMeta":{"type":1},"type":"literal"}},"name":"pluginID"},{"input":{"type":"string","value":{"content":"视频合成_剪映小助手","rawMeta":{"type":1},"type":"literal"}},"name":"pluginName"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"pluginVersion"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"tips"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"outDocLink"}],"inputDefs":[{"description":"查看说明：https://krxc4izye0.feishu.cn/wiki/Pgm9wXA4EipKhYkeEQJcLBlJnWb?from=from_copylink","input":{},"name":"image_infos","required":true,"type":"string"},{"description":"x缩放","input":{},"name":"scale_x","required":false,"type":"float"},{"description":"y缩放","input":{},"name":"scale_y","required":false,"type":"float"},{"description":"移动transform_x","input":{},"name":"transform_x","required":false,"type":"float"},{"description":"移动transform_y","input":{},"name":"transform_y","required":false,"type":"float"},{"description":"草稿地址，使用create_draft输出的draft_url即可","input":{},"name":"draft_url","required":true,"type":"string"}],"inputParameters":[{"input":{"type":"string","value":{"content":{"blockID":"168118","name":"draft_url","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"draft_url"},{"input":{"type":"string","value":{"content":{"blockID":"152586","name":"bg_image","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"image_infos"},{"input":{"type":"float","value":{"content":1,"rawMeta":{"type":4},"type":"literal"}},"name":"scale_x"},{"input":{"type":"float","value":{"content":1,"rawMeta":{"type":4},"type":"literal"}},"name":"scale_y"}],"settingOnError":{"processType":1,"retryTimes":0,"timeoutMs":180000}},"nodeMeta":{"description":"批量添加图片","icon":"https://p6-flow-product-sign.byteimg.com/tos-cn-i-13w3uml6bg/324427c7589a426286a9774fa69f64a2~tplv-13w3uml6bg-resize:128:128.image?rk3s=2e2596fd&x-expires=1744472328&x-signature=9GXsgm2HH29uW0ihgoymUTYxCmc%3D","subtitle":"视频合成_剪映小助手:add_images","title":"add_images_1"},"outputs":[{"name":"segment_infos","required":false,"schema":{"schema":[{"name":"end","required":false,"type":"integer"},{"name":"id","required":false,"type":"string"},{"name":"start","required":false,"type":"integer"}],"type":"object"},"type":"list"},{"name":"track_id","required":false,"type":"string"},{"name":"draft_url","required":false,"type":"string"},{"name":"image_ids","required":false,"schema":{"type":"string"},"type":"list"},{"name":"segment_ids","required":false,"schema":{"type":"string"},"type":"list"}]},"edges":null,"id":"109941","meta":{"position":{"x":3500.039163246175,"y":-322.3197886453107}},"type":"4"},{"blocks":[],"data":{"inputs":{"callTransferVoice":true,"chatHistoryWriting":"historyWrite","content":{"type":"string","value":{"content":"正在生成视频分镜描述","type":"literal"}},"inputParameters":[],"streamingOutput":false},"nodeMeta":{"description":"节点从“消息”更名为“输出”，支持中间过程的消息输出，支持流式和非流式两种方式","icon":"https://lf3-static.bytednsdoc.com/obj/eden-cn/dvsmryvd_avi_dvsm/ljhwZthlaukjlkulzlp/icon/icon-Output-v2.jpg","mainColor":"#5C62FF","subTitle":"输出","title":"输出_2"}},"edges":null,"id":"154682","meta":{"position":{"x":-3917.1885206739285,"y":-965.2378676053289}},"type":"13"},{"blocks":[],"data":{"inputs":{"callTransferVoice":true,"chatHistoryWriting":"historyWrite","content":{"type":"string","value":{"content":"正在生成音频...","type":"literal"}},"inputParameters":[],"streamingOutput":false},"nodeMeta":{"description":"节点从“消息”更名为“输出”，支持中间过程的消息输出，支持流式和非流式两种方式","icon":"https://lf3-static.bytednsdoc.com/obj/eden-cn/dvsmryvd_avi_dvsm/ljhwZthlaukjlkulzlp/icon/icon-Output-v2.jpg","mainColor":"#5C62FF","subTitle":"输出","title":"输出_3"}},"edges":null,"id":"133547","meta":{"position":{"x":-812.9194702824128,"y":-605.5426851216729}},"type":"13"},{"blocks":[],"data":{"inputs":{"callTransferVoice":true,"chatHistoryWriting":"historyWrite","content":{"type":"string","value":{"content":"视频编排中， 即将完成...","type":"literal"}},"inputParameters":[],"streamingOutput":false},"nodeMeta":{"description":"节点从“消息”更名为“输出”，支持中间过程的消息输出，支持流式和非流式两种方式","icon":"https://lf3-static.bytednsdoc.com/obj/eden-cn/dvsmryvd_avi_dvsm/ljhwZthlaukjlkulzlp/icon/icon-Output-v2.jpg","mainColor":"#5C62FF","subTitle":"输出","title":"输出_4"}},"edges":null,"id":"150526","meta":{"position":{"x":2065.96065308802,"y":-796.7482459224283}},"type":"13"},{"blocks":[],"data":{"inputs":{"apiParam":[{"input":{"type":"string","value":{"content":"7457837925833883688","rawMeta":{"type":1},"type":"literal"}},"name":"apiID"},{"input":{"type":"string","value":{"content":"add_images","rawMeta":{"type":1},"type":"literal"}},"name":"apiName"},{"input":{"type":"string","value":{"content":"7457837925833801768","rawMeta":{"type":1},"type":"literal"}},"name":"pluginID"},{"input":{"type":"string","value":{"content":"视频合成_剪映小助手","rawMeta":{"type":1},"type":"literal"}},"name":"pluginName"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"pluginVersion"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"tips"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"outDocLink"}],"inputDefs":[{"description":"查看说明：https://krxc4izye0.feishu.cn/wiki/Pgm9wXA4EipKhYkeEQJcLBlJnWb?from=from_copylink","input":{},"name":"image_infos","required":true,"type":"string"},{"description":"x缩放","input":{},"name":"scale_x","required":false,"type":"float"},{"description":"y缩放","input":{},"name":"scale_y","required":false,"type":"float"},{"description":"移动transform_x","input":{},"name":"transform_x","required":false,"type":"float"},{"description":"移动transform_y","input":{},"name":"transform_y","required":false,"type":"float"},{"description":"草稿地址，使用create_draft输出的draft_url即可","input":{},"name":"draft_url","required":true,"type":"string"}],"inputParameters":[{"input":{"type":"string","value":{"content":{"blockID":"168118","name":"draft_url","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"draft_url"},{"input":{"type":"string","value":{"content":{"blockID":"152586","name":"imageDataRight","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"image_infos"},{"input":{"type":"float","value":{"content":0.3,"rawMeta":{"type":4},"type":"literal"}},"name":"scale_x"},{"input":{"type":"float","value":{"content":0.3,"rawMeta":{"type":4},"type":"literal"}},"name":"scale_y"},{"input":{"type":"float","value":{"content":920,"rawMeta":{"type":4},"type":"literal"}},"name":"transform_x"},{"input":{"type":"float","value":{"content":-345,"rawMeta":{"type":4},"type":"literal"}},"name":"transform_y"}],"settingOnError":{"processType":1,"retryTimes":0,"timeoutMs":180000}},"nodeMeta":{"description":"批量添加图片","icon":"https://p3-flow-product-sign.byteimg.com/tos-cn-i-13w3uml6bg/f013e4af74224258a37363a531aecefe~tplv-13w3uml6bg-resize:128:128.image?rk3s=2e2596fd&x-expires=1745210894&x-signature=spbFsOh1PTgQ%2FOPJT1xGpg33sw8%3D","subtitle":"视频合成_剪映小助手:add_images","title":"add_images_2"},"outputs":[{"name":"draft_url","required":false,"type":"string"},{"name":"image_ids","required":false,"schema":{"type":"string"},"type":"list"},{"name":"segment_ids","required":false,"schema":{"type":"string"},"type":"list"},{"name":"segment_infos","required":false,"schema":{"schema":[{"name":"end","required":false,"type":"integer"},{"name":"id","required":false,"type":"string"},{"name":"start","required":false,"type":"integer"}],"type":"object"},"type":"list"},{"name":"track_id","required":false,"type":"string"}]},"edges":null,"id":"135409","meta":{"position":{"x":4523.868958269798,"y":-501.6795971860014}},"type":"4"},{"blocks":[],"data":{"inputs":{"apiParam":[{"input":{"type":"string","value":{"content":"7457837925833883688","rawMeta":{"type":1},"type":"literal"}},"name":"apiID"},{"input":{"type":"string","value":{"content":"add_images","rawMeta":{"type":1},"type":"literal"}},"name":"apiName"},{"input":{"type":"string","value":{"content":"7457837925833801768","rawMeta":{"type":1},"type":"literal"}},"name":"pluginID"},{"input":{"type":"string","value":{"content":"视频合成_剪映小助手","rawMeta":{"type":1},"type":"literal"}},"name":"pluginName"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"pluginVersion"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"tips"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"outDocLink"}],"inputDefs":[{"description":"查看说明：https://krxc4izye0.feishu.cn/wiki/Pgm9wXA4EipKhYkeEQJcLBlJnWb?from=from_copylink","input":{},"name":"image_infos","required":true,"type":"string"},{"description":"x缩放","input":{},"name":"scale_x","required":false,"type":"float"},{"description":"y缩放","input":{},"name":"scale_y","required":false,"type":"float"},{"description":"移动transform_x","input":{},"name":"transform_x","required":false,"type":"float"},{"description":"移动transform_y","input":{},"name":"transform_y","required":false,"type":"float"},{"description":"草稿地址，使用create_draft输出的draft_url即可","input":{},"name":"draft_url","required":true,"type":"string"}],"inputParameters":[{"input":{"type":"string","value":{"content":{"blockID":"168118","name":"draft_url","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"draft_url"},{"input":{"type":"string","value":{"content":{"blockID":"152586","name":"imageDataMiddle","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"image_infos"},{"input":{"type":"float","value":{"content":0.3,"rawMeta":{"type":4},"type":"literal"}},"name":"scale_x"},{"input":{"type":"float","value":{"content":0.3,"rawMeta":{"type":4},"type":"literal"}},"name":"scale_y"},{"input":{"type":"float","value":{"content":0,"rawMeta":{"type":4},"type":"literal"}},"name":"transform_x"},{"input":{"type":"float","value":{"content":-345,"rawMeta":{"type":4},"type":"literal"}},"name":"transform_y"}],"settingOnError":{"processType":1,"retryTimes":0,"timeoutMs":180000}},"nodeMeta":{"description":"批量添加图片","icon":"https://p26-flow-product-sign.byteimg.com/tos-cn-i-13w3uml6bg/f013e4af74224258a37363a531aecefe~tplv-13w3uml6bg-resize:128:128.image?rk3s=2e2596fd&x-expires=1745210918&x-signature=3QJD0j6JayiaPtReGoSWDJ%2B9mzA%3D","subtitle":"视频合成_剪映小助手:add_images","title":"add_images_3"},"outputs":[{"name":"draft_url","required":false,"type":"string"},{"name":"image_ids","required":false,"schema":{"type":"string"},"type":"list"},{"name":"segment_ids","required":false,"schema":{"type":"string"},"type":"list"},{"name":"segment_infos","required":false,"schema":{"schema":[{"name":"end","required":false,"type":"integer"},{"name":"id","required":false,"type":"string"},{"name":"start","required":false,"type":"integer"}],"type":"object"},"type":"list"},{"name":"track_id","required":false,"type":"string"}]},"edges":null,"id":"154660","meta":{"position":{"x":4511.33964511246,"y":-322.3197886453107}},"type":"4"},{"blocks":[],"data":{"inputs":{"inputParameters":[{"input":{"schema":{"type":"string"},"type":"list","value":{"content":{"blockID":"152586","name":"text_cap","source":"block-output"},"rawMeta":{"type":99},"type":"ref"}},"name":"input"}],"llmParam":[{"input":{"type":"string","value":{"content":"default_val","rawMeta":{"type":1},"type":"literal"}},"name":"generationDiversity"},{"input":{"type":"float","value":{"content":"0.8","rawMeta":{"type":4},"type":"literal"}},"name":"temperature"},{"input":{"type":"integer","value":{"content":"8192","rawMeta":{"type":2},"type":"literal"}},"name":"maxTokens"},{"input":{"type":"integer","value":{"content":"2","rawMeta":{"type":2},"type":"literal"}},"name":"responseFormat"},{"input":{"type":"string","value":{"content":"DeepSeek-V3","rawMeta":{"type":1},"type":"literal"}},"name":"modleName"},{"input":{"type":"integer","value":{"content":"1738675210","rawMeta":{"type":2},"type":"literal"}},"name":"modelType"},{"input":{"type":"string","value":{"content":"中文JSON数组如下：{{input}}","rawMeta":{"type":1},"type":"literal"}},"name":"prompt"},{"input":{"type":"boolean","value":{"content":false,"rawMeta":{"type":3},"type":"literal"}},"name":"enableChatHistory"},{"input":{"type":"integer","value":{"content":"3","rawMeta":{"type":2},"type":"literal"}},"name":"chatHistoryRound"},{"input":{"type":"string","value":{"content":"# 角色\n你是一位专业的翻译专家，专长于将中文文本精准且流畅地翻译成英文。\n\n## 技能\n### 技能 1: 翻译中文内容\n1. 当接收到中文内容后，将其准确翻译成英文，要确保译文完整保留原文的意义、语气以及风格， 中文内容在json数组中，需要将数组中的每句中文单独翻译。\n2. 在翻译过程中，充分留意中文的语境和文化内涵，让英文表达既忠实于原文，又契合英语习惯。\n\n## 输出要求\n1. 翻译后的英文文本务必符合英语语法规范，表达清晰、语句流畅，具备良好的可读性。\n2. 准确传达原文的所有信息，杜绝随意添加或删减内容。\n3. 若遇到中文习语或具有文化特色的内容，采用符合英语表达习惯的译法，保证信息完整且传达效果良好。\n\n## 注意事项\n1. 对于多义词或模糊表达，保证译文明确、连贯且前后一致。\n2. 若直译可能产生歧义，则采用意译方法，同时保证原意不变。\n\n## 示例\n### 中文输入示例\n[\"在现代生活中\", \"压力无处不在\", \"它不仅影响我们的情绪还会对健康造成隐性危害。\"]\n\n### 英文输出示例\n[\"In modern life\", \"stress is ubiquitous\", \"it not only affects our emotions but also poses hidden risks to our health.\"]\n\n输出为json格式数组，输出数组数量必须和输入数组数量一致。\n\n# 限制\n- 严格依照上述提示生成符合要求的英文翻译。\n- 输出为json格式数组，输出数组数量必须和输入数组数量一致。\n- 重复的句子也需要重复翻译。","rawMeta":{"type":1},"type":"literal"}},"name":"systemPrompt"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"stableSystemPrompt"},{"input":{"type":"boolean","value":{"content":false,"rawMeta":{"type":3},"type":"literal"}},"name":"canContinue"}],"settingOnError":{"processType":1,"retryTimes":0,"switch":false,"timeoutMs":600000}},"nodeMeta":{"description":"调用大语言模型,使用变量和提示词生成回复","icon":"https://lf3-static.bytednsdoc.com/obj/eden-cn/dvsmryvd_avi_dvsm/ljhwZthlaukjlkulzlp/icon/icon-LLM-v2.jpg","subTitle":"大模型","title":"大模型"},"outputs":[{"name":"text_cap_en","required":false,"schema":{"type":"string"},"type":"list"}],"version":"3"},"edges":null,"id":"160030","meta":{"position":{"x":1546.0043420340903,"y":-815.1368896865409}},"type":"3"},{"blocks":[],"data":{"inputs":{"apiParam":[{"input":{"type":"string","value":{"content":"7475829177439191075","rawMeta":{"type":1},"type":"literal"}},"name":"apiID"},{"input":{"type":"string","value":{"content":"caption_infos","rawMeta":{"type":1},"type":"literal"}},"name":"apiName"},{"input":{"type":"string","value":{"content":"7475829177439109155","rawMeta":{"type":1},"type":"literal"}},"name":"pluginID"},{"input":{"type":"string","value":{"content":"剪映小助手数据生成器","rawMeta":{"type":1},"type":"literal"}},"name":"pluginName"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"pluginVersion"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"tips"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"outDocLink"}],"inputDefs":[{"description":"关键词颜色","input":{},"name":"keyword_color","required":false,"type":"string"},{"description":"关键词字大小","input":{},"name":"keyword_font_size","required":false,"type":"integer"},{"description":"文本列表","input":{},"name":"texts","required":true,"schema":{"assistType":0,"type":"string"},"type":"list"},{"description":"时间节点，只接收结构：[{\"start\":0,\"end\":4612}]，一般从audio_timeline节点的输出获取","input":{},"name":"timelines","required":true,"schema":{"schema":[{"description":"结束时间","input":{},"name":"end","required":true,"type":"integer"},{"description":"开始时间","input":{},"name":"start","required":true,"type":"integer"}],"type":"object"},"type":"list"},{"description":"对应剪映的循环动画名字，多个动画请用英文|分割，比如：扫光|晃动","input":{},"name":"loop_animation","required":false,"type":"string"},{"description":"循环动画时长","input":{},"name":"loop_animation_duration","required":false,"type":"integer"},{"description":"对应剪映的出场动画名字，多个动画请用英文|分割，比如：消散|闭幕","input":{},"name":"out_animation","required":false,"type":"string"},{"description":"出场动画时长","input":{},"name":"out_animation_duration","required":false,"type":"integer"},{"description":"文字大小","input":{},"name":"font_size","required":false,"type":"integer"},{"description":"对应剪映的入场动画名字，多个动画请用英文|分割，比如：飞入|放大","input":{},"name":"in_animation","required":false,"type":"string"},{"description":"入场动画时长","input":{},"name":"in_animation_duration","required":false,"type":"integer"},{"description":"文本里面的重点词列表","input":{},"name":"keywords","required":false,"schema":{"assistType":0,"type":"string"},"type":"list"}],"inputParameters":[{"input":{"schema":{"type":"string"},"type":"list","value":{"content":{"blockID":"160030","name":"text_cap_en","source":"block-output"},"rawMeta":{"type":99},"type":"ref"}},"name":"texts"},{"input":{"schema":{"schema":[{"name":"start","type":"integer"},{"name":"end","type":"integer"}],"type":"object"},"type":"list","value":{"content":{"blockID":"152586","name":"text_timelines","source":"block-output"},"rawMeta":{"type":103},"type":"ref"}},"name":"timelines"}],"settingOnError":{"processType":1,"retryTimes":0,"timeoutMs":180000}},"nodeMeta":{"description":"根据时间线制作字幕数据","icon":"https://p9-flow-product-sign.byteimg.com/tos-cn-i-13w3uml6bg/6a3507dfdb5c4dc49bd72ec0e17a7752~tplv-13w3uml6bg-resize:128:128.image?rk3s=2e2596fd&x-expires=1745285100&x-signature=Dv34%2B4gLJEkcRYl1MbWxVoFAx2k%3D","subtitle":"剪映小助手数据生成器:caption_infos","title":"caption_infos_1"},"outputs":[{"name":"infos","required":false,"type":"string"}]},"edges":null,"id":"198051","meta":{"position":{"x":2683.3900829615677,"y":-346.48756325697366}},"type":"4"},{"blocks":[],"data":{"inputs":{"apiParam":[{"input":{"type":"string","value":{"content":"7457837925833850920","rawMeta":{"type":1},"type":"literal"}},"name":"apiID"},{"input":{"type":"string","value":{"content":"add_captions","rawMeta":{"type":1},"type":"literal"}},"name":"apiName"},{"input":{"type":"string","value":{"content":"7457837925833801768","rawMeta":{"type":1},"type":"literal"}},"name":"pluginID"},{"input":{"type":"string","value":{"content":"视频合成_剪映小助手","rawMeta":{"type":1},"type":"literal"}},"name":"pluginName"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"pluginVersion"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"tips"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"outDocLink"}],"inputDefs":[{"description":"草稿地址，使用create_draft输出的draft_url即可","input":{},"name":"draft_url","required":true,"type":"string"},{"description":"默认：15","input":{},"name":"font_size","required":false,"type":"integer"},{"description":"scale_x缩放","input":{},"name":"scale_x","required":false,"type":"float"},{"description":"0 默认。1富文本样式","input":{},"name":"style_text","required":false,"type":"integer"},{"description":"文字颜色：#ff1837","input":{},"name":"text_color","required":false,"type":"string"},{"description":"transform_x位置","input":{},"name":"transform_x","required":false,"type":"float"},{"description":"查看说明：https://krxc4izye0.feishu.cn/wiki/HhQrw3BFhi1XGOkkJCBcfkqGnwf?from=from_copylink","input":{},"name":"captions","required":true,"type":"string"},{"description":"边框颜色，eg：#fe8a80","input":{},"name":"border_color","required":false,"type":"string"},{"description":"字体列表：https://krxc4izye0.feishu.cn/wiki/SmnrwabXriG7JckEzyGcChk4nDd","input":{},"name":"font","required":false,"type":"string"},{"description":"字间距，默认0","input":{},"name":"letter_spacing","required":false,"type":"float"},{"description":"行间距，默认0","input":{},"name":"line_spacing","required":false,"type":"float"},{"description":"scale_y缩放","input":{},"name":"scale_y","required":false,"type":"float"},{"description":"transform_y位置","input":{},"name":"transform_y","required":false,"type":"float"},{"description":"字幕的对齐方式，0左对齐，1 居中对齐，2右对齐","input":{},"name":"alignment","required":false,"type":"integer"}],"inputParameters":[{"input":{"type":"string","value":{"content":{"blockID":"198051","name":"infos","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"captions"},{"input":{"type":"string","value":{"content":{"blockID":"168118","name":"draft_url","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"draft_url"},{"input":{"type":"integer","value":{"content":1,"rawMeta":{"type":2},"type":"literal"}},"name":"alignment"},{"input":{"type":"integer","value":{"content":5,"rawMeta":{"type":2},"type":"literal"}},"name":"font_size"},{"input":{"type":"float","value":{"content":0.5,"rawMeta":{"type":4},"type":"literal"}},"name":"scale_x"},{"input":{"type":"float","value":{"content":0.5,"rawMeta":{"type":4},"type":"literal"}},"name":"scale_y"},{"input":{"type":"integer","value":{"content":0,"rawMeta":{"type":2},"type":"literal"}},"name":"style_text"},{"input":{"type":"string","value":{"content":"171616","rawMeta":{"type":1},"type":"literal"}},"name":"text_color"},{"input":{"type":"float","value":{"content":0,"rawMeta":{"type":4},"type":"literal"}},"name":"transform_x"},{"input":{"type":"float","value":{"content":-932,"rawMeta":{"type":4},"type":"literal"}},"name":"transform_y"}],"settingOnError":{"processType":1,"retryTimes":0,"timeoutMs":180000}},"nodeMeta":{"description":"批量添加字幕","icon":"https://p6-flow-product-sign.byteimg.com/tos-cn-i-13w3uml6bg/f013e4af74224258a37363a531aecefe~tplv-13w3uml6bg-resize:128:128.image?rk3s=2e2596fd&x-expires=1745285156&x-signature=VqP3D41r9XSD0eraqUPrQiaKgRI%3D","subtitle":"视频合成_剪映小助手:add_captions","title":"add_captions_en"},"outputs":[{"name":"segment_ids","required":false,"schema":{"type":"string"},"type":"list"},{"name":"segment_infos","required":false,"schema":{"schema":[{"name":"end","required":false,"type":"integer"},{"name":"id","required":false,"type":"string"},{"name":"start","required":false,"type":"integer"}],"type":"object"},"type":"list"},{"name":"text_ids","required":false,"schema":{"type":"string"},"type":"list"},{"name":"track_id","required":false,"type":"string"},{"name":"draft_url","required":false,"type":"string"}]},"edges":null,"id":"183571","meta":{"position":{"x":3996.821196930364,"y":-82.9097467713376}},"type":"4"},{"blocks":[],"data":{"inputs":{"branches":[{"condition":{"conditions":[{"left":{"input":{"type":"string","value":{"content":{"blockID":"100001","name":"text","source":"block-output"},"type":"ref"}}},"operator":9},{"left":{"input":{"type":"string","value":{"content":{"blockID":"100001","name":"text","source":"block-output"},"type":"ref"}}},"operator":1,"right":{"input":{"type":"string","value":{"content":"无","rawMeta":{"type":1},"type":"literal"}}}}],"logic":1}}]},"nodeMeta":{"description":"连接多个下游分支，若设定的条件成立则仅运行对应的分支，若均不成立则只运行“否则”分支","icon":"https://lf3-static.bytednsdoc.com/obj/eden-cn/dvsmryvd_avi_dvsm/ljhwZthlaukjlkulzlp/icon/icon-Condition-v2.jpg","mainColor":"#00B2B2","subTitle":"选择器","title":"选择器"}},"edges":null,"id":"177659","meta":{"position":{"x":-5523.995657965912,"y":-812.7868896865406}},"type":"8"},{"blocks":[],"data":{"inputs":{"code":"// 在这里，您可以通过 ‘params’  获取节点中的输入变量，并通过 'ret' 输出结果\n// 'params' 和 'ret' 已经被正确地注入到环境中\n// 下面是一个示例，获取节点输入中参数名为‘input’的值：\n// const input = params.input; \n// 下面是一个示例，输出一个包含多种数据类型的 'ret' 对象：\n// const ret = { \"name\": ‘小明’, \"hobbies\": [“看书”, “旅游”] };\n\nasync function main({ params }: Args): Promise<Output> {\n\n    var title = params.title;\n    var content = params.content;\n    if(!content || content == '无'){\n        title = params.title1;\n        content = params.content1; \n    }\n\n    // 构建输出对象\n    const ret = {\n        \"title\": title,\n        \"content\":content\n    };\n\n    return ret;\n}","inputParameters":[{"input":{"type":"string","value":{"content":{"blockID":"100001","name":"title","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"title"},{"input":{"type":"string","value":{"content":{"blockID":"100001","name":"text","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"content"},{"input":{"type":"string","value":{"content":{"blockID":"152455","name":"title","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"title1"},{"input":{"type":"string","value":{"content":{"blockID":"152455","name":"content","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"content1"}],"language":5,"settingOnError":{"processType":1,"retryTimes":0,"switch":false,"timeoutMs":60000}},"nodeMeta":{"description":"编写代码，处理输入变量来生成返回值","icon":"https://lf3-static.bytednsdoc.com/obj/eden-cn/dvsmryvd_avi_dvsm/ljhwZthlaukjlkulzlp/icon/icon-Code-v2.jpg","subTitle":"代码","title":"代码_1"},"outputs":[{"name":"title","required":false,"type":"string"},{"name":"content","required":false,"type":"string"}]},"edges":null,"id":"158360","meta":{"position":{"x":-4393.937820084659,"y":-750.1368896865409}},"type":"5"},{"blocks":[],"data":{"inputs":{"apiParam":[{"input":{"type":"string","value":{"content":"7457837925833850920","rawMeta":{"type":1},"type":"literal"}},"name":"apiID"},{"input":{"type":"string","value":{"content":"add_captions","rawMeta":{"type":1},"type":"literal"}},"name":"apiName"},{"input":{"type":"string","value":{"content":"7457837925833801768","rawMeta":{"type":1},"type":"literal"}},"name":"pluginID"},{"input":{"type":"string","value":{"content":"视频合成_剪映小助手","rawMeta":{"type":1},"type":"literal"}},"name":"pluginName"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"pluginVersion"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"tips"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"outDocLink"}],"inputDefs":[{"description":"草稿地址，使用create_draft输出的draft_url即可","input":{},"name":"draft_url","required":true,"type":"string"},{"description":"默认：15","input":{},"name":"font_size","required":false,"type":"integer"},{"description":"scale_x缩放","input":{},"name":"scale_x","required":false,"type":"float"},{"description":"0 默认。1富文本样式","input":{},"name":"style_text","required":false,"type":"integer"},{"description":"文字颜色：#ff1837","input":{},"name":"text_color","required":false,"type":"string"},{"description":"transform_x位置","input":{},"name":"transform_x","required":false,"type":"float"},{"description":"查看说明：https://krxc4izye0.feishu.cn/wiki/HhQrw3BFhi1XGOkkJCBcfkqGnwf?from=from_copylink","input":{},"name":"captions","required":true,"type":"string"},{"description":"边框颜色，eg：#fe8a80","input":{},"name":"border_color","required":false,"type":"string"},{"description":"字体列表：https://krxc4izye0.feishu.cn/wiki/SmnrwabXriG7JckEzyGcChk4nDd","input":{},"name":"font","required":false,"type":"string"},{"description":"字间距，默认0","input":{},"name":"letter_spacing","required":false,"type":"float"},{"description":"行间距，默认0","input":{},"name":"line_spacing","required":false,"type":"float"},{"description":"scale_y缩放","input":{},"name":"scale_y","required":false,"type":"float"},{"description":"transform_y位置","input":{},"name":"transform_y","required":false,"type":"float"},{"description":"字幕的对齐方式，0左对齐，1 居中对齐，2右对齐","input":{},"name":"alignment","required":false,"type":"integer"}],"inputParameters":[{"input":{"type":"string","value":{"content":{"blockID":"185330","name":"infos","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"captions"},{"input":{"type":"string","value":{"content":{"blockID":"168118","name":"draft_url","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"draft_url"},{"input":{"type":"integer","value":{"content":5,"rawMeta":{"type":2},"type":"literal"}},"name":"font_size"},{"input":{"type":"integer","value":{"content":0,"rawMeta":{"type":2},"type":"literal"}},"name":"style_text"},{"input":{"type":"string","value":{"content":{"blockID":"159614","name":"keyword_color","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"text_color"},{"input":{"type":"float","value":{"content":-1394,"rawMeta":{"type":4},"type":"literal"}},"name":"transform_x"},{"input":{"type":"float","value":{"content":301,"rawMeta":{"type":4},"type":"literal"}},"name":"transform_y"}],"settingOnError":{"processType":1,"retryTimes":0,"timeoutMs":180000}},"nodeMeta":{"description":"批量添加字幕","icon":"https://p3-flow-product-sign.byteimg.com/tos-cn-i-13w3uml6bg/f013e4af74224258a37363a531aecefe~tplv-13w3uml6bg-resize:128:128.image?rk3s=2e2596fd&x-expires=1745502886&x-signature=rDIxeWJhVqe3YtFlHHLLbWduATM%3D","subtitle":"视频合成_剪映小助手:add_captions","title":"add_captions_left1"},"outputs":[{"name":"track_id","required":false,"type":"string"},{"name":"draft_url","required":false,"type":"string"},{"name":"segment_ids","required":false,"schema":{"type":"string"},"type":"list"},{"name":"segment_infos","required":false,"schema":{"schema":[{"name":"end","required":false,"type":"integer"},{"name":"id","required":false,"type":"string"},{"name":"start","required":false,"type":"integer"}],"type":"object"},"type":"list"},{"name":"text_ids","required":false,"schema":{"type":"string"},"type":"list"}]},"edges":null,"id":"114259","meta":{"position":{"x":4966.060613381348,"y":-114.84358134116734}},"type":"4"},{"blocks":[],"data":{"inputs":{"apiParam":[{"input":{"type":"string","value":{"content":"7475829177439191075","rawMeta":{"type":1},"type":"literal"}},"name":"apiID"},{"input":{"type":"string","value":{"content":"caption_infos","rawMeta":{"type":1},"type":"literal"}},"name":"apiName"},{"input":{"type":"string","value":{"content":"7475829177439109155","rawMeta":{"type":1},"type":"literal"}},"name":"pluginID"},{"input":{"type":"string","value":{"content":"剪映小助手数据生成器","rawMeta":{"type":1},"type":"literal"}},"name":"pluginName"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"pluginVersion"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"tips"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"outDocLink"}],"inputDefs":[{"description":"关键词颜色","input":{},"name":"keyword_color","required":false,"type":"string"},{"description":"关键词字大小","input":{},"name":"keyword_font_size","required":false,"type":"integer"},{"description":"文本列表","input":{},"name":"texts","required":true,"schema":{"assistType":0,"type":"string"},"type":"list"},{"description":"时间节点，只接收结构：[{\"start\":0,\"end\":4612}]，一般从audio_timeline节点的输出获取","input":{},"name":"timelines","required":true,"schema":{"schema":[{"description":"结束时间","input":{},"name":"end","required":true,"type":"integer"},{"description":"开始时间","input":{},"name":"start","required":true,"type":"integer"}],"type":"object"},"type":"list"},{"description":"对应剪映的循环动画名字，多个动画请用英文|分割，比如：扫光|晃动","input":{},"name":"loop_animation","required":false,"type":"string"},{"description":"循环动画时长","input":{},"name":"loop_animation_duration","required":false,"type":"integer"},{"description":"对应剪映的出场动画名字，多个动画请用英文|分割，比如：消散|闭幕","input":{},"name":"out_animation","required":false,"type":"string"},{"description":"出场动画时长","input":{},"name":"out_animation_duration","required":false,"type":"integer"},{"description":"文字大小","input":{},"name":"font_size","required":false,"type":"integer"},{"description":"对应剪映的入场动画名字，多个动画请用英文|分割，比如：飞入|放大","input":{},"name":"in_animation","required":false,"type":"string"},{"description":"入场动画时长","input":{},"name":"in_animation_duration","required":false,"type":"integer"},{"description":"文本里面的重点词列表","input":{},"name":"keywords","required":false,"schema":{"assistType":0,"type":"string"},"type":"list"}],"inputParameters":[{"input":{"schema":{"type":"string"},"type":"list","value":{"content":{"blockID":"158857","name":"data.left.x1_keywords","source":"block-output"},"rawMeta":{"type":99},"type":"ref"}},"name":"texts"},{"input":{"schema":{"schema":[{"name":"start","type":"integer"},{"name":"end","type":"integer"}],"type":"object"},"type":"list","value":{"content":{"blockID":"158857","name":"data.left.x1_timelines","source":"block-output"},"rawMeta":{"type":103},"type":"ref"}},"name":"timelines"},{"input":{"type":"string","value":{"content":"翻动","rawMeta":{"type":1},"type":"literal"}},"name":"in_animation"}],"settingOnError":{"processType":1,"retryTimes":0,"timeoutMs":180000}},"nodeMeta":{"description":"根据时间线制作字幕数据","icon":"https://p3-flow-product-sign.byteimg.com/tos-cn-i-13w3uml6bg/6a3507dfdb5c4dc49bd72ec0e17a7752~tplv-13w3uml6bg-resize:128:128.image?rk3s=2e2596fd&x-expires=1745502964&x-signature=mcJpqIM97yEoRk894zI4lQTP4Zw%3D","subtitle":"剪映小助手数据生成器:caption_infos","title":"caption_infos_left1"},"outputs":[{"name":"infos","required":false,"type":"string"}]},"edges":null,"id":"185330","meta":{"position":{"x":2658.16156481652,"y":-188.05437413607103}},"type":"4"},{"blocks":[],"data":{"inputs":{"code":"// 在这里，您可以通过 ‘params’  获取节点中的输入变量，并通过 'ret' 输出结果\n// 'params' 和 'ret' 已经被正确地注入到环境中\n// 下面是一个示例，获取节点输入中参数名为‘input’的值：\n// const input = params.input; \n// 下面是一个示例，输出一个包含多种数据类型的 'ret' 对象：\n// const ret = { \"name\": ‘小明’, \"hobbies\": [“看书”, “旅游”] };\n\nasync function main({ params }: Args): Promise<Output> {\n\n    const { image_list, list, duration_list, imgData } = params;\n\n    const captions_keywords = list.map(item => item.desc_keywords);\n    \n    const data = mapCaptionsToTracks(imgData, image_list, captions_keywords)\n \n\n\n\n\n    // 构建输出对象\n    const ret = {\n        \"data\": data\n    };\n\n    return ret;\n}\n\n\nfunction mapCaptionsToTracks(imgData, image_list, captions_keywords) {\n    // 1. 合并所有轨道的图片，并全局排序\n    const allImages = [];\n    [\"left\", \"middle\", \"right\"].forEach(track => {\n      imgData[track].forEach(img => {\n        allImages.push({ ...img, track });\n      });\n    });\n    allImages.sort((a, b) => a.start - b.start);\n  \n    // 2. 计算全局调整后的 end（下一张图片的 start）\n    allImages.forEach((img, index) => {\n      const nextImg = allImages[index + 1];\n      img.adjustedEnd = nextImg ? nextImg.start : img.end;\n    });\n  \n    // 3. 按轨道重新分组调整后的图片数据\n    const trackAdjustedData = { left: [], middle: [], right: [] };\n    allImages.forEach(img => {\n      trackAdjustedData[img.track].push({\n        ...img,\n        adjustedEnd: img.adjustedEnd\n      });\n    });\n  \n    // 4. 创建映射：image_url -> { track, start, adjustedEnd }\n    const imageToTrackMap = {};\n    [\"left\", \"middle\", \"right\"].forEach(track => {\n      trackAdjustedData[track].forEach(img => {\n        imageToTrackMap[img.image_url] = {\n          track: track,\n          start: img.start,\n          adjustedEnd: img.adjustedEnd\n        };\n      });\n    });\n  \n    // 5. 收集关键词数据（使用调整后的 end）\n    const rawTrackData = { left: [], middle: [], right: [] };\n    image_list.forEach((imageUrl, index) => {\n      const trackInfo = imageToTrackMap[imageUrl];\n      const keywords = captions_keywords[index] || [];\n      if (trackInfo && keywords.length > 0) {\n        keywords.forEach(keyword => {\n          rawTrackData[trackInfo.track].push({\n            keyword:  \"🔵\"+keyword,\n            start: trackInfo.start,\n            end: trackInfo.adjustedEnd\n          });\n        });\n      }\n    });\n  \n    // 6. 按轨道和时间段分组关键词\n    const result = { left: {}, middle: {}, right: {} };\n    [\"left\", \"middle\", \"right\"].forEach(track => {\n      // 初始化数据结构\n      result[track] = {\n        x1_keywords: [], x1_timelines: [],\n        x2_keywords: [], x2_timelines: [],\n        x3_keywords: [], x3_timelines: []\n      };\n  \n      // 按时间段分组\n      const timeGroups = new Map();\n      rawTrackData[track].forEach(item => {\n        const key = `${item.start}-${item.end}`;\n        if (!timeGroups.has(key)) timeGroups.set(key, []);\n        timeGroups.get(key).push(item.keyword);\n      });\n  \n      // 分配坐标（每组最多3个关键词）\n      timeGroups.forEach((keywords, timeKey) => {\n        const [start, end] = timeKey.split(\"-\").map(Number);\n        keywords.slice(0, 3).forEach((keyword, idx) => {\n          const position = `x${idx + 1}`;\n          result[track][`${position}_keywords`].push(keyword);\n          result[track][`${position}_timelines`].push({ start, end });\n        });\n      });\n    });\n  \n    return result;\n  }\n\n\n  \n// function mapCaptionsToTracks(imgData, image_list, captions_keywords) {\n//     // 1. 按轨道预处理图片数据，生成排序后的图片列表及调整后的 end 时间\n//     const trackAdjustedData = { left: [], middle: [], right: [] };\n  \n//     // 对每个轨道的图片按 start 排序，并计算调整后的 end\n//     [\"left\", \"middle\", \"right\"].forEach(track => {\n//       // 深拷贝原始数据并排序\n//       const sortedImages = [...imgData[track]].sort((a, b) => a.start - b.start);\n      \n//       // 计算调整后的 end（下一张图片的 start）\n//       sortedImages.forEach((img, index) => {\n//         const nextImg = sortedImages[index + 1];\n//         const adjustedEnd = nextImg ? nextImg.start : img.end; // 没有下一张则保持原 end\n//         trackAdjustedData[track].push({\n//           ...img,\n//           adjustedEnd // 添加调整后的 end\n//         });\n//       });\n//     });\n  \n//     // 2. 创建映射：image_url -> { track, start, adjustedEnd }\n//     const imageToTrackMap = {};\n//     [\"left\", \"middle\", \"right\"].forEach(track => {\n//       trackAdjustedData[track].forEach(img => {\n//         imageToTrackMap[img.image_url] = {\n//           track: track,\n//           start: img.start,\n//           adjustedEnd: img.adjustedEnd // 使用调整后的 end\n//         };\n//       });\n//     });\n  \n//     // 3. 收集每个轨道的原始关键词数据（使用调整后的 end）\n//     const rawTrackData = { left: [], middle: [], right: [] };\n//     image_list.forEach((imageUrl, index) => {\n//       const trackInfo = imageToTrackMap[imageUrl];\n//       const keywords = captions_keywords[index] || [];\n//       if (trackInfo && keywords.length > 0) {\n//         keywords.forEach(keyword => {\n//           rawTrackData[trackInfo.track].push({\n//             keyword: keyword,\n//             start: trackInfo.start,\n//             end: trackInfo.adjustedEnd // 使用调整后的 end\n//           });\n//         });\n//       }\n//     });\n  \n//     // 4. 按轨道和时间段分组，分配坐标位置（后续逻辑不变，仅示例 left 轨道）\n//     const result = { left: {}, middle: {}, right: {} };\n//     [\"left\", \"middle\", \"right\"].forEach(track => {\n//       // 按 start 和 end 分组关键词\n//       const timeGroups = new Map();\n//       rawTrackData[track].forEach(item => {\n//         const key = `${item.start}-${item.end}`;\n//         if (!timeGroups.has(key)) timeGroups.set(key, []);\n//         timeGroups.get(key).push(item.keyword);\n//       });\n  \n//       // 初始化坐标数据\n//       result[track] = {\n//         x1_keywords: [], x1_timelines: [],\n//         x2_keywords: [], x2_timelines: [],\n//         x3_keywords: [], x3_timelines: []\n//       };\n  \n//       // 分配坐标（每组最多3个关键词）\n//       timeGroups.forEach((keywords, timeKey) => {\n//         const [start, end] = timeKey.split(\"-\").map(Number);\n//         keywords.slice(0, 3).forEach((keyword, idx) => {\n//           const position = `x${idx + 1}`;\n//           result[track][`${position}_keywords`].push(keyword);\n//           result[track][`${position}_timelines`].push({ start, end });\n//         });\n//       });\n//     });\n  \n//     return result;\n//   }\n\n  ","inputParameters":[{"input":{"schema":{"type":"integer"},"type":"list","value":{"content":{"blockID":"169595","name":"duration_list","source":"block-output"},"rawMeta":{"type":100},"type":"ref"}},"name":"duration_list"},{"input":{"schema":{"assistType":2,"type":"string"},"type":"list","value":{"content":{"blockID":"422322","name":"data_list","source":"block-output"},"rawMeta":{"type":104},"type":"ref"}},"name":"image_list"},{"input":{"schema":[{"name":"left","schema":{"schema":[],"type":"object"},"type":"list"},{"name":"middle","schema":{"schema":[],"type":"object"},"type":"list"},{"name":"right","schema":{"schema":[],"type":"object"},"type":"list"}],"type":"object","value":{"content":{"blockID":"152586","name":"imgData","source":"block-output"},"rawMeta":{"type":6},"type":"ref"}},"name":"imgData"},{"input":{"schema":{"schema":[{"name":"story_name","type":"string"},{"name":"desc","type":"string"},{"name":"cap","type":"string"},{"name":"desc_promopt","type":"string"},{"name":"desc_keywords","schema":{"type":"string"},"type":"list"}],"type":"object"},"type":"list","value":{"content":{"blockID":"173538","name":"list","source":"block-output"},"rawMeta":{"type":103},"type":"ref"}},"name":"list"}],"language":5,"settingOnError":{"processType":1,"retryTimes":0,"switch":false,"timeoutMs":60000}},"nodeMeta":{"description":"编写代码，处理输入变量来生成返回值","icon":"https://lf3-static.bytednsdoc.com/obj/eden-cn/dvsmryvd_avi_dvsm/ljhwZthlaukjlkulzlp/icon/icon-Code-v2.jpg","subTitle":"代码","title":"代码_视频关键词"},"outputs":[{"name":"data","required":false,"schema":[{"name":"left","schema":[{"name":"x1_keywords","schema":{"type":"string"},"type":"list"},{"name":"x1_timelines","schema":{"schema":[{"name":"start","type":"integer"},{"name":"end","type":"integer"}],"type":"object"},"type":"list"},{"name":"x2_keywords","schema":{"type":"string"},"type":"list"},{"name":"x2_timelines","schema":{"schema":[{"name":"start","type":"integer"},{"name":"end","type":"integer"}],"type":"object"},"type":"list"},{"name":"x3_keywords","schema":{"type":"string"},"type":"list"},{"name":"x3_timelines","schema":{"schema":[{"name":"start","type":"integer"},{"name":"end","type":"integer"}],"type":"object"},"type":"list"}],"type":"object"},{"name":"middle","schema":[{"name":"x1_keywords","schema":{"type":"string"},"type":"list"},{"name":"x1_timelines","schema":{"schema":[{"name":"start","type":"integer"},{"name":"end","type":"integer"}],"type":"object"},"type":"list"},{"name":"x2_keywords","schema":{"type":"string"},"type":"list"},{"name":"x2_timelines","schema":{"schema":[{"name":"start","type":"integer"},{"name":"end","type":"integer"}],"type":"object"},"type":"list"},{"name":"x3_keywords","schema":{"type":"string"},"type":"list"},{"name":"x3_timelines","schema":{"schema":[{"name":"start","type":"integer"},{"name":"end","type":"integer"}],"type":"object"},"type":"list"}],"type":"object"},{"name":"right","schema":[{"name":"x1_keywords","schema":{"type":"string"},"type":"list"},{"name":"x1_timelines","schema":{"schema":[{"name":"start","type":"integer"},{"name":"end","type":"integer"}],"type":"object"},"type":"list"},{"name":"x2_keywords","schema":{"type":"string"},"type":"list"},{"name":"x2_timelines","schema":{"schema":[{"name":"start","type":"integer"},{"name":"end","type":"integer"}],"type":"object"},"type":"list"},{"name":"x3_keywords","schema":{"type":"string"},"type":"list"},{"name":"x3_timelines","schema":{"schema":[{"name":"start","type":"integer"},{"name":"end","type":"integer"}],"type":"object"},"type":"list"}],"type":"object"}],"type":"object"}]},"edges":null,"id":"158857","meta":{"position":{"x":867.7073439035418,"y":-559.7176492097236}},"type":"5"},{"blocks":[],"data":{"inputs":{"apiParam":[{"input":{"type":"string","value":{"content":"7475829177439191075","rawMeta":{"type":1},"type":"literal"}},"name":"apiID"},{"input":{"type":"string","value":{"content":"caption_infos","rawMeta":{"type":1},"type":"literal"}},"name":"apiName"},{"input":{"type":"string","value":{"content":"7475829177439109155","rawMeta":{"type":1},"type":"literal"}},"name":"pluginID"},{"input":{"type":"string","value":{"content":"剪映小助手数据生成器","rawMeta":{"type":1},"type":"literal"}},"name":"pluginName"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"pluginVersion"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"tips"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"outDocLink"}],"inputDefs":[{"description":"关键词颜色","input":{},"name":"keyword_color","required":false,"type":"string"},{"description":"关键词字大小","input":{},"name":"keyword_font_size","required":false,"type":"integer"},{"description":"文本列表","input":{},"name":"texts","required":true,"schema":{"assistType":0,"type":"string"},"type":"list"},{"description":"时间节点，只接收结构：[{\"start\":0,\"end\":4612}]，一般从audio_timeline节点的输出获取","input":{},"name":"timelines","required":true,"schema":{"schema":[{"description":"结束时间","input":{},"name":"end","required":true,"type":"integer"},{"description":"开始时间","input":{},"name":"start","required":true,"type":"integer"}],"type":"object"},"type":"list"},{"description":"对应剪映的循环动画名字，多个动画请用英文|分割，比如：扫光|晃动","input":{},"name":"loop_animation","required":false,"type":"string"},{"description":"循环动画时长","input":{},"name":"loop_animation_duration","required":false,"type":"integer"},{"description":"对应剪映的出场动画名字，多个动画请用英文|分割，比如：消散|闭幕","input":{},"name":"out_animation","required":false,"type":"string"},{"description":"出场动画时长","input":{},"name":"out_animation_duration","required":false,"type":"integer"},{"description":"文字大小","input":{},"name":"font_size","required":false,"type":"integer"},{"description":"对应剪映的入场动画名字，多个动画请用英文|分割，比如：飞入|放大","input":{},"name":"in_animation","required":false,"type":"string"},{"description":"入场动画时长","input":{},"name":"in_animation_duration","required":false,"type":"integer"},{"description":"文本里面的重点词列表","input":{},"name":"keywords","required":false,"schema":{"assistType":0,"type":"string"},"type":"list"}],"inputParameters":[{"input":{"schema":{"type":"string"},"type":"list","value":{"content":{"blockID":"158857","name":"data.right.x1_keywords","source":"block-output"},"rawMeta":{"type":99},"type":"ref"}},"name":"texts"},{"input":{"schema":{"schema":[{"name":"start","type":"integer"},{"name":"end","type":"integer"}],"type":"object"},"type":"list","value":{"content":{"blockID":"158857","name":"data.right.x1_timelines","source":"block-output"},"rawMeta":{"type":103},"type":"ref"}},"name":"timelines"},{"input":{"type":"string","value":{"content":"日出","rawMeta":{"type":1},"type":"literal"}},"name":"in_animation"}],"settingOnError":{"processType":1,"retryTimes":0,"timeoutMs":180000}},"nodeMeta":{"description":"根据时间线制作字幕数据","icon":"https://p3-flow-product-sign.byteimg.com/tos-cn-i-13w3uml6bg/6a3507dfdb5c4dc49bd72ec0e17a7752~tplv-13w3uml6bg-resize:128:128.image?rk3s=2e2596fd&x-expires=1745502964&x-signature=mcJpqIM97yEoRk894zI4lQTP4Zw%3D","subtitle":"剪映小助手数据生成器:caption_infos","title":"caption_infos_right1"},"outputs":[{"name":"infos","required":false,"type":"string"}]},"edges":null,"id":"557830","meta":{"position":{"x":2683.3900829615677,"y":174.46224503887618}},"type":"4"},{"blocks":[],"data":{"inputs":{"apiParam":[{"input":{"type":"string","value":{"content":"7457837925833850920","rawMeta":{"type":1},"type":"literal"}},"name":"apiID"},{"input":{"type":"string","value":{"content":"add_captions","rawMeta":{"type":1},"type":"literal"}},"name":"apiName"},{"input":{"type":"string","value":{"content":"7457837925833801768","rawMeta":{"type":1},"type":"literal"}},"name":"pluginID"},{"input":{"type":"string","value":{"content":"视频合成_剪映小助手","rawMeta":{"type":1},"type":"literal"}},"name":"pluginName"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"pluginVersion"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"tips"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"outDocLink"}],"inputDefs":[{"description":"草稿地址，使用create_draft输出的draft_url即可","input":{},"name":"draft_url","required":true,"type":"string"},{"description":"默认：15","input":{},"name":"font_size","required":false,"type":"integer"},{"description":"scale_x缩放","input":{},"name":"scale_x","required":false,"type":"float"},{"description":"0 默认。1富文本样式","input":{},"name":"style_text","required":false,"type":"integer"},{"description":"文字颜色：#ff1837","input":{},"name":"text_color","required":false,"type":"string"},{"description":"transform_x位置","input":{},"name":"transform_x","required":false,"type":"float"},{"description":"查看说明：https://krxc4izye0.feishu.cn/wiki/HhQrw3BFhi1XGOkkJCBcfkqGnwf?from=from_copylink","input":{},"name":"captions","required":true,"type":"string"},{"description":"边框颜色，eg：#fe8a80","input":{},"name":"border_color","required":false,"type":"string"},{"description":"字体列表：https://krxc4izye0.feishu.cn/wiki/SmnrwabXriG7JckEzyGcChk4nDd","input":{},"name":"font","required":false,"type":"string"},{"description":"字间距，默认0","input":{},"name":"letter_spacing","required":false,"type":"float"},{"description":"行间距，默认0","input":{},"name":"line_spacing","required":false,"type":"float"},{"description":"scale_y缩放","input":{},"name":"scale_y","required":false,"type":"float"},{"description":"transform_y位置","input":{},"name":"transform_y","required":false,"type":"float"},{"description":"字幕的对齐方式，0左对齐，1 居中对齐，2右对齐","input":{},"name":"alignment","required":false,"type":"integer"}],"inputParameters":[{"input":{"type":"string","value":{"content":{"blockID":"864795","name":"infos","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"captions"},{"input":{"type":"string","value":{"content":{"blockID":"168118","name":"draft_url","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"draft_url"},{"input":{"type":"integer","value":{"content":5,"rawMeta":{"type":2},"type":"literal"}},"name":"font_size"},{"input":{"type":"integer","value":{"content":0,"rawMeta":{"type":2},"type":"literal"}},"name":"style_text"},{"input":{"type":"string","value":{"content":{"blockID":"159614","name":"keyword_color","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"text_color"},{"input":{"type":"float","value":{"content":185,"rawMeta":{"type":4},"type":"literal"}},"name":"transform_x"},{"input":{"type":"float","value":{"content":294,"rawMeta":{"type":4},"type":"literal"}},"name":"transform_y"}],"settingOnError":{"processType":1,"retryTimes":0,"timeoutMs":180000}},"nodeMeta":{"description":"批量添加字幕","icon":"https://p3-flow-product-sign.byteimg.com/tos-cn-i-13w3uml6bg/f013e4af74224258a37363a531aecefe~tplv-13w3uml6bg-resize:128:128.image?rk3s=2e2596fd&x-expires=1745502886&x-signature=rDIxeWJhVqe3YtFlHHLLbWduATM%3D","subtitle":"视频合成_剪映小助手:add_captions","title":"add_captions_middle1"},"outputs":[{"name":"track_id","required":false,"type":"string"},{"name":"draft_url","required":false,"type":"string"},{"name":"segment_ids","required":false,"schema":{"type":"string"},"type":"list"},{"name":"segment_infos","required":false,"schema":{"schema":[{"name":"end","required":false,"type":"integer"},{"name":"id","required":false,"type":"string"},{"name":"start","required":false,"type":"integer"}],"type":"object"},"type":"list"},{"name":"text_ids","required":false,"schema":{"type":"string"},"type":"list"}]},"edges":null,"id":"604929","meta":{"position":{"x":4980.00162741224,"y":59.82632470464718}},"type":"4"},{"blocks":[],"data":{"inputs":{"apiParam":[{"input":{"type":"string","value":{"content":"7457837925833850920","rawMeta":{"type":1},"type":"literal"}},"name":"apiID"},{"input":{"type":"string","value":{"content":"add_captions","rawMeta":{"type":1},"type":"literal"}},"name":"apiName"},{"input":{"type":"string","value":{"content":"7457837925833801768","rawMeta":{"type":1},"type":"literal"}},"name":"pluginID"},{"input":{"type":"string","value":{"content":"视频合成_剪映小助手","rawMeta":{"type":1},"type":"literal"}},"name":"pluginName"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"pluginVersion"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"tips"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"outDocLink"}],"inputDefs":[{"description":"草稿地址，使用create_draft输出的draft_url即可","input":{},"name":"draft_url","required":true,"type":"string"},{"description":"默认：15","input":{},"name":"font_size","required":false,"type":"integer"},{"description":"scale_x缩放","input":{},"name":"scale_x","required":false,"type":"float"},{"description":"0 默认。1富文本样式","input":{},"name":"style_text","required":false,"type":"integer"},{"description":"文字颜色：#ff1837","input":{},"name":"text_color","required":false,"type":"string"},{"description":"transform_x位置","input":{},"name":"transform_x","required":false,"type":"float"},{"description":"查看说明：https://krxc4izye0.feishu.cn/wiki/HhQrw3BFhi1XGOkkJCBcfkqGnwf?from=from_copylink","input":{},"name":"captions","required":true,"type":"string"},{"description":"边框颜色，eg：#fe8a80","input":{},"name":"border_color","required":false,"type":"string"},{"description":"字体列表：https://krxc4izye0.feishu.cn/wiki/SmnrwabXriG7JckEzyGcChk4nDd","input":{},"name":"font","required":false,"type":"string"},{"description":"字间距，默认0","input":{},"name":"letter_spacing","required":false,"type":"float"},{"description":"行间距，默认0","input":{},"name":"line_spacing","required":false,"type":"float"},{"description":"scale_y缩放","input":{},"name":"scale_y","required":false,"type":"float"},{"description":"transform_y位置","input":{},"name":"transform_y","required":false,"type":"float"},{"description":"字幕的对齐方式，0左对齐，1 居中对齐，2右对齐","input":{},"name":"alignment","required":false,"type":"integer"}],"inputParameters":[{"input":{"type":"string","value":{"content":{"blockID":"557830","name":"infos","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"captions"},{"input":{"type":"string","value":{"content":{"blockID":"168118","name":"draft_url","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"draft_url"},{"input":{"type":"integer","value":{"content":5,"rawMeta":{"type":2},"type":"literal"}},"name":"font_size"},{"input":{"type":"integer","value":{"content":0,"rawMeta":{"type":2},"type":"literal"}},"name":"style_text"},{"input":{"type":"string","value":{"content":{"blockID":"159614","name":"keyword_color","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"text_color"},{"input":{"type":"float","value":{"content":1067,"rawMeta":{"type":4},"type":"literal"}},"name":"transform_x"},{"input":{"type":"float","value":{"content":271,"rawMeta":{"type":4},"type":"literal"}},"name":"transform_y"}],"settingOnError":{"processType":1,"retryTimes":0,"timeoutMs":180000}},"nodeMeta":{"description":"批量添加字幕","icon":"https://p3-flow-product-sign.byteimg.com/tos-cn-i-13w3uml6bg/f013e4af74224258a37363a531aecefe~tplv-13w3uml6bg-resize:128:128.image?rk3s=2e2596fd&x-expires=1745502886&x-signature=rDIxeWJhVqe3YtFlHHLLbWduATM%3D","subtitle":"视频合成_剪映小助手:add_captions","title":"add_captions_right1"},"outputs":[{"name":"track_id","required":false,"type":"string"},{"name":"draft_url","required":false,"type":"string"},{"name":"segment_ids","required":false,"schema":{"type":"string"},"type":"list"},{"name":"segment_infos","required":false,"schema":{"schema":[{"name":"end","required":false,"type":"integer"},{"name":"id","required":false,"type":"string"},{"name":"start","required":false,"type":"integer"}],"type":"object"},"type":"list"},{"name":"text_ids","required":false,"schema":{"type":"string"},"type":"list"}]},"edges":null,"id":"616043","meta":{"position":{"x":4980.00162741224,"y":217.97340180018193}},"type":"4"},{"blocks":[],"data":{"inputs":{"apiParam":[{"input":{"type":"string","value":{"content":"7475829177439191075","rawMeta":{"type":1},"type":"literal"}},"name":"apiID"},{"input":{"type":"string","value":{"content":"caption_infos","rawMeta":{"type":1},"type":"literal"}},"name":"apiName"},{"input":{"type":"string","value":{"content":"7475829177439109155","rawMeta":{"type":1},"type":"literal"}},"name":"pluginID"},{"input":{"type":"string","value":{"content":"剪映小助手数据生成器","rawMeta":{"type":1},"type":"literal"}},"name":"pluginName"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"pluginVersion"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"tips"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"outDocLink"}],"inputDefs":[{"description":"关键词颜色","input":{},"name":"keyword_color","required":false,"type":"string"},{"description":"关键词字大小","input":{},"name":"keyword_font_size","required":false,"type":"integer"},{"description":"文本列表","input":{},"name":"texts","required":true,"schema":{"assistType":0,"type":"string"},"type":"list"},{"description":"时间节点，只接收结构：[{\"start\":0,\"end\":4612}]，一般从audio_timeline节点的输出获取","input":{},"name":"timelines","required":true,"schema":{"schema":[{"description":"结束时间","input":{},"name":"end","required":true,"type":"integer"},{"description":"开始时间","input":{},"name":"start","required":true,"type":"integer"}],"type":"object"},"type":"list"},{"description":"对应剪映的循环动画名字，多个动画请用英文|分割，比如：扫光|晃动","input":{},"name":"loop_animation","required":false,"type":"string"},{"description":"循环动画时长","input":{},"name":"loop_animation_duration","required":false,"type":"integer"},{"description":"对应剪映的出场动画名字，多个动画请用英文|分割，比如：消散|闭幕","input":{},"name":"out_animation","required":false,"type":"string"},{"description":"出场动画时长","input":{},"name":"out_animation_duration","required":false,"type":"integer"},{"description":"文字大小","input":{},"name":"font_size","required":false,"type":"integer"},{"description":"对应剪映的入场动画名字，多个动画请用英文|分割，比如：飞入|放大","input":{},"name":"in_animation","required":false,"type":"string"},{"description":"入场动画时长","input":{},"name":"in_animation_duration","required":false,"type":"integer"},{"description":"文本里面的重点词列表","input":{},"name":"keywords","required":false,"schema":{"assistType":0,"type":"string"},"type":"list"}],"inputParameters":[{"input":{"schema":{"type":"string"},"type":"list","value":{"content":{"blockID":"158857","name":"data.middle.x1_keywords","source":"block-output"},"rawMeta":{"type":99},"type":"ref"}},"name":"texts"},{"input":{"schema":{"schema":[{"name":"start","type":"integer"},{"name":"end","type":"integer"}],"type":"object"},"type":"list","value":{"content":{"blockID":"158857","name":"data.middle.x1_timelines","source":"block-output"},"rawMeta":{"type":103},"type":"ref"}},"name":"timelines"},{"input":{"type":"string","value":{"content":"向下滑动","rawMeta":{"type":1},"type":"literal"}},"name":"in_animation"}],"settingOnError":{"processType":1,"retryTimes":0,"timeoutMs":180000}},"nodeMeta":{"description":"根据时间线制作字幕数据","icon":"https://p3-flow-product-sign.byteimg.com/tos-cn-i-13w3uml6bg/6a3507dfdb5c4dc49bd72ec0e17a7752~tplv-13w3uml6bg-resize:128:128.image?rk3s=2e2596fd&x-expires=1745502964&x-signature=mcJpqIM97yEoRk894zI4lQTP4Zw%3D","subtitle":"剪映小助手数据生成器:caption_infos","title":"caption_infos_middle11"},"outputs":[{"name":"infos","required":false,"type":"string"}]},"edges":null,"id":"864795","meta":{"position":{"x":2640.176689163626,"y":10.658439337603923}},"type":"4"},{"blocks":[],"data":{"inputs":{"mergeGroups":[{"name":"Group1","variables":[{"type":"string","value":{"content":{"blockID":"168118","name":"draft_url","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}}]},{"name":"Group2","variables":[{"type":"string","value":{"content":{"blockID":"100001","name":"title","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}}]}]},"nodeMeta":{"description":"对多个分支的输出进行聚合处理","icon":"https://lf3-static.bytednsdoc.com/obj/eden-cn/dvsmryvd_avi_dvsm/ljhwZthlaukjlkulzlp/icon/VariableMerge-icon.jpg","mainColor":"#00B2B2","subTitle":"变量聚合","title":"变量聚合"},"outputs":[{"name":"Group1","type":"string"},{"name":"Group2","type":"string"}]},"edges":null,"id":"107896","meta":{"position":{"x":5495.703818958104,"y":273.2730082245722}},"type":"32"},{"blocks":[],"data":{"inputs":{"branches":[{"condition":{"conditions":[{"left":{"input":{"type":"boolean","value":{"content":{"blockID":"100001","name":"is_show_img_keywords","source":"block-output"},"type":"ref"}}},"operator":1,"right":{"input":{"type":"string","value":{"content":"显示","rawMeta":{"type":1},"type":"literal"}}}}],"logic":2}}]},"nodeMeta":{"description":"连接多个下游分支，若设定的条件成立则仅运行对应的分支，若均不成立则只运行“否则”分支","icon":"https://lf3-static.bytednsdoc.com/obj/eden-cn/dvsmryvd_avi_dvsm/ljhwZthlaukjlkulzlp/icon/icon-Condition-v2.jpg","mainColor":"#00B2B2","subTitle":"选择器","title":"选择器_4"}},"edges":null,"id":"132546","meta":{"position":{"x":4511.33964511246,"y":-95.55974677133769}},"type":"8"},{"blocks":[],"data":{"inputs":{"code":"// 在这里，您可以通过 ‘params’  获取节点中的输入变量，并通过 'ret' 输出结果\n// 'params' 和 'ret' 已经被正确地注入到环境中\n// 下面是一个示例，获取节点输入中参数名为‘input’的值：\n// const input = params.input; \n// 下面是一个示例，输出一个包含多种数据类型的 'ret' 对象：\n// const ret = { \"name\": ‘小明’, \"hobbies\": [“看书”, “旅游”] };\n\nasync function main({ params }: Args): Promise<Output> {\n    \n    var logo = params.logo;\n    if(!logo){\n        logo = \"https://codel-agent.oss-cn-shanghai.aliyuncs.com/video_stick_psy_flow_plus.png\";\n    }\n\n    var vo_type = params.vo_type;\n    var speakerid = \"zh_male_yuanboxiaoshu_moon_bigtts\";\n    // 邻家女孩 zh_female_linjianvhai_moon_bigtts\n    // 渊博小叔 zh_male_yuanboxiaoshu_moon_bigtts\n\n    if(vo_type){\n        if(vo_type==\"邻家女孩\"){\n            speakerid = \"zh_female_linjianvhai_moon_bigtts\";\n        }\n    } \n\n    // 构建输出对象\n    const ret = {\n        \"logo\": logo,\n        \"speakerid\": speakerid\n    };\n\n    return ret;\n}","inputParameters":[{"input":{"assistType":2,"type":"string","value":{"content":{"blockID":"100001","name":"logo","source":"block-output"},"rawMeta":{"type":7},"type":"ref"}},"name":"logo"},{"input":{"type":"string","value":{"content":{"blockID":"100001","name":"vo_type","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"vo_type"}],"language":5,"settingOnError":{"processType":1,"retryTimes":0,"switch":false,"timeoutMs":60000}},"nodeMeta":{"description":"编写代码，处理输入变量来生成返回值","icon":"https://lf3-static.bytednsdoc.com/obj/eden-cn/dvsmryvd_avi_dvsm/ljhwZthlaukjlkulzlp/icon/icon-Code-v2.jpg","subTitle":"代码","title":"代码_logo_声音处理"},"outputs":[{"name":"logo","required":false,"type":"string"},{"name":"speakerid","required":false,"type":"string"}]},"edges":null,"id":"152899","meta":{"position":{"x":-1700.542094158333,"y":-790.0760885205722}},"type":"5"},{"blocks":[],"data":{"inputs":{"callTransferVoice":true,"chatHistoryWriting":"historyWrite","content":{"type":"string","value":{"content":"**复制下面地址，使用剪映小助手下载草稿**\n**草稿地址（可立即下载，推荐）**：{{draft_url}}\n","type":"literal"}},"inputParameters":[{"input":{"type":"string","value":{"content":{"blockID":"107896","name":"Group1","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"draft_url"}],"streamingOutput":false},"nodeMeta":{"description":"节点从“消息”更名为“输出”，支持中间过程的消息输出，支持流式和非流式两种方式","icon":"https://lf3-static.bytednsdoc.com/obj/eden-cn/dvsmryvd_avi_dvsm/ljhwZthlaukjlkulzlp/icon/icon-Output-v2.jpg","mainColor":"#5C62FF","subTitle":"输出","title":"输出_输出结果"}},"edges":null,"id":"103582","meta":{"position":{"x":6318.090417955272,"y":397.0415058501022}},"type":"13"},{"blocks":[],"data":{"inputs":{"code":"// 在这里，您可以通过 ‘params’  获取节点中的输入变量，并通过 'ret' 输出结果\n// 'params' 和 'ret' 已经被正确地注入到环境中\n// 下面是一个示例，获取节点输入中参数名为‘input’的值：\n// const input = params.input; \n// 下面是一个示例，输出一个包含多种数据类型的 'ret' 对象：\n// const ret = { \"name\": ‘小明’, \"hobbies\": [“看书”, “旅游”] };\n\nasync function main({ params }: Args): Promise<Output> {\n\n    // var style = params.style;\n  \n    // var llm_prompt = `\n    // 通用模板：极简主义黑色火柴人，纯黑色实心填充无轮廓线，粗体块状四肢结构分明，白色背景高对比度，二维平面设计风格，无阴影无渐变：黑色火柴人 + 行为动作 + 带有颜色的符号或物品 + 色彩点缀，儿童简笔画风格，超高清晰度矢量图\n    // 要求：除人物外其他物品需增加色彩点缀，增加符号、物品等简约装饰元素增加氛围\n    // 提示词参考案例：\n    // 1. 极简主义黑色火柴人，纯黑色实心填充无轮廓线，粗体块状四肢结构分明，白色背景高对比度，二维平面设计风格，无阴影无渐变：黑色女火柴人指向黑色男火柴人（生气动作） + 头顶蓝色问号（带有色彩的符号），儿童简笔画风格，超高清晰度矢量图\n    // 2. 极简主义黑色火柴人，纯黑色实心填充无轮廓线，粗体块状四肢结构分明，白色背景高对比度，二维平面设计风格，无阴影无渐变：黑色男火柴人与黑色女火柴人站在小巷尽头 + 彩色“交流饱和期”牌子（带有色彩的物品），儿童简笔画风格，超高清晰度矢量图\n    // 3. 极简主义黑色火柴人，纯黑色实心填充无轮廓线，粗体块状四肢结构分明，白色背景高对比度，二维平面设计风格，无阴影无渐变：黑色男火柴人与黑色女火柴人坐在棕色沙发上（疲惫神态） + 蓝色走动时钟（带有色彩且有动态的物品），儿童简笔画风格，超高清晰度矢量图\n    // 4. 极简主义黑色火柴人，纯黑色实心填充无轮廓线，粗体块状四肢结构分明，白色背景高对比度，二维平面设计风格，无阴影无渐变：黑色男火柴人与黑色女火柴人坐在沙发上（疲惫神态） + 围绕代表话题等的彩色图案（带有色彩的物品），儿童简笔画风格，超高清晰度矢量图\n    // 5. 极简主义黑色火柴人，纯黑色实心填充无轮廓线，粗体块状四肢结构分明，白色背景高对比度，二维平面设计风格，无阴影无渐变：黑色火柴人背着蓝色背包走在路上（带有色彩的物品），儿童简笔画风格，超高清晰度矢量图\n    // `;\n\n    // //极简主义黑色火柴人，纯黑色实心填充无轮廓线，粗体块状四肢结构分明，白色背景高对比度，二维平面设计风格，无阴影无渐变，人物呈现挠头姿势，用两个圆点表现困惑表情，儿童简笔画风格，超高清晰度矢量图\n    // var img_prompt=\"\";\n    // var img_prompt2 = \"\";\n    // var keyword_color = \"#2b2825\";// #FBE40A=黄色\n\n    // if(style){\n    //     if(style==\"黑白\"){\n    //         //llm_prompt=\"A minimalist image with stick figures having clean lines and high contrast. The background is white, figures are primarily black with white outlines. \"\n    //         llm_prompt = `\n    //         通用模板：极简主义黑色火柴人，纯黑色实心填充无轮廓线，粗体块状四肢结构分明，白色背景高对比度，二维平面设计风格，无阴影无渐变：黑色火柴人 + 行为动作 + 黑白色的符号或物品，儿童简笔画风格，超高清晰度矢量图\n    //         要求：增加黑白色符号、物品等简约装饰元素增加氛围\n    //         提示词参考案例：\n    //         1. 极简主义黑色火柴人，纯黑色实心填充无轮廓线，粗体块状四肢结构分明，白色背景高对比度，二维平面设计风格，无阴影无渐变：黑色女火柴人指向黑色男火柴人（生气动作） + 头顶黑色问号（带有黑色的符号），儿童简笔画风格，超高清晰度矢量图\n    //         2. 极简主义黑色火柴人，纯黑色实心填充无轮廓线，粗体块状四肢结构分明，白色背景高对比度，二维平面设计风格，无阴影无渐变：黑色男火柴人与黑色女火柴人站在小巷尽头 + 黑白“交流饱和期”牌子（带有黑白色的物品），儿童简笔画风格，超高清晰度矢量图\n    //         3. 极简主义黑色火柴人，纯黑色实心填充无轮廓线，粗体块状四肢结构分明，白色背景高对比度，二维平面设计风格，无阴影无渐变：黑色男火柴人与黑色女火柴人坐在白色沙发上（疲惫神态） + 黑色走动时钟（带有黑白色且有动态的物品），儿童简笔画风格，超高清晰度矢量图\n    //         4. 极简主义黑色火柴人，纯黑色实心填充无轮廓线，粗体块状四肢结构分明，白色背景高对比度，二维平面设计风格，无阴影无渐变：黑色男火柴人与黑色女火柴人坐在沙发上（疲惫神态） + 围绕代表话题等的黑白图案（带有黑白色的物品），儿童简笔画风格，超高清晰度矢量图\n    //         5. 极简主义黑色火柴人，纯黑色实心填充无轮廓线，粗体块状四肢结构分明，白色背景高对比度，二维平面设计风格，无阴影无渐变：黑色火柴人背着黑色背包走在路上（带有黑色的物品），儿童简笔画风格，超高清晰度矢量图\n    //         `;\n    //         img_prompt=\"\";\n    //         img_prompt2 = \"颜色，彩色，五颜六色\";\n    //         keyword_color = \"#2b2825\";\n    //     }\n    // }\n\n    \n    var style = params.style;\n    var llm_prompt=\"A minimalist image with stick figures having clean lines and high contrast. The background is white, figures are primarily black with white outlines, Items can be colored , allowing for minimal accents in other colors. \"\n    var img_prompt=\"4K，丰富的细节，彩色点缀，物品是彩色的\";\n    var img_prompt2 = \"描边，缺乏四肢，不干净的画面，真实人物，真实物品\";\n    var keyword_color = \"#2b2825\";// #FBE40A=黄色\n\n    if(style){\n        if(style==\"黑白\"){\n            llm_prompt=\"A minimalist image with stick figures having clean lines and high contrast. The background is white, figures are primarily black with white outlines. \"\n            img_prompt=\"白色背景，黑白风格，矢量图风格，黑色火柴黑人，最佳品质，超精细，杰作，4看，丰富的细节，\";\n            img_prompt2 = \"描边，颜色，纯黑色背景，渐变，缺乏四肢，不干净的画面，多边形，立体，3d，彩色，五颜六色，真实人物，真实物品\";\n            keyword_color = \"#FFFFFF\";\n        }\n    }\n    \n    // 构建输出对象\n    const ret = {\n        \"llm_prompt\": llm_prompt, // 拼接两次入参 input 的值\n        \"img_prompt\": img_prompt,\n        \"img_prompt2\": img_prompt2,\n        \"keyword_color\": keyword_color\n    };\n\n    return ret;\n}","inputParameters":[{"input":{"type":"string","value":{"content":{"blockID":"100001","name":"style","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"style"}],"language":5,"settingOnError":{"processType":1,"retryTimes":0,"switch":false,"timeoutMs":60000}},"nodeMeta":{"description":"编写代码，处理输入变量来生成返回值","icon":"https://lf3-static.bytednsdoc.com/obj/eden-cn/dvsmryvd_avi_dvsm/ljhwZthlaukjlkulzlp/icon/icon-Code-v2.jpg","subTitle":"代码","title":"代码_风格"},"outputs":[{"name":"img_prompt","required":false,"type":"string"},{"name":"llm_prompt","required":false,"type":"string"},{"name":"img_prompt2","required":false,"type":"string"},{"name":"keyword_color","required":false,"type":"string"}]},"edges":null,"id":"159614","meta":{"position":{"x":-3900.316600800885,"y":-763.1368896865409}},"type":"5"},{"blocks":[{"blocks":[],"data":{"inputs":{"inputParameters":[{"input":{"type":"string","value":{"content":{"blockID":"422322","name":"list.desc_promopt","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"desc_info"},{"input":{"type":"string","value":{"content":{"blockID":"422322","name":"list.desc","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"desc"},{"input":{"type":"string","value":{"content":{"blockID":"159614","name":"img_prompt","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"img_prompt"},{"input":{"type":"string","value":{"content":{"blockID":"159614","name":"img_prompt2","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"img_prompt2"}],"modelSetting":{"custom_ratio":{"height":1024,"width":1024},"ddim_steps":20,"model":8},"prompt":{"negative_prompt":"{{img_prompt2}}","prompt":"{{img_prompt}}:{{desc_info}}"},"references":[],"settingOnError":{"processType":1,"retryTimes":0,"timeoutMs":60000}},"nodeMeta":{"description":"通过文字描述/添加参考图生成图片","icon":"https://lf3-static.bytednsdoc.com/obj/eden-cn/dvsmryvd_avi_dvsm/ljhwZthlaukjlkulzlp/icon/icon-ImageGeneration-v2.jpg","mainColor":"#FF4DC3","subTitle":"图像生成","title":"图像生成_1"},"outputs":[{"assistType":2,"name":"data","type":"string"},{"name":"msg","type":"string"}]},"edges":null,"id":"743431","meta":{"position":{"x":-94.44235561948555,"y":-84.27329232920172}},"type":"16"},{"blocks":[],"data":{"inputs":{"apiParam":[{"input":{"type":"string","value":{"content":"7438919188246429731","rawMeta":{"type":1},"type":"literal"}},"name":"apiID"},{"input":{"type":"string","value":{"content":"cutout","rawMeta":{"type":1},"type":"literal"}},"name":"apiName"},{"input":{"type":"string","value":{"content":"7438919188246413347","rawMeta":{"type":1},"type":"literal"}},"name":"pluginID"},{"input":{"type":"string","value":{"content":"抠图","rawMeta":{"type":1},"type":"literal"}},"name":"pluginName"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"pluginVersion"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"tips"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"outDocLink"}],"inputDefs":[{"defaultValue":0,"description":"输出图模式，可选透明背景图/蒙版矢量图, enum list is [0,1], default value is 0","enum":[0,1],"enumVarNames":["透明背景图","蒙版矢量图"],"input":{},"name":"output_mode","required":false,"title":"输出图模式","type":"integer"},{"description":"自定义抠图内容的提示词，不填时默认保留主体抠图","input":{},"name":"prompt","required":false,"title":"提示词","type":"string"},{"assistType":2,"description":"待抠图的图片","input":{},"name":"url","required":true,"title":"上传图","type":"image"}],"inputParameters":[{"input":{"assistType":2,"type":"string","value":{"content":{"blockID":"743431","name":"data","source":"block-output"},"rawMeta":{"type":7},"type":"ref"}},"name":"url"},{"input":{"type":"string","value":{"content":"0","type":"literal"}},"name":"only_mask"},{"input":{"type":"string","value":{"content":"0","type":"literal"}},"name":"output_mode"}],"settingOnError":{"processType":1,"retryTimes":0,"timeoutMs":180000}},"nodeMeta":{"description":"保留图片前景主体，输出透明背景(.png)","icon":"https://lf3-static.bytednsdoc.com/obj/eden-cn/dvsmryvd_avi_dvsm/ljhwZthlaukjlkulzlp/icon/icon-plugin-cutout-v2.jpg","subtitle":"抠图:cutout","title":"cutout_1"},"outputs":[{"description":"抠图区域蒙板矢量图，在输出模式为蒙版矢量图时生效","name":"mask","required":false,"type":"string"},{"name":"msg","required":false,"type":"string"},{"assistType":2,"description":"透明背景图，在输出模式为透明背景时生效","name":"data","required":false,"type":"string"}]},"edges":null,"id":"849828","meta":{"position":{"x":923.5235868220626,"y":-70.3232923292017}},"type":"4"},{"blocks":[],"data":{"inputs":{"mergeGroups":[{"name":"Group1","variables":[{"assistType":2,"type":"string","value":{"content":{"blockID":"849828","name":"data","source":"block-output"},"rawMeta":{"type":7},"type":"ref"}}]}]},"nodeMeta":{"description":"对多个分支的输出进行聚合处理","icon":"https://lf3-static.bytednsdoc.com/obj/eden-cn/dvsmryvd_avi_dvsm/ljhwZthlaukjlkulzlp/icon/VariableMerge-icon.jpg","mainColor":"#00B2B2","subTitle":"变量聚合","title":"变量聚合_1"},"outputs":[{"assistType":2,"name":"Group1","type":"string"}]},"edges":null,"id":"199496","meta":{"position":{"x":1283.5235868220625,"y":113.40089877410435}},"type":"32"}],"data":{"inputs":{"batchSize":{"type":"integer","value":{"content":50,"rawMeta":{"type":2},"type":"literal"}},"concurrentSize":{"type":"integer","value":{"content":2,"rawMeta":{"type":2},"type":"literal"}},"inputParameters":[{"input":{"schema":{"schema":[{"name":"story_name","type":"string"},{"name":"desc","type":"string"},{"name":"cap","type":"string"},{"name":"desc_promopt","type":"string"},{"name":"desc_keywords","schema":{"type":"string"},"type":"list"}],"type":"object"},"type":"list","value":{"content":{"blockID":"173538","name":"list","source":"block-output"},"rawMeta":{"type":103},"type":"ref"}},"name":"list"}]},"nodeMeta":{"description":"通过设定批量运行次数和逻辑，运行批处理体内的任务","icon":"https://lf3-static.bytednsdoc.com/obj/eden-cn/dvsmryvd_avi_dvsm/ljhwZthlaukjlkulzlp/icon/icon-Batch-v2.jpg","mainColor":"#00B2B2","subTitle":"批处理","title":"批处理_1"},"outputs":[{"input":{"assistType":2,"schema":{"type":"string"},"type":"list","value":{"content":{"blockID":"199496","name":"Group1","source":"block-output"},"rawMeta":{"type":7},"type":"ref"}},"name":"data_list"}]},"edges":[{"sourceNodeID":"422322","sourcePortID":"batch-function-inline-output","targetNodeID":"743431"},{"sourceNodeID":"743431","sourcePortID":"","targetNodeID":"849828"},{"sourceNodeID":"849828","sourcePortID":"","targetNodeID":"199496"},{"sourceNodeID":"199496","sourcePortID":"","targetNodeID":"422322","targetPortID":"batch-function-inline-input"}],"id":"422322","meta":{"canvasPosition":{"x":-2809.7376083892527,"y":-110.20981844162303},"position":{"x":-2262.267507709716,"y":-763.1368896865409}},"type":"28"},{"blocks":[],"data":{"inputs":{"canvasSchema":"{\"version\":\"6.0.0-rc2\",\"width\":1920,\"height\":1080,\"backgroundColor\":\"#ffffffff\",\"customVariableRefs\":[{\"variableId\":\"uVykcxoTM7A5ucOq3o56e\",\"objectId\":\"5y_oInA3pIHG8S_7budL0\",\"variableName\":\"left_top\"},{\"variableId\":\"nnpdSNIMsKPJzUSB79B1v\",\"objectId\":\"2i71eehH41ZylH0LMw2SS\",\"variableName\":\"right_top\"},{\"variableId\":\"O00ldPjWqMo5nSiV3P1CL\",\"objectId\":\"21B49ClBWQ4_UHg1BH7xr\",\"variableName\":\"logo\"}],\"objects\":[{\"fontSize\":72,\"fontWeight\":\"normal\",\"fontFamily\":\"中等-思源黑体\",\"fontStyle\":\"normal\",\"lineHeight\":1.2,\"text\":\"从本能到驯化，警惕择偶陷阱\",\"charSpacing\":0,\"textAlign\":\"left\",\"styles\":[],\"pathStartOffset\":0,\"pathSide\":\"left\",\"pathAlign\":\"baseline\",\"underline\":false,\"overline\":false,\"linethrough\":false,\"textBackgroundColor\":\"\",\"direction\":\"ltr\",\"width\":936,\"height\":81.36,\"editable\":true,\"backgroundColor\":\"\",\"padding\":0,\"customId\":\"5y_oInA3pIHG8S_7budL0\",\"customType\":\"inline_text\",\"type\":\"IText\",\"version\":\"6.0.0-rc2\",\"originX\":\"left\",\"originY\":\"top\",\"left\":102.916,\"top\":24.3689,\"fill\":\"#000000ff\",\"stroke\":\"#000000ff\",\"strokeWidth\":0,\"strokeDashArray\":null,\"strokeLineCap\":\"butt\",\"strokeDashOffset\":0,\"strokeLineJoin\":\"miter\",\"strokeUniform\":false,\"strokeMiterLimit\":4,\"scaleX\":1,\"scaleY\":1,\"angle\":0,\"flipX\":false,\"flipY\":false,\"opacity\":1,\"shadow\":null,\"visible\":true,\"fillRule\":\"nonzero\",\"paintFirst\":\"fill\",\"globalCompositeOperation\":\"source-over\",\"skewX\":0,\"skewY\":0},{\"fontSize\":48,\"fontWeight\":\"normal\",\"fontFamily\":\"常规体-思源黑体\",\"fontStyle\":\"normal\",\"lineHeight\":1.2,\"text\":\"米粒恋爱说\",\"charSpacing\":0,\"textAlign\":\"right\",\"styles\":[],\"pathStartOffset\":0,\"pathSide\":\"left\",\"pathAlign\":\"baseline\",\"underline\":false,\"overline\":false,\"linethrough\":false,\"textBackgroundColor\":\"\",\"direction\":\"ltr\",\"width\":240,\"height\":54.24,\"editable\":true,\"backgroundColor\":\"\",\"padding\":0,\"customId\":\"2i71eehH41ZylH0LMw2SS\",\"customType\":\"inline_text\",\"type\":\"IText\",\"version\":\"6.0.0-rc2\",\"originX\":\"left\",\"originY\":\"top\",\"left\":1567.2572,\"top\":30.4089,\"fill\":\"#000000ff\",\"stroke\":\"#000000ff\",\"strokeWidth\":0,\"strokeDashArray\":null,\"strokeLineCap\":\"butt\",\"strokeDashOffset\":0,\"strokeLineJoin\":\"miter\",\"strokeUniform\":false,\"strokeMiterLimit\":4,\"scaleX\":1,\"scaleY\":1,\"angle\":0,\"flipX\":false,\"flipY\":false,\"opacity\":1,\"shadow\":null,\"visible\":true,\"fillRule\":\"nonzero\",\"paintFirst\":\"fill\",\"globalCompositeOperation\":\"source-over\",\"skewX\":0,\"skewY\":0},{\"width\":1919.9073,\"height\":3.7245,\"backgroundColor\":\"\",\"padding\":0,\"customId\":\"D6Ns99LWykNVzBpioidoP\",\"customType\":\"straight_line\",\"type\":\"Line\",\"version\":\"6.0.0-rc2\",\"originX\":\"left\",\"originY\":\"top\",\"left\":-0.8306,\"top\":869.724,\"fill\":\"rgb(0,0,0)\",\"stroke\":\"#333333fe\",\"strokeWidth\":5,\"strokeDashArray\":null,\"strokeLineCap\":\"round\",\"strokeDashOffset\":0,\"strokeLineJoin\":\"miter\",\"strokeUniform\":false,\"strokeMiterLimit\":4,\"scaleX\":1,\"scaleY\":1,\"angle\":0,\"flipX\":false,\"flipY\":false,\"opacity\":1,\"shadow\":null,\"visible\":true,\"fillRule\":\"nonzero\",\"paintFirst\":\"fill\",\"globalCompositeOperation\":\"source-over\",\"skewX\":0,\"skewY\":0,\"x1\":-959.9536324833155,\"x2\":959.9536324833155,\"y1\":1.8622696411252946,\"y2\":-1.8622696411252946},{\"subTargetCheck\":false,\"interactive\":false,\"width\":79.9665,\"height\":81.8536,\"backgroundColor\":\"\",\"padding\":0,\"customFixedHeight\":82.39275356295207,\"customId\":\"21B49ClBWQ4_UHg1BH7xr\",\"customType\":\"img\",\"type\":\"Group\",\"version\":\"6.0.0-rc2\",\"originX\":\"left\",\"originY\":\"top\",\"left\":14.5097,\"top\":20.0821,\"fill\":\"rgb(0,0,0)\",\"stroke\":null,\"strokeWidth\":0,\"strokeDashArray\":null,\"strokeLineCap\":\"butt\",\"strokeDashOffset\":0,\"strokeLineJoin\":\"miter\",\"strokeUniform\":false,\"strokeMiterLimit\":4,\"scaleX\":1,\"scaleY\":1,\"angle\":0,\"flipX\":false,\"flipY\":false,\"opacity\":1,\"shadow\":null,\"visible\":true,\"fillRule\":\"nonzero\",\"paintFirst\":\"fill\",\"globalCompositeOperation\":\"source-over\",\"skewX\":0,\"skewY\":0,\"clipPath\":{\"rx\":0,\"ry\":0,\"width\":79.9665,\"height\":81.8536,\"backgroundColor\":\"\",\"padding\":0,\"type\":\"Rect\",\"version\":\"6.0.0-rc2\",\"originX\":\"left\",\"originY\":\"top\",\"left\":-39.9832,\"top\":-40.9268,\"fill\":\"rgb(0,0,0)\",\"stroke\":null,\"strokeWidth\":1,\"strokeDashArray\":null,\"strokeLineCap\":\"butt\",\"strokeDashOffset\":0,\"strokeLineJoin\":\"miter\",\"strokeUniform\":false,\"strokeMiterLimit\":4,\"scaleX\":1,\"scaleY\":1,\"angle\":0,\"flipX\":false,\"flipY\":false,\"opacity\":1,\"shadow\":null,\"visible\":true,\"fillRule\":\"nonzero\",\"paintFirst\":\"fill\",\"globalCompositeOperation\":\"source-over\",\"skewX\":0,\"skewY\":0,\"inverted\":false,\"absolutePositioned\":false},\"layoutManager\":{\"type\":\"layoutManager\",\"strategy\":\"fit-content\"},\"objects\":[{\"cropX\":0,\"cropY\":0,\"width\":537,\"height\":449,\"backgroundColor\":\"\",\"padding\":0,\"customFixedType\":\"fill\",\"type\":\"Image\",\"version\":\"6.0.0-rc2\",\"originX\":\"left\",\"originY\":\"top\",\"left\":-49.5461,\"top\":-41.4268,\"fill\":\"rgb(0,0,0)\",\"stroke\":null,\"strokeWidth\":0,\"strokeDashArray\":null,\"strokeLineCap\":\"butt\",\"strokeDashOffset\":0,\"strokeLineJoin\":\"miter\",\"strokeUniform\":false,\"strokeMiterLimit\":4,\"scaleX\":0.1845,\"scaleY\":0.1845,\"angle\":0,\"flipX\":false,\"flipY\":false,\"opacity\":1,\"shadow\":null,\"visible\":true,\"fillRule\":\"nonzero\",\"paintFirst\":\"fill\",\"globalCompositeOperation\":\"source-over\",\"skewX\":0,\"skewY\":0,\"src\":\"https://p9-bot-workflow-sign.byteimg.com/tos-cn-i-mdko3gqilj/613929b244dd47669c959dc2d14c60f5.png~tplv-mdko3gqilj-image.image?rk3s=81d4c505&x-expires=1773793594&x-signature=Ft6dLnkl3bNevpdOCKGQHJSD%2BrY%3D\",\"crossOrigin\":null,\"filters\":[]},{\"rx\":0,\"ry\":0,\"width\":79.9665,\"height\":81.8536,\"backgroundColor\":\"\",\"padding\":0,\"type\":\"Rect\",\"version\":\"6.0.0-rc2\",\"originX\":\"left\",\"originY\":\"top\",\"left\":-39.9832,\"top\":-40.9268,\"fill\":\"#00000000\",\"stroke\":\"#000000ff\",\"strokeWidth\":0,\"strokeDashArray\":null,\"strokeLineCap\":\"butt\",\"strokeDashOffset\":0,\"strokeLineJoin\":\"miter\",\"strokeUniform\":false,\"strokeMiterLimit\":4,\"scaleX\":1,\"scaleY\":1,\"angle\":0,\"flipX\":false,\"flipY\":false,\"opacity\":1,\"shadow\":null,\"visible\":true,\"fillRule\":\"nonzero\",\"paintFirst\":\"fill\",\"globalCompositeOperation\":\"source-over\",\"skewX\":0,\"skewY\":0}]}],\"background\":\"#ffffffff\"}","inputParameters":[{"id":"DRg4tLIlSqt4p3tNkAhfv","input":{"type":"string","value":{"content":{"blockID":"152455","name":"title","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"title"},{"id":"uVykcxoTM7A5ucOq3o56e","input":{"type":"string","value":{"content":{"blockID":"100001","name":"left_top","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"left_top"},{"id":"nnpdSNIMsKPJzUSB79B1v","input":{"type":"string","value":{"content":{"blockID":"100001","name":"right_top","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"right_top"},{"id":"O00ldPjWqMo5nSiV3P1CL","input":{"type":"string","value":{"content":{"blockID":"152899","name":"logo","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"logo"}],"settingOnError":{"processType":1,"retryTimes":0,"timeoutMs":60000}},"nodeMeta":{"description":"自定义画板排版，支持引用添加文本和图片","icon":"https://lf3-static.bytednsdoc.com/obj/eden-cn/dvsmryvd_avi_dvsm/ljhwZthlaukjlkulzlp/icon/icon_DrawingBoard_v2.jpg","mainColor":"#FF4DC3","subTitle":"画板","title":"画板"},"outputs":[{"assistType":2,"name":"data","type":"string"},{"name":"msg","type":"string"}]},"edges":null,"id":"764135","meta":{"position":{"x":-912.2475476152571,"y":-854.6701292994316}},"type":"23"}],"versions":{"batch":"v2","loop":"v2"}}}