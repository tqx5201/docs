{"type":"coze-workflow-clipboard-data","source":{"workflowId":"7531649846487760942","spaceId":"","host":"www.coze.cn","isDouyin":false,"flowMode":0},"json":{"edges":[{"sourceNodeID":"143093","sourcePortID":"","targetNodeID":"125800"},{"sourceNodeID":"125800","sourcePortID":"loop-output","targetNodeID":"118058"},{"sourceNodeID":"120475","sourcePortID":"true","targetNodeID":"188902"},{"sourceNodeID":"188902","sourcePortID":"","targetNodeID":"198201"},{"sourceNodeID":"118058","sourcePortID":"","targetNodeID":"120475"},{"sourceNodeID":"120475","sourcePortID":"false","targetNodeID":"137106"}],"nodes":[{"blocks":[{"blocks":[],"data":{"inputs":{"apiParam":[{"input":{"type":"string","value":{"content":"7506116067216048162","rawMeta":{"type":1},"type":"literal"}},"name":"apiID"},{"input":{"type":"string","value":{"content":"task_info","rawMeta":{"type":1},"type":"literal"}},"name":"apiName"},{"input":{"type":"string","value":{"content":"7506116067216015394","rawMeta":{"type":1},"type":"literal"}},"name":"pluginID"},{"input":{"type":"string","value":{"content":"即梦图生视频","rawMeta":{"type":1},"type":"literal"}},"name":"pluginName"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"pluginVersion"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"tips"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"outDocLink"}],"inputParameters":[{"input":{"type":"string","value":{"content":{"blockID":"125800","name":"input","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"task_id"}],"settingOnError":{"processType":1,"retryTimes":0,"timeoutMs":180000}},"nodeMeta":{"description":"获取任务信息","icon":"https://p26-flow-product-sign.byteimg.com/tos-cn-i-13w3uml6bg/61ccc88fdc44402e83a4dc7b0306af6a~tplv-13w3uml6bg-resize:128:128.image?rk3s=2e2596fd&x-expires=1750430658&x-signature=P5e5o6w0XkeGSyqr%2FgPjTke7A1s%3D","subtitle":"即梦图生视频:task_info","title":"task_info"},"outputs":[{"name":"msg","required":false,"type":"string"},{"name":"code","required":false,"type":"integer"},{"name":"data","required":false,"schema":[{"name":"first_image","required":false,"type":"string"},{"name":"prompt","required":false,"type":"string"},{"name":"status","required":false,"type":"integer"},{"name":"task_id","required":false,"type":"string"},{"name":"updated_at","required":false,"type":"string"},{"name":"video_url","required":false,"type":"string"},{"name":"created_at","required":false,"type":"string"}],"type":"object"}]},"edges":null,"id":"188268","meta":{"canvasPosition":{"x":0,"y":0},"defaultCollapsed":false,"position":{"x":0,"y":100}},"type":"4"},{"blocks":[],"data":{"inputs":{"apiParam":[{"input":{"type":"string","value":{"content":"7493093346114764852","rawMeta":{"type":1},"type":"literal"}},"name":"apiID"},{"input":{"type":"string","value":{"content":"zhipu_get_video","rawMeta":{"type":1},"type":"literal"}},"name":"apiName"},{"input":{"type":"string","value":{"content":"7493093346114732084","rawMeta":{"type":1},"type":"literal"}},"name":"pluginID"},{"input":{"type":"string","value":{"content":"智谱图生视频","rawMeta":{"type":1},"type":"literal"}},"name":"pluginName"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"pluginVersion"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"tips"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"outDocLink"}],"inputParameters":[{"input":{"type":"string","value":{"content":"fca642c4fdca4f3eb3cf25431bca5e3d.UwcSee946F7aWi31","rawMeta":{"type":1},"type":"literal"}},"name":"api_key"},{"input":{"type":"string","value":{"content":{"blockID":"125800","name":"input","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"task_id"}],"settingOnError":{"processType":1,"retryTimes":0,"timeoutMs":180000}},"nodeMeta":{"description":"对接智谱获取视频接口。获取视频请在等在生成任务之后1-2分钟之后再去查询。质量优先的视频请在3-5分钟后查询。","icon":"https://p3-flow-product-sign.byteimg.com/tos-cn-i-13w3uml6bg/0c5ee2850b8c4532b39d644d1af7e6da~tplv-13w3uml6bg-resize:128:128.image?rk3s=2e2596fd&x-expires=1751095558&x-signature=5Ca3hGNnmVa%2BKNTeXD93Dz7XTLI%3D","subtitle":"智谱图生视频:zhipu_get_video","title":"zhipu_get_video"},"outputs":[{"description":"任务状态","name":"status","required":true,"type":"string"},{"description":"视频url","name":"video_url","required":false,"type":"string"}]},"edges":null,"id":"117276","meta":{"canvasPosition":{"x":0,"y":0},"defaultCollapsed":false,"position":{"x":8.729775108616874,"y":280.2086304625277}},"type":"4"}],"data":{"inputs":{"inputParameters":[{"input":{"schema":{"type":"string"},"type":"list","value":{"content":{"blockID":"143093","name":"data.result.datas","source":"block-output"},"rawMeta":{"type":99},"type":"ref"}},"name":"input"}],"loopCount":{"type":"integer","value":{"content":"10","type":"literal"}},"loopType":"array","variableParameters":[]},"nodeMeta":{"description":"用于通过设定循环次数和逻辑，重复执行一系列任务","icon":"https://lf3-static.bytednsdoc.com/obj/eden-cn/dvsmryvd_avi_dvsm/ljhwZthlaukjlkulzlp/icon/icon-Loop-v2.jpg","mainColor":"#00B2B2","subTitle":"循环","title":"获取视频的状态"},"outputs":[{"input":{"schema":{"type":"integer"},"type":"list","value":{"content":{"blockID":"188268","name":"data.status","source":"block-output"},"rawMeta":{"type":2},"type":"ref"}},"name":"statusList"},{"input":{"schema":{"type":"string"},"type":"list","value":{"content":{"blockID":"188268","name":"data.video_url","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"videoUrlList"}]},"edges":[{"sourceNodeID":"125800","sourcePortID":"loop-function-inline-output","targetNodeID":"188268"},{"sourceNodeID":"188268","sourcePortID":"","targetNodeID":"125800","targetPortID":"loop-function-inline-input"}],"id":"125800","meta":{"canvasPosition":{"x":-238.27102616400595,"y":408.32358055801836},"defaultCollapsed":false,"position":{"x":-233.75204759726745,"y":105.04557061678258}},"type":"21","_temp":{"bounds":{"x":0,"y":0,"width":0,"height":0}}},{"blocks":[],"data":{"inputs":{"apiParam":[{"input":{"type":"string","value":{"content":"7494245680807084082","rawMeta":{"type":1},"type":"literal"}},"name":"apiID"},{"input":{"type":"string","value":{"content":"get_table","rawMeta":{"type":1},"type":"literal"}},"name":"apiName"},{"input":{"type":"string","value":{"content":"7494245680807051314","rawMeta":{"type":1},"type":"literal"}},"name":"pluginID"},{"input":{"type":"string","value":{"content":"超级多维表格","rawMeta":{"type":1},"type":"literal"}},"name":"pluginName"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"pluginVersion"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"tips"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"outDocLink"}],"inputParameters":[{"input":{"type":"string","value":{"content":{"blockID":"100001","name":"input","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"table_id"},{"input":{"type":"string","value":{"content":"VIDEO_ID","rawMeta":{"type":1},"type":"literal"}},"name":"name"}],"settingOnError":{"processType":1,"retryTimes":0,"timeoutMs":180000}},"nodeMeta":{"description":"获取表格数据。","icon":"https://p9-flow-product-sign.byteimg.com/tos-cn-i-13w3uml6bg/58988df7861f40bca7fcc630a927a451~tplv-13w3uml6bg-resize:128:128.image?rk3s=2e2596fd&x-expires=1751093441&x-signature=vsKMz7vwlGki4tzTBrweBkvsO%2Fk%3D","subtitle":"超级多维表格:get_table","title":"get_table"},"outputs":[{"name":"data","required":false,"schema":[{"name":"pagination","required":false,"schema":[{"name":"page","required":false,"type":"integer"},{"name":"page_size","required":false,"type":"integer"},{"name":"total_pages","required":false,"type":"integer"},{"name":"total_rows","required":false,"type":"integer"}],"type":"object"},{"name":"result","required":false,"schema":{"schema":[{"name":"datas","required":false,"schema":{"type":"string"},"type":"list"},{"name":"title","required":false,"type":"string"}],"type":"object"},"type":"list"},{"name":"table_name","required":false,"type":"string"},{"name":"web_url","required":false,"type":"string"}],"type":"object"},{"name":"success","required":false,"type":"boolean"}]},"edges":null,"id":"143093","meta":{"canvasPosition":{"x":0,"y":0},"defaultCollapsed":false,"position":{"x":-834.9374684835617,"y":118.04557061678258}},"type":"4","_temp":{"bounds":{"x":0,"y":0,"width":0,"height":0}}},{"blocks":[],"data":{"inputs":{"apiParam":[{"input":{"type":"string","value":{"content":"7494245680807100466","rawMeta":{"type":1},"type":"literal"}},"name":"apiID"},{"input":{"type":"string","value":{"content":"save_list","rawMeta":{"type":1},"type":"literal"}},"name":"apiName"},{"input":{"type":"string","value":{"content":"7494245680807051314","rawMeta":{"type":1},"type":"literal"}},"name":"pluginID"},{"input":{"type":"string","value":{"content":"超级多维表格","rawMeta":{"type":1},"type":"literal"}},"name":"pluginName"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"pluginVersion"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"tips"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"outDocLink"}],"inputParameters":[{"input":{"schema":{"type":"string"},"type":"list","value":{"content":{"blockID":"125800","name":"videoUrlList","source":"block-output"},"rawMeta":{"type":99},"type":"ref"}},"name":"datas"},{"input":{"type":"string","value":{"content":"视频地址","rawMeta":{"type":1},"type":"literal"}},"name":"name"},{"input":{"type":"string","value":{"content":{"blockID":"100001","name":"input","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"table_id"}],"settingOnError":{"processType":1,"retryTimes":0,"timeoutMs":180000}},"nodeMeta":{"description":"保存列表数据。","icon":"https://p26-flow-product-sign.byteimg.com/tos-cn-i-13w3uml6bg/58988df7861f40bca7fcc630a927a451~tplv-13w3uml6bg-resize:128:128.image?rk3s=2e2596fd&x-expires=1751261746&x-signature=F2LsvgvQ6b3SR27fQnJB13wG1xo%3D","subtitle":"超级多维表格:save_list","title":"保存视频地址"},"outputs":[{"name":"web_url","required":false,"type":"string"},{"name":"data","required":false,"schema":[{"name":"added_rows","required":false,"schema":{"type":"string"},"type":"list"},{"name":"message","required":false,"type":"string"},{"name":"table_id","required":false,"type":"string"},{"name":"total_rows","required":false,"type":"integer"},{"name":"updated_rows","required":false,"schema":{"type":"integer"},"type":"list"}],"type":"object"},{"name":"message","required":false,"type":"string"},{"name":"success","required":false,"type":"boolean"}]},"edges":null,"id":"188902","meta":{"canvasPosition":{"x":0,"y":0},"defaultCollapsed":false,"position":{"x":1300.6409323455396,"y":65.63545892336742}},"type":"4","_temp":{"bounds":{"x":0,"y":0,"width":0,"height":0}}},{"blocks":[],"data":{"inputs":{"code":"// 在这里，您可以通过 ‘params’  获取节点中的输入变量，并通过 'ret' 输出结果\n// 'params' 和 'ret' 已经被正确地注入到环境中\n// 下面是一个示例，获取节点输入中参数名为‘input’的值：\n// const input = params.input; \n// 下面是一个示例，输出一个包含多种数据类型的 'ret' 对象：\n// const ret = { \"name\": ‘小明’, \"hobbies\": [“看书”, “旅游”] };\n\nasync function main({ params }: Args): Promise<Output> {\n    // 即梦图生视频插件任务状态：7->成功,0->生成中,2->等待中\n    // 智谱图生视频插件任务状态：SUCCESS->成功,FAILED->失败,QUEUE->等待中\n    let normalStatus = ['7','0','2','SUCCESS','QUEUE']\n    let done = true;\n    let taskIsFail = false; \n    for(let i = 0;i< params.videoUrlList.length;i++){\n        let videoUrl = params.videoUrlList[i];\n        let videoStatus = params.statusList[i];\n        // 如果视频地址为空，则表示视频任务还未完成\n        if(videoUrl===''){\n            done = false;\n        }\n        // 如果当前视频任务状态不属于正常状态，则说明视频生成失败\n        if(normalStatus.indexOf(videoStatus)===-1){\n            taskIsFail  = true;\n            // 存在图生视频失败的情况，直接结束本次工作流\n            done = true;\n        }\n    }\n    // 构建输出对象\n    const ret = {\n        \"done\": done,\n        \"taskIsFail\": [taskIsFail]\n    };\n\n    return ret;\n}","functionID":"38wfwk8icdyxd","inputParameters":[{"input":{"schema":{"type":"string"},"type":"list","value":{"content":{"blockID":"125800","name":"videoUrlList","source":"block-output"},"dependencies":{"variables":null},"inputMode":"","rawMeta":{"type":99},"type":"ref"}},"left":{},"name":"videoUrlList","right":{}},{"input":{"schema":{"type":"string"},"type":"list","value":{"content":{"blockID":"125800","name":"statusList","source":"block-output"},"dependencies":{"variables":null},"inputMode":"","rawMeta":{"type":99},"type":"ref"}},"left":{},"name":"statusList","right":{}}],"language":5,"settingOnError":{"processType":1,"switch":false,"timeoutMs":60000}},"nodeMeta":{"description":"编写代码，处理输入变量来生成返回值","icon":"https://lf3-static.bytednsdoc.com/obj/eden-cn/dvsmryvd_avi_dvsm/ljhwZthlaukjlkulzlp/icon/icon-Code-v2.jpg","title":"检测视频任务状态"},"outputs":[{"input":{},"name":"done","required":false,"type":"boolean"},{"input":{},"name":"taskIsFail","required":false,"schema":{"type":"boolean"},"type":"list"}],"settings":null,"version":""},"edges":null,"id":"118058","meta":{"canvasPosition":{"x":0,"y":0},"defaultCollapsed":false,"position":{"x":330.07109792574823,"y":131.04557061678258}},"type":"5","_temp":{"bounds":{"x":0,"y":0,"width":0,"height":0}}},{"blocks":[],"data":{"inputs":{"branches":[{"condition":{"conditions":[{"left":{"input":{"type":"boolean","value":{"content":{"blockID":"118058","name":"done","source":"block-output"},"type":"ref"}}},"operator":11}],"logic":2}}]},"nodeMeta":{"description":"连接多个下游分支，若设定的条件成立则仅运行对应的分支，若均不成立则只运行“否则”分支","icon":"https://lf3-static.bytednsdoc.com/obj/eden-cn/dvsmryvd_avi_dvsm/ljhwZthlaukjlkulzlp/icon/icon-Condition-v2.jpg","mainColor":"#00B2B2","subTitle":"选择器","title":"选择器_1"}},"edges":null,"id":"120475","meta":{"canvasPosition":{"x":0,"y":0},"defaultCollapsed":false,"position":{"x":854.7364132840898,"y":202.96597754534628}},"type":"8","_temp":{"bounds":{"x":0,"y":0,"width":0,"height":0}}},{"blocks":[],"data":{"inputs":{"callTransferVoice":true,"chatHistoryWriting":"historyWrite","content":{"type":"string","value":{"content":"任务还未完成，等待下一次同步。。。。。。","type":"literal"}},"inputParameters":[],"streamingOutput":false},"nodeMeta":{"description":"节点从“消息”更名为“输出”，支持中间过程的消息输出，支持流式和非流式两种方式","icon":"https://lf3-static.bytednsdoc.com/obj/eden-cn/dvsmryvd_avi_dvsm/ljhwZthlaukjlkulzlp/icon/icon-Output-v2.jpg","mainColor":"#5C62FF","subTitle":"输出","title":"输出"}},"edges":null,"id":"137106","meta":{"canvasPosition":{"x":0,"y":0},"defaultCollapsed":false,"position":{"x":1367.6107894407041,"y":530.1740742605648}},"type":"13","_temp":{"bounds":{"x":0,"y":0,"width":0,"height":0}}},{"blocks":[],"data":{"inputs":{"apiParam":[{"input":{"type":"string","value":{"content":"7494245680807100466","rawMeta":{"type":1},"type":"literal"}},"name":"apiID"},{"input":{"type":"string","value":{"content":"save_list","rawMeta":{"type":1},"type":"literal"}},"name":"apiName"},{"input":{"type":"string","value":{"content":"7494245680807051314","rawMeta":{"type":1},"type":"literal"}},"name":"pluginID"},{"input":{"type":"string","value":{"content":"超级多维表格","rawMeta":{"type":1},"type":"literal"}},"name":"pluginName"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"pluginVersion"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"tips"},{"input":{"type":"string","value":{"content":"","rawMeta":{"type":1},"type":"literal"}},"name":"outDocLink"}],"inputParameters":[{"input":{"schema":{"type":"string"},"type":"list","value":{"content":{"blockID":"118058","name":"taskIsFail","source":"block-output"},"rawMeta":{"type":99},"type":"ref"}},"name":"datas"},{"input":{"type":"string","value":{"content":"I2V任务是否存在失败","rawMeta":{"type":1},"type":"literal"}},"name":"name"},{"input":{"type":"string","value":{"content":{"blockID":"100001","name":"input","source":"block-output"},"rawMeta":{"type":1},"type":"ref"}},"name":"table_id"}],"settingOnError":{"processType":1,"retryTimes":0,"timeoutMs":180000}},"nodeMeta":{"description":"保存列表数据。","icon":"https://p9-flow-product-sign.byteimg.com/tos-cn-i-13w3uml6bg/58988df7861f40bca7fcc630a927a451~tplv-13w3uml6bg-resize:128:128.image?rk3s=2e2596fd&x-expires=1751263581&x-signature=8e6sarMsyqetiurcL76Smh6%2F7ns%3D","subtitle":"超级多维表格:save_list","title":"视频任务是否存在失败"},"outputs":[{"name":"web_url","required":false,"type":"string"},{"name":"data","required":false,"schema":[{"name":"updated_rows","required":false,"schema":{"type":"integer"},"type":"list"},{"name":"added_rows","required":false,"schema":{"type":"string"},"type":"list"},{"name":"message","required":false,"type":"string"},{"name":"table_id","required":false,"type":"string"},{"name":"total_rows","required":false,"type":"integer"}],"type":"object"},{"name":"message","required":false,"type":"string"},{"name":"success","required":false,"type":"boolean"}]},"edges":null,"id":"198201","meta":{"canvasPosition":{"x":0,"y":0},"defaultCollapsed":false,"position":{"x":1779.9681810353554,"y":77.54591893959207}},"type":"4","_temp":{"bounds":{"x":0,"y":0,"width":0,"height":0}}},{"blocks":[],"data":{"inputs":{"note":"[{\"type\":\"paragraph\",\"children\":[{\"text\":\"保存视频地址和I2V任务是否存在失败\",\"type\":\"text\"}]},{\"type\":\"paragraph\",\"children\":[{\"text\":\"PS：I2V-》Image to Video\",\"type\":\"text\"}]},{\"type\":\"paragraph\",\"children\":[{\"text\":\"因为to和2（two）发音一致，所以这里缩写I2V\",\"type\":\"text\"}]}]","schemaType":"slate"},"size":{"height":150,"width":240}},"edges":null,"id":"109937","meta":{"canvasPosition":{"x":0,"y":0},"defaultCollapsed":false,"position":{"x":1667.6107894407041,"y":202.96597754534628}},"type":"31","_temp":{"bounds":{"x":0,"y":0,"width":0,"height":0}}}],"versions":{"loop":"v2"}}}